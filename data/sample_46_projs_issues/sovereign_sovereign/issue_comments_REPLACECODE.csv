issue_num,datetime,body,login,close_date
669,2017-03-23 19:03:58,,synchrone,
668,2017-03-21 12:40:24,"I was testing the git hosting role, and although the cgit website displayed neither the about page of a repository displayed any content nor was it possible to view the content of any file.

- The first problem originated because my readme file is README.md a markdown file. That dependency is not installed with pip.
- Second problem is that source files are parsed by the syntax highlighter. That script in cgit enforces the use of python3 but the pygments dependency is installed with the system pip which in debian jessy is still python2, thus pygments was not available for use in the python3 interpreter. I have added a Python3 pip and install pip3 dependencies for it

I was also thinking it might be good to update cgit version to current 1.1. That version even enforces python3 in the markdown converter. That would allow to remove the pip2 install dependency that I for the moment have left in the role. Also I don't know how to force the install step once the version has been updated.",Titan-C,
667,2017-03-17 11:36:36,"As mentioned in a previous approach, I've come up with a way to evolve Sovereign. I've put some ideas into a Wiki page:

https://github.com/alexec/sovereign/wiki/Sovereign-2

I'd be keen to see what people think? What problems do you encounter? What do you like? What would you want to see?",alexec,
667,2017-03-17 11:54:04,"

On 17.03.2017 12:36, Alex Collins wrote:
>
> As mentioned in a previous approach, I've come up with a way to evolve
> Sovereign. I've put some ideas into a Wiki page:
>
> https://github.com/alexec/sovereign/wiki/Sovereign-2
>
> I'd be keen to see what people think? What problems do you encounter?
> What do you like? What would you want to see?
>

If you have a large team that constantly and in a VERY fast pace tracks
security issues, maintaines, updates and rebuilds your local docker
packages,
this approach of using Docker might be fine.

Otherwise I'd consider it a security nightmare with a jungle of not
properly maintained docker images.

Build it straight from the Debian packages so that a simple ""apt-get
update; apt-get upgrade"" gives you the latest security fixes.

Cheers
  Mike


",neuffer,
667,2017-03-17 12:02:26,"Thanks. That's a really important comment about a critical issue. We don't want to sacrifice security. This isn't as straightforward in the Docker world as `apt-get update + upgrade`. I'll find out how my organisation does this currently. Also, I think think should be a requirement of the solution ""It must be a single bash command to get the latest security patches"".",alexec,
667,2017-03-17 19:12:30,"> Otherwise I'd consider it a security nightmare with a jungle of not properly maintained docker images.

A simple fix is to make official Sovereign Docker images that are vetted for security. It could be a part of the Sovereign value proposition that these Docker images are locked-down.",bsima,
667,2017-03-20 17:08:32,I really like this idea. How complicated is it to build your own docker images?,cstich,
667,2017-03-20 23:42:11,"Excellent work on all this! Here's my pie-in-the-sky wish list: 

- Add a [Samba domain controller](https://wiki.alpinelinux.org/wiki/Setting_up_a_samba-ad-dc) to the mix for unified auth and multi-user management. Should be pretty straightforward for all the apps that support LDAP. 
- Add [Leanote](https://github.com/leanote/leanote) to the mix.
- Replace RoundCube, Z-Push and the contacts/calendar portion of OwnCloud/NextCloud with [SoGO](https://sogo.nu/).
- Replace cgit/gitolite with [GoGit](https://gogs.io/).
- It seems a little redundant to have both MySQL and PostgreSQL installed. Can the architecture be consolidated down to one DB?",MrDrMcCoy,
667,2017-03-21 12:54:01,"I think using Docker images will make it much harder as those images need an individual update. Or in that case we are better of splitting sovereign into individual services and each service is the one that builds the docker image.
My biggest issue with sovereign is that it is not modular enough to configure which services I want to install in my server. I see that is the intention of using the docker images,(and in my ignorant opinion) I feel using the playbook with more modular roles is a simpler solution.",Titan-C,
667,2017-03-21 17:16:42,"> My biggest issue with sovereign is that it is not modular enough

This was what prevented me from using sovereign, since it has many interdependent parts (and also because it had many services I don't need, and I wanted to learn ansible/ configuration management in general).

I'm still following development here as I consider it high quality work and the commit log is very instructive; feel free to borrow ideas from my (personal, wouldn't yet recommend for production use) ansible based self-hosting solution at https://github.com/nodiscc/srv01 - it is not as feature complete as sovereign but I think it solves the modularity problem (roles are sometimes interconnected but it takes advantage of ansible's tagging system). Criticism and bug reports are also welcome.

I'm not very interested in Docker based containerization but I'd like to learn/work on seccomp/LXC/... based sandboxing in the future.

Best of luck with future work on sovereign",nodiscc,
667,2017-03-22 14:59:23,"@nodiscc Your self-hosting solution at https://github.com/nodiscc/srv01 is very intresting, thanks for sharing the link. I'am working on something compareable see https://github.com/return42/handsOn.

handsOn was created for german users, the description is in german: http://return42.github.io/handsOn

But I guess, with a little bash knowledge, reading the scripts https://github.com/return42/handsOn/tree/master/scripts and with a look at the templates https://github.com/return42/handsOn/tree/master/templates everyone will see how my setups are made.",return42,
667,2017-03-22 19:00:27,"@return42 with all respect I would not use your project _at all_; and I don't think it can actually be used to improve sovereign. Sovereign's only indesirable characteristic is interdependence of roles. Regarding handsOn

 * `cloc` reports 4000+ lines of Shell scripts...  ‡≤†_‡≤†
 * Improper quoting, improper use of comparison operators, `shellcheck scripts/*` reports hundreds of errors/warnings...
 * No idempotence at all
 * (Apparently?) tight coupling between components
 * No configuration hardening
 * No english documentation

This is just a list of few things you could improve (hint: you might be better off starting from scratch and using configuration management).

Re. sovereign 2: I would definitely use something based on/similar to [DebOps ansible playbooks](https://github.com/debops/debops-playbooks), which can *actually* be run separately, but with an added layer that eases configuration/customization (which Sovereign is actually good at, and was a great inspiration for my work - single config file). A docker-container approach is the complete opposite of this, and as others have said, would be a security/maintenance nightmare.",nodiscc,
667,2017-03-23 07:46:09,"@nodiscc: As I wrote, handsOn is for german audience. It focus on *productivity AND education*, describing the setups in detail to give the audiance a chance to admin in a different context. It's far from what sovereign is (no plug&play character). I gave the link to show how my service-setups are / if someone is intrested e.g to see how to place *this or that* service behind an apache instance (your speach: ""feel free to borrow ideas from my""). If there is nothing for you, leaf it.

Anyway, thanks for your hints. Good point, I have to lint my scripts ;) ...  BTW:
 
> ShellCheck does not attempt to figure out runtime or dynamic assignments like with `source` ...

.. one reason for the *hundreds* of errors :o",return42,
667,2017-03-23 13:09:58,"@return42 I understand; juste a note that if you use it for educational purposes - aside from a few ansible-specific tricks and basic config - I think ansible makes the whole setup much easier to understand than bash scripts - ie. you don't have to learn bash intricacies; along several other advantages. Not trying to detract from your work, it looks rather well done aside unavoidable problems when working with a large bash codebase, which ansible effectively abstracts away.

@alexec I have re-read your writeup and I think it brings some good points, can you give some details on the following:

* Requires a too much experience in Linux system administration to set-up and maintain. E.g. You need to know DKIM, DMARC, Postgresql, MySQL, Apache etc etc: How so? 
* Requires too much time to set-up: Been a while since I tried it. How much time does it take? What is the longest step and can it be automated?
* Requires too much time to maintain: Same question, what are required maintenance tasks? I've come up with a soltuion that only requires running an `upgrade` command periodically. How can this be automated?
* Does not work on Ubuntu (package version problems): WHile I understand it is tempting to support every distribution, I think focusing on a single (or 2) distributions is part of the project's value (I chose Debian stable)
* Needs manual configuration (OwnCloud is insecure by default): How so? Can you link to that particular proble/can it be automated?
* Configuration is not consistent: How can it be solved? The way I solved this is a single configuration file.
* Hard to choose what components to install: Yes. Roles probably need to be split up and reorganized
* Components are not isolated: Further sandboxing/isolating services through seccomp/LXC/SELinux could be done without requiring downloading a full docker container each time.
",nodiscc,
667,2017-03-25 09:56:50,"@alexec 

Ad owncloud/nextcloud: You need to set the permissions correctly after install and as far as I could tell right now sovereign is not doing that. [Install documentations](https://doc.owncloud.org/server/9.0/admin_manual/installation/installation_wizard.html)",cstich,
667,2017-03-25 10:54:15,@cstich Here are the tasks I use to harden Owncloud file permissions: https://github.com/nodiscc/srv01/blob/master/roles/webapp-owncloud/tasks/owncloud.yml#L140.,nodiscc,
667,2017-03-26 15:43:50,@nodiscc Oh nice. Thanks for pointing this out.,cstich,
667,2017-03-26 17:34:18,@alexec Awesome that you consider going for nginx as well! üéâ That would be another reason to reopen [the issue with the answer to life the universe and everything](https://github.com/sovereign/sovereign/issues/42). üòâ ,alexanderadam,
666,2017-03-16 13:51:34,"I encountered this bug on a fresh debian 8.0 image on linode.

https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=784608;msg=5

The steps in the bug report fixed it for me.

Also my output is still blank and the default highlighter can't find pygments, I haven't researched it enough to work out why, will update when I work it out",KnightHawk3,
665,2017-03-16 10:12:25,"
<S_CODE_TOKEN>",Brando753,
665,2017-03-20 16:52:26,Can you try creating the encfs manually and see what happens?,cstich,
664,2017-03-14 13:05:21,"I got this error when cron tried to run logrotate:

<S_CODE_TOKEN>`

I think the su line in `/etc/logrotate.d/selfoss` is for whatever reason failing. Does anybody have any ideas? ",cstich,
663,2017-03-10 11:11:11,"SMTP Postfix IMAP Dovecat server has invalid certificate:
![image](https://cloud.githubusercontent.com/assets/2272584/23793153/33481da8-058a-11e7-909e-e484fb89a333.png)
",zbigniewTomczak,
662,2017-03-06 01:46:20,I am just curious what the reason is the standard way to login into the main user after a fresh install is not via my public key?,cstich,
662,2017-03-08 18:18:13,I think that would be a great addition.,lukecyca,
661,2017-02-28 06:27:35,"Ever since the switch to using Rspamd (probably following #626), whenever I attempt to move messages either into the junk folder or wrongly flagged spam out of the junk folder I see this error or similar:

> The IMAP command ‚ÄúUID COPY‚Äù (to Junk) failed for the mailbox ‚ÄúINBOX‚Äù with server error: antispam signature not found.

I'm using Apple Mail on latest Sierra. I've poked around the logs but not sure where to find anything on the server that would help debug. Some searches online suggest a permission issue with the Rspamd binary but I'm not sure where to begin.

Apologies for the vagueness but not sure if this is a client or server issue. If anyone can give me pointers I'd be grateful. Or maybe this is a problem seen by others. Thanks.",iboxifoo,
661,2017-03-08 18:22:01,"FWIW I am also using Apple Mail on Sierra, with no issues when moving messages in/out of the junk folder.

I do get an error like that if, for example, I try to move a message from a different one of my accounts (say gmail) into the junk folder of my sovereign account.

To troubleshoot, you could connect to rspamd's web console and ensure that it is analyzing and creating signatures for the messages in question.",lukecyca,
661,2017-03-12 21:31:07,"I'm seeing this also, but I have not had time to find the root cause.",mikeashley,
660,2017-02-24 23:20:10,"Also more scriptable, in vein of alternative commands provided",JasonGhent,2017-03-02 23:40:05
660,2017-02-26 16:38:40,Maybe add a note about what the ``sed`` command does for those who might not be familiar with it?,ariddell,2017-03-02 23:40:05
660,2017-02-26 16:56:18,Sure. sed is used here to truncate the hash type from the beginning of the doveadm output.,JasonGhent,2017-03-02 23:40:05
660,2017-02-26 17:01:07,"Right, perhaps add such a note to the README.md? It's a good change. Thanks for this.",ariddell,2017-03-02 23:40:05
660,2017-02-27 14:59:28,Updated. üòÑ ,JasonGhent,2017-03-02 23:40:05
660,2017-03-02 23:36:03,Any additional feedback?,JasonGhent,2017-03-02 23:40:05
660,2017-03-02 23:40:03,Looks great! Thanks.,ariddell,2017-03-02 23:40:05
659,2017-02-21 19:07:58,"Hi all !
When installing Sovereign from scratch on a fresh Debian 8 VPS, I get a Composer error at this task : `TASK [webmail : Initialize composer]`

When running manually the associated command I get this error : 

<S_CODE_TOKEN>

Any idea ?

Thanks !",Peyphour,2017-03-12 21:38:42
659,2017-02-26 09:32:06,"Looks like [a bug](https://github.com/composer/composer/issues/6193) in  @composer which is a package manager for php

There needs to be a new stable release of composer, which can be tracked on their [download page](https://getcomposer.org/download/).

",sauravg,2017-03-12 21:38:42
659,2017-03-09 19:00:11,"2 things here.
I'm not a git ninja so my apologies for not putting this in a PR

I made the changes below and got a successful build. 

It looks to me that the problem is with Pear repositories.  I researched the current composer.json from roundcube (https://github.com/roundcube/roundcubemail/blob/master/composer.json-dist) has changed and now load the packages from packagist. 

Here is the updated code for var_www_roundcube_composer.json

{
    ""name"": ""roundcube/roundcubemail"",
    ""description"": ""The Roundcube Webmail suite"",
    ""license"": ""GPL-3.0+"",
    ""repositories"": [
        {
            ""type"": ""composer"",
            ""url"": ""https://plugins.roundcube.net/""
        },
        {
            ""type"": ""vcs"",
            ""url"": ""https://github.com/roundcube/Net_Sieve.git""
        },
        {
            ""type"": ""vcs"",
            ""url"": ""https://git.kolab.org/diffusion/PNL/php-net_ldap.git""
        }
    ],
    ""require"": {
        ""php"": "">=5.4.0"",
        ""pear/pear-core-minimal"": ""~1.10.1"",
        ""pear/net_socket"": ""~1.0.12"",
        ""pear/auth_sasl"": ""~1.1.0"",
        ""pear/net_idna2"": ""~0.2.0"",
        ""pear/mail_mime"": ""~1.10.0"",
        ""pear/net_smtp"": ""~1.7.1"",
        ""pear/net_ldap2"": ""~2.2.0"",
        ""pear/crypt_gpg"": ""~1.6.0"",
        ""roundcube/net_sieve"": ""~1.5.0"",
        ""roundcube/plugin-installer"": ""~0.1.6"",
        ""endroid/qrcode"": ""~1.6.5"",
        ""alexandregz/twofactor_gauthenticator"": ""dev-master"",
	""roundcube/carddav"": ""dev-master""
    },
    ""require-dev"": {
        ""phpunit/phpunit"": ""~5.7.15""
    },
    ""suggest"": {
        ""pear/net_ldap2"": ""~2.2.0 required for connecting to LDAP"",
        ""kolab/Net_LDAP3"": ""dev-master required for connecting to LDAP""
    }
}",johnniefox,2017-03-12 21:38:42
659,2017-03-09 20:24:31,"Hi, I got around this issue in a much simpler fashion :
I downloaded a prebuilt releasing from roundcube website.",Peyphour,2017-03-12 21:38:42
659,2017-03-12 21:35:44,"@johnniefox Thanks for posting your fix.

This is a duplicate of #604.  I'm going to close this one, but I'll update #604 pointing here for a possible fix.",mikeashley,2017-03-12 21:38:42
658,2017-02-20 12:26:30,"I noticed that after clearing all my cache and cookies and then I visit my domain say : `example.com` my browser will try to open the insecure `http://example.com` website. In this case I get the reply
<S_CODE_TOKEN>
The moment I try to go into `www.example.com` it will instantly refresh to the secure version of `https://example.com` and from then on the browser will always know to load the secure version of the website(until the next time I clear my cache) even if I just type `example.com`",Titan-C,2017-02-21 13:26:07
658,2017-02-21 13:26:07,duplicate of issue #524 ,neuhaus,2017-02-21 13:26:07
657,2017-02-11 22:35:07,,alexec,
656,2017-02-11 22:31:14,,alexec,
656,2017-02-12 16:36:44,"The URL parameter fails SSL verification checks, `wget` does not. This is a problem on both Ubuntu and Debian.",alexec,
656,2017-02-25 00:51:54,I haven't experienced the SSL verification issue on Trusty.,jplock,
655,2017-02-11 22:24:42,"Also invokes the update PHP file, rather that the HTTP endpoint (which is secured and therefore cannot be invoked this way).",alexec,
655,2017-02-12 00:07:22,Will this work in both ubuntu and debian?,jplock,
655,2017-02-12 16:36:10,Yes. This will work for both.,alexec,
655,2017-03-12 17:24:51,"This looks fine to me but I don't use Selfoss so can't really test. Can anyone else?

Also worth noting that PHP packages are installed from a variety of places. Not just here.

 - ./roles/mailserver/tasks/z-push.yml
 - ./roles/readlater/tasks/wallabag.yml
 - ./roles/webmail/tasks/roundcube.yml
",lukecyca,
655,2017-03-12 17:59:55,"I know it's a bit of change of direction for this project, but I'd  could be much easier to run and main docker builds.",alexec,
655,2017-03-12 18:08:10,"> I know it's a bit of change of direction for this project, but I'd could be much easier to run and main docker builds.

Certainly. If you're willing to lead that, I could create a new repo for you.",lukecyca,
655,2017-03-12 18:09:31,"Perhaps to start with, we could discus this on a new issue?",alexec,
654,2017-02-11 21:57:52,‚Ä¶does not work with Ubuntu 16,alexec,
653,2017-02-11 21:47:24,‚Ä¶he service starts,alexec,
652,2017-02-11 21:43:32,,alexec,
652,2017-02-12 00:06:10,Why would we want to do this?,jplock,
652,2017-02-12 16:35:47,"On Ubuntu 16.04, fail2ban would not start due to the jail names. They did not match the actual names of the jails in `/etc/fail2ban/filter.d`.",alexec,
652,2017-03-12 17:22:43,"I tested this PR on Debian 8.7 and it breaks, so I looked into it a bit...

The ""section name"" in the config file is not necessarily the filter name. If you look in `/etc/fail2ban/jail.conf`, there is a section called `ssh` which is configured to use the `sshd` filter, which it finds in `/etc/fail2ban/filter.d`.

Not sure what problem you hit with Ubuntu, @alexec. Perhaps you can let us know what your `/etc/fail2ban/jail.conf` looks like.
",lukecyca,
651,2017-02-11 21:39:18,"* Require `www` prefix for blog.
* Allow configuration of a 404 page.
",alexec,
650,2017-02-02 19:19:46,I was testing mosh and could not get it to work as my vps did not have the required local. This PR ensures en_US.UTF-8 is present.,Titan-C,2017-02-06 13:04:00
650,2017-02-02 19:42:08,What precisely didn't work?,ariddell,2017-02-06 13:04:00
650,2017-02-06 13:04:09,LGTM. Thanks for the pull request!,neuhaus,2017-02-06 13:04:00
649,2017-02-01 21:17:03,"Recent MySQL versions are more strict than before. A more recent version of OpenDMARC  (>1.3.1) is really needed. I.3.2 has not been released :(

https://sourceforge.net/p/opendmarc/tickets/193/",alexec,
649,2017-02-20 05:27:27,Just hit this myself.,tomschlick,
648,2017-02-01 20:53:20,"This should not be merged whole, only piecemeal (I've commented out `autoconfig` and various other roles). This works on a Digital Ocean Ubuntu server.

* Added feature flags to customise your set-up.
* Fixed `fail2ban` set-up
* Install python (as Ansible needs this)
* Added some mail troubleshooting
* Fixed OpenDKIM so it starts
* Fixed SelfOSS auto-update

Theres some problems with OpenDMARC cronjob (basically newer versions of MySQL are stricter).",alexec,2017-02-11 15:43:26
648,2017-02-02 17:40:50,"> Removed mosh (a bit of an unknown and could be another hole for hackers to poke around)
 
:( I love mosh! FWIW mosh just uses ssh, so it's presumably as secure as ssh. See the two security questions in the FAQ (ctrl+f ""security""): https://mosh.org/",bsima,2017-02-11 15:43:26
648,2017-02-06 15:20:06,@alexec is it possible to submit separate PR's for some of these items to make it easier to review and merge in pieces?  Some of this looks good.,jplock,2017-02-11 15:43:26
648,2017-02-11 15:43:20,"kk, I'll break this up and submit separately",alexec,2017-02-11 15:43:26
648,2017-02-11 16:08:52,Thanks!,jplock,2017-02-11 15:43:26
647,2017-01-31 06:58:23,"15-lda.conf says the settings apply to lmtp too however mail is not processed by sieve rules, this needs to be added so it works:

<S_CODE_TOKEN>

I've added this in a separate lmtp conf file and it works fine, also the firewall needs to open a port for managesieve, port 4190 which is not opened.",JGjorgji,
647,2017-01-31 14:56:20,If you manage sieve using the sieve plugin for Roundcube you don't need to open the port in the firewall so it makes sense to keep it that way as a secure default.,neuhaus,
647,2017-01-31 19:14:36,"That makes sense guess i was using thunderbird and didn't consider that. It would be useful to have this mentioned someplace in case someone wants to use it in this way too.

How about the filtering is it working for you by default?",JGjorgji,
647,2017-02-01 05:26:07,"

On 31.01.2017 20:14, Gjorgji Jankovski wrote:
>
> That makes sense guess i was using thunderbird and didn't consider
> that. It would be useful to have this mentioned someplace in case
> someone wants to use it in this way too.
>
>

Maybe this information could be added to the project wiki ?


",neuffer,
646,2017-01-26 15:13:51,"If the generated password for the Selfoss database contains a comma (`,`), it will be interpreted by F3 (the database wrapper used by Selfoss) as an array; thus failing the connection to the selfoss psSQL database.

I realize this is a bug with F3 (or maybe a feature of their ini parsing function), but to reduce sovereign user's potential head aches, commas should be forbidden from the password generated for Selfoss.

~~Also side note but I was unable to figure out how this password was generated and resorted to changing it manually as described in https://github.com/sovereign/sovereign/issues/643.~~

Oh it turns out the password located under `secret/` works, it didn't before because of the aforementioned error !

",pyrho,
646,2017-01-26 16:28:28,"I think I ran into this same problem. Shouldn't it be a ticket in selfoss though?

Alternatively, maybe you could just add quotes around the password(s) in the .ini file: https://github.com/sovereign/sovereign/blob/master/roles/news/templates/var_www_selfoss_config.ini.j2#L4-L6",bsima,
646,2017-01-26 19:38:43,"Agree this shouldn't have to be dealt with here.
I spent quite some time looking at the source code of selfoss and debugging PHP (which I never did) to find out what the issue was, if we could spare the trouble to future sovereign users it'd be a plus :)",pyrho,
645,2017-01-25 21:44:41,"When I run the ansible-playbook -i ./hosts site.yml I get a conneciton error.  I have generated the password hash both ways listed on the install instructions, and get a different hash result every time I run either command (is that normal?)

Either way, this is the result and I'm unable to proceed with the install.

[15:40][snapek@host][~/sovereign]$ ansible-playbook -i ./hosts site.yml

PLAY [all] *********************************************************************

TASK [setup] *******************************************************************
fatal: [sov.host.here]: UNREACHABLE! => {""changed"": false, ""msg"": ""Failed to connect to the host via ssh."", ""unreachable"": true}
 [WARNING]: Could not create retry file 'site.retry'.         [Errno 2] No such file or directory: ''


PLAY RECAP *********************************************************************
sov.host.here            : ok=0    changed=0    unreachable=1    failed=0
",snapek,
645,2017-01-25 22:20:56,"you are trying to ssh into the wrong domain: `sov.host.here`. You have
to put in you `hosts` file the domain or the IP of your server machine.

> I have generated the password hash both ways listed on the install
> instructions, and get a different hash result every time I run either
> command (is that normal?)

yes
",Titan-C,
645,2017-01-25 22:33:55,"Yeah, I tried both the hostname, the fqdn and the ip of the target machine all with the same results.  I just edited the example above to read sov.host.here for privacy purposes.",snapek,
645,2017-01-26 13:26:41,"I had similar problems, but it was my fault: In ran the playbook from the VPS where sovereign is running now. So i had to switch to the deploy user, create a ssh-key for the delpoy user and put the public key in the authorized_keys file before running the playbook. Just to be sure i didn't omit the `--ask-sudo-pass` argument. Just in case you're running the same setup :-)",der-gee,
644,2017-01-23 14:46:25,"This will still work, and will then allow you to support certain roles in your inventory:

~~~
[mailserver,owncloud]
mydomain
~~~",alexec,2017-02-01 20:32:36
644,2017-02-01 20:32:36,This can be achieved by modifying `site.yml`,alexec,2017-02-01 20:32:36
643,2017-01-22 09:18:03,I can't see anywhere in the documentation how to change your password. I think this is probably a key task?,alexec,
643,2017-01-23 14:30:21,Which password in particular? There are many...,neuhaus,
643,2017-01-23 14:41:07,All of them!,alexec,
643,2017-01-23 14:55:50,"There is nothing special about Sovereign regarding changing of passwords.
You should refer to the documentation of the particular software.
For UNIX accounts you can use the ""passwd"" command.

Regarding virtual mail passwords, we don't bundle a tool to administrate them at the moment.
Consider using something like [vea](https://github.com/neuhaus/vea/).

If you can contribute a pull request to improve the documentation in this regard, that would be delightful.",neuhaus,
643,2017-01-23 22:53:07,"I had issues with selfoss and wallabag and managed to edit both passwords via ssh:

**selfoss:**
- Visit https://news.yourdomain.tld/password and generate your hash.
- Afterwards set the `password` in `/var/www/selfoss/config.ini` to the generated hash.

**wallabag:** (instructions found [here](https://github.com/wallabag/wallabag/issues/1092#issuecomment-74593670), added some details)
- Look up your wallabag salt: `cat /var/www/wallabag/inc/poche/config.inc.php`
- Create a SHA1-hash from your password, login and the salt. You can use [this generator](http://www.sha1-online.com/). For instance, `passwordloginsalt` gives 1bbc43879ee7fb5c78c8dcefee1f9f31d0ffe4f2. I'll use these credentials in the insert statement below, make sure to use your own ^^ 
- Switch to the postgres user: `su postgres`
- Log into the wallabag db: `psql wallabag`
- With `\d` you'll get all tables. To quit the view type `q`
- My users table was clear, but look it up with: `SELECT * FROM users;`
- If empty, add your user with: INSERT INTO users VALUES (1,'login','1bbc43879ee7fb5c78c8dcefee1f9f31d0ffe4f2','login','your@mail.adress'); 
- Otherwise change the existing entry accordingly. Be sure to end your sql-statements with "";""
- You don't have to provide your mail adress.
- Type `\q` to quit psql

Hope this helps some guys having the same issues.

* This could also be helpful for issue #636 ",der-gee,
643,2017-01-24 06:17:28,"

On 23.01.2017 23:53, der-gee wrote:
>
> I had issues with selfoss and wallabag and managed to edit both
> passwords via ssh:
>
> *selfoss:*
>
>   * Visit https://news.yourdomain.tld/password and generate your hash.
>   * Afterwards set the |password| in |/var/www/selfoss/config.ini| to
>     the generated hash.
>
> *wallabag:* (instructions found here
> <https://github.com/wallabag/wallabag/issues/1092#issuecomment-74593670>,
> added some details)
>
>   * Look up your wallabag salt: |cat
>     /var/www/wallabag/inc/poche/config.inc.php|
>   * Create a SHA1-hash from your password, login and the salt. You can
>     use: this generator <http://www.sha1-online.com/>. For instance,
>     |passwordloginsalt| gives
>     1bbc43879ee7fb5c78c8dcefee1f9f31d0ffe4f2. I'll use these
>     credentials in the insert statement below, make sure to use your
>     own ^^
>   * Switch to the postgres user: |su postgres|
>   * Log into the wallabag db: |psql walabag|
>   * With |\d| you'll get all tables. To quit the view type |q|
>   * My users table was clear, but look it up with: |SELECT * FROM users;|
>   * If empty, add your user with: INSERT INTO users VALUES
>     (1,'login','1bbc43879ee7fb5c78c8dcefee1f9f31d0ffe4f2','login','your@mail.adress
>     <mailto:your@mail.adress>');
>   * Otherwise change the existing entry accordingly. Be sure to end
>     your sql-statements with "";""
>   * You don't have to provide your mail adress.
>   * Type |\q| to quit psql
>
> Hope this helps some guys having the same issues.
>

I think it would be a good idea to add this to the wiki. :-)


",neuffer,
643,2017-01-24 07:33:33,"What about a script you could run?
",alexec,
643,2017-01-24 13:04:13,"@neuffer I've created said [wiki page](https://github.com/sovereign/sovereign/wiki/Edit-Selfoss-and-Wallabag-credentials).
@alexec Maybe someone more experienced could provide one? I'm not seeing myself doing it, at least any time soon.",der-gee,
643,2017-02-01 21:19:51,"I think the Wiki page is perfect. 

I plan to change my passwords as part of my set-up (as I'm doing this for security and privacy reasons). I'll update this when I've got instructions.",alexec,
642,2017-01-22 08:53:21,"This is minor one for me (as I do not plan to use the components that require it), but my server does not have php5 available anymore. ",alexec,2017-01-23 14:45:53
642,2017-01-23 14:25:01,What OS (and version) do you use?,neuhaus,2017-01-23 14:45:53
642,2017-01-23 14:41:50,Ubuntu on Digital Ocean. Very recent version.,alexec,2017-01-23 14:45:53
642,2017-01-23 14:45:53,"Ubuntu 16.10 is not supported by Sovereign. We only support the [LTS versions of Ubuntu](https://wiki.ubuntu.com/LTS) (14.04 and 16.04 currently).
We will deal with this when we switch to Ubuntu 18.04 LTS or Debian 9.

However, if you can install the php7 packages offered by Ubuntu 16.10 (and Ubuntu 16.04) and tell us what breaks, we can start working on that. Please open a new bug for that. 

Thanks!",neuhaus,2017-01-23 14:45:53
641,2017-01-12 15:06:33,Correct command line,Peyphour,2017-01-12 19:15:48
640,2017-01-05 22:19:14,"Just installed sovereign straight from the readme on a minimal/barren debian vps. Found and solved a couple of minor issues which I'd like to share/feedback.  Is this the place? IRC seems rather quiet.

More importantly (for me) is how to start using it. In other words how to add accounts, domains etc and how to test things. I know this must be easy but can't find where to begin. Up until now I have been using a rather simple combo of cyrus and exim. So the sql and dovecot is a bit unfamiliar to me. Please point my nose in the right direction and apologies if this is the wrong ""channel"" to broach these topic(s).

",JayBeRayBearGun,2017-01-17 15:01:04
640,2017-01-12 15:21:49,I've been able to add accounts and domains directly into the database. Didn't find a cleaner way though,Peyphour,2017-01-17 15:01:04
640,2017-01-12 15:48:04,"

On 12.01.2017 16:21, Peyphour wrote:
>
> I've been able to add accounts and domains directly into the database.
> Didn't find a cleaner way though
>

You should try Postfixadmin

https://sourceforge.net/projects/postfixadmin/

It will take care of these problems.

Unfortunately it has not been integrated in sovereign yet.

Cheers
  Mike
",neuffer,2017-01-17 15:01:04
640,2017-01-12 15:50:02,"@neuffer 
Is it easy to install ?",Peyphour,2017-01-17 15:01:04
640,2017-01-12 16:03:42,"

On 12.01.2017 16:50, Peyphour wrote:
>
> @neuffer <https://github.com/neuffer>
> Is it easy to install ?
>
> ‚Äî
> You are receiving this because you were mentioned.
> Reply to this email directly, view it on GitHub
> <https://github.com/sovereign/sovereign/issues/640#issuecomment-272199024>,
> or mute the thread
> <https://github.com/notifications/unsubscribe-auth/AQFJn_Ym0CK9CgLmmHd2PLSbvS3viRQgks5rRkuxgaJpZM4LcMW4>.
>

No, but I have it running with a non sovereign install.


oskapt has build a role to install it with his sovereign branch.
https://github.com/oskapt/sovereign

Debian testing has a package for it that is pretty current.
The package in Debian stable is very very outdated.

Cheers
  Mike
 


",neuffer,2017-01-17 15:01:04
640,2017-01-13 11:31:02,"Thanks for the replies. Let me share a few ansible/installer bugs I encountered.

1) in sovereign/roles/common/tasks/encfs.yml

line 14: 
  shell: ls /encrypted/*

should be:
  shell: ls /encrypted/

2) in soveriegn/roles/news/defaults/main.yml:

line 9: 
  selfoss_version: 2.16

should be: 
  selfoss_version: '2.16'
",JayBeRayBearGun,2017-01-17 15:01:04
640,2017-01-14 13:38:51,"These sound like good changes. Would you like to create a pull request? If you have already made these changes a Github fork, making a pull request is typically very easy.",ariddell,2017-01-17 15:01:04
640,2017-01-14 21:10:17,@ariddell i better get acquainted with github a bit more then :) no clue at the moment,JayBeRayBearGun,2017-01-17 15:01:04
640,2017-01-14 22:09:39,">in sovereign/roles/common/tasks/encfs.yml
>line 14:
>shell: ls /encrypted/*
>
>should be:
>shell: ls /encrypted/

`ls` is being used to check if /encrypted/ is empty. If it is, then `ls /encrypted/*` gives the exit status 1, otherwise it exits 0. A side effect of this is that ansible complains...",sigmafeud,2017-01-17 15:01:04
640,2017-01-15 14:39:42,"
> More importantly (for me) is how to start using it. In other words how to add accounts, domains

I added email accounts directly in `group_vars/sovereign`. Just put one
or many more items under `mail_virtual_users`.
",Titan-C,2017-01-17 15:01:04
640,2017-01-15 16:30:40,"

On 15.01.2017 15:39, √ìscar N√°jera wrote:
>
> > More importantly (for me) is how to start using it. In other words
> how to add accounts, domains
>
> I added email accounts directly in `group_vars/sovereign`. Just put one
> or many more items under `mail_virtual_users`.

But this only works if you have a completely static setup and you plan
to never ever to add or remove users after your initial installation.

Cheers
  Mike
",neuffer,2017-01-17 15:01:04
640,2017-01-15 17:04:07,"> But this only works if you have a completely static setup and you plan
> to never ever to add or remove users after your initial installation.

I have changed the passwords with this method, and added new email
accounts which I did not have in mind in the beginning. But other than
that, yes is a static setup. I'm the single user, of all the few
accounts I configured. I have not yet thought about removing users, it
is not yet in my use case.
",Titan-C,2017-01-17 15:01:04
640,2017-01-15 21:39:04,"> how to add accounts, domains etc

The canonical way to add email domains/users is adjusting the variables in `group_vars/sovereign` and then re-running the playbook. You of course also have to follow the DNS instructions (in the README) for each domain to ensure MX, SPF and DKIM are set up.

Adding domains for other purposes requires some manual steps is just beyond the ""normal"" use case of Sovereign. For a website you would need to create a new Apache virtual host at the very least, and also maybe manually create a certificate through LetsEncrypt. Adding additional domains for other services (OwnCloud, etc.) is, uhh, you're on your own. :)

>But this only works if you have a completely static setup and you plan
to never ever to add or remove users after your initial installation.

This should not be the case. If you change the `mail_virtual_users` and related variables, it will correctly reflect those changes the next time you run the playbook. [import.sql](https://github.com/sovereign/sovereign/blob/master/roles/mailserver/templates/mailserver.sql.j2) will be re-templated with the new user information, and the `import sql postfix` handler will be triggered to run it on the server. That `sql` script first deletes the relevant tables and immediately re-creates them.

Deleting users will remove them from these database tables (and thus deactivate them) but it will not actually delete the mailboxes from disk.

",lukecyca,2017-01-17 15:01:04
640,2017-01-15 22:53:36,"

On 15.01.2017 22:39, Luke Cyca wrote:
>
>     how to add accounts, domains etc
>
> The canonical way to add email domains/users is adjusting the
> variables in |group_vars/sovereign| and then re-running the playbook.
> You of course also have to follow the DNS instructions (in the README)
> for each domain to ensure MX, SPF and DKIM are set up.
>
> Adding domains for other purposes requires some manual steps is just
> beyond the ""normal"" use case of Sovereign. For a website you would
> need to create a new Apache virtual host at the very least, and also
> maybe manually create a certificate through LetsEncrypt. Adding
> additional domains for other services (OwnCloud, etc.) is, uhh, you're
> on your own. :)
>
>     But this only works if you have a completely static setup and you plan
>     to never ever to add or remove users after your initial installation.
>
> This should not be the case. If you change the |mail_virtual_users|
> and related variables, it will correctly reflect those changes the
> next time you run the playbook. import.sql
> <https://github.com/sovereign/sovereign/blob/master/roles/mailserver/templates/mailserver.sql.j2>
> will be re-templated with the new user information, and the |import
> sql postfix| handler will be triggered to run it on the server. That
> |sql| script first deletes the relevant tables and immediately
> re-creates them.
>

And thus you will also reset/delete all the passwords (amongst other
things) that your users might have changed in the meantime. Not good.

Cheers
 Mike
",neuffer,2017-01-17 15:01:04
640,2017-01-17 15:01:03,OK! thanks so far for all this usefull feedback! ,JayBeRayBearGun,2017-01-17 15:01:04
640,2017-01-23 14:29:11,"I use [vea](https://github.com/neuhaus/vea) to add mail accounts and virtual domains.
Make sure to password protect the web pages if you want to use it.",neuhaus,2017-01-17 15:01:04
639,2016-12-31 22:08:44,"While trying to run ansible-play book I got this error:
<S_CODE_TOKEN>
",chuanhhoang,2017-01-12 19:16:12
639,2016-12-31 23:20:44,did you carefully read step 4 and replace that line?,TylerNakamura,2017-01-12 19:16:12
639,2017-01-02 09:08:06,"In fact, yes. The problem is at this line: 

6. Run the Ansible Playbooks
ansible-playbook -i --ask-sudo-pass ./hosts site.yml

The format is incorrect. Please update the README",chuanhhoang,2017-01-12 19:16:12
639,2017-01-05 22:41:53,I experienced the same plus a few other issues (which I fixed),JayBeRayBearGun,2017-01-12 19:16:12
639,2017-01-12 12:02:00,"Solution to this problem : 

> Run the Ansible Playbooks `ansible-playbook -i --ask-sudo-pass ./hosts site.yml`

Should be replaced with `ansible-playbook -i  ./hosts --ask-sudo-pass site.yml`",Peyphour,2017-01-12 19:16:12
639,2017-01-12 15:03:24,@Peyphour please submit a PR,morenoh149,2017-01-12 19:16:12
639,2017-01-12 19:16:12,Fixed.,ariddell,2017-01-12 19:16:12
638,2016-12-27 16:31:03,"When the common role restarts apache, the service fails to restart because apache is configured for threading with `mpm_event` but php is not.

<S_CODE_TOKEN>

I'm running Debian 8 on Digital Ocean. I don't see any configuration for proxy_fcgi or php-fpm in the playbook, so I assume this is just a difference in the Digital Ocean defaults? I replaced `mpm_event` with `mpm_prefork` and apache restarts.

<S_CODE_TOKEN>",adborden,
637,2016-12-20 17:27:02,"[Rspamd's greylisting module](https://rspamd.com/doc/modules/greylisting.html) is enabled by default in our configuration, so it is already performing greylisting. We previously used (and still use) Postgrey as well. I think this means we are currently greylisting _twice_.

We need to verify that Rspamd's greylisting is working as intended, and then remove Postgrey completely.",lukecyca,
637,2017-01-24 19:07:23,"I don't think that the rspamd greylisting module is active by default on Debian 8 (and therefore at the moment when using sovereign).
What i did to check:

- Disable postgrey by removing
`check_policy_service inet:127.0.0.1:10023,` from `roles/mailserver/templates/etc_postfix_main.cf.j2 => All mails arrived instantly, so apparantly no greylisting active
- Search for the textstring `greylist` `in /etc/rspamd/*` => No appropriate results.",Dosenpfand,
637,2017-01-24 19:27:08,"@Dosenpfand thanks for investigating. I would really like to see us move away from postgrey and then ensure that rspamd's greylisting is enabled and working.

If you want to do more work towards this or take a stab at a PR, I'll happily help test it on my own installation and help get it merged.",lukecyca,
637,2017-02-04 11:53:20,@lukecyca Unfortunately I will not have time to work on this in the foreseeable future. Additionally I kept disabled postgrey the last month and did not see any spam hitting my inbox.,Dosenpfand,
636,2016-12-12 01:23:40,"Hi,
I just finished setting up sovereign on Debian Jessie. Unfortunately, I am unable to log into RoundCube or wallabag, as I do not know what username or password was set. Using the value under secret/selfoss_password_hash, I am able to log into selfoss, but I get an immediate error. Is that the intended password?",swriddle,
635,2016-12-12 01:05:54,,hippich,2016-12-28 16:06:47
635,2016-12-14 14:48:01,"I won't be able to try this out until next week, but it looks good - thanks!",lukecyca,2016-12-28 16:06:47
635,2016-12-28 16:06:49,"I've been testing this by putting it in my personal `~/.dovecot.sieve` since I didn't want to roll out this change to the other mail users I have just yet.

Nevertheless this is working perfectly. Thank you, @hippich!",lukecyca,2016-12-28 16:06:47
634,2016-12-10 18:30:04,"It was unclear where do to the commands. Not everyone will know ansible should not be run from the server. Also, the ""optional"" passwordless option was not actually optional, given how this was written.",OKNoah,2016-12-14 14:40:44
634,2016-12-11 05:10:28,@lukecyca Fixed those typos.,OKNoah,2016-12-14 14:40:44
634,2016-12-12 12:45:02,"LGTM. I'd still like to drop entirely the explicit step where one must create a `deploy` user. It would make things simpler. If there's ever consensus on this, perhaps we could switch over.",ariddell,2016-12-14 14:40:44
634,2017-02-03 13:19:51,"Apparently I'm not the only one who thinks having the deploy user isn't necessary:

https://github.com/google/fury/blob/master/README.opinions.md#just-log-in-as-root-already

> ## Just log in as root already
> Excluding the case of using automation for specific types of service deployment, your configuration needs root@machine anyway. Stop pretending you don't, and don't litter your config mgmt system with the twelve different mechanisms for privilege escalation that people think they need. Just bite the bullet and let the config mgmt log in as root.
>Admittedly, this does exclude people who have valid reasons for restricting privilege escalation. But they're already dealing with headaches stemming from that anyway, so I'm just going to give them one more.",ariddell,2016-12-14 14:40:44
634,2017-02-03 18:17:11,@ariddell sounds good. Open a new issue or pull request for that!,lukecyca,2016-12-14 14:40:44
633,2016-12-10 16:44:57,"When I try deploy _without_ the optional password-less deploy user, it fails, saying a password was needed.",OKNoah,
633,2016-12-10 23:40:46,https://github.com/sovereign/sovereign/pull/634,OKNoah,
633,2016-12-12 12:46:37,This at least does seem like a bug. Was the user in question in the ``sudo`` group?,ariddell,
632,2016-12-09 15:15:12,"I'm stuff with a ""Could not resolve hostname"" problem. And I'm wondering why do I need to resolve a hostname if I'm just installing this on the remote server itself? Then from reading another comment, I think maybe I'm supposed to do all this on my local machine?",OKNoah,2016-12-09 15:41:41
632,2016-12-09 15:41:41,"Ansible is run on your local machine, and configures a remote machine. This allows you to target a brand new server with no dependencies beyond a default distro install.

It is also possible to run it ""from within"" the target server, and have it target localhost. However that is non-standard, somewhat advanced usage.

Please re-open if this doesn't make sense and you'd like further clarification. Cheers!",lukecyca,2016-12-09 15:41:41
632,2016-12-10 23:39:41,@lukecyca  https://github.com/sovereign/sovereign/pull/634,OKNoah,2016-12-09 15:41:41
631,2016-12-09 10:53:11,"Fresh install, generated the hash with passlib. I tried logging in with 'username' and 'username@domain', without luck. 

What I did:
- Hashed password with the python passlib code, copied from the tutorial, only replacing 'password' obviously.
- Copied it over to the group_vars/sovereign file, without putting it into double quotes, leaving a space before it, like this; password_hash: hashed_pass  

Questions:
- Do I insert the hashed pass with quotes in the config, or without?
- Do I login with user@domain or simply user? 
- Is it possible to create an user account after installation, without logging in to the admin account first? 
",hajzso,
631,2016-12-09 20:17:00,What error are you getting?,sigmafeud,
631,2016-12-12 14:08:36,"Wrong username/password. I'm certain I am screwing up something either with the password hash generation, or the config file.",hajzso,
631,2016-12-25 13:31:23,"I'm having the same issue, or making the same error. But I can't login for webmail. IMAP access works",Titan-C,
631,2016-12-25 13:40:44,"~~I don't seem to be able to create new users other than the `main_user_name`~~. It works, but only IMAP",Titan-C,
631,2016-12-26 11:29:04,"I solved this problem, although I don't really have a clear idea of what it was.. I did a reinstall on a fresh VPS and it worked. Some things I noticed:

First time I ran the playbooks, it kept hanging on random tasks, I had to restart it like 5 times until it could finish, and password didn't work. (So maybe if it hangs, and you restart it it scews with the password?)

Next I tried with the hash in double quotes, kept hanging again, and didn't work either;

For the third, successful install I turned off my VPN and started with a fresh VPS again, no double quotes around the hash, and it worked. Be sure to use the correct hashing method though, if you are on macOS it's the passlib one. I don't know if turning off the VPN was what kept it from hanging, but it ran smoothly the first time. If a task hangs on a task for more than 10 minutes, it's almost sure is an error of some kind, even the Diffie Hellman group didn't take more than 7 mins for me. (If you have a slow computer, leave it a bit more obviously) ",hajzso,
631,2016-12-26 19:28:44,"It is a mystery when and how sovereign works. I do get to ran the playbooks, my first biggest problem was my vps not having the fuse kernel module for encfs. But once that deactivated it runs well, nevertheless I experienced the problems in https://github.com/sovereign/sovereign/issues/601#issuecomment-255566608 and with a clean installation dropping as many services as possible to the bare minimun(for me IMAP without autoconfig and webmail, and then owncloud) it works. But if I ran all at once they don't work.",Titan-C,
630,2016-12-08 01:41:44,"This pull is meant to address issues [624](https://github.com/sovereign/sovereign/issues/624) and [629](https://github.com/sovereign/sovereign/issues/629). List variables should be referenced in the form `with_items: ""{{ somelist }}""`, according the [ansible docs](https://docs.ansible.com/ansible/playbooks_loops.html).",sigmafeud,2016-12-08 02:38:59
630,2016-12-08 02:38:55,Thanks!,jplock,2016-12-08 02:38:59
629,2016-12-06 16:18:19,"See gist here for log: https://gist.github.com/cromulus/2b9226743fd2fb4acd5403b47ab3cf3d

Looks like znc is causing problems.",cromulus,2016-12-08 02:39:27
629,2016-12-06 16:36:15,"Removing ircbouncer from sites.yml results in this error:
<S_CODE_TOKEN>

re-running `vagrant provision` results in:
<S_CODE_TOKEN>
removing vpn from site.yml and trying again...",cromulus,2016-12-08 02:39:27
629,2016-12-06 22:49:29,"Seems like openvpn_clients and friends are being interpreted as strings, not lists in roles/vpn/tasks/openvpn.yml and in roles/vpn/templates/client.cnf.j2. The diffs in [my fork](https://github.com/sigmafeud/sovereign.git) get me past this error.",sigmafeud,2016-12-08 02:39:27
629,2016-12-07 10:27:11,"Good, can you please make a pull request with your changes?",neuhaus,2016-12-08 02:39:27
628,2016-12-05 23:12:59,"Just checked out master and ran vagrant up, and it failed with this error:
<S_CODE_TOKEN>

retrying vagrant provision results in:

<S_CODE_TOKEN>",cromulus,2016-12-06 10:34:08
628,2016-12-05 23:29:17,see [#624](https://github.com/sovereign/sovereign/issues/624),sigmafeud,2016-12-06 10:34:08
627,2016-12-05 23:03:56,"Perhaps we should generate the roundcube des_key here:
/roles/webmail/templates/var_www_roundcube_config_config.inc.j2:77

Leaving it as the default is insecure, according to [roundcube's docs](https://github.com/roundcube/roundcubemail/wiki/Configuration).",cromulus,
627,2016-12-07 10:29:36,"Good find, thanks. Can you provide a pull request with a fix?",neuhaus,
627,2016-12-07 10:39:40,The key is used to store the user's IMAP password temporarily in the session database. So changing it should only affect active sessions.,neuhaus,
626,2016-12-05 17:44:59,"[Part 1](https://kaworu.ch/blog/2014/03/25/dovecot-antispam-with-rspamd/) of this tutorial was implemented in #617, but [Part 2](https://kaworu.ch/blog/2015/10/12/dovecot-antispam-with-rspamd-part2/) still needs to be implemented to have a fully-functional anti-spam system.",lukecyca,2016-12-28 16:09:56
626,2016-12-28 16:09:56,"Part 2 has been merged in #635. We now have a fully-functional anti-spam system again!

Some minor issues still remain:

* #625 
* #637 ",lukecyca,2016-12-28 16:09:56
625,2016-12-05 17:42:14,"I noticed while reviewing #617 that we are using rspamd's default password of q1 instead of [setting one](https://rspamd.com/doc/quickstart.html#setting-the-controller-password). This port isn't exposed to the Internet, so it's not an emergency. The rspamd docs suggest this is only required from ""non-trusted IPs"" so maybe we can just disable this?",lukecyca,
624,2016-12-03 23:59:00,"On Debian 8.6 x64 DigitalOcean droplet.

I get the following error when attempting to setup prosody (sames happens to item.name, but I hard-coded it for testing):

<S_CODE_TOKEN>

Tried commenting out the prosody_accounts in roles/xmpp/defaults/main.yml.

Contents of relevant portion of group_vars/soverign:
<S_CODE_TOKEN>
I believe the prosody_admin and prosody_virtual_domain are defined when the prosody tasks are ran (or at least there were no errors there). So I don't think I am messing up the host scope.",cacciatc,2016-12-08 02:39:14
624,2016-12-05 22:24:40,"I think this is a bug in sovereign/roles/xmpp/tasks/prosody.yml, line 31.
`with_items: prosody_accounts`
should be 
`with_items: ""{{ prosody_accounts }}""`
but I'm totally new to ansible/yaml so don't take my word for it.",sigmafeud,2016-12-08 02:39:14
624,2016-12-06 16:44:59,@sigmafeud: Nope. still fails.,cromulus,2016-12-08 02:39:14
623,2016-12-03 07:58:17,"Hi,

I have installed the wallabag playbook using the default steps and getting to the  read.domain.tld shows me that the installation is complete with a success page.

![screenshot from 2016-12-03 12 26 06](https://cloud.githubusercontent.com/assets/1630265/20857480/0732d35c-b954-11e6-975e-593df13ddd86.png)

Clicking on ""Click here to finish update"" link keeps on sending me to the same page unless I change the owner of `/var/www/wallabag` to `www-data`.

Then clicking on the link to finish installation sends me to wallabag login page. Alas! I have no idea what credentials to use.

In some other articles on the internet (I read it but have not been able to find it again), I am supposed to get the option of entering database details and creating a new user. 

The page that I have shared a screenshot of contains the entire user-details form as hidden. If I unhide it (using firebug/chrome inspector and removing `display: hidden` css), I am able to enter details of database and a new user
![screenshot from 2016-12-03 13 04 27](https://cloud.githubusercontent.com/assets/1630265/20857681/c5bda676-b959-11e6-845c-211eb7bd25a1.png)

Submitting still don't work as I am told that `inc/pocho/config.inc.php` cannot be created. So I have to delete `/var/www/wallabag/inc/pocho/config.inc.php` and submit again and I am stated that the user is created and I can go in!

I hope someone else might find these steps helpful.",tushartyagi,2016-12-03 08:04:37
623,2016-12-03 08:04:37,Closing it as I was able to get it work.,tushartyagi,2016-12-03 08:04:37
622,2016-12-01 07:41:43,"I have followed the installation guide as [here](https://github.com/sovereign/sovereign/wiki/Setting-up-on-DigitalOcean-with-Debian-7-(INCOMPLETE)) and official readme.md.

The installation went without any errors and I am able to access the `TLD` and `www`, `mail` subdomains. But if try to access `news`, `read`, `autoconfig`, and `cloud` subdomains, I am getting an invalid certificate error that the certificate is issued for TLD and is not for these 3 subdomain(s) -- although I am able to move forward to the actual apps.

Is Let's Encrypt only configured for the `www` and `mail` subdomains? Is there anything that I am missing? ",tushartyagi,
622,2016-12-04 04:18:41,"Only a single certificate is generated, and it will have a CN of your main domainname (example.com). It will have SANs (Subject Alternative Name) for all the subdomains for each service (news.example.com, etc.).

See ""Can I get a certificate for multiple domain names (SAN certificates)?"" in the [Let's Encrypt FAQ](https://community.letsencrypt.org/t/frequently-asked-questions-faq/26).

Investigate your certificate details in a browser and make sure all of the SAN entries are there and are correct. These are generated within `roles/common/files/letsencrypt-gencert`.",lukecyca,
621,2016-11-21 13:05:31,"MySQL is not being dumped in  `sovereign/roles/tarsnap/files/tarsnap.sh`, so this database does not get backed up at the moment.

Thanks to @cimm for bringing this to our attention in his PR #615 ",neuhaus,
621,2016-11-25 11:59:27,"There are several ways to backup MySQL databases and it's always a compromise between availability and complexity since there is no integrated support for hot backups like PostgreSQL has. I'd figure these solutions to be somewhat feasible for sovereign:

* `mysqldump` and `FLUSH TABLES WITH READ LOCK` -- Cold backup wich blocks write access during dump . For smaller databases this is probably negligible, especially if backups are run at times with low demand. This gets bad where availablity is a concern and/or databases are quite large (and dumps take quite some time rendering the server immutable).
* Percona's `xtrabackup` -- Hot backup without hassle, but works only with `InnoDB` engine. This is a simple solution with minor restrictions, but InnoDB is superior to MyISAM in many aspects anyway.
* `mysqldump` with master-slave replication -- Hot backup, with slave replication stopped for dump. While setup is actually not quite complicated it still adds additional complexity and requires more resources for the additional slave server, thus getting out of the scope of sovereign.

I'd prefer to use `xtrabackup` if it's possible to go without MyISAM databases. I haven't done this myself (rather have setup a replication backup) but sources (e.g. https://vitobotta.com/painless-hot-backups-mysql-live-databases-percona-xtrabackup/) tell, it works well and is quite easy to setup.",straight-shoota,
621,2016-11-25 12:07:12,Isn't a normal mysqldump at night perfectly acceptable for our target audience?,neuhaus,
621,2016-11-26 22:42:16,"Probably, yes. Just wanted to let you know, since I have digged into this recently. Although I'd at least think about xtrabackup: Even if you could live with a small downtime while running a backup dump, it's still nice if you don't need to.",straight-shoota,
620,2016-11-20 22:45:55,"Just noticed that owncloud playbook does not enables itself as apache virtual host. This is a bit surprising because roundcube and selfoss activates themselves just fine. This PR fixes it.

`roles/webmail/tasks/roundcube.yml` was used as inspiration for this PR.",nfedyashev,2016-11-20 22:54:52
620,2016-11-21 12:54:55,Thanks!,neuhaus,2016-11-20 22:54:52
619,2016-11-20 22:22:21,"[Changelog](https://github.com/SSilence/selfoss/releases)

I'm running php7 so without this update selfoss 2.15 is basically unusable.
As a bonus it has other features and bug fixes.",nfedyashev,2016-11-20 22:44:10
619,2016-11-20 22:44:06,"Thanks!
",jplock,2016-11-20 22:44:10
618,2016-11-17 09:51:15,"without this change it fails on ansible(2.2.0.0) with the following message:

    TASK [mailserver : Generate OpenDKIM keys] *************************************
    fatal: [sovereign.host]: FAILED! => {""failed"": true, ""msg"": ""the field 'args' has an invalid value, which appears to include a variable that is undefined. The error was: 'unicode object' has no attribute 'name'\n\nThe error appears to have been in '/Users/nfedyashev/Projects/sovereign/roles/mailserver/tasks/opendkim.yml': line 19, column 3, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n\n- name: Generate OpenDKIM keys\n  ^ here\n""}",nfedyashev,2016-11-17 12:08:09
618,2016-11-17 09:52:16,"I'm not an expert in ansible but that update allowed me to continue running this playbook
",nfedyashev,2016-11-17 12:08:09
618,2016-11-17 12:08:01,"There are a few other places in the roles where we need to fix this too. Thanks!
",jplock,2016-11-17 12:08:09
617,2016-11-06 15:18:32,‚Ä¶never message is moved from inbox to spam,hippich,2016-12-05 17:40:13
617,2016-11-06 15:58:48,"This is related to #611 
",hippich,2016-12-05 17:40:13
617,2016-12-04 05:11:44,"This looks great. Thanks!

I am now running this patch on my personal server. I then moved a bunch of spams into the Junk folder and I hope that rspamd is using that to build it's database. Do you know how to check? I was able to bring up the Rspamd web UI, but even that couldn't tell me.

We still don't actually do anything special with identified spam, right? We need to implement [part 2](https://kaworu.ch/blog/2015/10/12/dovecot-antispam-with-rspamd-part2/) as well. Correct?

Also it seems we are using rspamd's default password of `q1` instead of [setting one](https://rspamd.com/doc/quickstart.html#setting-the-controller-password). This port isn't exposed to the Internet, so it's not an emergency. The rspamd docs suggest this is only required from ""non-trusted IPs"" so maybe we can just disable this?",lukecyca,2016-12-05 17:40:13
617,2016-12-05 15:04:52,"Yeah, i did the same and also noticed no spam appears in the junk folder. and ""part 2"" is indeed probably what is missing.

as for password part - not sure.. probably deserve its own ticket and PR.",hippich,2016-12-05 17:40:13
616,2016-11-04 22:45:46,"Newer versions of Ansible complain when using bare variables like `mail_virtual_users` and prefer the newer `'{{ mail_virtual_users }}'` syntax:

<img width=""994"" alt=""depreciation"" src=""https://cloud.githubusercontent.com/assets/68112/20024752/c65d958c-a2e8-11e6-87ea-88371b820c5b.png"">

This commit fixes two of those old style bare variables: the `mail_virtual_domains` and `mail_virtual_users` one. There might be more but I did not run the full playbook.

Seen in Ansible version 2.1.2.0.",cimm,2016-11-05 13:29:26
616,2016-11-05 13:29:23,"I've seen this too. Thanks!
",ariddell,2016-11-05 13:29:26
615,2016-11-04 22:16:45,"A simple role to install the [Ba√Økal](http://baikal-server.com) CalDAV (calendars) and CardDAV (contacts) server via Sovereign.

The server runs on `dav.example.com` and the connection is encrypted  thanks to the Let's Encrypt support Sovereign already provides.

### Why

I don't need a full fledged ownCloud installation. I've heard good things about it but I simply don't need file sharing, a web UI for my calendars, sharing, photo galleries, etc. You might, and that's fine, but for me it only adds complexity (and possibly, maybe, a larger attack surface). I only need a something that syncs my contacts and calendars between my phone and laptop. That's all.

### Alternatives

There are a few other CardDAV and CalDAV solutions out there. I personally tried [Radicale](http://radicale.org/) and Ba√Økal but there are [plenty](https://en.wikipedia.org/wiki/Comparison_of_CalDAV_and_CardDAV_implementations) of other options out there. There is even a Radicale Sovereign role, currently being discussed in pull request #462.

Why not go for Radicale? I tried. I tried again this week but ran an older version a while back and it doesn't fit my bill. I like it, it's closer to the unix philosophy as Ba√Økal but development doesn't feel as active and there have been issues when using macOS software (Contacts and Calendar). Not saying it's a bad solution, it just didn't work for me.

### Open issues

- [ ] Depends on MySQL

This role currently depends on MySQL and it's my understanding Sovereign is moving to PostgreSQL. Ba√Økal only supports MySQL and SQLite. What should I do: keep MySQL or do I use SQLite?

- [ ] Tests

There are currently no tests for this role. I did not yet take the time to learn how to test an Ansible role and will add tests if the there is intertest in a Ba√Økal role.

- [ ] How do we include options?

I currently added the Ba√Økal role to the `site.yml` config. This is not a good idea as you probably don't want to run ownCloud _and_ Ba√Økal. How do we show there is an alternative without adding it to the `site.yml` config? Add it as a comment at the end or is there a better way?

- [ ] GUI configuration

Once installed Ba√Økal needs to be configured via a web UI. Once done the web UI can be disabled but you need it the first time. This bothers me as it means the role is not fully automated: you need to configure it manually, a config file would have been better. Is this simply a matter of explaining the process in the README or can we do better?

- [ ] No backups

I don't think we update MySQL databases at the moment (might be mistaken) which means your data is not backed up when using this role. Will add this when I add PostgreSQL support.

### Feedback

Feedback welcome: is this something Sovereign can use or should we just focus on the ownCloud integration and not spend time supporting alternative options?
",cimm,
615,2016-11-21 13:02:17,"Have you tried using SQLite instead of MySQL? Is the performance good enough?

Regarding site.yml, I think you should add it but comment it out and add a comment there (or explain it in the relevant section of the README).

GUI configuration: What is being done there? Can we automate it?

No MySQL backup: You're right. That's a bug. I'll open a new issue.",neuhaus,
615,2016-12-05 22:40:45,"If we remove owncloud, could I suggest [seafile](https://www.seafile.com) as a file sharing alternative? My strong preference is to choose projects that do one thing and do that one thing well..",cromulus,
615,2016-12-06 07:49:49,"I don't see a reason to remove owncloud. We're just offering more than one alternative. Perhaps it's a mistake not to focus, time will tell",neuhaus,
615,2016-12-12 12:51:19,"@cromulus I agree with you that owncloud does too much. The broader issue is that sovereign (or rather an ansible playbook + roles) is monolithic and it's hard to do anything except remove roles. It's not easy to provide a set of alternatives to choose from or to allow third-party ""plugin"" roles. Ansible doesn't seem to be the best tool in such a situation though.",ariddell,
615,2016-12-12 13:00:12,"One reason to use alternatives to Owncloud could be performance and resource requirements. Owncloud 9.1 recommends 512MB of memory (the minimum is 128MB).
If you run sovereign on a constrained device like a Raspberry Pi you want to have very lean services to get acceptable performance. On the other hand if you have more resources you may like the extra features that Owncloud offers.",neuhaus,
615,2016-12-12 14:27:42,I'd prefer to stick with owncloud as I find their desktop and mobile apps to be of decent quality.,jplock,
615,2016-12-12 18:35:00,"@ariddell Hmm... yes. My hunch is that the right long term move for personal mail, cardav, caldav, filesync, etc. etc. is to setup a docker ecosystem that revolves around an ldap/auth service, announces services (etcd, consul, docker service links, ...), and potentially utilizes a shared filesystem (local host filesystem volume, ceph, nfs, torus, glusterfs ... )

Each component would be responsible for it's own upgrade path, installation, etc. Could be run either on a single host, ala dokku, or across a kubernetes cluster.

That's mighty different from the current sovereign architecture and I think would require a totally separate project.",cromulus,
615,2016-12-12 18:46:22,"@cromulus I agree with you in general terms. One thing to try to hang onto is the accumulated knowledge embedded in sovereign (and similar projects using ansible like debops and streisand). (Maybe @drybjed knows about new projects that fit your description?)

I'd certainly be interested in learning about projects attempting a fully modular approach. I think other users of sovereign would be interested too. If there's a mature project I think we could certainly mention it in a ""See Also"" section of the README.
",ariddell,
615,2016-12-12 18:47:38,"Back on topic, perhaps we could add a section to the README listing mature alternatives to the roles that are currently supported in sovereign. For example, Ba√Økal could be mentioned as a replacement for (a part of) owncloud. Seafile and Syncthing could also be mentioned. What do you think about this @cimm?",ariddell,
614,2016-11-01 18:26:31,,joewildish,2016-11-01 18:27:38
613,2016-10-30 22:15:07,"Hi,
I had a trouble with installation.
![selection_069](https://cloud.githubusercontent.com/assets/2339101/19840450/d1dd7b68-9efe-11e6-8b0e-0fa3b3077042.png)

It appeared, that postgresql needed correct locale to be exported. This is very simple and naive fix. However, it works.
",akovalyov,
613,2016-12-05 17:51:34,Can this be broken out into separate task statements?,jplock,
613,2016-12-05 18:01:23,"I see we have a well-hidden wiki page about this from when it came up in #149
https://github.com/sovereign/sovereign/wiki/Troubleshooting

Indeed it would be better to handle it from within ansible, or otherwise make it more user-friendly.  However I have some concerns with this patch:
- forces `en_US.UTF-8` whereas some users may not be english-speaking 'mericans.
- writes out `/etc/default/locale` directly. Should it use `dpkg-reconfigure locales`?
- my reading of this shell script is that it will append two more lines onto `/etc/default/locale` every time the playbook is run!",lukecyca,
612,2016-10-30 19:28:29,"Nowadays passwords are not set by the user anymore in the `group_vars/sovereign` file but created by ansible and saved in the `secret` folder.
",Titan-C,2016-10-31 23:03:54
611,2016-10-30 14:56:01,"From my understanding sovereign moved away from dspam to rspamd. I manually removed plugin configuration from dovecot and apt-get remove dspamd itsef (had it there since debian wheezy) - Otherwise I would get errors moving messages to the Junk folder.

Now files move to spam folder just fine but I see nothing there to actually tell rspamd to look into junk folders to learn about spam.. Any pointers to how I can see if it operates normally?
",hippich,2016-12-05 17:45:11
611,2016-11-05 00:00:51,"Use the dovecot antispam plugin to pass SPAM and HAM over to rspamc

https://kaworu.ch/blog/2014/03/25/dovecot-antispam-with-rspamd/
",SavageCore,2016-12-05 17:45:11
611,2016-11-05 04:49:28,"So i checked - it appears that dovecot_antispam plugin is installed after sovereign is run, but plugin configuration is not. Is this is simply missed part or it was omitted on purpose?
",hippich,2016-12-05 17:45:11
611,2016-11-05 12:29:24,"I'm not sure, I haven't actually deployed with sovereign yet. Config is easy enough and someone should make a PR!
",SavageCore,2016-12-05 17:45:11
611,2016-12-05 17:45:11,Fixed with #617. Note that detected spam still won't be automatically moved or deleted. That requires #626.,lukecyca,2016-12-05 17:45:11
610,2016-10-30 05:13:32,"In few instances I had situation where certain files were removed from wallabag installation (probably by wallabag itself, or by sovereign) which resulted in process breaking due git refusing to pull updates into repo with uncommited changes. Force=yes should get around it.
",hippich,2016-10-30 21:06:31
610,2016-10-30 10:00:01,"PR #598 also forces the pull.  @hippich Are you interested in using that PR?  It would be nice to get some testing on it before we integrate.
",mikeashley,2016-10-30 21:06:31
610,2016-10-30 21:06:31,"Yeah, #598 definitely sounds like a better option. Closing this one. Thanks for pointing out it to me!
",hippich,2016-10-30 21:06:31
609,2016-10-30 05:11:04,,hippich,2016-10-30 14:23:51
609,2016-10-30 09:39:52,"Thanks.  Did this fix a specific problem for you?
",mikeashley,2016-10-30 14:23:51
609,2016-10-30 15:09:16,"Yeah, sorry, I forgot to describe issue I had - in my case /decrypted/roundcube/sqlite.db was missing (not sure why) and roundcube was trying to create it on a first open, but failing due permissions. And with group set to www-data it successfully creates default sqlite.db DB and let me log in.
",hippich,2016-10-30 14:23:51
608,2016-10-29 18:08:44,"I wanted to debug why I don't get my vps to work. I have problems as listed in https://github.com/sovereign/sovereign/issues/601#issuecomment-255566608

I followed the wiki for development but it could not find the image. This little fix does the job
",Titan-C,2016-10-30 14:30:17
608,2016-10-30 09:55:50,"Thanks for this.  I tried the patch on my machine, and I was not able to download the image.  Browsing at hashicorp, though, it does look correct.  Is a hashicorp login needed now to download these boxes?
",mikeashley,2016-10-30 14:30:17
608,2016-10-30 12:11:55,"I did not need any login. After changing the image name it worked for me.
",Titan-C,2016-10-30 14:30:17
608,2016-10-30 14:31:11,"Thanks.  I had collision with Anaconda on my machine.  Looks good.
",mikeashley,2016-10-30 14:30:17
607,2016-10-29 15:42:45,"So I was debugging this issue for awhile (i am total newb to ansible) - no matter what i do - i would never get new email account created in the Postgres. It turned out that importing sql happens as a result of ""Copy import.sql"" task, which in turn notifies import task. Problem is - if you stop deployment in the middle of the process but after import.sql is copied and before import task is run, next re-run of deployment will completely ignore importing, since nothing did change during copy task...

So I was wondering if that something ansible playbook should take care of (may be run import sql always, not only when import.sql file changes) or may be there is a flag somewhere to trigger notify to always run? 

I personally resolved it by SSHing into server and manually deleting /etc/postfix/import.sql
",hippich,
607,2016-10-30 09:26:22,"I am not sure why the import script is run in a handler.  Perhaps other maintainers have insight?  It looks to me that schema changes could be handled in a way similar to the way timezone reconfiguration happens in the common role.  This would shorten the window in which termination of a deployment run leaves the server in a bad state.  A PR would be welcome if you are interested.
",mikeashley,
607,2016-10-30 21:11:43,"The easiest fix would be to add `changed_when: true` to the Copy import.sql` task, this should force re-import sql files always (I do not see immediate problems with it)

But that does not makes deployment window you mentioned smaller. Also, could you point me to timezone handling part? 
",hippich,
606,2016-10-24 03:03:29,"Hello,

I'm in the process of making my VPS usable using the partial sovereign deployment, and it seems that `.dovecot.sieve` was in maildir, directly, which is why my `mail.err` exploded :)

[This mail thread](http://www.dovecot.org/list/dovecot/2009-October/043586.html) has some more details about that, but basically what I did is I modified `/etc/dovecot/conf.d/90-sieve.conf` from:

<S_CODE_TOKEN>

to

<S_CODE_TOKEN>

I re-created the `ln -s` and removed `~/.dovecot.sieve`. By the way, dovecot runs as `vmail`, so chgrping the folder to `dovecot` doesn't make much sense, unless I'm missing something.

All this could be a side-effect of the partial deployment, as well as something that could be handled better.
",working-name,
606,2016-10-24 12:22:00,"Thanks for the report.
On my box `.dovecot.sieve` is a symbolic link pointing to `sieve/phpscript.sieve`.

The way I avoided the issue on my system was to move the mail into a Maildir subdirectory.
so in  `sovereign/roles/mailserver/files/etc_dovecot_conf.d_10-mail.conf`
change line 30 from
`mail_location = maildir:/decrypted/%d/%n`
to 
`mail_location = maildir:/decrypted/%d/%n/Maildir`

Perhaps this is something that should be the default. Input welcome.
",neuhaus,
606,2016-10-24 22:59:24,"Emailed a reply in the morning but it didn't get to GitHub, maybe they blocked my host, who knows. It's a sovereign mail server, by the way =)

I do like your solution better, much more elegant, no messy ""sieve"" that's seen by IMAP clients.

Thank you!
",working-name,
606,2016-11-27 13:41:35,"Where was that symbolic link located because on my install it's just not there. Did you also change any other settings to make this work I would love to get it all functioning
",shaneonabike,
606,2017-03-16 11:14:27,"For whomever this might be helpful. If you just change line 30 in your config to `mail_location = maildir:/decrypted/%d/%n/Maildir`, then a new install didn't set the permissions correctly for me for `Maildir`. ",cstich,
605,2016-10-20 09:44:21,"See https://bestpractices.coreinfrastructure.org/ for details.

I think we already meet most of the criteria. Thoughts?
",neuhaus,
605,2016-10-24 13:05:43,"> I think we already meet most of the criteria.

Just give it a try and register the project there, then you will know :wink: Getting 100 % is not easy but nobody expects that on the first try. You can improve incrementally.
",ypid,
605,2016-10-24 13:19:46,"Well, for one we would have to get a proper website, something that is overdue anyway. I would be interested in working on it, anyone else?
",neuhaus,
605,2016-10-24 13:30:09,"One of the missing things is a version number for the project.
Also we should start doing releases.
And we should have a changelog for every release.
What do you think about offering private vulnerability reports? I don't think we really need them right now.
",neuhaus,
605,2016-10-24 13:54:26,":+1:

The [CII Best practices status of DebOps](https://bestpractices.coreinfrastructure.org/projects/237) might be helpful as a similar project.
",ypid,
605,2016-10-27 21:14:09,"One could use https://github.com/koalaman/shellcheck for the static code analysis requirement.
",ariddell,
604,2016-10-18 00:33:26,"For testing purposes, I spun up a brand new Debian 8.6 droplet on Digital Ocean, and ran our playbook against that. The following task failed:

<S_CODE_TOKEN>
",lukecyca,
604,2016-10-18 00:37:37,"[This wiki page](https://github.com/sovereign/sovereign/wiki/Migrating-from-Debian-7-to-Debian-8) suggests that webmail is not currently functional in the jessie branch (now master) but PR #590 has been merged and the README suggests that webmail is indeed functional.

I don't personally use webmail on my main Sovereign install. Paging @mikeashley who worked on that PR. :)
",lukecyca,
604,2016-10-18 08:38:46,"Yes, I'll take a look.
",mikeashley,
604,2016-10-22 09:04:19,"@lukecyca There are two things going on.  First, I couldn't reproduce the problem as you reported it.  The install runs clean for me.  Second, when I run the initialize task from the command line on my test server, I do get the warning reported by your Ansible run.

So I need to address the warning but first I would like to understand why my testing doesn't reproduce your report.  Can you tell me what version of Ansible you are running?  I am wondering if you are running a more paranoid deployment setup.
",mikeashley,
604,2016-10-30 09:29:22,"Took the jessie label off since jessie is master now.  Keeping the wheezy tag for issues on that branch.
",mikeashley,
604,2016-11-16 01:11:40,"It appears the issue is actually due to composer not allowing installs from insecure locations by default now.
https://stackoverflow.com/questions/35726742/cannot-install-horde-imap-client-with-composer
",nomadhacker,
604,2016-11-30 07:33:27,"Is there any update on this? Possibly a workaround? 
I have faced the same issue while installing sovereign on a fresh Debian 8.2 AWS instance. 

<S_CODE_TOKEN>
It is the same if I add 
<S_CODE_TOKEN>
to the `composer.json` file.",tushartyagi,
604,2017-01-22 08:54:09,+1,alexec,
604,2017-01-22 11:07:46,"I am still unable to reproduce this when deploying using Ansible 2.2 to a fresh Linode test server running Debian 8.6.  That's a puzzle for me, but in the meantime, composer's documentation indicates the warning can be suppressed.  Does this patch or something similar help?

    diff --git a/roles/webmail/tasks/roundcube.yml b/roles/webmail/tasks/roundcube.y
    index 1d569ad..9e87f83 100644
    --- a/roles/webmail/tasks/roundcube.yml
    +++ b/roles/webmail/tasks/roundcube.yml
    @@ -43,6 +43,8 @@
       command: php /root/composer.phar install --no-dev
                chdir=/var/www/roundcube
                creates=/var/www/roundcube/vendor/autoload.php
    +  environment:
    +    COMPOSER_ALLOW_SUPERUSER: 1
     
     - name: Remove installer directory
       file: path=/var/www/roundcube/installer state=absent",mikeashley,
604,2017-01-22 11:49:50,"For those who see this error, please report what version of Ansible you are using.",mikeashley,
604,2017-01-23 21:39:48,"I just saw the exact same error on a Digital Ocean Server with Debian 8. The cause was that the server was running out of memory, as it only had 512 MB. When i activated a swap file the installation ran without problems.",Dosenpfand,
604,2017-02-06 16:49:40,"ansible 2.2.1.0 here, I got the same error when trying to install stuff on a fresh Ubuntu 16.04",arpadlukacs,
604,2017-02-07 07:19:39,@arpadlukacs how much memory + swap did the system you tried running it on have?,Dosenpfand,
604,2017-02-07 07:31:39,"I used VirtualBox with 2GB RAM, I'm not sure about the swap, because I just chose the automatic partition.",arpadlukacs,
604,2017-03-01 18:06:43,"I get the same error. I am on a fresh Debiatn 8.7 and have Ansible 2.0.0.2. I do have 489MB of RAM and 511MB of swap.

I am not sure if this is helpful but I ran the playbook with `-vvvv` and I do get a slightly longer error message.

<S_CODE_TOKEN>`",cstich,
604,2017-03-01 19:00:26,I did some digging around and apparently there seems to be bug somewhere upstream with regards to `composer` and the `PEARL` repository. The same issue is referenced at `Roundcube` [here](https://github.com/composer/composer/issues/6193) as well. ,cstich,
604,2017-03-12 21:38:34,"Issue #659 points out that Roundcube has updated their install to work around the problem.  An updated  configuration is included in the issue.  If somebody could verify the fix and submit a pull request, that would be great.",mikeashley,
603,2016-10-17 17:04:49,"I am in the middle of upgrade from wheezy to jessie and most of it seems to work except vpn role. Getting error about not being able to find service 'openvpn@server' despite `systemctl enable openvpn@server` in command line appears to work just fine. Any clues on how to debug that?

<S_CODE_TOKEN>
",hippich,2016-10-21 04:19:02
603,2016-10-18 00:45:27,"I recently did the upgrade and had no issues with OpenVPN.

What task was this in?
",lukecyca,2016-10-21 04:19:02
603,2016-10-18 00:47:50,"<S_CODE_TOKEN>
",hippich,2016-10-21 04:19:02
603,2016-10-21 04:19:02,"So I restarted server after upgrade from wheezy to jessie and it appears like it solved this problem, therefore i am closing this issue.
",hippich,2016-10-21 04:19:02
602,2016-10-16 00:46:11,"As discussed in #595
",lukecyca,2016-10-16 08:25:50
601,2016-10-15 05:22:59,"Hello guys,

I'm about to give up. This has been an exercise in futility overall.

I tried both master and wheezy on 14.04, 15.04, 16.04, useless. No way in hell you can get it to work, there's just too many things that are different, packages that are discontinued, owncloud has issues with requirements not updating, there's a test repo to address that instead of actually updating the official repo, whatever. No matter how many times I tried to run ansible-playbook it kept failing in new ways, which utterly defeats the purpose of automating commands.
### changes I made while attempting to get 'wheezy' to complete on 16.04

<S_CODE_TOKEN>

Then I figured since master is about 200 commits ahead of wheezy it shouldn't be as neglected. Still no luck there. I have a fresh Debian 8.6, I ran ansible using master branch, and at the end of it all (which by some miracle was able to complete) I've got a borked setup. Nothing accepts any of the passwords, except for znc :)
- there was no sqlite3 installed, roudcube never created its database file in /decrypted. If you inject the sqlite.initial it won't work. Trying to log in says Invalid request! No data was saved, nothing is logged about the error anywhere.
- owncloud says 403
- IMAP won't accept my password
- news says an error occured
- wallabag does not accept my password

What else can I possibly try to get this to work? Other than manually creating the setup...
",working-name,
601,2016-10-15 08:14:59,"Wheezy was never updated to run on distributions that use systemd.  Master does not support Ubuntu distributions yet.

If you are deploying from master on Debian 8, what errors do you see?  Perhaps you are misconfiguring your setup before running the playbook?
",mikeashley,
601,2016-10-15 12:30:26,"(Debian 8) No errors other than /encrypted/\* not being found. The second was about not being able to start OpenVPN but that's because TUN/TAP was off for my VPS. All the rest were yellow and green statuses.   

I'll post my configuration once I get to a computer.   
",working-name,
601,2016-10-15 12:58:38,"Errors:

<S_CODE_TOKEN>

My [config](https://gist.github.com/working-name/4843c1985040bdb749983c615b463cea).
Before I ran the playbook I copied my `id_rsa.pub` as `gitolite.pub`, commented out `- tarsnap` in site.yml, and ran these:

<S_CODE_TOKEN>
",working-name,
601,2016-10-16 01:13:21,"Ran the playbook on Debian 8.5 x64, this time I'm able to log in via IMAP/SMTP. However not much else is improved. 

If you'd like to see the verbose playbook log, [here it is](https://gist.github.com/working-name/7540a91f519b16d28f98de391e423d7f).

I'm going to attempt to document what I find, just in case it may be useful to you. If not, just let me know, I'll close the issue.
1. Wallabag pgsql database has the structure but no contents. Also db structure doesn't match what I find references in wallabag's issues concerning changing username (which is a big no no) and/or password.
2. OwnCloud is borked. Checked apache, there shouldn't be a problem, but it's serving `autoconfig.autoconfig.com` on `cloud.domain.com`. I'm missing something, I'm sure but at the moment it makes no sense.
",working-name,
601,2016-10-16 08:20:00,"Documenting will be helpful if you can get to root cause.  I have no personal experience with wallabag.  As for owncloud, it deploys properly on a test server I use, so I am interested in understanding what went wrong in your case.
",mikeashley,
601,2016-10-23 02:57:20,"Well I'm not sure what's different about your test server, but my OpenVZ VPS and my other VMWare Fusion Debian 8 instances behave the same. No errors while deploying, however once deployed:
1. Roundcube complains about not being able to connect to the database (might be connected to the fact that /decrypted/\* is skipped while deploying, I can't find the sqlite file referenced in roundcube's config)
2. read., the wallabag installation: database has tables created but everything is blank
3. owncloud installation is serving autoconfig. (I see the mail folder with config-v1.1.xml). `/var/www/owncloud/config/config.php` is blank. And again, nothing in the vhost config suggests it should be serving `/var/www/autoconfig`. This is odd.
4. selfoss installation does not accept any logins. It's unclear whether it's trying to get to a non existing sqlite.db file in the webdir under data/sql/something.db or it's failing to pull anything from the local mysql install, which by the way does not have a database named ""selfoss"", and it's using the root user to access mysql which in my opinion should not have a blank password in the first place.

How do you usually debug this? Looking at the verbose log doesn't tell me much, as ironic as that sounds :)
",working-name,
601,2016-10-24 22:57:50,"Yeah, I give up. 

If any one of you developers want to try your hand at deploying on my VMWare Debian 8 and see it fail live, let me know :)
",working-name,
601,2016-10-29 17:42:19,"I experience the the same problems on my openVZ VPS as listed in https://github.com/sovereign/sovereign/issues/601#issuecomment-255566608
",Titan-C,
601,2016-10-30 12:38:24,"I just managed to get a development environment as stated in the wiki, with virtualbox and vagrant. I see the exact same problems as in my OpenVZ VPS. 
",Titan-C,
601,2016-10-30 13:34:30,"Remember, @mikeashley this is not openVZ only, it's also VMWare, which is a full virtualization, it does not use the local kernel. I'll do my best to find some time to set up a physical debian box and test it out.

@Titan-C I tried to troubleshoot the playbook but it's a mess. The most you can do with it is get back the output of commands sent to the server with `-v` flag, and if you set the ENV  `ANSIBLE_KEEP_REMOTE_FILES=1`, `~deploy/.ansible/tmp/*` will not be removed. However, as far as I'm concerned those two are as useless as can be. Nothing in the command output shows me an error, and the temp files are a mess of auto-generated python scripts. So I gave up because it would take an insane amount of time to try to untangle that. Meaning you're better off manually installing each piece of software that failed to properly deploy. sovereign is a good starting point, it saves you some time, but that's where it stops.
",working-name,
601,2016-10-30 14:55:49,"I reproduced a number of your problems with the Vagrant-based VM.
- PR #609 addresses the problem you were having with Roundcube.
- Regarding owncloud and newebe, check /var/log/apache2.  I find that apache is seeing requests to autoconfig.sovereign.local in those cases.  I don't know why it is correct for news and mail.  I think we're seeing an interaction between host lookup and Apache that doesn't happen in a properly-configured server.  (My test server is a full Linode instance with its own domain.)
- Beware, selfoss and newebe may still have configuration problems.  If you find any, a PR to correct them would be most welcome.  Personally I don't use either of these.
",mikeashley,
601,2016-10-31 10:07:55,"> I think we're seeing an interaction between host lookup and Apache that doesn't happen in a properly-configured server. (My test server is a full Linode instance with its own domain.)

What is a properly-configured server? Isn't it this project about configuring the server? I'm also testing online on a VPS with its own domain and I also see owncloud being served to autoconfig.
",Titan-C,
600,2016-10-13 03:18:20,"TASK [mailserver : Ensure mail domain directories are in place] ****************
fatal: FAILED! => 

<S_CODE_TOKEN>

From what I can gather there's supposed to be directories for the domain name and the account name inside /decrypted. Right now I only have ""test"" in there. I cannot find another reference to `item.domain` and `item.account` which are probably the ""undefined variables"".

Should I create the folders manually? Will that backfire on me?

I've been attempting this on 14.04, then 16.04, and now I'm on 15.04 which seems to work the best so far. I did have to hack another spot in the postfix_main.cf template where it tried to pull `.join(friendly_networks)` but `friendly_networks` is a blank field.
",working-name,2016-10-13 14:53:20
600,2016-10-13 08:58:30,"Are you using the master branch or the wheezy branch from git?
",neuhaus,2016-10-13 14:53:20
600,2016-10-13 14:38:32,"Hi there,

I was using the master, I wasn't aware there was a wheezy branch.

I reinstalled 16.04 on the VPS and tried to run the wheezy version on it.

That dovecot.yml error is still there. When I grep for `item.name` I can only find it used but not defined. Where is that supposed to be defined?

#### Full Error // TASK [mailserver : Ensure mail domain directories are in place]

<S_CODE_TOKEN>
",working-name,2016-10-13 14:53:20
600,2016-10-13 14:49:15,"Check your `group_vars/sovereign` file, it should define `mail_virtual_domains` there.
Did you configure a domain name in that file?

This is covered in the README in point 4 ""Configure your installation"".
",neuhaus,2016-10-13 14:53:20
600,2016-10-13 14:53:20,"Please reopen if this does not fix your problem.

Note: We could put a check in the playbook that makes sure you have configured a domain and gives a more helpful error message if you forgot it.
",neuhaus,2016-10-13 14:53:20
600,2016-11-15 03:33:21,"This issue is _likely_ due to the way yaml is written in the old vs. new code. In the old code, the code was:

<S_CODE_TOKEN>

while in the new code it is:

<S_CODE_TOKEN>

Note the differences between the last lines. You will have to switch to the second style for all similar constructions. The easiest way to do that is to merge in these files from the current branch (checking they haven't changed too much).
",dr-nate,2016-10-13 14:53:20
599,2016-10-09 17:40:34,"My install is errors out on

`TASK [common : Get an SSL certificate for {{server name}} from Let's Encrypt] ***`

When I attempt to start apache2 manually on the server  I get the following error:

<S_CODE_TOKEN>

**{{server name}} is a redaction for posting.**

I check under the letsencrypt directoy that is created from the LetsEncrypt release download (`letsencrypt.yaml`).  I don't see a `letsencrypt-gencert` file.

Thanks in advance for any assistance.
",doughock,2016-10-09 22:28:07
599,2016-10-09 22:28:07,"It seem to be an issue with the server name.  I change the name to something more simple (i.e. domain.com) and the installation finished.
",doughock,2016-10-09 22:28:07
599,2016-10-10 08:44:07,"OK, can you tell us what characters caused the issue in the hostname? Perhaps we can add a little note to the README regarding invalid hostnames.
",neuhaus,2016-10-09 22:28:07
598,2016-10-08 13:29:12,"This PR upgrades wallabag to the latest version. Wallabag 2 was released in April 2016 and brings many improvements and changes. Looks like they re-wrote many parts of the application. The old 1.x version is not actively worked on anymore.

Two things that still need some work (help / suggestions welcome!)
1. currently, the URL is read.myhostname/web. I think the apache config files needs some tweaking. Any ideas?
2. re-runing the ""Install wallabag"" step results in an error.
",wsteitz,2017-01-13 13:15:41
598,2016-10-08 22:15:07,"Thank you for the PR.  Would it be possible to split the configuration file changes into different commits?  I find it very helpful to have one commit for the package's configuration file and then a second commit for sovereign-specific changes.  This makes it easier in the future to reason about configuration file changes in new versions of the package.
",mikeashley,2017-01-13 13:15:41
598,2016-10-09 09:14:56,"I've splitted the commits in role and configuration changes. Of course that means that the intermediate commit is not a working revision, as the steps in the role don't match the configuration files.

Re-running the installer now also works without problems. To avoid overwriting the old wallabag 1.x database, the database is now called wallabag2.

Overall, the PR is now feature complete and ready for review.
",wsteitz,2017-01-13 13:15:41
598,2016-10-09 13:07:23,"Thanks for the updates.  Two other questions after review: 1) how have you tested this, and 2) have you considered adding `DESIGN.md` to document assumptions, intent, gaps, etc?  You might look at `DESIGN.md` in the webmail role for inspiration.
",mikeashley,2017-01-13 13:15:41
598,2017-01-02 14:17:13,is there any chance to get it merged soon?,akovalyov,2017-01-13 13:15:41
598,2017-01-13 12:49:41,"@mikeashley @wsteitz how can I help in getting this into core? I am a newbie in Ansible, but at least can help with testing (not with documentation, English and writing are two my weak points as well). ",akovalyov,2017-01-13 13:15:41
598,2017-01-13 13:15:41,"@akovalyov  I decided against using ansible on my server. So there is no real interest from my side to finish up on this one. Sorry.

In the meantime, wallabag's installation steps got simplified a bit. It would need to check what has changed and adapt accordingly. the best idea is probably closing this PR and re-open a new one.",wsteitz,2017-01-13 13:15:41
597,2016-10-03 14:22:53,"changelog at https://github.com/SSilence/selfoss/releases/tag/2.15
",wsteitz,2016-10-08 21:56:10
596,2016-10-01 06:58:41,"I haven't used ansible in a pretty long time. I looked at my old user.yml file and I'm seeing a few more variables in there that aren't in the new sovereign file. Like `webmail_db_password` and `mail_db_password`. I'm wondering how these are set now and what I could be doing wrong? I'm on Debian 8.6.

The exact error that is coming up on the page is 

<S_CODE_TOKEN>

Thank you.
",DomenicF,2016-10-01 17:53:02
596,2016-10-01 17:53:02,"I see NOTE: currently unavailable. on the README now. 
",DomenicF,2016-10-01 17:53:02
595,2016-09-29 06:02:33,"After upgrading to Jessie, I am not able to get rmilter to work. I get these messages in `/var/log/mail.log`:

<S_CODE_TOKEN>

I noticed that the rmilter process is still using a unix socket, but from #521 it sounds like the intention is to use a tcp socket.

<S_CODE_TOKEN>

Perhaps `/etc/rmilter.conf` needs to be specified by ansible. Better yet, perhaps we should put all configuration overrides in `rmilter.conf.local` or `rmilter.conf.d`.

@carljm could you have a look and clarify? I can prep a PR if you can clarify what should be done.
",lukecyca,2016-10-17 23:54:09
595,2016-09-29 14:46:29,"Confirmed that the following change appears to fix it.

<S_CODE_TOKEN>

Will wait for comments before submitting a PR to make sure I'm not missing something (I don't feel I understand systemd that well yet).
",lukecyca,2016-10-17 23:54:09
595,2016-10-13 09:01:56,"So the issue is that postfix running smtpd in a chroot can't reach the rmilter unix domain socket?
UNIX domain socket would be preferable if we can get it to work, it's roughly twice as fast as TCP sockets IIRC.
",neuhaus,2016-10-17 23:54:09
595,2016-10-14 08:47:54,"> So the issue is that postfix running smtpd in a chroot can't reach the rmilter unix domain socket?

In #521, @carljm explains why he chose to use a TCP socket, which I think is probably fine. At least, that's not what I'm trying to change here.

The issue here is that the configuration for rmilter appears to still try to use the UNIX socket, which is contradictory to the comments in #521, etc.

It's probably a simple fix. I just wanted to run it by @carljm for clarification prior to making the change in case I'm missing something.
",lukecyca,2016-10-17 23:54:09
595,2016-10-16 22:13:51,"Sorry, haven't had much time for sovereign recently. I think this is fine. It definitely worked after #521, but that was probably because we were using a socket-triggered service, and that service definition specified the TCP port. I think that has since been removed for other reasons, which probably broke this.
",carljm,2016-10-17 23:54:09
595,2016-10-17 23:54:09,"Thanks @carljm. My fix has been merged so I consider this resolved.
",lukecyca,2016-10-17 23:54:09
594,2016-09-28 23:14:32,"Has there been any thought put into using RainLoop over roundcube?  I'm using RainLoop locally and it seems pretty solid.  It probably wouldn't take me too long to add the setup to ansible.  The manual installation was pretty straight forward.
",bpeterman,
594,2016-09-29 15:59:16,"There don't seem to be any packages yet for Rainloop, so what would be the advantages?
",neuhaus,
594,2016-10-09 09:26:23,"I case we are rethinking the webmail client used in sovereign, [mailpile](https://www.mailpile.is/) looks very interesting.
",wsteitz,
594,2016-10-10 08:43:06,"Looks nice. Again, what are the benefits to change from Roundcube to RainLoop or mailpile?
",neuhaus,
594,2016-10-10 22:59:15,"Well, I think the main reason I switched to RainLoop was because Roundcube doesn't appear to be working currently with Sovereign (didn't work for me ""out of the box"").  Might just be personal preference as I feel the Roundcube interface is fairly antiquated.  Just thought I'd throw the idea out there to see what others think.
",bpeterman,
594,2016-10-10 23:29:46,"Could you be more specific about what didn't work?  Fresh install of Debian 8?  Debian 7?
",mikeashley,
594,2016-10-11 17:20:35,"I'm mainly referring to this.  https://github.com/sovereign/sovereign/commit/195d8811fc1551afbe84bb7b6267a25008653fe9#diff-04c6e90faac2675aa89e2176d2eec7d8R22  

I thought it was a known issue.  I can't recall the exact errors but it was a fresh install on Ubuntu 16.04.
I could go digging in my logs to determine the exact issue but I'm not sure I still have them.  I believe I ended up commenting out the Roundcube section after a few iterations. 
",bpeterman,
594,2016-10-12 08:35:03,"Ah, the README was out of date; I corrected it on master.  The master branch doesn't officially support Ubuntu yet but would love to see that regression fixed with a PR.  On the wheezy branch (which supports Trusty but not Xenial), Roundcube is indeed a little rough to install due to nagging issues with unattended installs of the package with the postgres backend.  It has to be patched up manually.
",mikeashley,
594,2017-02-06 13:05:39,Talking about the wheezy branch.. we should announce a date when we will stop supporting it.,neuhaus,
594,2017-02-06 17:23:56,"On 06.02.2017 14:05, Sven Neuhaus wrote:

> woTalking about the wheezy branch.. we should announce a date when we
> will stop supporting it.
>

Also Debian 9 has just been frozen, so it would be prudent to start
thinking about compatibility to it.

",neuffer,
593,2016-09-27 09:37:10,"Postgres is used by several roles, but the setup is currently part of the 'mailserver' role. By moving it to 'common', it's possible to disable the mailserver without breaking the others.
",wsteitz,2016-10-03 20:00:29
593,2016-09-29 16:43:41,"Looks good to me, have you tested this?
",neuhaus,2016-10-03 20:00:29
593,2016-09-30 07:42:21,"I tried it on a newly setup VPS without problems.
",wsteitz,2016-10-03 20:00:29
593,2016-10-03 20:00:34,"Thanks!
",neuhaus,2016-10-03 20:00:29
592,2016-09-26 04:03:31,"https://pingability.com/zoneinfo.jsp complains when mail is rejected for the abuse user.
",bpeterman,2016-09-29 16:48:12
592,2016-09-29 16:48:18,"Thanks!
",neuhaus,2016-09-29 16:48:12
591,2016-09-16 09:17:35,"This PR addresses Issue #557.  I tested it by deploying, redeploying to verify no changes, manually dropping the database, and deploying a final time to confirm the database is configured again.
",mikeashley,2016-09-16 17:00:59
591,2016-09-16 17:01:29,"Looks like a simple, sensible change.
",ariddell,2016-09-16 17:00:59
590,2016-09-05 10:42:48,"This PR reinstates the webmail role lost when we moved to Jessie.  It installs Roundcube from source using sqlite3 as the database backend.  The `carddav`, `managesieve`, and `twofactor_gauthentication` plugins are carried forward using the plugin management system that the Roundcube team has implemented using PHP composer.
",mikeashley,2016-09-11 09:04:29
590,2016-09-05 11:59:07,"Thanks, looks good. Do you have it running on your test system?
",neuhaus,2016-09-11 09:04:29
590,2016-09-05 12:28:20,"Yes.  When all the feedback is in, and it's ready to commit, I'll rebase to squash the whitespace cleanup.
",mikeashley,2016-09-11 09:04:29
590,2016-09-05 12:55:06,"On 05.09.2016 12:42, Mike Ashley wrote:

> This PR reinstates the webmail role lost when we moved to Jessie. It
> installs Roundcube from source using sqlite3 as the database backend.
> The |carddav|, |managesieve|, and |twofactor_gauthentication| plugins
> are carried forward using the plugin management system that the
> Roundcube team has implemented using PHP composer.

Why do you use sqlite3 when there is already an installed postgresql?
This makes life just much harder if you want to integrate the system a
bit more.

Cheers
  Mike
",neuffer,2016-09-11 09:04:29
590,2016-09-05 13:48:55,"What do you mean by ""integrate the system""?  Roundcube does not persist much data, and I think it's an advantage to not have this role depend on postgresql.  
",mikeashley,2016-09-11 09:04:29
590,2016-09-06 11:06:59,"On 05.09.2016 15:49, Mike Ashley wrote:

> What do you mean by ""integrate the system""? Roundcube does not persist
> much data, and I think it's an advantage to not have this role depend
> on postgresql.
> 
> We already have the dependency on postgresql, so you don't gain
> anything, but instead complicate the dependency graph and in case of
> upgrades
> you now have to migrate 2 database backends and their data instead of one.

I am planning to add postfixadmin to the mix, which will also use
postgresql as its backend and to change the current postfix setup
accordingly
Keeping all data in one database server instead of distributing it
amongst postgresql, the mysql family and sqllite gives you the advantages
mentioned above plus it is easier for those pieces of software to
interact with each other.

Somewhere on the net there is a postfixadmin/roundcube integration
plugin floating around  which will then allow end users to change their
passwords from the roundcube gui for example.

Keeping you data in several seperate and different database backends
will turn this into a mess.

Cheers
  Mike
",neuffer,2016-09-11 09:04:29
590,2016-09-06 23:43:40,"Mike, sorry, I don't follow your reasoning.  On an upgrade, you have to migrate the database no matter where it is.  As for interaction, that typically happens through the application layer of the packages we're talking about, not the persistence layer, so no advantage there either.

You are right we are adding a package dependency (sqlite3), but in exchange we get a more efficient runtime.  That's a benefit: we're aiming to keep our memory footprint small.  Our goal is to get rid of mysql (see Issue #502), and I think it'd be great to eliminate postgres also.
",mikeashley,2016-09-11 09:04:29
590,2016-09-07 06:42:21,"On 07.09.2016 01:43, Mike Ashley wrote:

> Mike, sorry, I don't follow your reasoning. On an upgrade, you have to
> migrate the database no matter where it is. As for interaction, that
> typically happens through the application layer of the packages we're
> talking about, not the persistence layer, so no advantage there either.

And how many applications do you know support accessing more then one
database engine at one? It is always either or.
How are you doing to keep the account information for dovecot, and
roundcube and... in sync when they are all kept in different DB engines?
Either you are building yourself a single user mail server and you don't
care or you'll get into into support hell real quick.
And then you'll find out that maintaining accounts and passwords accross
multiple applications AND database engines is no fun.
It is much easier if you have to access one, to code for one instead of
two, three or more that you access in parallel.
How many persistence layers do you know support different engines in
parallel? You always configure them either or.

> You are right we are adding a package dependency (sqlite3), but in
> exchange we get a more efficient runtime. That's a benefit: we're
> aiming to keep our memory footprint small. Our goal is to get rid of
> mysql (see Issue #502
> https://github.com/sovereign/sovereign/issues/502),

Then standardize on postgresql as described there.

> and I think it'd be great to eliminate postgres also.
> 
> With sqlite you run into almost the same problem as descriped above, one
> application one engine. You'll run multiple engines and your data is
> separate.

In that case sovereign won't my kind of system to support anymore and
I'll go back to hand crafting my installation scripts.
",neuffer,2016-09-11 09:04:29
589,2016-08-30 16:29:22,"Rspamd changed the recommended way of starting its services, thus the playbook is failing on this task.

References:
- https://github.com/vstakhov/rspamd/pull/762
- https://rspamd.com/doc/quickstart.html#running-rspamd

> Packaging should start rspamd and configure it to run on startup on installation.
",tomasbedrich,2016-09-04 09:38:32
589,2016-08-30 17:12:38,"FWIW, I wrote this rspamd setup initially, and this change looks correct to me.
",carljm,2016-09-04 09:38:32
589,2016-09-05 11:09:07,"Thanks, guys!
",mikeashley,2016-09-04 09:38:32
588,2016-08-30 15:26:28,,tomasbedrich,2016-09-05 11:07:54
588,2016-09-04 09:22:11,"Why would we want this change?  
",mikeashley,2016-09-05 11:07:54
588,2016-09-04 10:23:40,"It allows you to use SSH agent forwarding from local machine when logged in as a root on the remote machine. I use this feature for cloning the Github repositories to /var/www (owned by root) without a need to store my private SSH keys on the remote machine.
",tomasbedrich,2016-09-05 11:07:54
588,2016-09-05 11:08:21,"Thank you!
",mikeashley,2016-09-05 11:07:54
587,2016-08-10 22:07:49,"All my commits fail CI because of some error in Travis that is unrelated to my actual code:

<S_CODE_TOKEN>

Can someone go buy that dude a beer so he stops crying?
",oskapt,
586,2016-08-10 22:04:18,"This PR will remove any existing source installation of z-push and install it from their new Ubuntu/Debian repos. It also splits out the configuration into the new backend-specific configuration and installs all the requisite packages.

I have this running in production under Ubuntu 14.04.

This closes #584.
",oskapt,2016-09-11 14:18:31
586,2016-08-11 21:05:00,"Thanks @oskapt . Do there need to be any changes on the jessie branch?
",ariddell,2016-09-11 14:18:31
586,2016-08-11 21:48:20,"@ariddell It isn't tested on Jessie, but it's configured to work on all three. I'm running it on Ubuntu. Someone should run it just to make sure I didn't miss anything - afaict the only difference is the repository path.
",oskapt,2016-09-11 14:18:31
586,2016-09-09 09:10:13,"@oskapt I think this PR is headed in a good direction.  Do you have any interest in reworking it for the jessie branch?  I don't know if anybody will champion it for wheezy.  If you are not interested I will probably pick it up.
",mikeashley,2016-09-11 14:18:31
586,2016-09-11 14:18:31,"I'm going off on my own.
",oskapt,2016-09-11 14:18:31
585,2016-08-10 21:59:49,"The imap module needs to be enabled on Ubuntu 14.04. Without it z-push doesn't work.

This closes #583.
",oskapt,2016-09-11 11:03:24
585,2016-09-09 09:05:44,"I am not working on the wheezy branch.  Does any committer want to champion this PR?  If not, I will close it.

The imap module is enabled by default on the jessie branch.
",mikeashley,2016-09-11 11:03:24
585,2016-09-11 11:09:06,"Thanks for the fix!
",mikeashley,2016-09-11 11:03:24
584,2016-08-10 21:49:49,"the new version of z-push is available via repos and requires slightly different configuration. PR en route.
",oskapt,
583,2016-08-10 13:52:06,"Fresh install on Trusty is throwing this error:

<S_CODE_TOKEN>

As a result, mobile devices (all my iDevices) won't connect and won't process mail in or out.
",oskapt,2016-09-11 10:11:27
583,2016-08-10 16:41:44,"I just rewrote the config to install z-push from package (they now have package repos), hoping that 2.3 would fix this issue. It doesn't, so now I'm diving into their code to see where the function they're testing actually resides. Either it's not in `php5-imap` (which we install) or the name has changed (which they should have caught). 
",oskapt,2016-09-11 10:11:27
583,2016-08-10 16:45:32,"Hrmph. Nevermind. On Trusty we need to call `php5enmod imap` to actually turn it on after installing. PR forthcoming.
",oskapt,2016-09-11 10:11:27
583,2016-09-11 10:11:27,"Closing, since the PR covers this.
",mikeashley,2016-09-11 10:11:27
582,2016-08-10 13:26:42,"As an extension to the behavior documented in #581, there is a race condition regarding mail delivery when the playbooks are run. 

During the time that the SQL is being run, any mail that is delivered or being processed will suddenly find itself with no user configuration on which to operate. The period in question is small, but it exists.

The problem arises from our behavior of dropping the tables and recreating them from scratch.

My proposal is that we don't do this. If we were running mailservers without using Ansible, we would have a utility for managing users and domains, executing add/move/change as necessary. No Exchange admin blows away the database and reloads all configuration from a CSV file when he wants to add a new user. Even those using flat file maps make changes and recompile the hashed versions. The mere fact that we are using Ansible does not mean we suddenly have license to be sloppy. If anything, we should be _more_ elegant, because our CLI-fu gives us more flexibility.

Dropping the tables on every run is the easy way out, but it's not the right way to do it. Dynamic SQL templates, though more complicated, deliver precision actions according to the rules we define.

My solutions proposed in #581 will solve this issue because Ansible will only act on objects that need to change. If we decide not to implement the `password` plugin in Roundcube, then we can assume that the user has never changed his password. If that assumption is true (and without providing a means for them to do so, it is true), then we only have to make add/move/changes to the database records for users and domains that require them. Our exposure is then no more than it is in an enterprise environment when the admin clicks the OK button in the GUI.
",oskapt,2016-09-16 08:13:03
582,2016-09-11 10:20:55,"Why wouldn't you simply stop the postfix and dovecot services before commencing with configuration changes?  That seems to be the cleanest way to handle it.
",mikeashley,2016-09-16 08:13:03
582,2016-09-11 13:15:56,"Configuration management (Ansible, Puppet, Chef, cfengine) is a tool to automate tasks that a human would do. It does them in the same way, every time, without fail. When I write playbooks, I automate myself.
- No human system administrator stops the mailserver when adding users.
- No human sysadmin blows away the entire database every time they want to add a user, domain, alias or other object.

To do so is wrong. It's lazy. It's forgivable only in the context of trying to get to our objective as quickly as possible, but if a problem comes up as a result of this decision, we are tasked with reworking the solution to fix the problem. 

If you only care about a mailserver serving mail for yourself, then you are justified in not caring. However, this does not preclude considering a better solution. Sovereign's mailserver and webmail component _already_ build and configure a complicated group of applications, so rather than reinvent the wheel, people _will_ use this for small groups. You can continue to tolerate its shortcomings under the pretense of ""it was never meant to be used by more than one person,"" but Postfix, Dovecot, Roundcube, et al, _were_ meant to be used by more than one person. 

I'm offering a solution that keeps the workflow clean and professional. You can decline to accept it, but do it for a reason better than, ""why would you not just simply take the lazy, easy, amateur way out?""
",oskapt,2016-09-16 08:13:03
581,2016-08-10 13:11:23,"The way that the playbook is designed appears to target a single-user environment. All passwords are generated manually offline, most are hashed, and the hashed form is put into the config. These hashed forms are inserted into files and tables as appropriate.

At the same time, the mail portion of the configuration allows (and encourages) multiple users. Sovereign, as built, is an excellent setup for a private mail server. The problem is that users cannot change their passwords.

As it is currently written, with all passwords are stored in the Ansible configuration, all Postfix tables are dropped and recreated on every Ansible run. This means that even if a user _could_ change their password, it would be reset on the next run. If that structure changes, there is still no provision for a user to change their password. The would have to come to the person who runs Ansible, tell them the new password, and that person would have to generate the new hash and re-run Ansible.

This is contrary to our responsibilities as system administrators. We should _not_ have everyone's password. Users should trust that the system we run is secure. We should encourage people to change their passwords on first login so that we have plausible deniability regarding access to anyone's account, whether they be friend, family, or coworker.

My proposition is as follows:
1. Configure the SQL in a way that does not drop and recreate the tables. We can do this by using `IF NOT EXISTS` statements, conditionals around index creation, and dynamic SQL around creating and removing users based on whether they exist already and what we are telling Ansible the state of the user should be (`enabled: yes` or something similar).
2. Add a flag of `force: yes` to the user configuration in Ansible that tells it to overwrite the current password with the provided hash. This can be used for password resets and locking accounts that we want to keep around. Those people who wish to continue using Sovereign in its current form can provide `force: yes` to all account definitions.
3. Add additional configuration to Roundcube to enable the `password` plugin and provide the appropriate SQL statements for it to work with Postgres.
",oskapt,2016-09-16 08:12:10
581,2016-08-14 20:14:05,"Additionally I'd suggest the use of postfixadmin.
Ubuntu and Debian currently have version 2.93-2 in their repositories.
Postfixadmin is under active development even so it doesn't look like it from the projects webpage.
",neuffer,2016-09-16 08:12:10
581,2016-09-11 10:39:15,"This has come up several times in the past.  As we say in the first paragraph of this project's README, sovereign is designed for maintaining personal cloud services.  I do not recommend it for groups precisely because all configuration information is kept on the client side, under version control, including passwords.

Admittedly, not all our roles are in line with this design intent.  OwnCloud is an example.  However, I'd rather keep the pressure on having the complete configuration on the client side and not go in the wrong direction.

[mailinabox.email](http://mailinabox.gui) has a gui.  Perhaps it has these features that you are looking for as well?
",mikeashley,2016-09-16 08:12:10
581,2016-09-11 14:17:25,"My philosophy is covered in #582 in today's response.

As for keeping thing on the client side, such as passwords, and in a repo, Ansible Vault is designed to allow you to do this safely. 

Furthermore, if the use case _can_ spread to > 1 user (even if that is just me and my wife), why not give users the ability to change passwords? Does including this functionality, already nicely packaged for you, cause damage?

I can see where this is headed. I provide solutions to problems in this project, and you direct me to another project instead. Might as well just tell me to use Gmail.
",oskapt,2016-09-16 08:12:10
580,2016-08-09 19:31:51,"I'm going to get flamed by the ""don't break Debian"" crowd, but whatevz. A mailserver with no webmail client is not nearly as useful as a mailserver with one. Ubuntu 14.04 is also stuck on 0.9.5.

This PR installs Roundcube 1.2.1 from (**_gasp_**) SOURCE!

OMG. Unreal. A bunch of PHP scripts in a docroot that we don't need a package maintainer for! Madness! Cats and dogs living together! It's like 1996 again! Let's install Slackware!

This includes a little filter plugin that I needed to get the plugins wrapped in quotes in the template in some fashion that didn't make me want to claw my eyes out. It's called 'wrap' and was not my idea. It came from something on stackoverflow or someplace...DRY, etc.

I'm running this in production, and I (painfully) extracted the core of it today to make this PR. I ran a basic install with default variables and it didn't scream, so it should be good. It's better with my other PRs (password plugin, etc), but those aren't necessary...however, this PR includes previous changes to install the roundcube password plugin because I didn't want to deal w/ manually merging the two branches. I compensated by not activating it - it's just code sitting there, waiting for the user to find it (or for my other PR to be merged).

I _did_ have to hack their db init script so that it can be idempotent and safely run without barfing on every Ansible run.

This may be useful for work being done in #495 and #507.
",oskapt,2016-09-11 11:57:26
580,2016-08-09 22:06:31,"This is essentially a duplicate of PR #457 which we elected not to take.  Please consolidate discussion to #507.  We do need to get the webmail situation resolved.
",mikeashley,2016-09-11 11:57:26
580,2016-08-10 12:59:04,"We've had so many pains with the distribution provided packages, perhaps for roundcube, building from source is the better option? I'm open to this idea (as I mentioned in the closing comment of #457 ).
",neuhaus,2016-09-11 11:57:26
580,2016-08-10 13:47:16,"The argument for using a package is that it allows for easy uninstalling of the content if you remove it. That barely applies here - Roundcube isn't throwing stuff in `/usr/local/{etc,bin,sbin,share}/` and `/var/{lib,log,spool}/` or whatever. It's a web app. It's PHP.

I'm putting it all in `/var/lib/roundcubemail-{{ roundcube_version }}` with a link to that at `/var/lib/roundcube`. All config files have been updated/modified to use this path. My `no_roundcube.yml` from #574 removes these locations, and all configuration, whether it was installed by package or from source.

We have some basic choices:
- use 0.9.5 (not an option on jessie)
- use nothing 
- install it from source
- wait for someone upstream to fix whatever the problem is

Given these options, let's consider our objective. If we want to be package maintainers for Debian or Roundcube, then we're in the wrong place. If we want to be proud that our collection of tools for running a private mailserver does _not_ provide a web mail client, then maybe we're doing alright. If we want to wait for Debian to change their mind about including it, or for someone else to write another web mail client that Debian _will_ include, then we should all go get beers.

If, however, we want to give a complete tool set for privatization of mail in the post-Snowden world where we all live, we can consider the shortest path to the objective of giving our users a functional, robust, web mail client and install it from source.
",oskapt,2016-09-11 11:57:26
580,2016-08-16 12:45:20,"I know y'all will prob reject this PR, but that doesn't stop me from updating the branch to make sure it works.

Found today that if this is installed on top of a packaged install of roundcube, it barfs. I added some plays to remove the packaged versions and check for/optionally delete `/var/lib/roundcube` so that we can symlink it.

I have this running in production on 14.04.
",oskapt,2016-09-11 11:57:26
580,2016-09-09 09:03:59,"I am not working on the wheezy branch.  Does any committer want to champion this PR?  If not, I will close it.  PR #590 reinstates webmail on jessie.
",mikeashley,2016-09-11 11:57:26
580,2016-09-11 11:57:26,"There seem to be no takers for this PR.  At a minimum, this PR needs to be reworked to install Roundcube cleanly and not bother with uninstalling an existing package.  The role should assume a clean install of Sovereign.  I recommend looking at the commits merged at commit 0e379f as an example of how to do this.

Please do resubmit a reworked PR if you care to do so.  I'm convinced now that we're going to need to install from source to get Roundcube set up properly.
",mikeashley,2016-09-11 11:57:26
579,2016-08-09 19:20:04,"while we all wait for this to be fixed upstream, this PR will patch the files in question according to the referenced bug report.

i have this running in production.

it brings up an interesting question, though - why do we run opendmarc with mysql when contribution guidelines state that everything should run against postgres? we're all running two db engines on our boxes now.
",oskapt,2016-09-11 11:02:22
579,2016-09-09 09:02:59,"We have open issue #502 about running with mysql.  I'll review this patch and see if it applies to the jessie branch.
",mikeashley,2016-09-11 11:02:22
579,2016-09-11 11:00:19,"Jessie is running version 1.3, and the bug has been has been corrected in that version.
",mikeashley,2016-09-11 11:02:22
579,2016-09-11 11:09:30,"Thank you for this fix.
",mikeashley,2016-09-11 11:02:22
578,2016-08-04 14:22:52,"Automatic renewal of certificates should occur silently if there was no error, currently a daily reminder is sent by mail that nothing happened.
This is also the [official recommendation](https://certbot.eff.org/docs/using.html#renewal):

> If you‚Äôre sure that this command executes successfully without human intervention, you can add the command to crontab (since certificates are only renewed when they‚Äôre determined to be near expiry, the command can run on a regular basis, like every week or every day). **In that case, you are likely to want to use the -q or --quiet quiet flag to silence all output except errors.**
",Dosenpfand,2016-08-05 07:05:50
578,2016-08-05 07:06:31,"Thank you!
",mikeashley,2016-08-05 07:05:50
577,2016-07-14 16:40:12,"This PR creates a SQL function in the `mailserver` database for updating passwords and configures the password plugin for operation. It won't be useful without #576, so feel free to scrap this if you don't accept the other.
",oskapt,2016-09-11 14:19:06
577,2016-07-14 21:46:22,"Hi @oskapt . Thanks for all these PRs. Have you looked at the jessie branch? It's quite a bit ahead of master and perhaps might benefit from these changes.
",ariddell,2016-09-11 14:19:06
577,2016-07-28 02:13:40,"jessie is a non-starter because it's missing roundcube. i'm building this out for production to replace Fastmail - a web email client is important.

i ended up just deploying my stuff on Ubuntu, since that's where the rest of our environment is. i just moved my personal wheezy instance of sovereign to a new Ubuntu instance with all of the changes in these PRs. works great.
",oskapt,2016-09-11 14:19:06
577,2016-08-05 07:19:31,"There's PR #507 on the jessie branch for reinstating roundcube.  You might have a look.
",mikeashley,2016-09-11 14:19:06
577,2016-08-05 12:31:09,"I wrote my own playbook for installing Roundcube from source, and it works fine. I think I'm over submitting PRs here, since they seem to get attention from everyone _except_ the maintainer.
",oskapt,2016-09-11 14:19:06
577,2016-08-08 21:09:45,"Thanks for the PR. I was on vacation for the last 4 weeks however @mikeashley  and @ariddell are also comitters.
",neuhaus,2016-09-11 14:19:06
577,2016-09-09 09:01:05,"I am not working on the wheezy branch.  Does any committer want to champion this PR?  If not, I will close it.
",mikeashley,2016-09-11 14:19:06
577,2016-09-11 14:19:06,"I'm going off on my own.
",oskapt,2016-09-11 14:19:06
576,2016-07-13 16:21:18,"Sovereign, as written, drops all tables and recreates them on every run. In doing so it recreates all users with passwords as originally set. There is no provision to allow users to change their own passwords (though I'm about to work on that), and if they did, the passwords would be clobbered on the next run. This also creates a race condition - email that arrives during the instant that the database is down will be dropped or misrouted.

This PR changes that. It adds some additional plays to determine what users and domains exist and modifies the template to not add those that do. It also adds an option for `active: False` for each object (domain, user, alias), which will remove it from the database if it exists. Domains are sent through two tests - they must be in a list of domains that exist in the database, and they must not have been deleted during this run. Users and aliases are only added for domains that pass both tests. Finally, in order to keep the `CREATE TABLE IF NOT EXISTS` logic, the three indices were moved to the table create blocks.

The result is that `import.sql` will have only the statements necessary to create the tables and add/remove objects that _need_ to be added or removed. Users or aliases left behind for deleted domains are ignored. Nothing is dropped, so once users have the ability to change their passwords, the integrity of those passwords is preserved, and I, as the admin, do not know what they are. This final point is very important for trust.

This PR is applied against your current master branch, so it is not dependent on anything I've already submitted. I had to provide `ansible.cfg` in order to enable the Jinja `do` extension, so I tossed in some other harmless configuration options that make for nicer command-lines at runtime.
",oskapt,2016-09-11 14:18:56
576,2016-07-13 17:11:07,"In general I'm in favor of this approach (especially due to the race condition issue, though I wonder if a transaction and appropriate transaction isolation could solve that too?) But the trust issue isn't necessarily a problem with the current approach, you can provide a separate UI for users to provide a password and you just get the hash to integrate into the Ansible config. You're going to have access to their password hash regardless, that's not a problem.
",carljm,2016-09-11 14:18:56
576,2016-07-13 17:14:21,"Realized after posting PR that it didn't handle a case where a user was removed from the configuration but still in the db. I now check for that and remove from the db (config is god). Same for aliases - if no user exists (deleted in this run or otherwise), aliases are removed.
",oskapt,2016-09-11 14:18:56
576,2016-07-13 17:18:23,"@carljm - My thought here is that users changing passwords updates the database (if I use the roundcube plugin, which is what I'll be poking at next). If passwords are already in the database, then I just need to not clobber them. That's a _lot_ less work than having some external setup that grabs the password, encrypts it, puts it in Ansible, and then runs Ansible to update the database. Users also expect their password change to be instantaneous. Even if I update the database directly, then extract those passwords and update Ansible, it's clunky. Now my mailserver is updating my sovereign repository, and for most users, the Ansible configuration doesn't live on the mailserver. Git, SSH, push permissions...what I have here is far easier to manage.
",oskapt,2016-09-11 14:18:56
576,2016-07-13 17:25:45,"@oskapt yeah, I get your thinking, and I've wrestled back and forth with this same question. But it still seems to me that there's some conceptual inconsistency in this PR. Right now, as you say, ""config is god,"" in every aspect. Whatever's in the config is guaranteed to match what's actually used (assuming you've run Ansible.)

After this PR, ""config is kinda-sorta-mostly-god, but only in terms of which records exist, not necessarily in terms of their data attributes -- various things could be changed directly in the database and will then not match your config, and that inconsistency could persist indefinitely."" I understand why that seems useful for passwords, but it definitely doesn't seem like an improvement in terms of simplicity or clarity of the mental model.

I wonder if there'd be some way to do this that applied _only_ to password hashes, and removed password hashes from the Ansible config entirely? I just really don't like the idea of having stuff in Ansible that is permanently out-of-sync and misleading.
",carljm,2016-09-11 14:18:56
576,2016-07-13 18:02:29,"@carljm It's a dilemma, for sure. I've run sovereign for ~2y at home, where my wife doesn't care if she can't change her password. I'm deploying it for a small office environment now, and they _do_ care. The workflow now with Fastmail is I set them up and give them their initial password and then tell them to change it. If they forget it, I can go back and reset it. I see this change for sovereign as the same logic. I set your initial password in the config and you change it. From that point on the password hash is ignored, as I believe _it should be_. I could add a `force: True` flag that would act as a password reset, so that the ""setting and resetting of passwords"" is still within the sysadmin domain, whether it's Ansible or some other tool.

In this configuration there is no other tool, so enabling Ansible to act like any other admin/management tool for passwords seems like the right move.

I don't know whose decision it is to merge or not merge these things - I'm just handing them over because they seem useful. I'm running them all in production, and they all solve specific problems I've encountered w/ sovereign.

FYI - I fixed the index issue with virtual aliases. I've only tested it on Postgres 9.1. If someone can test the IF/THEN for 9.4, that would be great. Otherwise w/ 9.5 it solves itself.
",oskapt,2016-09-11 14:18:56
576,2016-07-13 18:44:40,"@oskapt I'm not a maintainer/committer, so the merge decision isn't up to me :-) Definitely appreciate you sharing your work back!
",carljm,2016-09-11 14:18:56
576,2016-08-09 12:51:22,"I appreciate how this solves a real problem. It does, however, as @carljm  points out, run contrary to the idea of the ansible configuration specifying precisely the desired state of the server.

edit: correct @mention
",ariddell,2016-09-11 14:18:56
576,2016-08-09 15:35:21,"I think the answer to ""should I know every user's password and should they never be able to change them"" trumps the philosophical dilemma of ""should Ansible control everything.""  Adding `force: true` or something still gives me the ability to override it during Ansible.

Ansible replaces actions that I would do manually, assuring that they are done consistently. Any action that I would do, it does for me. I would reset a password when it's lost. I would not reset everyone's password every time I add a new account.
",oskapt,2016-09-11 14:18:56
576,2016-08-10 08:42:45,"@oskapt I appreciate the effort you put into this.  Thank you.  Could you separate the problem(s) you are trying to solve from your implementation?  @carljm is making some good points, for example, about alternative and probably more robust ways of addressing the race condition that exists when rerunning the mailserver role concurrent with mail delivery.  As for password management, I want to be sure I understand what you're trying to accomplish.  I suggest opening two separate issues, and let's work through it there so we can document the thinking.
",mikeashley,2016-09-11 14:18:56
576,2016-08-10 13:37:51,"Please see #581 and #582 for the issues you requested.

I move fast. Sorry that I don't open issues first. I'm the sole admin in a fast-moving company with little tolerance for stuff not working. They don't understand much about IT, so I don't have the luxury of working through solution options over several weeks - when I find something that doesn't work, I fix it. If I don't, I have to answer impossible questions from the company owner.

FWIW, I've been building infrastructure on the Internet for more than 20 years, and was the owner and principal architect for an MSP that built and managed datacenters for US media companies for 14 years. That's the foundation for the solutions I'm proposing.

All of the solutions you get are also post-production. I'm running them long before I submit them back to you for inclusion. That's why they're often difficult to extract into neat little branches. I actually reconstructed my whole repo yesterday so that I can give you cleaner branches to pull from while still keeping my `master` branch as the collection of all the stuff I'm actually using. I can't currently use the `master` branch because it's hung up on #573 and #574. 

If you want, you can close all of them, and we can work through them in the issues. I can generate  new PRs if you decide that you want a solution that uses the configuration I've written. They're all currently failing Travis anyway, either because they're using Ansible Vault or for some other Travis reason that isn't connected to the code I've written.
",oskapt,2016-09-11 14:18:56
576,2016-09-09 09:00:35,"I am not working on the wheezy branch.  Does any committer want to champion this PR?  If not, I will close it.
",mikeashley,2016-09-11 14:18:56
576,2016-09-11 14:18:56,"I'm going off on my own.
",oskapt,2016-09-11 14:18:56
575,2016-07-10 16:12:47,"Fixes the _""Unable to negotiate a key exchange method""_ error when trying to communicate with Github using SSH. This was caused by setting too restrictive default value for `KexAlgorithms` in SSH config file.

Related links:
- [testing Github SSH connection](https://help.github.com/articles/testing-your-ssh-connection/)
- [article containing a fix](https://stribika.github.io/2015/01/04/secure-secure-shell.html)
",tomasbedrich,2016-07-12 17:04:23
574,2016-07-08 15:28:36,"Sorry if this is messy - I'm doing this for myself and don't seem to be very good at keeping it organized for you.  I'm doing this in its own branch so that new commits don't sneak in after submitting the PR. I'll keep my master pulling from yours so it's clean.

This PR contains everything from the first PR and also:
- private information now stored in `vars/private.yml` (password: `sovereign`)
- documentation updates (new README in `vars` and updates to main README)
- teardown plays for everything except roundcube and mailserver (`no_foo.yml` for each role and task)
- minor updates, like `cache_valid_time` to keep things snappy on repeat runs

I built a default install from the earlier PR and then individually tore down each component to make sure they all work. 

This is the last major PR I'll be submitting for the moment. This branch will be the branch from which I deploy our production server.
",oskapt,2016-09-11 14:18:44
574,2016-07-09 00:29:19,"in this case travis gets stuck on the vault password. you can solve this by writing out the password (sovereign) to a file and using `--vault_password_file` to point to it in the command.
",oskapt,2016-09-11 14:18:44
574,2016-07-12 16:46:38,"Added some changes to fix errors discovered today. I tested with installing roles and then uninstalling them, but I didn't test with never installing the roles to begin with. There were some errors on stopping nonexistent services - these are now ignored.
",oskapt,2016-09-11 14:18:44
574,2016-07-12 17:03:52,"These are great PR's, but they are huge.  :)  It would probably help the review and merging process if the various things you are trying to do were broken down into separate PRs that didn't touch so many files at one time.
",jplock,2016-09-11 14:18:44
574,2016-07-12 17:40:33,"Is that really appropriate? I'm adding a `no_thing.yml` for every role. It's really the _same_ thing, just in all the roles. Should I submit one PR per role that does the same thing?

Same with moving variables into `private.yml` with Vault. Same thing with fixing all the lint stuff.  Do you want me to submit 50 PRs, one for each part of the same task?
",oskapt,2016-09-11 14:18:44
574,2016-07-12 17:40:54,"Hate that the close button is closer than the comment button.
",oskapt,2016-09-11 14:18:44
574,2016-09-09 08:59:40,"I am not working on the wheezy branch.  Does any committer want to champion this PR?  If not, I will close it.
",mikeashley,2016-09-11 14:18:44
574,2016-09-11 14:18:44,"I'm going off on my own.
",oskapt,2016-09-11 14:18:44
573,2016-07-06 18:42:46,"Most of these are cleanup after running `ansible-lint` on the master branch. There were a bunch of more-complicated/less-valuable suggestions, but I took on the easy ones. I also fixed stuff that generates deprecation warnings in Ansible >= 2.0.

In doing this I stumbled across a bug in `newebe.conf` where it wasn't notifying supervisor correctly. This has also been fixed (no issue seems to exist for it).

I'll be sending you two more pull requests in coming days that will be built on top of these changes. I'm telling you this now so that you can consider what's coming in your decision to merge the changes provided here. 

One adds a bunch of `no_X.yml` tasks so that users who install X can later uninstall it and have all of the configuration reverted. For example, I run my own bouncer elsewhere, so I don't want `znc` left floating around. I run Openfire for XMPP, so I don't want `prosody` hanging around. I simply replace `znc.yml` with `no_znc.yml` in the `include` directive in `main.yml` for the role, and the magic happens.

The second PR reflects changes that move security items into Ansible Vault. This includes all passwords, certificates, and the tarsnap key. I've updated the documentation accordingly. 

I need to test that those changes work on a default install, which is why they're not included here. I also figure that even if you reject the `no_X` and Vault changes, having some cleanup from `ansible-lint` can't hurt.

Hopefully you'll accept them all. If not, I'll just continue running my own fork of this project.
",oskapt,2016-09-11 14:18:01
573,2016-07-07 14:30:23,"there's a typo in `ansible.cfg` - inventory directive should be `inventory` instead of `inventory_file`. it's fixed in my master branch. not sure what i was thinking when i made that change or how it missed testing. sorry.
",oskapt,2016-09-11 14:18:01
573,2016-07-08 01:33:48,"looks like travis is borked.
",oskapt,2016-09-11 14:18:01
573,2016-07-08 01:43:01,"Thanks for these changes.  I think they look pretty good and safe to apply.
",jplock,2016-09-11 14:18:01
573,2016-08-09 19:36:57,"i cherry-picked all the relevant lint stuff into a new branch: oskapt/lint-cleanup. might be easier to work with.
",oskapt,2016-09-11 14:18:01
573,2016-08-11 21:07:59,"This is great. Is this all ready? Also -- it would be great to have a separate PR making all these changes targeting the jessie branch.
",ariddell,2016-09-11 14:18:01
573,2016-09-09 08:58:54,"I am not working on the wheezy branch.  Does any committer want to champion this PR?  If not, I will close it.
",mikeashley,2016-09-11 14:18:01
573,2016-09-11 12:13:16,"What version of ansible and ansible-lint were you running against when you made these changes?  Your note suggests a version of Ansible > 2.0, but we currently pin master at version 1.6.6, and I didn't see a change to `requirements.txt` or `test-requirements.txt`.

Given that these are lint cleanups, please do get this PR working with TravisCI before continuing.
",mikeashley,2016-09-11 14:18:01
573,2016-09-11 14:18:01,"Pinned to Ansible 1.6, eh? No, thanks.
",oskapt,2016-09-11 14:18:01
572,2016-07-03 10:09:19,"The `private_key` variable used to check for changes was never
registered.
",mikeashley,2016-07-03 10:10:07
571,2016-06-26 19:50:44,,cimm,2016-06-26 19:50:59
571,2016-06-26 19:51:41,"Sorry, wrong pull request. üò¢ 
",cimm,2016-06-26 19:50:59
570,2016-06-23 19:28:49,"Getting my feet wet with Ansible and trying to get the `jessie` branch working on my server. Saw the following warning and thought is was an easy candidate to find out how to help the project a tiny little bit.

<S_CODE_TOKEN>

Using Ansible 2.1.0.0.

The diff should be self explanatory. Someone probably accidentally duplicated the `when` statement when adding the Let's Encrypt test recipes meaning that [line 97](https://github.com/sovereign/sovereign/pull/570/commits/264c232bbfd63ac7f2b1a9f7a843b80fe68d3b66#diff-5edbcf92d4f29eadd38d08e1358f740cL97) is ignored as Ansible only looks at the last `when` statement.

This is a mini insignificant fix and I am new to both Ansible and this project so feel free to close and ignore the pull request. Thank you for building Sovereign.
",cimm,2016-07-03 08:48:39
570,2016-07-03 08:48:30,"Looks good.  Thank you!
",mikeashley,2016-07-03 08:48:39
569,2016-06-13 14:57:13,"Hi@all,

how i can control / administrate the mail addresses and the alias?  
",approached,2016-07-03 09:03:24
569,2016-06-24 15:14:31,"Is the database structure compatible to: http://postfixadmin.sourceforge.net/
",approached,2016-07-03 09:03:24
569,2016-07-03 09:03:24,"Duplicate of #448.
",mikeashley,2016-07-03 09:03:24
568,2016-06-12 21:22:30,"- Harvest testing configuration into group variables
- Define testing group for Vagrant to use
- Move testing passwords to secrets directory that Vagrant uses
- Update .gitignore to keep the testing secrets
",mikeashley,2016-06-13 12:42:03
567,2016-05-30 09:19:49,"The directives provided by `mod_access_compat` are deprecated.  This
patch eliminates references to them.
",mikeashley,2016-07-03 08:49:55
566,2016-05-27 22:27:23,,mrwacky42,2016-06-04 16:00:01
565,2016-05-27 21:52:14,"Enforce `tls-min-version` on the client side configuration.

See also #561 
",mrwacky42,2016-05-27 22:27:05
565,2016-05-27 22:20:17,"Thanks for this. The target branch should be jessie. (I think requiring TLS 1.2 will break older openvpn clients that are currently working fine.)
",ariddell,2016-05-27 22:27:05
565,2016-05-27 22:27:05,"I'm actually running on CentOS...
",mrwacky42,2016-05-27 22:27:05
565,2016-05-27 22:27:34,"Closed in favor of #566
",mrwacky42,2016-05-27 22:27:05
564,2016-05-27 21:49:58,"The ciphers have changed and there's a new minimum version requirement.
",ariddell,2016-05-27 22:16:52
564,2016-05-27 22:16:52,"Fixed.
",ariddell,2016-05-27 22:16:52
563,2016-05-27 21:02:46,,ariddell,2016-05-28 09:38:45
562,2016-05-27 20:37:16,"sudo doesn't come installed by default when installing jessie from an .iso or when using Digital Ocean's Jessie 8.3.
",ariddell,2016-05-28 09:40:33
561,2016-05-24 06:25:18,"A couple more tips from https://blog.g3rt.nl/openvpn-security-tips.html
- tls-min-version (on client side)
- remote-cert-eku
- verify-x509-name
",mrwacky42,2016-05-27 21:29:24
561,2016-05-26 17:11:25,"My sense is that none of this is needed. We are distributing certificates. There's no need to check CN or extended key usage.
",ariddell,2016-05-27 21:29:24
561,2016-05-26 17:18:40,"The justification for tips 1 & 2 is here: https://blog.g3rt.nl/openvpn-security-tips.html.
Just more extra armor to make sure you aren't being MITM'd
",mrwacky42,2016-05-27 21:29:24
561,2016-05-26 18:36:44,"I don't think there's a MITM threat here. The client has a copy of the
server certificate on disk and that server certificate is self-signed.
Am I missing something?

On 05/26, Sharif Nassar wrote:

> The justification for tips 1 & 2 is here: https://blog.g3rt.nl/openvpn-security-tips.html.
> Just more extra armor to make sure you aren't being MITM'd
> 
> ---
> 
> You are receiving this because you commented.
> Reply to this email directly or view it on GitHub:
> https://github.com/sovereign/sovereign/pull/561#issuecomment-221936190
",ariddell,2016-05-27 21:29:24
561,2016-05-27 21:29:24,"Our OpenVPN server certificate is self-signed and we distribute the OpenVPN CA certificate so there's no MITM threat. The only way to impersonate the OpenVPN server would be to obtain a copy of the private key on the server. At this point we're just simply compromised.
",ariddell,2016-05-27 21:29:24
561,2016-05-27 21:33:32,"Ok, these changes don't hurt anything either..
",mrwacky42,2016-05-27 21:29:24
561,2016-05-27 21:47:53,"My sense is that some of these changes _are_ unhelpful. They add unnecessary complexity. More importantly, the first and second tips in the linked blog post are connected to the centralized/ICANN PKI infrastructure that many people are trying to move away from.

The `tls-min-version` is probably a good idea. Want to put that in a PR?
",ariddell,2016-05-27 21:29:24
560,2016-05-21 13:46:23,"Currently client email is submitted on port 465.  This has been
deprecated for years.  The correct way to submit email is on the
submission port (587).

This patch makes this change.  The postfix master.cf file is modified to
use the submission port, carrying over relevant configuration from the
smtps port.  Both firewall rules and the email autoconfig file are
updated accordingly.
",mikeashley,2016-07-03 08:57:20
560,2016-05-21 13:49:09,"This addresses #374.  Please review.  Specific questions:
- I did not carry over `wrappermode` based on [this guidance](http://www.postfix.org/TLS_README.html#server_enable).  Ok?
- My update to `autoconfig.xml` specifies STARTTLS with the expectation the server will require TLS because `security_level` is `encrypt`.  Ok?
",mikeashley,2016-07-03 08:57:20
560,2016-05-21 13:53:33,"I tested the postfix/firewall change.  I have not tested the autoconfig change but checked an example online, so I believe it's right.
",mikeashley,2016-07-03 08:57:20
560,2016-05-22 09:28:08,"Although 465 is depreciated there has been a recently increase in desire to use it - the problem with 587 is that people can do mitm attacks to block STARTTLS, and some clients will stop doing TLS at that point, which is not desirable!

465 on the other hand is TLS only.

There's no harm in doing both.
",JasperWallace,2016-07-03 08:57:20
560,2016-05-23 07:19:40,"This patch configures 587 to be TLS only.  It does send STARTTLS but requires the client to request a TLS connection.  According to the docs, the `wrappermode` semantics are a bit different but give you TLS also.

Indeed, there is no harm in doing both, and doing both would make this change backwards-compatible with our existing setup.  Any disagreement on enabling both?
",mikeashley,2016-07-03 08:57:20
560,2016-05-30 09:35:44,"I updated this PR to leave port 465 open, and the commit message is reworded.  I believe this is ready to go if somebody can take a final look.
",mikeashley,2016-07-03 08:57:20
560,2016-05-30 11:30:22,"Looks good to me. :balloon: 
If you merge pull request #507 please make sure to change the port there, too.
Thanks! 
",neuhaus,2016-07-03 08:57:20
560,2016-05-30 20:29:31," @Yannik do you have any thoughts about @JasperWallace's comment and/or this PR?
",ariddell,2016-07-03 08:57:20
560,2016-06-04 21:26:22,"I was testing this along with the roundcube PR, and when I clicked 'Send', this error poped up:

> SMTP Error (-1): Connection to server failed.

And here's the error logs:

<S_CODE_TOKEN>

I double checked and the submission port was open as expected, and I had updated the roundcube configuration to use port `587` instead of `465`.
",aminb,2016-07-03 08:57:20
560,2016-06-04 22:27:58,"I have not updated PR #507.  In addition to changing the port number, I think you'll need to use `tls://{{ mail_server_hostname }}` instead of `ssl://...` for the smtp server in roundcube's configuration file.
",mikeashley,2016-07-03 08:57:20
560,2016-06-04 23:56:11,"Oh very true, I forgot to change the prefix from `ssl://` to `tls://`, and changing that (along with the port of course) did it and it's working fine. Looking forward to seeing these PRs merged :)
",aminb,2016-07-03 08:57:20
559,2016-05-16 14:39:10,"Encfs, while handy, is far from ideal, and has several issues as posted on https://en.wikipedia.org/wiki/EncFS. 

Proposal: support full disk encryption, and boot-time dropbear to allow unlocking of the disk via SSH.
(unlock could be done via an expect script from a remote site, in case the server goes down frequently, via cron/...)

Something as stupid as 

<S_CODE_TOKEN>

already does the trick.
",jdeluyck,2016-09-29 16:07:52
559,2016-05-17 15:47:26,"The default scripts provided with Debian 7 and Ubuntu 14.04 for doing this are broken.

There are some alternatives:
- Ext4 encryption (see issue #468)
- [securefs](https://github.com/netheril96/securefs), ""a better transparent encryption filesystem""

See also: Solved issue #120 which already makes encfs optional.
",neuhaus,2016-09-29 16:07:52
559,2016-09-29 16:07:52,"I'd like to keep this out of sovereign at the moment.
Putting the entire machine into an encrypted root partition is something you can do already prior to setting up sovereign.
EncFS is already optional. You are welcome to improve the documentation in this regard.

A PR to use securefs instead of EncFS would be interesting.
",neuhaus,2016-09-29 16:07:52
558,2016-05-13 11:00:22,"https://www.eff.org/deeplinks/2016/05/announcing-certbot-new-tls-robot

There may be a need to update the scripts...
",tomasbedrich,
558,2016-05-21 10:46:02,"See also https://certbot.eff.org/#debianjessie-apache.
",mikeashley,
557,2016-05-07 09:51:16,"I am using Debian Jessie and everything is working fine, except of this cron task, which is failing. Here is the log:

<S_CODE_TOKEN>
",tomasbedrich,2016-09-29 16:33:51
557,2016-05-07 10:31:40,"I am not seeing that on my server.  Perhaps replay the mailserver playbook with the dmarc tag and see if there is anything strange?  From the log it looks like the database is misconfigured.
",mikeashley,2016-09-29 16:33:51
557,2016-05-08 09:34:50,"Replaying the playbook with `--tag=dmarc` completed successfully and gave me this result:

<S_CODE_TOKEN>

Nothing was changed and everything seems to be okay from the perspective of playbook.

I was digging a little bit deeper and opened the MySQL DB and _it was empty_ - so even after replaying the playbook, the schema hasn't been created. Therefore I have created the schema manually using `mysql -u opendmarc -p < /usr/share/doc/opendmarc/schema.mysql` and it works now.

The DB was empty - my fault, I know. But I think there is also a problem with the playbook, more concretely [with this line](https://github.com/sovereign/sovereign/blob/jessie/roles/mailserver/tasks/opendmarc.yml#L29). The notify handler won't execute unless DB is created so _the schema cannot be re-created separately_. What do you thing about separating the schema import task?
",tomasbedrich,2016-09-29 16:33:51
557,2016-05-08 14:13:02,"I made that change. Previously the schema always re-imported on every run. 

Ideally the schema import would be a task that runs conditionally based on a more detailed check (like, do the tables exist). The ideal check would be for a complete schema match, not sure that's feasible.

Anyway if you're able to put together a PR along those lines I'd be in favor, but I don't think we should go back to ""schema import always runs unconditionally.""
",carljm,2016-09-29 16:33:51
557,2016-05-08 14:16:50,"Probably what happened in your case was that an Ansible run crashed after creating the db but before handlers were run. 
",carljm,2016-09-29 16:33:51
557,2016-05-09 08:49:20,"I agree with @carljm.  We shouldn't run the import script unconditionally.  I've seen such import scripts unconditionally drop tables if they already exist.  This would not be good if replaying a playbook on a system that has been running for a while.

Before making a change, we should understand what really happened.  Can the problem be reproduced in a test setup?
",mikeashley,2016-09-29 16:33:51
557,2016-05-09 22:33:38,"I am 95% sure that my guess above about what happened is correct. It's a general problem with Ansible handlers. If a later task fails and the Ansible run aborts before running handlers, the handlers won't ever run (because the task that triggered them won't report changed next time). Moving away from using a handler for this would take care of that.
",carljm,2016-09-29 16:33:51
557,2016-05-17 15:23:48,"Sorry for the delayed reply, guys. I cannot confirm what actually happened, but I think @carljm is correct. The [OpenDMARC schema](http://apt-browse.org/browse/ubuntu/trusty/universe/amd64/opendmarc/1.2.0+dfsg-1/file/usr/share/doc/opendmarc/schema.mysql) is using `IF NOT EXISTS` clauses, so what's the problem of running it unconditionally? The SQL engine will handle the potential conflict.
",tomasbedrich,2016-09-29 16:33:51
557,2016-05-17 15:50:26,"I was going to suggest using `IF NOT EXISTS` for the schema statements - if it already uses them I see no harm in doing them on every playbook invocation.
",neuhaus,2016-09-29 16:33:51
557,2016-05-17 17:06:57,"I don't like it because it makes the play report ""changed"" every time; I couldn't find a way to properly detect changed status. Also it's slower :/
",carljm,2016-09-29 16:33:51
557,2016-05-17 18:30:10,"Ok, I understand your opinion. At least it might be interesting [to rewrite the playbook using `register` keyword](http://stackoverflow.com/a/28840013/570503) to minimize the time between creating the DB and running the import.

Another option would be to write a script which would do the import, count a number of created tables and return an appropriate exit code for ansible, which would handle it using `changed_when` keyword. But honestly, I have no idea, how to ""cleanly"" count the number of created tables.
",tomasbedrich,2016-09-29 16:33:51
557,2016-12-22 19:10:18,@tomasbedrich thanks for the workaround,nfedyashev,2016-09-29 16:33:51
556,2016-05-03 22:38:33,"Hi, Hi am am very new with linux so please bare with me, I have managed to set up my ssh connection so I can login to my server with putty and do not require to enter a passwword, but when I try and run the script I get the following error:

![scree](https://cloud.githubusercontent.com/assets/12296640/15000674/7e8264ae-1189-11e6-9bf2-7d5044b18803.JPG)

Anyone any ideas what I could be doing wrong? Cheers
",scouseman,2016-05-21 10:44:17
556,2016-05-21 10:44:17,"This appears to be a basic setup problem with your server.  I recommend you check your hosting providers documentation and make sure you can login from a shell via SSH.
",mikeashley,2016-05-21 10:44:17
555,2016-05-03 07:04:23,"- NameVirtualHost is [not needed anymore](https://httpd.apache.org/docs/2.4/mod/core.html#namevirtualhost) since version 2.3.11
- SSLCertificateChainFile is [deprecated](https://httpd.apache.org/docs/current/mod/mod_ssl.html#sslcertificatechainfile), SSLCertificateFile was extended to also load intermediate CA certificates from the server certificate file since version 2.4.8. See also Let's Encrypt [user guide](https://letsencrypt.readthedocs.io/en/latest/using.html#where-certs).
",Dosenpfand,2016-05-04 12:34:49
555,2016-05-04 12:34:47,"Thanks!
",ariddell,2016-05-04 12:34:49
554,2016-05-01 20:21:39,"Unfortunately I made a duplicate of #553. üòû So for description, please see that PR.

But additionally there are `--pre-hook` and `--post-hook` used for renewal, which ensures apache won't be restarted unless necessary. [This is pretty new in LE client](https://community.letsencrypt.org/t/client-version-0-5-0/13770).

Also I have changed a cron frequency to daily, [as described on LE website](https://letsencrypt.org/getting-started/):

> We recommend running renewal scripts at least daily, at a random hour and minute. This gives the script many days to retry renewal in case of transient network failures or server outages.
",tomasbedrich,2016-05-03 07:51:27
554,2016-05-01 23:56:32,"There's a spelling error in the title of your second comment (Chaged => Changed).
",mikeashley,2016-05-03 07:51:27
554,2016-05-01 23:57:58,"Good idea to use pre-hook and post-hook.  Have you tested them to be sure they work as expected?
",mikeashley,2016-05-03 07:51:27
554,2016-05-02 00:50:40,"Yes, I have tested the hooks with LE `--dry-run` option and they seemed to work fine.

Sorry for the spelling errors, but I am not going to fix them, because I don't want to break something by amending commits which are already public. 
",tomasbedrich,2016-05-03 07:51:27
554,2016-05-02 07:43:53,"I believe it would be ok to force-push an update to this branch.  It's been done before to clean up a PR after feedback, and I would rather have a clean history.

Also, any thoughts on the line note about service restarts?
",mikeashley,2016-05-03 07:51:27
554,2016-05-02 10:13:03,"Okay, I have force-pushed the fixes and changed the hook system work consistently for both, pre and post renewal hooks. The apache start/stop commands are now placed as separate scripts in `/etc/letsencrypt/{pre,post}renew/apache`

Here is the log with `--dry-run` and `-v` options, from which I assume everything is working fine.

<S_CODE_TOKEN>
",tomasbedrich,2016-05-03 07:51:27
554,2016-05-02 22:35:59,"Reviewed; lgtm.
",carljm,2016-05-03 07:51:27
554,2016-05-03 00:08:04,"@tomasbedrich This is looking better. Since you're proposing we run the renewal check daily, I want to be sure: the pre-hook and post-hook only run if the certificates need to be renewed, correct?  It looks that way from the log you posted.  Have you (or @carljm?) done any more checking to be sure about the semantics of those options?
",mikeashley,2016-05-03 07:51:27
554,2016-05-03 07:44:22,"These commands are executed _once_ before all renewals (if any) and _once_ after them. As cited from [version 0.5.0 changelog](https://community.letsencrypt.org/t/client-version-0-5-0/13770):

> Pre-hook commands will be run before any certs are renewed, post-hook commands will be run after any certs are renewed ... If no certs are due for renewal, no command is run.

No additional checks done by me so far.
",tomasbedrich,2016-05-03 07:51:27
554,2016-05-03 07:51:19,"Thank you for checking on that.  And thank you for the PR!
",mikeashley,2016-05-03 07:51:27
553,2016-05-01 09:33:57,"LE client no longer accepts lists of domains for certificate renewal and
instead renews all installed certificates due to be renewed.  This is
the behavior we want, and it simplifies the script.
",mikeashley,2016-05-03 07:52:36
553,2016-05-03 07:52:31,"Rescinded.  PR #554 taken instead.
",mikeashley,2016-05-03 07:52:36
552,2016-04-28 22:37:15,"The fail2ban config for dovecot was referring to a log file /var/log/maillog, which does not exist. It should be /var/log/mail.log. This causes fail2ban to fail to start. I only noticed because that in turn caused the post-rotate script for fail2ban's logrotate config to error out.
",carljm,2016-04-28 23:17:21
552,2016-04-28 23:24:47,"Thanks!
",mikeashley,2016-04-28 23:17:21
550,2016-04-25 12:08:42,"There's an issue with packages not receiving security updates.
https://www.wilderssecurity.com/threads/ubuntu-lts-many-vulnerabilities-despite-long-term-support.385386/
has some details.

We need to make a list of affected packages, perhaps also track their [https://people.canonical.com/~ubuntu-security/cve/universe.html](vulnerabilities) and perhaps move to packages in the main tree, if possible.
",neuhaus,
550,2016-04-25 15:21:01,"Maybe you could run `debsecan` on a base sovereign install and list the affected packages in the readme.

I use `debsecan | grep -i high | grep -i remote` or `debsecan | grep -i high` depending on what info I need.
",nodiscc,
549,2016-04-22 21:47:22,"The ownCloud configuration file does not get touched.  The virtual host
configuration is modified by sovereign but can be updated in place and
Apache restarted.
",mikeashley,2016-05-21 16:29:59
548,2016-04-17 17:00:50,,Dosenpfand,2016-04-26 10:11:01
548,2016-04-18 08:31:06,"What error do you see if this is omitted?  You shouldn't need it if you don't include the blog role.
",mikeashley,2016-04-26 10:11:01
548,2016-04-19 16:42:39,"I get a DNS  error by letsencrypt, because the entry does not exist:

> Domain: www.mydomain.com
> Type:   connection
> Detail: DNS problem: NXDOMAIN looking up A for www.mydomain.com

Upon closer inspection I think it should not fail otherwise since [letsencrypt-gencert](https://github.com/sovereign/sovereign/blob/jessie/roles/common/files/letsencrypt-gencert) checks the hosts existense first. I don't know why it failed in my case.
Nevertheless I think the README should include the www entry, maybe with it's role. 
",Dosenpfand,2016-04-26 10:11:01
548,2016-04-22 12:54:19,"#524 is related. What if we just skipped the naked domain entirely and shifted the blog to www.domain?
",ariddell,2016-04-26 10:11:01
548,2016-04-22 13:09:39,"I'm not sure it's related.  Root cause on this one still hasn't been identified.
",mikeashley,2016-04-26 10:11:01
548,2016-04-25 08:37:09,"@Dosenpfand This is a good update to the README.  Please squash the commit, and I'll merge it in.
",mikeashley,2016-04-26 10:11:01
548,2016-04-26 07:39:29,"@mikeashley done
",Dosenpfand,2016-04-26 10:11:01
547,2016-04-15 09:32:34,"This is done to suppress warnings from ansible-lint.
",mikeashley,2016-04-15 17:40:11
547,2016-04-15 17:29:19,"LGTM, I'd say merge it.
",carljm,2016-04-15 17:40:11
546,2016-04-09 19:07:07,"I want to move my real server over to jessie.  I need to migrate the following:
- mail for three users
- owncloud (files, contacts, calendars)

I'm not doing this migration in place but do want to keep the same domain name.  How do the pros handle this?
",mikeashley,2016-04-18 08:51:01
546,2016-04-18 08:51:01,"I added a page on the wiki.
",mikeashley,2016-04-18 08:51:01
545,2016-04-09 19:01:30,,mikeashley,2016-04-22 11:35:03
545,2016-04-22 11:35:03,"This is a bad patch.  It only works if ownCloud is already installed.
",mikeashley,2016-04-22 11:35:03
544,2016-04-09 12:47:08,"Depending on when the client is run, there are no certificates to
update.  By default, the client runs in interactive mode and wants to
notify the user of this.  This causes Ansible to hang waiting for an
acknowledgement that will never come.  Adding the non-interactive flag
fixes this.
",mikeashley,2016-05-21 16:27:00
544,2016-04-09 12:55:09,"I cannot reproduce the CI build errors from `ansible-lint`.  Is anybody else seeing this?
",mikeashley,2016-05-21 16:27:00
544,2016-04-14 21:57:30,"I do get those errors locally, not only on this branch but on the main `jessie` branch too. It probably depends on ansible-lint version? I have 2.6.1.

If it is just a new warning in a more recent ansible-lint, it should be fixed, but also doesn't need to hold back this PR.
",carljm,2016-05-21 16:27:00
543,2016-03-30 09:28:04,"OpenVPN can be forced to use TLS version 1.2 (the current, most secure version).
Debian Jessie ships with OpenVPN 2.3.4 which [has a bug](https://community.openvpn.net/openvpn/ticket/401) and defaults to TLS 1.0, however Ubuntu Xenial will come with 2.3.10 so we can use the option `tls-min-version 1.2` there.

The template file `sovereign/roles/vpn/templates/client.cnf.j2` needs to be changed.
",neuhaus,
543,2016-03-30 09:32:31,"I looked at the OpenVPN bug and it's not clear to me if setting `tls-min-version 1.2` will work on OpenVPN 2.3.4 (assuming it's set on the peer as well). Could someone please check?
",neuhaus,
542,2016-03-30 09:26:13,,johngian,2016-03-30 10:22:30
542,2016-03-30 09:27:58,"The configuration generated by sovereign regarding znc doesn't create some folders required by znc. This causes all the user/modules changes and content not to be persistent in the disk.
",johngian,2016-03-30 10:22:30
542,2016-03-30 09:36:33,"I don't use ZNC myself. 
What do you think about using per-user files for ZNC in `~/.znc/`?
",neuhaus,2016-03-30 10:22:30
542,2016-03-30 09:45:52,"We are using a custom `datadir` when running the znc service:
`/usr/bin/znc --datadir=/usr/lib/znc`

That means that the path where znc saves everything is going to be `datadir`.

Also we are creating a user/group named `znc` to spawn the `znc` daemon and this user's home is `/usr/lib/znc`. That means that `~/.znc` will be `/usr/lib/znc/.znc` which doesn't really make sense because of `datadir`.
",johngian,2016-03-30 10:22:30
542,2016-03-30 10:22:43,"OK, thanks for clarifying and thanks for the pull request.
",neuhaus,2016-03-30 10:22:30
541,2016-03-27 15:58:41,"I did a clean installation of a new Debian jessie server configured using sovereign. It looks like monit configuration for pgsql/apache doesn't check the correct process `pid` files.
",johngian,2016-03-30 09:09:10
541,2016-03-30 09:09:14,"Thanks!
",neuhaus,2016-03-30 09:09:10
540,2016-03-21 20:42:42,"Hi,

i have a couple of Alias-Domains setup under a single account. Occasionally i need to send emails from those domains (which works fine with the current sovereign setup;)).
But while i was checking for valid DKIM Headers i found out, that there is a Header injected containing the original Account email:

sovereign account/login: romain@xyz.de
Then i send email from roman@aliasdomain.de:
And i get a Header showing my account:

<S_CODE_TOKEN>

I'm still trying to figure out if this is injected by postfix, fuglu but maybe someone knows the origin?

greetings,
Roman
",strowi,2016-04-14 09:12:48
540,2016-03-24 14:35:23,"I don't see that part in my Received header, I may have changed something in my setup though.

An example mail header looks like this:

<S_CODE_TOKEN>
",neuhaus,2016-04-14 09:12:48
540,2016-04-14 09:12:48,"See also https://askubuntu.com/questions/78163/when-sending-email-with-postfix-how-can-i-hide-the-sender-s-ip-and-username-in

You may want to set

<S_CODE_TOKEN>

in `/etc/postfix/main.cf`.
The thing is, this option defaults to ""no"" and we do not have it in our template so I don't understand why it even shows up for you.

I'll close the bug for now, feel free to reopen.
",neuhaus,2016-04-14 09:12:48
539,2016-03-21 16:49:42,"How can I install the system in the server?
I have tried following https://github.com/sovereign/sovereign/wiki/Setting-up-on-DigitalOcean-with-Debian-7-(INCOMPLETE) but here I am getting confused with the local and production server. 
Is there any clear instructions available?
",itsazzad,2016-04-14 13:13:34
539,2016-03-24 14:38:59,"The installations instructions are in the [README](https://github.com/sovereign/sovereign/blob/master/README.md).

You need to have a basic Debian or Ubuntu server installation before you can start with Sovereign. Pretty much all you need is the ability to SSH into the machine and run `sudo`.

The local box where you start ansible can be anything really.. you can even run Ansible on the destination server itself.

Please elaborate on the problem you are having.
",neuhaus,2016-04-14 13:13:34
539,2016-03-24 14:43:26,"@neuhaus I had tried with the readme first but the first step it is saying `1. Get a wildcard SSL certificate` where its using the file `roles/common/files/wildcard_private.key` but that file and folder is not yet available. From here starts the confusion.
",itsazzad,2016-04-14 13:13:34
539,2016-03-24 15:01:53,"OK, thanks for clarifying that. You pointed out a valid point:
The README (mistakenly) assumes that you have already downloaded the project files and unpacked them.
You can do so by clicking the ""Download ZIP"" button on the [project page](https://github.com/sovereign/sovereign). It links to https://github.com/sovereign/sovereign/archive/master.zip

Also, soon you will no longer require the expensive wildcard SSL certificate because you can use Let's encrypt instead.
",neuhaus,2016-04-14 13:13:34
539,2016-04-14 09:15:00,"@itsazzad Did that clear up the issues you have or is there still something that's unclear?
",neuhaus,2016-04-14 13:13:34
539,2016-04-14 13:13:32,"Sorry, project was cancelled. Before that I went with `Mail-in-a-Box` only because of the wildcard SSL. Next time if need may try with `sovereign` again.
",itsazzad,2016-04-14 13:13:34
538,2016-03-17 13:14:19,"The Ansible 2.0 refactor was significant. It would be useful to have a version of sovereign that's compatible with the current version of ansible.
- [ ] Get Ansible 2.0 running in the jessie branch
- [ ] Revert workarounds for pre-ansible 2.0 (#534 ?)
",ariddell,
538,2016-04-14 09:16:45,"This issue is getting more important, Xenial ships with Ansible 2.0
",neuhaus,
537,2016-03-15 04:42:23,"On my machine, I updated `/etc/hostname` and `/etc/hosts` so that my server would know itself by its canonical hostname, rather than just `localhost` (mostly because I find the default `username@localhost` shell prompt not very useful).

Would anyone else be interested in seeing those modifications built into the Ansible setup so they wouldn't have to be made manually? If there's interest from the maintainers, I'll submit a PR; should be pretty simple. Might require a new user-defined var for the canonical hostname; right now we only set the domain.
",carljm,
537,2016-04-14 09:17:24,"Yes please
",neuhaus,
537,2016-04-14 13:04:46,"I'd prefer less complexity. I've gotten used to the world of ephemeral hosts where hostnames are rarely used.
",ariddell,
537,2016-09-29 16:35:45,"OTOH this is something that could be considered outside the scope of sovereign, i.e. The hostname can be set before running sovereign
",neuhaus,
536,2016-03-15 04:27:58,"As discussed in https://groups.google.com/forum/#!msg/ansible-project/XrQ08TdtcRk/I4s7rF7GkyMJ the `mysql_db` module's `import` arg unconditionally re-runs the given SQL file, whether needed or not, and always reports `changed: true`. This PR only imports the schema after initially creating the database.

Similarly, the `file` module's `touch` arg updates the mtime and atime (which we don't need here) and always reports `changed: true`. Using `copy` instead with empty contents ensures the file exists with given ownership, but only returns `changed: true` if it was actually created or its ownership was changed.

With these changes, the OpenDMARC tasks run changed-clean for me.
",carljm,2016-03-18 08:27:04
536,2016-03-18 08:26:59,"Looks good.  Thanks!
",mikeashley,2016-03-18 08:27:04
535,2016-03-15 03:49:34,"This causes the Postgres role passwords to be encrypted rather than plaintext in the database.

It also uses the `postgresql_user` Ansible module to apply the change to the admin user's password; this fixes changed-reporting. (The previous version of that task always reported `changed: true`).
",carljm,2016-04-06 08:45:05
535,2016-03-20 09:05:24,"ownCloud configures the postgres admin user also.  Could this PR address that also with a similar change?  Should we be assuming that all users will use postfix?
",mikeashley,2016-04-06 08:45:05
535,2016-03-30 09:12:46,"Yeah, I don't see anyone switching from Postfix to something else at the moment.
",neuhaus,2016-04-06 08:45:05
535,2016-04-05 18:34:05,"Ok, I made the same change to the owncloud role's configuration of the PG admin user.

Seems like really that task ought to be centralized into a PG role rather than repeated in each role that uses PG, but that's beyond the scope I want to get into in this PR. It gets into the modularity questions that are being discussed elsewhere.

I think this is ready for merge.
",carljm,2016-04-06 08:45:05
535,2016-04-06 07:18:23,"Looks good to me.  @neuhaus, any other comments?
",mikeashley,2016-04-06 08:45:05
535,2016-04-06 08:45:16,"Looks good to me as well. Thanks for the patch.
",neuhaus,2016-04-06 08:45:05
534,2016-03-15 03:25:19,"Without this PR in Jessie, the `enabled=yes` arg on the ntp service task has no effect and always reports `changed: true`, due to https://github.com/ansible/ansible-modules-core/issues/915

This PR works around that bug to actually ensure that NTP is enabled and fix the changed reporting.
",carljm,2016-03-17 12:23:11
534,2016-03-15 04:35:04,"Also worked around the same bug for `collectd`.
",carljm,2016-03-17 12:23:11
534,2016-03-17 12:23:18,"Thanks!
",neuhaus,2016-03-17 12:23:11
533,2016-03-15 01:41:55,"Previous to this PR, because the ZNC and dovecot roles were modifying the LetsEncrypt renewal cron job in place, every subsequent run would reinstall the original version of that cron job. This causes spurious ""changed"" tasks, as well as problems if e.g. the LetsEncrypt tasks are run outside of a full run (because the cronjob will be restored to its non-updated form). This PR fixes that by making each post-renew task an independent script, found and executed by the cronjob. Tested and working.
",carljm,2016-04-09 12:39:48
533,2016-03-15 02:36:33,"Added another commit to this, which just makes the LetsEncrypt dependencies installation report its ""changed"" status correctly.
",carljm,2016-04-09 12:39:48
533,2016-03-15 02:43:44,"...and one more commit, fixing the cert-request task to actually not request a new cert if we already have one. Seems the `args:` form of passing args may only work with the ""command"" module, not the ""script"" module? Not sure, but it wasn't working, and this form does work. (Ansible 1.9.3).
",carljm,2016-04-09 12:39:48
533,2016-03-15 03:04:40,"...and one last fix, to avoid bouncing Apache unless we are actually going to generate a new cert.

At this point, the `letsencrypt.yml` tasks run clean and unchanged, and don't do anything unnecessary, when nothing needs to be done.
",carljm,2016-04-09 12:39:48
533,2016-03-30 09:15:06,"I'm confused about `roles/common/files/letsencrypt-gencert`: The script stops apache, then runs the letsencrypt client with `certonly`, then starts apache again.

Doesn't the `certonly` option require apache to be running?
",neuhaus,2016-04-09 12:39:48
533,2016-04-05 18:16:19,"@neuhaus This PR doesn't change the fact that Apache is stopped before running the letsencrypt client, it just moves that logic directly into the `gencert` script instead of having it in Ansible.

The LE config that @mikeashley set up uses the `standalone` letsencrypt plugin, which runs its own webserver, thus it needs ports 80/443 available, thus we have to shut down our Apache first.

It might be worth considering whether we should instead use the `apache` or `webroot` plugin, and have our own Apache instance serve the LetsEncrypt confirmation stuff. Then we wouldn't need to bounce it. I'm guessing @mikeashley might have more insight as to why he didn't choose that route.

See http://letsencrypt.readthedocs.org/en/latest/using.html#plugins for more on the available LE plugins.

I can (and will) add a comment into the `gencert` script clarifying the above.
",carljm,2016-04-09 12:39:48
533,2016-04-05 18:30:03,"Ok, I think I've addressed all the comments here; take another look?
",carljm,2016-04-09 12:39:48
533,2016-04-06 07:15:01,"I think these are good changes and should be merged.  @neuhaus ?

Issue #509 suggests not bouncing Apache.  We agreed this is the right thing to do.  We're just waiting for a patch from me or somebody else to make it happen.
",mikeashley,2016-04-09 12:39:48
533,2016-04-09 12:40:14,"I checked this on my test server.  So nice to see `changed=0`.  Thank you!
",mikeashley,2016-04-09 12:39:48
533,2016-04-14 00:37:49,":+1:
",carljm,2016-04-09 12:39:48
532,2016-03-14 09:00:15,,mikeashley,2016-03-14 14:34:48
531,2016-03-12 16:13:04,"Use secure https
Cheers
",spk,2016-03-12 19:19:21
531,2016-03-12 17:28:13,"+1. This was my oversight when updating the rspamd source handling. (I think I was just following the rspamd docs, which use http.) Thanks for the cleanup!
",carljm,2016-03-12 19:19:21
530,2016-03-12 09:21:54,"Jessie version of PR #528
",mikeashley,2016-03-12 14:36:20
529,2016-03-12 08:56:50,"Rmilter can implement domainkeys identified mail (DKIM).  Currently OpenDKIM is used to implement it in Sovereign.  We use Rmilter for Rspamd, so I suggest removing the opendkim package and using Rmilter instead to simplify the mailserver setup.
",mikeashley,
529,2016-03-12 17:18:12,"+1. Rmilter's DKIM support still requires OpenDKIM under the hood (though maybe just a library package, I haven't looked into details yet), so we won't be totally removing opendkim, but it will mean one less milter postfix has to talk to. 
",carljm,
529,2016-10-02 12:49:15,"BTW, in the upcoming Rspamd 1.4 and Rmilter 1.10, it is intended to use Rspamd to add [DKIM signatures](https://rspamd.com/doc/modules/dkim.html) than Rmilter. 

The same is also true for all other functions of Rmilter: [ratelimits](https://rspamd.com/doc/modules/ratelimit.html), [greylisting](https://rspamd.com/doc/modules/greylisting.html), [replies](https://rspamd.com/doc/modules/replies.html) and even antivirus scanning - that's all now in Rspamd.

I plan to add milter protocol support directly to Rspamd (perhaps, in 1.5), so Rmilter won't be needed any longer.
",vstakhov,
528,2016-03-11 14:27:45,,Yannik,2016-03-12 09:04:00
528,2016-03-12 09:01:26,"Thank you for the care you are putting into this!
",mikeashley,2016-03-12 09:04:00
527,2016-03-10 07:56:24,"Running master on a ubuntu 14.04 VPS gives me these in the  mail.log file:
`
Mar 10 07:38:24 Ubuntu-1404-trusty-64-minimal dspam[11588]: Unable to open file for reading: /decryp
ted/dspam/data/merlinux.eu/hpk/hpk.sig/56e0e34713931689415866.sig: No such file or directory
`

Is this a significant problem?  I am particularly asking since i have the feeling dspam so far lets lots of spam through to my inbox.  How can i check that dspam is actually training on my inbox/junk mailboxes properly? 
thanks for any pointers. 
",hpk42,2016-12-05 17:49:15
527,2016-03-10 08:24:13,"and when i run `dspam_stats` or `dspam_train` as either the dspam or as root user i always get `unable to attach dspam context`.  This does mean that dspam is not properly working, right? 
",hpk42,2016-12-05 17:49:15
527,2016-03-10 14:15:51,"Is there really a space in `/decryp ted/`?
",neuhaus,2016-12-05 17:49:15
527,2016-03-10 15:09:10,"nope, sorry, there isn't a space.  By now i found out that i can run `dspam_train holger@... SPAMDIR/cur INBOXDIR/cur` and that does something but i still basically basically get lots of spam in my inbox, even the same messages.  Also i found out that i need to check for the `X-DSPAM-RESULT: Spam` header in my sieve file instead of the `X-SPAM-FLAG` which i found on the web.

Basically my question now is if sovereign configures  dspam/dovecot by default to work out of the box including training messages i move from inbox to junk.
",hpk42,2016-12-05 17:49:15
527,2016-04-14 08:57:58,"I'm not very familiar with dspam, hopefully someone else can provide some insight.
",neuhaus,2016-12-05 17:49:15
527,2016-08-22 13:32:21,"By default dspam trains on messages that it passes through as being ham, essentially reinforcing its own conclusion unless told otherwise. There is no provision within the sovereign configuration for telling it otherwise. You can move messages to Junk, but they will stay there. 

I've modified my install of sovereign with files you can find in [this gist](https://gist.github.com/oskapt/0316f402dd3f8ee986f9d40a61713df6)

The steps are:
1. create a new playbook in the `mailserver` role called `local.yml` for local mods
2. add the template for `junk_training.sh` in `templates/`
3. add the two support scripts in `files/`
   - `decrypted_dspam_antispam_update-cut.sh`
   - `decrypted_dspam_antispam_update-filter.sh`

With these items we get the following:
- dynamically extract domains from `/decrypted` by looking for top-level directories owned by `vmail`
- crawl this list every 30 minutes (via cron), looking for users' `Junk` folders
- for every message in `Junk` retrain and move to `Spam`
- if we don't have a `Spam` folder for the user, create one
- if we don't have a `Ham` folder for the user, create one
- for any user with messages in the `Ham` folder, retrain as non-spam and move to `INBOX`
- additionally, go through every day and delete spam older than 30 days for everyone

This works great. I move messages to Junk, and within 30 minutes they're in Spam. If I find a message in Spam that isn't spam, I move it to Ham, and within 30 minutes it reappears in my inbox.

The only issue with this script, also recognized by the author on line 50, is that it moves to INBOX instead of pushing it back through maildrop to go through sieve rules. It hasn't yet become annoying enough for me to fix it. It also doesn't mark messages as read, so my spam folder always shows some number of unread messages. Also not yet annoying enough for me to fix.

`dspam` takes a while (2 weeks or so) to figure out what you consider to be spam, after which it starts working well. Because it self-trains on Ham, you don't have the normal Bayesian issues of also having to train it on what is not spam.

I hope this helps answer your questions about dspam!
",oskapt,2016-12-05 17:49:15
527,2016-08-22 13:44:07,"Oh - also, the reason you get errors about `unable to attach to dspam context` is because we're not running dspam as a daemon. I don't know what the benefit of doing so might be, but I believe all of the command-line tools for interacting with `dspam` expect to talk to the daemon.
",oskapt,2016-12-05 17:49:15
527,2016-11-28 15:34:13,"I am getting 

`/decrypted/dspam/junk_training.sh: line 19: syntax error near unexpected token `|'
/decrypted/dspam/junk_training.sh: line 19: `domains=({{ domain_list.stdout_lines|join(' ') }})'`

But I want to make sure that I am installing this properly. Did you indicate that all the files should go in the mailserver directory (the appropriate places). I noticed you had a main.yml that I cannot figure out where to put. I had manually added everything first to test it out but I don't think that the domain_list is incorrect...

@oskapt if you could give me some 10 second advice I would be super appreciative as I think this is a huge essentiall addon
",shaneonabike,2016-12-05 17:49:15
527,2016-11-28 16:02:01,"* `main.yml` changes are to go at the bottom of `main.yml` in the `mailserver/tasks` directory (I've updated gist to reflect this)
* `domain_list` is derived from the command in the first block of `local.yml` - it looks at the contents of `/decrypted`, filters them by what directories are owned by `vmail` (which theoretically should only be directories corresponding to domains hosted on the system), and stuffs it into the variable `domain_list`. 

If you put these files in manually, `junk_training.sh` won't work. It's a `j2` template that needs to be installed by Ansible. If you want to use it manually, just put something like:
<S_CODE_TOKEN>

If you only have one domain, keep the parentheses and put your single domain inside of it.

Let me know if you have other questions.",oskapt,2016-12-05 17:49:15
527,2016-11-28 16:10:57,"Of course! Silly me and now this totally works! This should totally be integrated into the main stream it's awesome!
",shaneonabike,2016-12-05 17:49:15
527,2016-11-28 16:18:29,@oskapt The spam training is a great addition. Could you have a look at PR #617 / issue #611 ? Are you proposing the same thing with your gist?,neuhaus,2016-12-05 17:49:15
527,2016-11-28 16:31:03,"My gist is for dspam, not rspamd. None of my stuff is useful for rspamd - go with the dovecot antispam plugin instead. It monitors all folders, removes the need for spam/ham/junk, and pushes the training back in. It's definitely the way to go.",oskapt,2016-12-05 17:49:15
527,2016-12-05 17:49:15,"With #617 we now have rspamd training based on users moving messages to Junk.

I believe the last missing piece for a fully-functional auti-spam system is #626, which will cause Sieve to move spammy messages out of the inbox automatically.",lukecyca,2016-12-05 17:49:15
526,2016-03-09 22:01:33,"**This is a major change to sovereign**

This modularizes sovereign by moving default variables into their roles. It responds to demands for a less monolithic sovereign setup expressed in #440 and elsewhere.

Highlights:
- Users need only define two variables for all roles to work: `domain` and `main_user_name`
- All passwords are generated using ansible's [password lookup](https://docs.ansible.com/ansible/playbooks_lookups.html#the-password-lookup) and stored in the directory `secret`.
- Uses the ansible standard `group_vars/sovereign` instead of the bespoke `vars/user.yml`
- Default variables are moved into their respective roles (`defaults/main.yml`)

Documentation will be added and testing will be fixed if there's interest in this change.
",ariddell,2016-05-29 22:25:34
526,2016-03-09 23:31:39,"This looks great! I think it's a big improvement, thanks for putting it together.
",carljm,2016-05-29 22:25:34
526,2016-03-11 14:08:06,"Anyone else have thoughts? If there's interest in this I'll go ahead and add more documentation.
",ariddell,2016-05-29 22:25:34
526,2016-03-11 14:33:21,"@ariddell I have looked through all your changes. This would be a great improvement to sovereign.
",Yannik,2016-05-29 22:25:34
526,2016-03-11 14:43:09,"I want to spend some time looking at this.  I still have my doubts but 
am being open-minded about it.  That said, I am swamped with work, and 
it may be another week before I can look at it.
",mikeashley,2016-05-29 22:25:34
526,2016-03-11 16:31:13,"Thanks for removing the openvpn part, great work, @ariddell!
",Yannik,2016-05-29 22:25:34
526,2016-04-18 14:03:31,"I think it would be great to merge this -- if it gets merged at all -- before the move to jessie. The benefits of modularizing the roles (mainly, moving role-specific variables into roles) are easy to understand. The downside is the lack of backwards compatibility.
",ariddell,2016-05-29 22:25:34
526,2016-04-22 10:08:30,"I think this is a good step.  My biggest question is around the password lookup method and how we would migrate existing passwords.  It moves role-specific variables into their roles and makes it a little easier to reason about changes to them.

Unless I'm mistaken, this is only a small part of addressing resuability?  As written today, some roles still make assumptions about how other roles are designed and used.  Two examples: our LE setup and duplicated postgres install/configuration.  I don't think this PR needs to full address resuability, but I want to make sure we're clear that this is only one step.
",mikeashley,2016-05-29 22:25:34
526,2016-04-22 12:44:21,"(Line comments have been addressed)

This is indeed ""only a small part of addressing resuability"", as @mikeashley puts it. The title of the PR is perhaps too ambitious. I would love to do more.

I find that inter-dependencies like postgres are difficult to deal with in ansible. I haven't seen a satisfactory solution really (although some of @drybjed's tricks in https://github.com/debops/debops are interesting). My sense is you need some sort of key-value store to register what roles have been successfully run. I'm not sure sovereign's quite ready for that. It might be easier, in practice, to remove the inter-dependencies with role-specific databases.
",ariddell,2016-05-29 22:25:34
526,2016-04-22 13:07:31,"@ariddell You are exactly right, some way to store a state in Ansible (which is inherently stateless by design) so that it can be carried over between the playbook executions, either in the same `ansible-playbook` run, or on subsequent runs, is needed to get full idempotency. In DebOps, I'm doing this using Ansible local facts stored on remote hosts (a JSON data structure with key/value data relevant to a particular role).

In the case of PostgreSQl support, which is done by the [debops.postgresql_server](http://docs.debops.org/en/latest/ansible/roles/ansible-postgresql_server/docs/getting-started.html) role on the server side, and [debops.postgresql](http://docs.debops.org/en/latest/ansible/roles/ansible-postgresql/docs/getting-started.html) role on the client side, I use Ansible local facts to pass the relevant data between two roles. The default variables are not good for this, because when a role is not included in the play, its variables are not ""loaded"" by Ansible. Other forms of variables available in Ansible are either not modifable through Ansible inventory, or the inventory itself which should be left under user control.

If you wonder why there are two PostgreSQL roles (and MariaDB, and similar), this allows an easy setup where the database server is on one host and clients that access the database are on another host(s).

As for remembering what roles have been executed before... I don't think that's really needed. You just need to ensure that each role is idempotent, and using the playbook, run your roles in the correct order. For example, my application roles don't really care if `nginx` role has been executed or not, they expect the webserver to just be there when it's needed.
",drybjed,2016-05-29 22:25:34
526,2016-04-25 08:22:54,"I recommend we take this PR, but it would be good to get a look from one more committer.  @neuhaus or @jplock or @lukecyca?

Documentation still needs updated.  Also, has this been tested?  @ariddell are you sure about password migration?  People upgrading their Debian 7 servers would need to do this.
",mikeashley,2016-05-29 22:25:34
526,2016-04-25 12:52:13,"I have tested this. I'll do some additional testing about the password
migration when I write the docs.

On 04/25, Mike Ashley wrote:

> I recommend we take this PR, but it would be good to get a look from one more committer.  @neuhaus or @jplock or @lukecyca?
> 
> Documentation still needs updated.  Also, has this been tested?  @ariddell are you sure about password migration?  People upgrading their Debian 7 servers would need to do this.
> 
> ---
> 
> You are receiving this because you were mentioned.
> Reply to this email directly or view it on GitHub:
> https://github.com/sovereign/sovereign/pull/526#issuecomment-214203423
",ariddell,2016-05-29 22:25:34
526,2016-04-27 08:17:11,"I'm in favor of this PR, however I don't have time to test it right now.
",neuhaus,2016-05-29 22:25:34
526,2016-04-27 12:33:52,"Thanks. In that case, I'll work on the documentation.

On 04/27, Sven Neuhaus wrote:

> I'm in favor of this PR, however I don't have time to test it right now.
> 
> ---
> 
> You are receiving this because you were mentioned.
> Reply to this email directly or view it on GitHub:
> https://github.com/sovereign/sovereign/pull/526#issuecomment-215007556
",ariddell,2016-05-29 22:25:34
526,2016-05-21 16:23:02,"@ariddell Are you ready for this to be merged? If so, I'll do a final review and likely do some testing.
",mikeashley,2016-05-29 22:25:34
526,2016-05-21 20:19:57,"It's ready except for documentation updates. I'm going to try to test it
fully this week and write the docs.

On 05/21, Mike Ashley wrote:

> @ariddell Are you ready for this to be merged? If so, I'll do a final review and likely do some testing.
> 
> ---
> 
> You are receiving this because you were mentioned.
> Reply to this email directly or view it on GitHub:
> https://github.com/sovereign/sovereign/pull/526#issuecomment-220786773
",ariddell,2016-05-29 22:25:34
526,2016-05-24 06:35:49,"This looks like more idiomatic Ansible code. The way vars are set up currently took me a few minutes to figure out.

üëç 
",mrwacky42,2016-05-29 22:25:34
526,2016-05-27 21:50:47,"This is ready to be merged.
",ariddell,2016-05-29 22:25:34
526,2016-05-28 10:00:03,"I'll test it, taking it from the top.  I'll consider @QWp6t's input on ansible-vault as well as I work my way through a test setup.
",mikeashley,2016-05-29 22:25:34
526,2016-05-29 20:42:11,"Regarding secrets, I like the way @ariddell has done it.  It makes the secrets available to me in text files on my local machine without any fanfare.  I can commit them to my private branch.  I can easily copy them to use when logged into my server.

I tested all roles except tarsnap.  The variable `irc_timezone` got dropped accidentally.  I submitted a PR to @ariddell to correct it.  Once this PR is updated, I'll merge it.  We'll need some guidance on the wiki on how to migrate passwords in the .yml files to text files in the `secret` directory.
",mikeashley,2016-05-29 22:25:34
526,2016-05-29 21:38:14,"Merged the PR. I can't take credit for the secrets approach, it's a scaled-down version of @drybjed's approach in debops.
",ariddell,2016-05-29 22:25:34
525,2016-03-09 21:09:44,"There is no requirement, AFAIK, that a self-signed x509 certificate contain any
information other than common name (CN). Requiring users to provide county, state, city, etc. is inconvenient and, if I have this right, unnecessary.
",ariddell,2016-08-05 07:12:43
525,2016-03-11 09:05:58,"I like the change.  Have you tested it?  Also, I don't know a lot about certificates, so it would be good if somebody else could comment on the wisdom of this change.
",mikeashley,2016-08-05 07:12:43
525,2016-03-11 14:09:41,"I do need to test this with a laptop or some other device.
",ariddell,2016-08-05 07:12:43
525,2016-05-24 06:33:09,"This would potentially break #561 with respect to verifying the server's x509 cert.
I'd rather just have dummy defaults and suggest (however weakly) that the user supply them.
",mrwacky42,2016-08-05 07:12:43
525,2016-05-27 20:27:16,"If/when #526 gets merged there's some cleanup that needs to happen in this PR. These lines need to be removed from group_vars/sovereign

<S_CODE_TOKEN>
",ariddell,2016-08-05 07:12:43
525,2016-05-27 22:17:43,"Verified working on a Debian laptop.
",ariddell,2016-08-05 07:12:43
525,2016-07-03 08:59:59,"@ariddell #526 was merged.  Can you confirm whether this PR is ready to go or update it?
",mikeashley,2016-08-05 07:12:43
525,2016-07-03 19:21:02,"Sure. I'll rebase it.
",ariddell,2016-08-05 07:12:43
524,2016-03-09 18:32:27,"Heroku recommends against using A records and ""naked domains""

> DNS A-records can be used to configure zone apex domains (also called bare, naked, or root domains). These records have serious availability implications when used in environments such as on-premise data-centers, cloud infrastructure services, and platforms like Heroku.

There's also this site: http://www.yes-www.org/

This all makes sense and if a sovereign user would like to force HTTP/S requests to go to `www.{{domain}}` this should be supported.
",ariddell,
524,2016-03-10 12:11:15,":+1: 
On my server I also redirect from 
http://domain to https://www.domain and
https://domain to https://www.domain
",neuhaus,
524,2016-04-14 09:22:55,"We don't want to break the ACME challenges, so they must not be redirected. Here's one of the Apache `VirtualHost` blocks for a site that shall be redirected to the version with HTTPS and a ""www"" prefix. It's not pretty but it works:

<S_CODE_TOKEN>
",neuhaus,
523,2016-03-09 15:23:46,"The `monitoring` role installs and configures
- logwatch
- monit
- collectd

If possible, I think it would be desirable to break the role apart into three roles. This would respond to demands for modularity (expressed in #440) without materially affecting existing users (or expectations of existing users).
",ariddell,
522,2016-03-09 15:17:48,"I'd prefer that the support for librato (a paid service run by Librato, Inc) not be included in sovereign. I'm sure there are other services out there and it seems like supporting one implies tacit support.

(google authenticator unfortunately includes the word ""google""---I wish it didn't---but it is an open standard [RFC4226](https://tools.ietf.org/html/rfc4226))
",ariddell,
522,2016-03-09 15:18:17,"If we did this just in jessie we could avoid breaking anyone's configuration.
",ariddell,
522,2016-04-12 13:21:06,"Ideally we would provide free alternatives for all commercial services supported by sovereign. Tarsnap is another one of those.
",neuhaus,
521,2016-03-09 10:24:52,"This gets rspamd hooked up to postfix via rmilter.

Rmilter has a bunch of other capabilities that could be explored in the future (including the ability to do DKIM signing and verification, so we wouldn't need to have Postfix talk directly to OpenDKIM as a separate milter), but this PR only sets it up for rspamd.

The `rmilter.socket` systemd unit file has to be replaced because the default unit file uses a Unix socket instead of a TCP socket, and (as discussed at https://github.com/vstakhov/rmilter/issues/39) this doesn't play nicely with postfix running smtpd in a chroot. The author of rmilter recommends just using a TCP socket instead.
",carljm,2016-03-12 08:49:23
521,2016-03-09 10:25:24,"This fixes #394.
",carljm,2016-03-12 08:49:23
521,2016-03-09 10:52:37,"Oh, and this is running and tested on my new mail server; mail log shows details of successful rspamd checks of incoming messages.
",carljm,2016-03-12 08:49:23
521,2016-03-09 18:07:49,"LGTM
",ariddell,2016-03-12 08:49:23
521,2016-03-10 08:06:54,"hey carl, you here :)  I am still running on master and wondering if to go for the jessie branch -- may i ask if rspamd will also automatically train on inbox/spam-box so that i can move messages via an IMAP client and it gets recognized? 
",hpk42,2016-03-12 08:49:23
521,2016-03-10 10:12:10,"Do we really have to intsall redis?
",mikeashley,2016-03-12 08:49:23
521,2016-03-10 11:31:59,"I'd rather not add redis for this myself, however looking at its memory requirements (1MB without any data and 100MB with 1 million items) I think it's manageable.
rmilter considers memcached to be legacy software and encourages to switch to redis.
",neuhaus,2016-03-12 08:49:23
521,2016-03-10 19:35:31,"Yeah, rmilter/rspamd seem to have a strong preference for having redis available and complains at you in its log if you don't. I don't think it's strictly required, but it's necessary for some features, including bayesian learning, which I think we want available. Personally, I don't mind having Redis around; it's very useful, it's stable, and it has a small memory footprint.

Speaking of the Bayes filter, hello @hpk42 ! :-) So you can train rspamd with `rspamc learn_ham email_file1 email_file2 ...` or `rspamc learn_spam email_file1 email_file2`. Rspamd doesn't have anything set up to do that automatically, and currently this PR doesn't either. I wasn't sure how opinionated we wanted Sovereign to be on that.

One option would be a cron job that runs learn_spam/learn_ham on some specially-named ham/spam folders (probably configurable by vars?) in the main user's maildir (I think I'd need to look into how to only run it on new messages that weren't already processed). The downside of this approach is that it doesn't scale quite as well to multi-email-user Sovereign installations (though I suppose we could have it run for all configured mail accounts).

Another option (recommended by the rspamd author) is to set up local mail aliases that pipe the mail directly to learn_spam/learn_ham. The downside of this is that you need some way to conveniently redirect mail to these aliases from your MUA; e.g. Thunderbird has a ""redirect mail"" plugin that will do this.

Open to thoughts on this, though I think the PR could be merged as-is to at least make rspamd functional, and any desired setup for Bayes learning could be treated as a separate enhancement.
",carljm,2016-03-12 08:49:23
521,2016-03-11 09:11:36,"I like the idea of getting rspamd properly set up and then tweaking further in separate PRs if folks feel improvement is needed.  That said, mail setup isn't trivial.  Is there somebody who owns the mail server configuration and is watching that it's coherent?
",mikeashley,2016-03-12 08:49:23
521,2016-03-11 22:52:43,"I haven't examined the mail server config in great detail yet, so I can't speak to its overall coherency, but I can verify that it works :) including DKIM and (with this PR) rspamd. 

In any case, I don't think there's any concern that this PR makes the mail server config any less ""coherent."" It just completes the rspamd work that was earlier started and left half-done. The impact on the mail server config is pretty minimal, as you can see in the diff.

The main potential lack of coherence I see is that we have two milters (opendkim and rmilter) whose tasks could both be handled by rmilter. I plan to look into that in a future PR. 
",carljm,2016-03-12 08:49:23
520,2016-03-09 08:12:19,"My friend Victor Arron Grant is going to have a bad time installing this :wink: 

(but seriously, people may have good reasons to provide a key)
",Jbonnett,
520,2016-03-09 14:17:55,"Could you explain a bit more? Would a user providing certs via host vars put the PEM encoded certificate in a file such as `group_vars/all`?
",ariddell,
520,2016-03-09 17:18:14,"I was thinking you could just use the existing wildcard file location, and the same logic you have now in LetsEncrypt.yml for testing and just use a boolean rather than detecting the vagrant user. 
",Jbonnett,
520,2017-03-24 04:04:28,"Any news on this, I would also like to use a wildcart cert over lets encrypt",Brando753,
519,2016-03-09 00:21:36,"google_auth_version is not used in jessie, neither is znc_version
",ariddell,2016-03-11 08:59:42
519,2016-03-11 08:59:35,"Looks good.  Looking back at the diffs, we have switched both ZNC and google authenticator to use distribution packages instead of downloads.
",mikeashley,2016-03-11 08:59:42
518,2016-03-08 19:21:43,"as per discussion in https://github.com/sovereign/sovereign/pull/504
",nodiscc,2016-03-09 18:05:18
517,2016-03-08 04:41:51,"Fixes #510 (and fixes a failing test).
",carljm,2016-03-08 08:38:17
517,2016-03-08 08:38:25,"Thanks!
",neuhaus,2016-03-08 08:38:17
516,2016-03-08 04:03:53,"With current code in jessie, I get this daily email from cron to `root@mydomain`:

<S_CODE_TOKEN>

It looks like the opendmarc report cron job is supposed to send its output to `/var/log/opendmarc_report.log`, but it's currently redirecting only stdout, not stderr, so the stderr output gets mailed to me.

Is this intentional? Is this a report that I should be carefully reading each day?

Assuming it's not intentional, this PR redirects stderr as well, so all output goes to the log file and nothing gets mailed to root.
",carljm,2016-03-09 09:06:24
516,2016-03-08 09:49:09,"Is there a way to send an email only if there is an error during the cron job? That would be ideal.
",neuhaus,2016-03-09 09:06:24
516,2016-03-08 16:11:20,"Hmm. I think that should be possible. I'd edit the `/etc/opendmarc/report.sh` script which is run by the cron job, to make each individual step (`opendmarc-import`, `opendmarc-reports`, and `opendmarc-expire`) redirect all its ""normal"" output to stdout, so in a success case all the output goes to stdout. Then I'd make sure that if any step fails (nonzero exit code) it writes something to stderr telling the admin to go check the log file for details.

If that sounds like a reasonable plan, I can put together a PR for it.
",carljm,2016-03-09 09:06:24
516,2016-03-08 19:38:50,"Ok, this should achieve the goal. The report script will now error out if any of its steps exit with error, and the cron job now directs all output to the log file, but in case of an error exit will dump the last few lines of the logfile in an email to root. Good enough?
",carljm,2016-03-09 09:06:24
516,2016-03-08 19:46:44,"Tested and working on my server. Also, the subject of the email from cron contains the name of the log file, so it's pretty clear where to go looking for more info if there is an error.
",carljm,2016-03-09 09:06:24
516,2016-03-09 09:06:45,"Thanks for the nice solution!
",neuhaus,2016-03-09 09:06:24
515,2016-03-07 23:04:17,"Hi,
maybe it would be prudent to add another task to #512 / #511 which deletes `/etc/rc.local` or deletes the iptables which were present in it in the previous version of sovereign? The current tasks do not cause issues if these iptables commands are in the rc.local, but it would be nice to actually clean it up.
Are there any procedures that exist for things like this in sovereign? Like introducing such a task which is necessary for upgrades but not for fresh setups in a minor version and remove one or two major versions of sovereign later?
",Yannik,2016-09-16 17:00:04
515,2016-05-27 20:08:38,"Something easy would be to abort (I think there's a `fail` module) if a file is present and prompt the user to delete the file.
",ariddell,2016-09-16 17:00:04
515,2016-09-16 09:31:13,"I like the idea of using Ansible to upgrade installs, but I worry about confusion for users and burden on playbook authors.  If I'm using sovereign, can I count on a playbook to handle the upgrade for me or not?  For authors, how do I reason about upgrades?  How do i test?  How far back do I take support?

When we moved to Jessie, the approach was to do a clean break: assume the user is doing a clean install.  That said, we have a wiki page for those of us who are upgrading to call out what to watch for and how to fix the one-off bumps in the upgrade path.
",mikeashley,2016-09-16 17:00:04
515,2016-09-16 17:00:04,"Clean break sounds best to me as well. I think this is safe to close for now.
",ariddell,2016-09-16 17:00:04
514,2016-03-07 22:40:20,,carljm,2016-03-07 22:42:06
513,2016-03-07 17:17:42,"This `+` prefix in the `/etc/sudoers.d/sudoers` file created by Sovereign prevented my main user from actually being able to sudo. Per the sudoers man page, a `+` prefix indicates a ""netgroup"" -- but this is clearly a user name, not a netgroup, so I'm not sure why the `+` is there. Removing it allowed my user to sudo.
",carljm,2016-03-07 17:23:16
513,2016-03-07 17:18:45,"Wow, the initial `+` and `-` in the diff lines make this a confusing change to review :-) I wonder if diff/patch issues explain how this `+` snuck in there to begin with.
",carljm,2016-03-07 17:23:16
513,2016-03-07 18:58:52,"You can do a git bisect
",ariddell,2016-03-07 17:23:16
513,2016-03-07 18:59:36,"I did; the `+` appears to have been there since that file was first added.
",carljm,2016-03-07 17:23:16
512,2016-03-07 13:34:22,"jessie version of #511 
",ariddell,2016-03-07 22:47:26
511,2016-03-07 10:22:04,,Yannik,2016-03-07 11:46:40
511,2016-03-07 11:43:12,"Was this change tested?
",mikeashley,2016-03-07 11:46:40
511,2016-03-07 11:44:14,"I personally do use these tasks in my own openvpn role.
",Yannik,2016-03-07 11:46:40
511,2016-03-07 11:46:30,"Great.  Thanks for this.
",mikeashley,2016-03-07 11:46:40
511,2016-03-07 13:29:37,"We need one of these for jessie too, I think.
",ariddell,2016-03-07 11:46:40
510,2016-03-07 06:46:17,"When I run `vagrant up` on `jessie` branch followed by `nosetests`, the test for DKIM signature fails. Looking at syslog, I see this:

<S_CODE_TOKEN>

In `/etc/opendkim/TrustedHosts`, I see

<S_CODE_TOKEN>

But from the perspective of the Sovereign VM, `sovereign.local` resolves to `127.0.0.1` (because it is listed as such in `/etc/hosts`, and `mail.sovereign.local` does not resolve at all (it is listed in the `/etc/hosts` of the host machine, but not of the Sovereign VM. So the host machine is not a trusted host for OpenDKIM, and since the tests run from the host machine, the test email is not DKIM-signed, and the test fails.

Can others reproduce this, or am I doing something wrong?

I think the simplest fix is to add the IP address of the host machine to `/etc/opendkim/TrustedHosts` when running under Vagrant. I've verified that that does in fact cause the test to pass. I can submit a PR for this if other contributors are also seeing this test failure and agree that that's the right fix.
",carljm,2016-03-08 08:39:14
510,2016-03-07 07:02:39,"Hmm, wait, I'm confused. The MUA host shouldn't need to be a trusted host; if the mail comes through the submission port with proper authentication it should be signed. Need to dig further and figure out why that's not happening in this test...
",carljm,2016-03-08 08:39:14
510,2016-03-07 18:28:27,"Confirmed that this is an issue on my deployed server, too, so it's not just a Vagrant/tests problem; the test is indicating a real problem. The issue seems to be that the OpenDKIM milter thinks the mail was not submitted by an authenticated user (thus the ""not authenticated"" in the log transcript above), when in fact it was. Trying to debug why that is the case; if anyone with more OpenDKIM experience can point me in the right direction, that would be great. This is all on `jessie` branch, running on Debian Jessie.
",carljm,2016-03-08 08:39:14
510,2016-03-08 04:38:08,"Found it! OpenDKIM decides whether a message is authenticated or not based on the presence or absence of the `{auth_type}` macro (see http://www.opendkim.org/opendkim.8.html under `OPERATION`). The Sovereign Postfix config is currently configured to pass the `{auth_authen}` macro to mail milters, but not the `{auth_type}` macro (see https://github.com/sovereign/sovereign/blob/jessie/roles/mailserver/templates/etc_postfix_main.cf.j2#L107). Thus OpenDKIM thinks the message is unauthenticated and chooses not to sign it. Adding `{auth_type}` to the list of macros passed to mail milters fixes the problem. PR on its way shortly.
",carljm,2016-03-08 08:39:14
510,2016-03-08 08:39:14,"Carl, thanks for the bug report and the patch.
",neuhaus,2016-03-08 08:39:14
509,2016-03-07 00:56:26,"Currently, LE certificate generation bounces Apache.  This isn't required if webroot authentication is used.  The common role should be updated to use this method.
",mikeashley,
508,2016-03-07 00:47:46,"Use ansible>1.9,<2 on jessie.

Resolves #466 on jessie and contains the jessie version of  #487 (applied to master)

(I attempted to use Ansible 2.0 but a variety of new errors popped up.)
",ariddell,2016-03-07 01:27:31
508,2016-03-07 01:27:10,"Ran this with Vagrant and reviewed the diffs.  Looks good.
",mikeashley,2016-03-07 01:27:31
507,2016-03-05 14:39:49,"Address issue #495.  This has been lightly tested on a sandbox server but should get more testing.

I like using debconf to get the package configured correctly and avoid whacking configuration files into place.  I tried to make this work on mater, but I could not seem to get debconf changes to be used by the roundcube package.  I am probably doing something wrong.  It works fine here on the jessie branch though.
",mikeashley,2016-09-05 10:37:49
507,2016-03-11 09:07:07,"Any holdup on reviews of this?  Anything I can do to facilitate?  The failing checks are because this was submitted before the travis fix.
",mikeashley,2016-09-05 10:37:49
507,2016-03-11 14:08:56,"I don't know anything about webmail and I've never used it. Perhaps someone else can review this?
",ariddell,2016-09-05 10:37:49
507,2016-03-30 09:40:09,"I can have a look at this
",neuhaus,2016-09-05 10:37:49
507,2016-04-09 12:13:01,"This is not ready to go.  Looks like there is a bug in the package configuration when running from a clean install. 
",mikeashley,2016-09-05 10:37:49
507,2016-04-09 16:34:22,"Fixed with latest commit.
",mikeashley,2016-09-05 10:37:49
507,2016-04-16 15:42:24,"This is not ready to go, still.  During an upgrade from Wheezy to Jessie, where roundcube had been removed and purged, the `debconf` tasks complained about missing setups.  For some reason I didn't see this when installing on a clean Jessie system.  Installing the roundcube package interactively followed by running the playbook for finalizing the setup worked fine, so I think the trouble is isolated to preconfiguring the package options.
",mikeashley,2016-09-05 10:37:49
507,2016-04-22 12:14:39,"I'm not able to reproduce the debconf problems I encountered while upgrading from Wheezy to Jessie when doing a clean install.  The debconf tasks in `roundcube.yml` run fine.  They update the configuration database correctly.

I don't think it's worth the effort to root cause and find a fix for a problem that only occurs on upgrades.  I suggest instead we document the workaround on the wiki.

@neuhaus Any opinions on this?  I think this PR is still our best proposal for how to use the packaged distribution of roundcube correctly.
",mikeashley,2016-09-05 10:37:49
507,2016-04-22 13:15:49,"So you tried this both with a fresh jessie install and an installation of wheezy upgraded to jessie?
",neuhaus,2016-09-05 10:37:49
507,2016-04-22 13:20:23,"I tried to reproduce the problem within Vagrant using a Jessie VM.  The next step would be to try with a Wheezy VM upgraded to Jessie.
",mikeashley,2016-09-05 10:37:49
507,2016-04-22 13:56:16,"I tried to reproduce with a Debian 7.9 VM upgraded to Jessie and was not successful.  It's possible the problem was unique to my production server and the way I executed the upgrade.
",mikeashley,2016-09-05 10:37:49
507,2016-05-21 16:25:19,"Are we ready to merge this PR?  It's an important one to return feature parity with master.
",mikeashley,2016-09-05 10:37:49
507,2016-05-29 21:04:08,"This will need updated after #526 is merged.
",mikeashley,2016-09-05 10:37:49
507,2016-05-30 11:32:56,"Needs a small update if pull request #560 is merged
",neuhaus,2016-09-05 10:37:49
507,2016-06-04 04:41:59,"I was testing this branch and I got this error:

<S_CODE_TOKEN>

I think it's the same issue as with #417, and I remember having that on wheezy too.

Does any else still have this problem on jessie?

Ultimately, I had to comment that task and remove carddav from the list of plugins for the playbook to continue.

P.S. now that the playbook went through just fine, when I go to the mail subdomain, roundcube shows me a `DATABASE ERROR: CONNECTION FAILED!` error.
",aminb,2016-09-05 10:37:49
507,2016-06-04 07:24:58,"What happened is that roundcube's debconf selections were set incorrectly and you were left with a broken roundcube install.  I have not had the chance to root cause this and find the correct fix.  Help is welcome.

The workaround is to remove and purge the roundcube packages, and then reinstall the packages manually.  Use postgres as the backend.  Once you've done this, the playbook should run without error.
",mikeashley,2016-09-05 10:37:49
507,2016-06-04 14:27:26,"@mikeashley Thank you! Your workaround helped resolve the problem, and all is fine.

I was looking at the diff between the file created by manual install and the one generated by sovereign's templates, and I couldn't pin down the problem. But at least I have a working setup, so thank you.
",aminb,2016-09-05 10:37:49
507,2016-07-05 10:43:24,"Just an update.  I've chased this into the noninteractive install of the roundcube-core package.  I may be doing something wrong with options, but it sure feels like a bug in there.  I've filed a [bug report](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=829485) with the maintainers.
",mikeashley,2016-09-05 10:37:49
507,2016-08-09 22:11:06,"There has been no response from the package maintainers on my bug report.  We have three choices:
1. Continue to wait for a response.
2. Back off and install roundcube using mysql as the back end.
3. Install the package from source.

I am against 3 since in principal we would be giving up easy security and version updates.  I don't want to burden every user of sovereign with having to manually upgrade.

I am leaning towards 2.  We already have to use mysql for opendmarc, and while I dislike adding another dependency on mysql, I think the urgency to resolve this issue outweighs it.

Any opinions?
",mikeashley,2016-09-05 10:37:49
507,2016-08-10 07:10:20,"What do you think about using sqlite? It would mean no extra server process and the load on the database is likely to be low.
",neuhaus,2016-09-05 10:37:49
507,2016-08-10 08:14:26,"I suggested mysql since that is what Roundcube defaults to, and I think using the default DB backend is going to be the only way to install the current package noninteractively.

There is an Option 4, which is to fix the roundcube package installer and submit it upstream, but that would be new territory for me and definitely take longer than pursuing Option 2.

All that said, I'm a big fan of sqlite and do think it's an appropriate backend.
",mikeashley,2016-09-05 10:37:49
507,2016-08-10 08:47:30,"I think we should try to get rid of a second database (which is MySQL) if possible, so adding a new dependency is not the way to go.
For dedicated servers, RAM is usually the most scarce resource. Having two database servers running is a relatively big memory hog.
Sqlite is among Roundcube's [currently supported database providers](https://github.com/roundcube/roundcubemail/wiki/Configuration).
",neuhaus,2016-09-05 10:37:49
507,2016-09-05 10:37:49,"I am closing this PR, backing off the approach of using backports.  I'll submit another PR for installing from source.
",mikeashley,2016-09-05 10:37:49
506,2016-03-04 20:52:15,"Address Issue #495.  This has been lightly tested on a sandbox deployment.
",mikeashley,2016-03-05 02:44:31
506,2016-03-04 20:54:31,"I used debconf to preconfigure the package manager to use postgres for the backend.  This might help with the install problems we've seen.
",mikeashley,2016-03-05 02:44:31
506,2016-03-05 02:44:31,"Using debconf doesn't seem to be working on master.  I'd like to see if I can find a solution that works for both branches.  I'm going to close this PR in order to work on it a bit more.
",mikeashley,2016-03-05 02:44:31
505,2016-02-28 13:01:15,"- Remove unnecessary dependencies
- Clean up postgresql server setup
- Install from official package repository
- Expect package installer to enable modules that are needed
- Update virtual host config with owncloud 8.2 configuration
- Update post-deploy instructions
",mikeashley,2016-03-07 13:37:05
505,2016-02-28 13:05:49,"This update deploys in the vagrant test environment and passes some basic smoke testing including file upload/download and generating expiring links.
",mikeashley,2016-03-07 13:37:05
504,2016-02-21 16:35:22,"Here is the proposal for LE support again.  I would still like to avoid bouncing Apache in order to generate and renew certificates, but I would also like to get this into testing sooner rather than later.  If this PR is merged onto jessie, I'll add a ticket to address the bounce.
",mikeashley,2016-03-07 00:31:30
504,2016-02-22 13:29:31,"I started reviewing this. I'll do more today or tomorrow.
",ariddell,2016-03-07 00:31:30
504,2016-03-03 23:18:44,"Got distracted this week. If someone else wants to look through the commits please go ahead. If not, I'll try to look at it soon.
",ariddell,2016-03-07 00:31:30
504,2016-03-06 23:36:08,"I've reviewed the code today. It all looks good.
",ariddell,2016-03-07 00:31:30
504,2016-03-07 00:25:45,"Indeed, an earlier version used a variable in defaults.yml to say what domains the certificate should include.  I abandoned it, though.  The Let's Encrypt certificate server uses DNS to verify sites for certificate generation, so DNS must be configured before the playbook is run regardless, and the extra variable in defaults.yml introduced a possibility for the playbook configuration to be out of sync with the DNS configuration.
",mikeashley,2016-03-07 00:31:30
504,2016-03-07 00:29:19,"Good suggestion on the script name.
",mikeashley,2016-03-07 00:31:30
504,2016-03-07 00:31:23,"Great. Thanks!
",ariddell,2016-03-07 00:31:30
504,2016-03-07 20:32:34,"Looks like Google's Bash style recommends

<S_CODE_TOKEN>

https://google.github.io/styleguide/shell.xml?showone=Variable_expansion#Variable_expansion
",ariddell,2016-03-07 00:31:30
504,2016-03-07 20:43:02,"@ariddell a reputable source is at http://mywiki.wooledge.org/ParsingLs but I guess keeping `ls` is fine as long as it's not demonstrably broken in this case.
",nodiscc,2016-03-07 00:31:30
504,2016-03-07 20:54:46,"I think it is definitely something worth changing either to use `find` or to use the Google method. @nodiscc do you want to submit a PR?
",ariddell,2016-03-07 00:31:30
504,2016-03-07 22:41:23,"@ariddell why not? Using `find`, and the `$(command)` notation instead of backticks would be cleaner. I would also use `set -o errexit` so that the script exits with non-zero return code if something goes wrong. This way the ansible task would fail and the user would be notified. Is this ok?
",nodiscc,2016-03-07 00:31:30
504,2016-03-07 22:56:52,"These are all important changes! I agree about errexit and avoiding backticks. Did I mistype something? (This PR has already been merged, so there needs to be a new PR with the fixes)
",ariddell,2016-03-07 00:31:30
504,2016-03-09 18:26:08,"Finally tested this live. Everything appears to be working. Thanks again @mikeashley 
",ariddell,2016-03-07 00:31:30
504,2016-03-09 19:50:59,"I should mention that I've got it running live as well and haven't noticed any issues. So far just the common and mailserver roles (haven't done anything web-related yet), but it's working fine for SMTP and IMAP.
",carljm,2016-03-07 00:31:30
503,2016-02-21 12:09:28,"This addresses Issue #491.  Running under postgres is a good goal, but let's get the jessie branch stable.  Switching to postegres will take some feasibility work.  I opened Issue #502 to track it.
",mikeashley,2016-02-22 13:23:58
503,2016-02-22 13:23:51,"Shame about putting back mysql but I suppose this makes sense.
",ariddell,2016-02-22 13:23:58
502,2016-02-21 12:08:10,"The opendmarc package uses mysql as the back end.  If the installation could be modified to use postgres, this would allow sovereign deploys to avoid installing mysql.  There was a brief discussion around this in the comments on PR #397.
",mikeashley,
502,2016-03-09 09:15:15,"This would also fix issue #497 if it were done on trusty (it's not an issue for xenial).
",neuhaus,
502,2016-03-09 14:35:17,"What needs to be done to make this happen. It would be a positive development if only postgres were required.
",ariddell,
502,2016-03-11 09:03:30,"At a minimum the SQL to initialize the database needs to be converted from MySQL to PostgreSQL, and the package needs to be configured to use posgres as the backend.  Nominally it supports this, since the backend support looks abstracted, but I don't recall seeing anything to suggest that this had ever been tested or is supported.
",mikeashley,
502,2016-12-28 02:19:04,"I've created an experimental fork of opendmarc with PostgreSQL support (only)

https://github.com/nestihacky/opendmarc

Commit: https://github.com/nestihacky/opendmarc/commit/0241bf1999706b197ccb021da75a921bbc38233f 

I also have packages for Fedora/Centos if you would like to test it: https://copr.fedorainfracloud.org/coprs/rmarko/opendmarc/

I'm only running this for few days in production. It still needs a number of IF clauses to handle both MySQL and PostgreSQL, bit more testing and then I'll try to upstream this.

Btw we now have usable mailserver deployment scripts based on sovering mailserver that targets Centos 7 - https://github.com/nestihacky/ansible-role-mailserver",sorki,
501,2016-02-19 12:40:07,"@mikeashley has done an epic amount of high quality work on the Let's Encrypt scheme/role and on getting the jessie branch working. I'd like to propose that he be made a contributor to sovereign.

cc: @al3x, @lukecyca, @neuhaus, @jplock
",ariddell,2016-03-03 22:36:23
501,2016-02-19 12:44:37,"+1
",jplock,2016-03-03 22:36:23
501,2016-02-19 16:18:40,":+1: 
",neuhaus,2016-03-03 22:36:23
501,2016-03-03 22:36:23,"Thank you for the recommendation and endorsements.
",mikeashley,2016-03-03 22:36:23
500,2016-02-19 10:22:05,"This addresses Issue #475.  Runs under Vagrant.

The server was not starting.  As a result, the dnsmasq service failed to
start, and the playbook thus failed to run when using the vpn role.  This
patch corrects the configuration per instructions from
https://help.ubuntu.com/community/OpenVPN.

OpenVPN PAM configuration moved up to reduce server bouncing as the
playbook runs.  The dependency on service (re)starts between openvpn and
dnsmasq works but feels brittle.
",mikeashley,2016-02-19 12:37:07
500,2016-02-19 10:30:26,"Updated commit message, no change to patch.
",mikeashley,2016-02-19 12:37:07
500,2016-02-19 12:36:54,"Thanks. I remember working on this briefly and trying to get the dnsmasq / iptables setup working in a sane manner.

Frankly, if it feels too brittle I wouldn't object to removing OpenVPN and having an issue to fix it properly. I think openvpn is one of the roles which needs to change the most with systemd
",ariddell,2016-02-19 12:37:07
499,2016-02-19 09:54:12,"I've deployed a new host with just the following roles:
`roles:
    - common
    - mailserver
    - webmail
    - git
    - monitoring`

After deployment completes, I see that services are running as expected, but I cannot login. The following logs has the actual mail address replaced by the values from my playbook for clarity:

`Feb 18 17:09:47 sovhost dovecot: auth: Error: LINE 1: SELECT email AS user, password FROM virtual_users WHERE emai...
Feb 18 17:09:47 sovhost dovecot: auth: Error:                                             ^
Feb 18 17:09:47 sovhost dovecot: auth: Error: pgsql: Query failed, aborting: SELECT email AS user, password FROM virtual_users WHERE email = '{{main_user_name}}@{{domain}}';
Feb 18 17:09:47 sovhost dovecot: auth: Error: sql({{main_user_name}}@{{domain}},my.mailclient.ip,<MPB2nhIsVgBRinWu>): Password query failed: ERROR:  relation ""virtual_users"" does not exist
Feb 18 17:09:47 sovhost dovecot: auth: Error: LINE 1: SELECT email AS user, password FROM virtual_users WHERE emai...
Feb 18 17:09:47 sovhost dovecot: auth: Error:                                             ^
Feb 18 17:09:49 sovhost dovecot: imap-login: Disconnected (auth failed, 3 attempts in 26 secs): user=<ms@q{{main_user_name}}@{{domain}}>, method=PLAIN, rip=my.mailclient.ip, lip=sov.host.ip, TLS, session=<MPB2nhIsVgBRinWu>`

If I connect to the mailserver database using the postgres user, I cannot see any tables:
`mailserver=# \d
No relations found.`

I did have one failed  task related to encfs when running the play:
`PLAY RECAP *********************************************************************
sovhost                     : ok=186  changed=143  unreachable=0    failed=1`

`TASK [common : Check for existing encfs] ***************************************
fatal: [sovhost]: FAILED! => {""changed"": false, ""cmd"": ""ls /encrypted/*"", ""delta"": ""0:00:00.004261"", ""end"": ""2016-02-18 22:41:39.514355"", ""failed"": true, ""rc"": 2, ""start"": ""2016-02-18 22:41:39.510094"", ""stderr"": ""ls: cannot access /encrypted/*: No such file or directory"", ""stdout"": """", ""stdout_lines"": [], ""warnings"": []}
...ignoring`

Is this the cause, or is there something else that I'm missing here ? 
",Anonymouslemming,2016-05-21 10:33:54
499,2016-02-19 13:01:58,"What version of ubuntu or debian?
",ariddell,2016-05-21 10:33:54
499,2016-02-19 13:43:59,"Ubuntu 14.04.4 LTS

I've tried ansible installed from pip (2.0.0.1) and from github (2.1.0) with the same results.
",Anonymouslemming,2016-05-21 10:33:54
499,2016-02-21 10:32:46,"You may have misconfigured `vars/user.yml` and/or accidentally modified `vars/defaults.yml`.

This is telling: `Feb 18 17:09:49 sovhost dovecot: imap-login: Disconnected (auth failed, 3 attempts in 26 secs): user=<ms@q{{main_user_name}}@{{domain}}>, method=PLAIN, rip=my.mailclient.ip, lip=sov.host.ip, TLS, session=<MPB2nhIsVgBRinWu`.

The string `{{main_user_name}}@{{domain}}` should have been replaced with your main user name @ your domain.  Also, in `vars/user.yml` that string normally is `{{ main_user_name }}@{{ domain }}`.  (Not sure if the space between the braces and the variable name is required by Ansible.)

I recommend double-checking your configuration.
",mikeashley,2016-05-21 10:33:54
499,2016-02-21 21:10:48,"Sorry if I didn't make it clear in my post - that was my clumsy attempt to obfuscate my domain details. I'm definitely seeing the value I put for main user and domain in the user / domain parts in the log.
",Anonymouslemming,2016-05-21 10:33:54
499,2016-05-21 10:33:54,"There has not been followup on this bug report, so I am going to assume it's been resolved.
",mikeashley,2016-05-21 10:33:54
498,2016-02-18 10:20:41,"Make a clean distinction between Debian 7 and Debian 8.  Anticipate the next Ubuntu LTS release (Xenial) that is planned for support.  This drops roundcube, but we have Issue #495 noting that we need to restore it.

This deploys with no errors in the Vagrant test environment.  I'm expecting this should help streamline work to migrate over to Jessie and get remaining problems straightened out before adding Xenial support.
",mikeashley,2016-02-20 14:53:17
498,2016-02-18 12:35:45,"Thanks for this.

Perhaps there should be a separate commit removing roundcube (all of it, including the role) pending a real solution. The code for the role is still in the git tree. If the roundcube removal is its own commit it could also be trivially reverted.
",ariddell,2016-02-20 14:53:17
498,2016-02-19 00:30:57,"That works for me.  I was a little reluctant to drop it, but Roundcube has gone from 0.9 to 1.2, so I think the whole role needs pretty careful review before reinstatement.
",mikeashley,2016-02-20 14:53:17
498,2016-02-19 00:58:44,"Missed a couple of references to Ubuntu in the common role.  Corrected.
",mikeashley,2016-02-20 14:53:17
498,2016-02-20 14:53:13,"Thanks for this. We're almost there!
",ariddell,2016-02-20 14:53:17
497,2016-02-17 02:04:51,"On Ubuntu 14.04 and a standard sovereign install, I get this the opendmarc_report.log

> Can't locate DBD/yes.pm in @INC (you may need to install the DBD::yes module) (@INC contains: /etc/perl /usr/local/lib/perl/5.18.2 /usr/local/share/perl/5.18.2 /usr/lib/perl5 /usr/share/perl5 /usr/lib/perl/5.18 /usr/share/perl/5.18 /usr/local/lib/site_perl .) at /usr/sbin/opendmarc-import line 22.
> Can't locate DBD/yes.pm in @INC (you may need to install the DBD::yes module) (@INC contains: /etc/perl /usr/local/lib/perl/5.18.2 /usr/local/share/perl/5.18.2 /usr/lib/perl5 /usr/share/perl5 /usr/lib/perl/5.18 /usr/share/perl/5.18 /usr/local/lib/site_perl .) at /usr/sbin/opendmarc-reports line 27.

It still connects to the database. 
",simontretter,2016-09-11 11:02:23
497,2016-03-09 09:13:35,"It's a bug in the OpenDMARC 1.2.0+dfsg-1 package, fixed in 1.3.0 (or Debian 1.2.0+dfsg-2 which has not yet made it to Ubuntu Trusty).
- https://sourceforge.net/p/opendmarc/tickets/90/
- https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=742447

Could you please open a bug at https://launchpad.net/ubuntu/+source/opendmarc/+bugs ?
",neuhaus,2016-09-11 11:02:23
497,2016-03-10 07:50:22,"Is there a temporary work around? Like installing yes.pm manually or so? 
",hpk42,2016-09-11 11:02:23
497,2016-03-10 08:15:46,"@hpk42 There is a patch for opendmarc in the bug at https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=742447
",neuhaus,2016-09-11 11:02:23
496,2016-02-14 12:17:54,"- Currently we use the opensuse repository.  The owncloud maintainers [recommend](https://owncloud.org/install/#instructions-server) using their [official repository](https://download.owncloud.org/download/repositories/stable/owncloud/).  We should follow their recommendation.
- The role needs reviewed to ensure we are still installing it correctly.  OwnCloud's installer and updater changed significantly with OwnCloud 8.0.
",mikeashley,2016-03-07 13:37:08
496,2016-02-22 09:29:27,"With OwnCloud 8.2, first-time setup includes selection of the DB backend and initialization of the database.  Post-deply instructions need updated, and the role's tasklist needs updated to not do all the DB setup work it tries to do now.
",mikeashley,2016-03-07 13:37:08
496,2016-02-28 13:04:07,"PR #505 should address this issue.
",mikeashley,2016-03-07 13:37:08
495,2016-02-14 12:14:45,"Roundcube support needs to be reinstated from Debian backports and tested.  We've had nagging installation problems (#417 is the latest) under wheezy.  Is the situation any better under jessie, or do we need to consider a different install method?
",mikeashley,2016-09-11 09:06:31
495,2016-02-25 12:34:00,"For the record, the [version](https://packages.debian.org/en/jessie-backports/roundcube) available via jessie-backports (1.1.4) is the same that Ubuntu Xenial [will ship with](https://launchpad.net/ubuntu/xenial/+source/roundcube).
",neuhaus,2016-09-11 09:06:31
495,2016-07-17 09:11:27,"Current roundcube in Debian testing is 1.2.0+dfsg.1-1
",neuffer,2016-09-11 09:06:31
495,2016-09-11 09:06:31,"Addressed with PR #590.
",mikeashley,2016-09-11 09:06:31
494,2016-02-14 02:22:39,,mikeashley,2016-02-15 21:03:16
493,2016-02-13 16:18:43,"Make a clean distinction between Debian 7 and Debian 8.  Anticipate the next Ubuntu LTS release (Xenial) that is planned for support.
",mikeashley,2016-02-14 11:03:30
493,2016-02-13 17:41:31,"This conflicts with #486. 

I hope having things actually working on xenial isn't going to be a blocker for the Jessie branch, since xenial is in pretty early stages still. E.g. The official rspamd apt repo (which #486 switches to) doesn't even have xenial packages yet. 
",carljm,2016-02-14 11:03:30
493,2016-02-14 10:44:24,"This also conflicts with PR #489.  I recommend delaying this PR.  I'll fix it up after the two conflicting PRs are resovled.
",mikeashley,2016-02-14 11:03:30
492,2016-02-13 14:50:11,,mikeashley,2016-02-15 21:03:30
491,2016-02-13 12:23:12,"The database import fails to run.  There is a syntax error in the import file, and after that is fixed, there is type error.  It appears the import file was written for a database other than postgres.

It looks like this broke at commit 2352d2d67e591cb1ee841c0782ea7ce05b36e355.  Speculation: the aim of the commit was to remove the last(?) reference to mysql.
",mikeashley,2016-03-04 20:58:19
491,2016-02-13 12:52:32,"I would like @al3x to weigh in on intent.  Some brief googling fails to turn up how to configure this to use postgres, and the man pages are all about mysql for report generation.  Seems like the two options are 1) drop opendmarc, and 2) revert to using mysql and install it.
",mikeashley,2016-03-04 20:58:19
491,2016-02-14 01:04:43,"Yes, I was in the process of removing MySQL. It seemed to bother users that they were running two databases (understandably).
",al3x,2016-03-04 20:58:19
491,2016-02-14 01:17:35,"I found PR #397 where this has come up before.  I recommend reverting to MySQL so that OpenDMARC works and that we can keep moving towards a stable jessie branch.  If somebody feels strongly about squashing MySQL from the system, they can tackle making OpenDMARC work with Postgres separately.
",mikeashley,2016-03-04 20:58:19
490,2016-02-13 11:29:25,"The znc package installs the client but does not set it up as a service.  This patch restores the service configuration that was done on wheezy/trusty.

This addresses Issue #474.
",mikeashley,2016-02-16 12:38:04
490,2016-02-15 21:06:01,"Should we try to use systemd instead of init in jessie? Surely there's a systemd service file we can copy from somewhere? I find the `.service` files far more readable at this point.
",ariddell,2016-02-16 12:38:04
490,2016-02-16 01:13:03,"Good suggestion.
",mikeashley,2016-02-16 12:38:04
489,2016-02-13 10:29:56,"To improve maintainability, avoid using the Include directive.  Move most of the SSL configuration to the global configuration and leave enabling the SSL engine to each virtual host that wants to use it.
",mikeashley,2016-02-14 13:46:43
488,2016-02-13 10:28:01,"Both jessie and wily use the standard solr package, which expects tomcat7.  This PR switches from tomcat8 to tomcat7.  This prevents tomcat7 and tomcat8 from both being installed and thus fighting over port 8080 and generating monitoring alerts.
",mikeashley,2016-02-14 13:44:14
488,2016-02-14 13:44:11,"LGTM
",ariddell,2016-02-14 13:44:14
487,2016-02-11 20:52:07,"cf https://github.com/sovereign/sovereign/pull/486
",spk,2016-03-05 19:47:40
487,2016-02-11 21:19:08,"I'll merge this but what exactly does it fix?
",ariddell,2016-03-05 19:47:40
487,2016-02-11 21:20:07,"Should fix the Ansible lint errors on #486, which are unrelated to that PR.
",carljm,2016-03-05 19:47:40
487,2016-02-11 21:25:18,"Yes we have to use last ansible version for syntax check and a fixed version for ansible-lint.
I don't have better solution right now.
",spk,2016-03-05 19:47:40
487,2016-02-11 21:51:03,"Sorry, I'm confused. Why can't the requirements.txt file be used? Shouldn't the travis.yml file just have a line pip install -r requirements.txt?
",ariddell,2016-03-05 19:47:40
487,2016-02-11 21:54:43,"No I tried in this commit https://github.com/spk/sovereign/commit/3daf7cf56bb1d84d9efbd78e743569748251de48
but ansible-lint failed completely due to too old ansible version.
cf https://travis-ci.org/sovereign/sovereign/builds/108639408#L443
",spk,2016-03-05 19:47:40
487,2016-02-11 22:41:44,"So the problem is with ansible. Why are we pinning to 1.6.6 anyway?

Can you go back to spk@3daf7cf and figure out a version of ansible that works?

If you're feeling up to it, the ansible-lint requirement probably should go in test-requirements.txt. I believe that's the convention.
",ariddell,2016-03-05 19:47:40
487,2016-02-12 06:50:37,"I cannot upgrade ansible, this is a known issue, cf https://github.com/sovereign/sovereign/pull/466
I did not know about test-requirements.txt, I will do that.
",spk,2016-03-05 19:47:40
487,2016-03-05 17:27:36,"Title updated. Currently ansible is fixed to `1.6.6`, this version does not work with ansible-lint.
And there is still `sudo` on the codebase that cause errors so fixed ansible-lint to 2.3.6
",spk,2016-03-05 19:47:40
487,2016-03-05 19:21:54,"OK. I think I get this now. Sorry for being so slow.

Can you squash/rebase all those commits into a single commit (since it's a simple change)?

p.s. maybe then we can resolve #446 by upgrading both ansible and ansible-lint to the current version (maybe just on jessie)?
",ariddell,2016-03-05 19:47:40
487,2016-03-05 19:43:13,"No problem @ariddell 
This is done and I also added a todo on `.travis.yml`
",spk,2016-03-05 19:47:40
486,2016-02-11 20:26:28,"This replaces #477.
",carljm,2016-02-17 12:40:06
486,2016-02-11 20:32:08,"Ansible-lint is failing, but it doesn't appear to have anything to do with the changes in this PR.

I tested the rspamd tasks modified here via Vagrant, and they ran fine.
",carljm,2016-02-17 12:40:06
486,2016-02-17 01:55:29,"I verified this runs via Vagrant.  I recommend merging.
",mikeashley,2016-02-17 12:40:06
486,2016-02-17 12:40:01,"Great. Thanks!
",ariddell,2016-02-17 12:40:06
485,2016-02-09 02:11:36,"I don't know how many sovereign installations run Ubuntu. For me, the mirror autoselect keeps breaking my installation in weird ways. ansible does not run through because of some apt error, mostly because the apt source is not giving me what I need. 

Can't we just leave this on the standard mirror the hoster provides? 
",simontretter,
485,2016-02-10 09:05:05,"Are you running Ubuntu trusty? What is the exact problem you encounter? I haven't had any problems with the mirror autoselect.
",neuhaus,
485,2016-02-10 11:28:22,"It often gives me broken mirrors where apt-get update won't run through. If I fix the sources.list by using official mirrors, everything runs fine.
",simontretter,
485,2016-02-10 12:29:07,"I see. What do you suggest we do? We could add this problem and its solution to the documentation.
",neuhaus,
485,2016-02-10 12:54:43,"That would be one way. I personally would be fine without the mirror autoselection. Would dropping it hurt anyone?
",simontretter,
485,2016-02-10 13:33:51,"Fine with me, as long as the documentation is clear about it.
",neuhaus,
485,2016-02-11 14:17:10,"Can we just have a default variable in the role that one can turn on or off?
",ariddell,
485,2016-02-11 14:39:25,":+1: 
",neuhaus,
484,2016-02-07 23:10:47,"This should fix #479, though even with this fix I can't get `vagrant up` to run on master (now it fails with `psql: FATAL:  database ""roundcube"" does not exist` on the ""set roundcube password"" step).
",carljm,2016-02-17 12:34:35
483,2016-02-07 18:09:54,"LetsEncrypt support is not yet on master.
",mikeashley,2016-02-08 12:07:50
482,2016-02-07 17:46:02,"See http://blog.rlove.org/2015/01/public-key-pinning-hpkp.html
",ariddell,
482,2016-02-10 12:34:29,"The nice thing about the Let's Encrypt policy is that their limits are high enough that this shouldn't be a problem. We can just generate two keys.
From an operational security standpoint it doesn't make sense to have both keys on the machine, however. If there is a breakin we would have to revoke both keys.

Possible solution:
Have the admin provide a PGP public key. Create a backup key+cert regularly, then encrypt it using the public key and shred the unencrypted copy.
",neuhaus,
482,2016-02-11 14:18:33,"The idea from the blog post that sounded good was that we could pin the CA certificate (let's encrypt), not our local certificate.

When I have time I'll try implementing this. The more TOFU we can get the better.
",ariddell,
482,2016-02-11 14:41:40,"Oh ok. Not sure I like that idea - the less trust we have to give to a CA, the better.
If we can get it automated, pinning the actual certificate (plus a backup) sounds more secure.
",neuhaus,
482,2016-02-11 16:16:58,"There's no additional trust involved, it's just very good MITM protection. I'll write up a more detailed sketch with the PR.
",ariddell,
482,2016-02-19 08:27:53,"@neuhaus Using a GPG key to encrypt the backup RSA key is an excellent idea! That just solved my problem with implementing HPKP in a somewhat sane way, thank you. :-)
",drybjed,
482,2016-11-21 13:27:32,"I would advice to avoid using HPKP as I think it poses more problems (especially when changing keys) than it's solving

https://blog.qualys.com/ssllabs/2016/09/06/is-http-public-key-pinning-dead",Citillara,
481,2016-02-02 14:48:41,"Same as https://github.com/sovereign/sovereign/pull/480 but for jessie branch.
",pawel-lewtak,2016-02-02 15:52:51
480,2016-02-01 21:58:06,"I fixed two links as ansibleworks.com domain doesn't work anymore
",pawel-lewtak,2016-02-02 15:53:01
480,2016-02-02 14:44:03,"Thanks! Would you mind submitting a second PR against the jessie branch as well?
",ariddell,2016-02-02 15:53:01
480,2016-02-02 14:45:36,"No problem. Will do in a second.
",pawel-lewtak,2016-02-02 15:53:01
479,2016-02-01 07:34:42,"Running `vagrant up` on latest `master` branch results in:

<S_CODE_TOKEN>
",carljm,2016-02-17 12:34:35
478,2016-02-01 07:31:38,"Running `vagrant up` on unmodified latest `jessie` branch results in:

<S_CODE_TOKEN>
",carljm,2016-02-07 22:38:45
478,2016-02-07 22:38:45,"Oh, this is a dupe of #474, sorry.
",carljm,2016-02-07 22:38:45
477,2016-02-01 07:28:58,,carljm,2016-02-11 20:27:36
477,2016-02-01 07:30:24,"I'm also curious -- why the `download.suse.com` repos for rspamd, instead of the `rspamd.com` repos recommended at https://rspamd.com/downloads.html ? And why using repos labeled for Ubuntu 14.10 for 14.04?
",carljm,2016-02-11 20:27:36
477,2016-02-10 12:39:43,"Good questions. Looks like these are issues that should be fixed.
",neuhaus,2016-02-11 20:27:36
477,2016-02-10 16:15:35,"Shall I add the fixes for those two issues to this PR as well, or file separate PRs?
",carljm,2016-02-11 20:27:36
477,2016-02-10 18:19:03,"Yes please
",neuhaus,2016-02-11 20:27:36
477,2016-02-11 20:27:36,"Replaced by #486.
",carljm,2016-02-11 20:27:36
476,2016-01-28 13:34:21,"This cherry-picks all (edit: was ""useful"") commits from master into jessie (and resolves very minor conflicts).

It includes the following commits:
- [master^2] Adding monit tunnel information to Readme
- [master^^2] Run ansible-lint before submitting a pull request
- [master^^2^] Ask for good commit practices
- [master^^2~2] Document the design
- [master^^2~3] Consider README.md in the design checklist
- [master^^2~4] Make decisions
- [master^^2~5] Consider testing in design
- [master^^2~6] Updated contribution guidelines
- [master~2^2] reverting become change. become directive is only available in ansible 1.9.x and newer.
- [master~2^2^] sudo directive was deprecated in ansible 1.9.x. Changed the entry to become directive to fix deprecation warnings.
- [master~2^2~2] Added ""UseRoaming no"" to ssh.config to fix OpenSSH: client bugs CVE-2016-0777 and CVE-2016-0778 see: http://undeadly.org/cgi?action=article&sid=20160114142733
- [master~3^2] ufw tasks shall have the ufw tag resolves #453
- [master~4^2] restart apache on SSL changes
- [master~4^2^] properly install changed SSL certificate
- [master~5^2] Ensure the config.ini is readable by www-data
- [master~5^2^] Pin Selfoss version to an actual release
- [master~6^2] Generate 2048 DH group and add it to Postfix
- [master~7^2] update openvpn server config
- [master~8^2] Configure logrotate permissions for selfoss
- [master~9^2] Remove reference to Google's DNS servers
- [master~10^2] Add SSL stapling cache for apache
- [master~4^2~2] Comment copyediting
- [master~4^2~3] up comments in openvpn config template
- [master~4^2~4] comment out google dns in openvpn config template
- [master~4^2~5] add new settings into openvpn config template
- [master~4^2~6] update openvpn variables
- [master~12^2] change auth to interna_hashed
- [master~13^2] Remove not needed common_timezone on user vars
- [master~13^2^] Set Etc/UTC as default timezone
- [master~13^2~2] Use common_timezone and fix idempotence
- [master~14^2] Add some info on DMARC
",ariddell,2016-02-11 14:38:44
476,2016-01-30 16:53:00,"Great! If you want I'll have a look when I return from FOSDEM.
",neuhaus,2016-02-11 14:38:44
476,2016-02-06 10:46:40,"@neuhaus I am delaying rebasing the jessie LE branch until this is resolved.
",mikeashley,2016-02-11 14:38:44
476,2016-02-06 12:12:00,"OK, I looked over this pull request and it looks good to me.  üëç
",neuhaus,2016-02-11 14:38:44
476,2016-02-11 14:16:30,"@neuhaus would you mind merging? (merging non-minor PRs oneself is a faux pas by convention, right?)
",ariddell,2016-02-11 14:38:44
476,2016-02-11 14:38:41,"@ariddell Not at all! It's a good convention.
",neuhaus,2016-02-11 14:38:44
475,2016-01-28 09:39:41,"The dnsmasq service fails to restart.

‚óè dnsmasq.service - dnsmasq - A lightweight DHCP and caching DNS server
   Loaded: loaded (/lib/systemd/system/dnsmasq.service; enabled)
  Drop-In: /run/systemd/generator/dnsmasq.service.d
           ‚îî‚îÄ50-dnsmasq-$named.conf, 50-insserv.conf-$named.conf
   Active: failed (Result: exit-code) since Thu 2016-01-28 01:38:16 UTC; 52s ago
  Process: 18487 ExecStop=/etc/init.d/dnsmasq systemd-stop-resolvconf (code=exited, status=0/SUCCESS)
  Process: 18518 ExecStart=/etc/init.d/dnsmasq systemd-exec (code=exited, status=2)
  Process: 18517 ExecStartPre=/usr/sbin/dnsmasq --test (code=exited, status=0/SUCCESS)
 Main PID: 17071 (code=exited, status=0/SUCCESS)

Jan 28 01:38:16 li879-96 dnsmasq[18517]: dnsmasq: syntax check OK.
Jan 28 01:38:16 li879-96 dnsmasq[18518]: dnsmasq: failed to create listening socket for 10.8.0.1: Cannot assign requested address
Jan 28 01:38:16 li879-96 dnsmasq[18518]: failed to create listening socket for 10.8.0.1: Cannot assign requested address
Jan 28 01:38:16 li879-96 dnsmasq[18518]: FAILED to start up
Jan 28 01:38:16 li879-96 systemd[1]: dnsmasq.service: control process exited, code=exited status=2
Jan 28 01:38:16 li879-96 systemd[1]: Failed to start dnsmasq - A lightweight DHCP and caching DNS server.
Jan 28 01:38:16 li879-96 systemd[1]: Unit dnsmasq.service entered failed state.
",mikeashley,2016-02-20 00:39:48
475,2016-02-13 14:27:10,"I investigated this.  It looks like ansible is reporting that the openvpn server is started after the handler runs to bounce it, but it's not, and thus dnsmasq has no interface to bind against when it tries to start.  Logging into the server and starting openvpn followed by starting dnsmasq works fine.

Root cause still needs to be identified.  Running ansible in verbose mode (`vvvv`) wasn't very helpful.
",mikeashley,2016-02-20 00:39:48
475,2016-02-13 15:01:23,"Issue #401 is related.
",mikeashley,2016-02-20 00:39:48
475,2016-02-20 00:39:48,"Fixed with PR #500.
",mikeashley,2016-02-20 00:39:48
474,2016-01-28 09:38:09,"The package installs the znc client but does not set it up as a service.  Thus the role fails to run because the user 'znc' does not exist.

There is a bug/enhancement report in to the package maintainer to install as a service.  We could either wait and see if that gets done, or we could go back to the old way of installing.
",mikeashley,2016-02-17 09:54:41
474,2016-02-17 09:54:41,"Fixed with PR #490.
",mikeashley,2016-02-17 09:54:41
473,2016-01-28 09:25:37,"The cache configuration must be global, i.e., not per virtual host.  As
a result, this change moves most of the SSL configuration to a global
configuration and leaves enabling the SSL engine to each virtual host
that wants to use it.
",mikeashley,2016-02-07 15:02:38
473,2016-01-28 13:20:16,"I think master got a patch on this. Let me finish up cherry-picking stuff (ten minutes) and see if it includes the fixes.

Edit: here are the missing commits: #476 

Looking forward to testing LE.
",ariddell,2016-02-07 15:02:38
473,2016-01-29 10:04:19,"Looks good.  I like moving the SSL configuration to global instead of using an Include in the virtual hosts, but it's a style thing.  I may propose this again, but I'm eager to see the catchup PR merged so we can finalize the LE PR and get it on jessie.
",mikeashley,2016-02-07 15:02:38
473,2016-02-07 15:02:38,"Rescinding this and will resubmit after the jessie catchup PR is merged.
",mikeashley,2016-02-07 15:02:38
472,2016-01-28 09:23:33,"Fix for PR #427 that was just merged.
",mikeashley,2016-01-30 16:48:40
472,2016-01-30 16:48:44,"Thanks
",neuhaus,2016-01-30 16:48:40
471,2016-01-24 15:58:08,"There are important changes that got applied to master but didn't get applied to jessie. (I'm going to attempt a rebase today.)

In light of this, would it be useful to have a public timeline for switching to jessie as the default branch? April is the release of Ubuntu Xenial.

What's a good solution in the short term? Would requiring that PRs apply to both branches be useful? Or should someone just make sure to rebase every month?
",ariddell,2016-01-25 12:45:59
471,2016-01-24 16:15:20,"I've rebased jessie and pushed it to this branch here: https://github.com/ariddell/sovereign/tree/jessie-rebased

I'm not sure exactly how you review a rebase. Would it be preferable to just cherry-pick each commit from master separately and submit that as a PR?
",ariddell,2016-01-25 12:45:59
471,2016-01-25 12:45:59,"I'll answer my own question. All the changes in master that are missing from jessie need to be submitted as individual PRs against jessie. I'll get started on this.
",ariddell,2016-01-25 12:45:59
471,2016-01-27 10:11:37,"Thanks for doing this!
Ideally we would do a rebase every now and then and once we officially support Jessie, the jessie branch turns into the master branch, the former master branch moves to the wheezy branch and only gets maintenance updates until we drop it.

Please make sure that these patches don't break compatibility with Ubuntu Trusty.
",neuhaus,2016-01-25 12:45:59
471,2016-01-27 13:04:41,"I've done a few of the cherry-picks. I'll keep going. Thanks for
the note.

My sense was that the jessie branch was just going to support jessie and
the next Ubuntu (jessie-based) LTS. In any event, it's a question for
another issue. I'm going to just cherry-pick the useful commits in the
master branch here.

On 01/27, Sven Neuhaus wrote:

> Thanks for doing this!
> Ideally we would do a rebase every now and then and once we officially support Jessie, the jessie branch turns into the master branch, the former master branch moves to the wheezy branch and only gets maintenance updates until we drop it.
> 
> Please make sure that these patches don't break compatibility with Ubuntu Trusty.
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/sovereign/sovereign/issues/471#issuecomment-175526420
",ariddell,2016-01-25 12:45:59
471,2016-01-27 13:06:29,"Nah, I thought the jessie branch was a temporary thing until it's working and then we can merge it into master.
If the jessie branch breaks backward compatibility with older distributions we need to move the last working code into a maintenance branch so people have some time to upgrade their stuff
",neuhaus,2016-01-25 12:45:59
471,2016-01-27 13:32:04,"I thought the consensus was to break backward compatibility. I'm clearly wrong! Not sure where this is best discussed. Probably not in an issue tracker. Maybe a mailing list?
",ariddell,2016-01-25 12:45:59
471,2016-01-27 13:34:54,"There is no mailing list, this is the right place for discussion.

Sure, the jessie branch can break backward compatibility. That's another reason why we need two branches while we support both jessie and something older.
",neuhaus,2016-01-25 12:45:59
471,2016-01-27 14:26:48,"Ok, so at some point we create a branch called `oldstable` and rename
jessie to master? Works for me.

On 01/27, Sven Neuhaus wrote:

> There is no mailing list, this is the right place for discussion.
> 
> Sure, jessie can break backward compatibility. That's why we need another branch for the phase where we support both jessie and something older.
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/sovereign/sovereign/issues/471#issuecomment-175630993
",ariddell,2016-01-25 12:45:59
471,2016-01-27 15:25:54,"exactly. that point is reached as soon as the current jessie branch is stable.
",neuhaus,2016-01-25 12:45:59
471,2016-01-28 13:40:32,"Ok, I've cherry-picked everything #476. @neuhaus, mind having a look?
",ariddell,2016-01-25 12:45:59
471,2016-01-31 07:08:26,"I will once I get back home
",neuhaus,2016-01-25 12:45:59
470,2016-01-22 09:47:51,"Version v0.12 of cgit was released 8 days ago.
It appears to have lots of fixes.

If someone is using cgit a lot perhaps he/she can test it? If it works without a problem we only need to change `cgit_version` in `vars/defaults.yml`.
",neuhaus,2016-02-21 14:59:38
470,2016-02-14 02:17:29,"I upgraded my server to cgit 0.12 and gitolite 3.6.4.  Both seem to be working well.
",mikeashley,2016-02-21 14:59:38
470,2016-02-21 14:39:49,"Addressed on the jessie branch with PR #494.
",mikeashley,2016-02-21 14:59:38
469,2016-01-18 23:57:15,"Fresh install hits a failure

<S_CODE_TOKEN>
",ariddell,2016-01-30 16:49:11
469,2016-01-18 23:59:17,"It's `conf-available` now. (edit: looks like a different error)
",ariddell,2016-01-30 16:49:11
469,2016-01-28 09:35:01,"PR #472 fixes this.
",mikeashley,2016-01-30 16:49:11
469,2016-01-30 16:49:17,"merged #472 
",neuhaus,2016-01-30 16:49:11
468,2016-01-18 23:47:08,"On a Digital Ocean machine with a fresh Debian 8 image, encfs will not work without some extra intervention.

Is this a bug in Debian? Shouldn't installing the fuse package call `modprobe fuse` or whatever it takes to get things working?

If it's not a bug there needs to be some documentation in sovereign.
",ariddell,2016-05-27 20:51:06
468,2016-01-19 00:27:45,"I ran into this in the vagrant jessie development environment.

https://github.com/jmcgnh/sovereign/issues/9

A reboot is required to pick up a new kernel, modpobe all by itself can't resolve the problem.

My approach for dealing with it is to run modprobe fuse and check the stderr; the results indicate whether a reboot is needed. If needed, I do the reboot and wait for the system to come back. It's coded and tested, but I'm not satisfied that it's a worthy solution, yet.
",jmcgnh,2016-05-27 20:51:06
468,2016-01-19 12:57:50,"Checking modprobe and potentially exiting with an informative message sounds like a good solution.
",ariddell,2016-05-27 20:51:06
468,2016-01-19 13:09:40,"@jmcgnh thanks for looking into this.

Since we're on the subject of disk encryption, should we investigate the use of [ext4 encryption](https://lwn.net/Articles/639427/) instead of encfs? It was added to Linux 4.1.
Linux 4.1/4.2 is also available for jessie as part of jessie-backports. Ubuntu 16.04 Xenial will ship with a 4.3 kernel.
",neuhaus,2016-05-27 20:51:06
468,2016-01-19 14:29:23,"@neuhaus that looks good. It looks like both encfs and ext4 leak the same information (# files, permissions, approximate sizes) but that ext4 is in the kernel and will enjoy, I would assume, a greater likelihood of long-term support.
",ariddell,2016-05-27 20:51:06
468,2016-01-19 22:15:09,"I think encryption should totally be optional and no role should be dependant on that. My Server runs on an encrypted LVM volume (e.g.)...
",skriems,2016-05-27 20:51:06
468,2016-01-22 10:03:11,"Same here. Still, ext4 encryption is promising a speed improvement over encfs.
",neuhaus,2016-05-27 20:51:06
468,2016-02-17 10:44:05,"It looks like there are three options:
1. Continue with encfs.
2. Pick up the 4.1 kernel from backports and use ext4 encryption.
3. Use an encrypted LVM volume.

There are pros and cons with each choice.  Factors like performance, security, reliability, backups, and ease of setup should be considered.  Are there other factors that go in this list?  It would be great to see the tradeoffs side-by-side so we can decide which way to go with this issue.
",mikeashley,2016-05-27 20:51:06
468,2016-02-17 12:52:51,"I vote to try ext4 in jessie and revert if it's worse than encfs. The fact that ext4 encryption is in the kernel tells me it's likely been audited more than encfs. It seems like there were some significant problems with encfs uncovered during the last audit: https://defuse.ca/audits/encfs.htm
",ariddell,2016-05-27 20:51:06
468,2016-02-17 14:20:25,"@jmcgnh Do you think your solution in jmcgnh#9 is solid enough?

I like the idea of switching to ext4 encryption. I'm using an encrypted root partition myself so I'm not the expert on this one at the moment.
Note that the author of [ext4-crypt](https://github.com/gdelugre/ext4-crypt) commented that the kernel feature was ""very unstable and experimental"" 7 months ago.
",neuhaus,2016-05-27 20:51:06
468,2016-02-21 14:24:03,"I was not able to reproduce this in Debian 8.1 either in the vagrant test environment or on a fresh Linode instance.  Are you still seeing this problem?

For what it's worth, linode images do not include modprobe for security reasons.  @jmcgnh's patch won't work as is with that provider if we need it.
",mikeashley,2016-05-27 20:51:06
468,2016-05-19 21:33:13,"@ariddell Is this still a problem on Digital Ocean?  I'm not seeing any problems with it on Linode with Debian 8.1.
",mikeashley,2016-05-27 20:51:06
468,2016-05-20 14:58:12,"I'll check. I'll be moving my install to jessie soon.
",ariddell,2016-05-27 20:51:06
468,2016-05-27 20:51:06,"Problem is gone.

(Jessie 8.3 on Digital Ocean)
",ariddell,2016-05-27 20:51:06
467,2016-01-16 13:50:48,"hi,

i am just browsing through this project and couldn't find anything related... are domain aliases supported in the mail-configuration?
If not, it could be a nice feature addition as it is a quite commonly used feature...

regards,
strowi
",strowi,2016-03-06 19:45:26
467,2016-01-18 10:05:50,"We support the standard Postfix virtual domain stuff. There are three tables for this in the Postgresql database.
This could really use more documentation, pull requests welcome!

Does this answer your question?
",neuhaus,2016-03-06 19:45:26
467,2016-03-06 19:45:26,"sorry, for the late reply.. yes it does. 
Thank you very much!
",strowi,2016-03-06 19:45:26
466,2016-01-15 13:37:44,"seperate pull request for sudo -> become change.

Upped requirements.txt to ansible 1.9.4
",fengor,2016-03-07 13:30:40
466,2016-02-04 06:13:20,"because become is definately available in 1.9.4
",fengor,2016-03-07 13:30:40
466,2016-02-12 13:02:33,"The version string should be `ansible>=1.9.4,<2.0`, IMHO. Could this and #487 be reconciled somehow? The PRs are not very clear. From the PR text and commit messages I'm not sure what the problem is and/or why the commits solve the problem.
",ariddell,2016-03-07 13:30:40
466,2016-02-17 12:39:04,"What about a single PR that deals with upgrading to Ansible to 2.0+ and deals with the ansible-lint issue in #487. It should have a title like ""Upgrade Ansible to 2.0"". I'm willing to do this if nobody else gets around to it.
",ariddell,2016-03-07 13:30:40
466,2016-02-17 14:26:48,"We don't know what version of ansible the users have. Ansible (often) runs on a different machine than the one that is being configured. If it's a Ubuntu trusty box they probaby have Ansible 1.5.4. Debian jessie ships with Ansible 1.7.2
",neuhaus,2016-03-07 13:30:40
466,2016-02-17 14:51:27,"There is no reason to rely on a system-installed Ansible version; a project like sovereign needs to be able to pin itself to a specific Ansible version and rely on that. The instructions should include creating a Python virtualenv and running `pip install -r requirements.txt` within it, so we always have exactly the specified Ansible version available. 
",carljm,2016-03-07 13:30:40
466,2016-02-17 15:10:01,"I agree. Let's just decide on a version to support and have the
requirements.txt file reflect this. I believe Ansible is using semantic
versioning so >=2.0,<2.1 sounds good to me.

On 02/17, Carl Meyer wrote:

> There is no reason to rely on a system-installed Andible version; a project like sovereign needs to be able to pin itself to a specific Ansible version and rely on that. The instructions should include creating a Python virtualenv and running `pip install -r requirements.txt` within it, so we always have exactly the specified Ansible version available. 
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/sovereign/sovereign/pull/466#issuecomment-185237160
",ariddell,2016-03-07 13:30:40
466,2016-02-17 19:09:59,"For what it's worth many users don't want to depend on pip installs for production/trusted machines. I prefer sticking to the ansible version provided by my package manager. As your current target is Jessie, I think you should also expect ansible to be at the version provided in Jessie (even if the admin/deployement machine is not always using the same OS/version).

Just my 2 cents.
",nodiscc,2016-03-07 13:30:40
466,2016-02-17 19:18:08,"IIRC, we already required a version higher than the version installed by default with wheezy/trusty.

Remember, we're talking about the local copy of ansible. Having a virtualenv or using `pip install --user` is no big deal.
",ariddell,2016-03-07 13:30:40
466,2016-03-05 19:23:53,"Since master is doing fine could we apply this just to jessie? We could upgrade ansible to 2.0 and ansible-lint as well.
",ariddell,2016-03-07 13:30:40
466,2016-03-07 13:30:39,"Fixed with #508.
",ariddell,2016-03-07 13:30:40
465,2016-01-15 07:46:31,"sudo was deprecated in ansible playbooks in 1.9.

See the deprecation warning in the travis logs.
",fengor,2016-03-14 08:53:30
465,2016-01-15 10:50:28,"Sounds good. Could you provide a PR please?

Edit: OK, let's make sure it will still work with older versions of Ansible for the time being. When was ""become"" added to Ansible? ""sudo"" was removed in 2.0 (released 3 days ago) but no distribution is including that yet. The next major distribution update supported by Sovereign will be Ubuntu 16.04 LTS released in April. We have time until then to do this migration.
",neuhaus,2016-03-14 08:53:30
465,2016-01-15 13:38:47,"https://github.com/sovereign/sovereign/pull/466

Pull request does not need to be merged at once but can be done when supported distros are updated to ansible 1.9 or greater
",fengor,2016-03-14 08:53:30
465,2016-02-14 11:29:03,"@fengor I'm trying to make sense of the related pull requests but can't verify root cause.  Could you explain how to reproduce the deprecation warnings on one's desktop?  I am not able to do it with either 1.9.3 or 1.9.4 running `ansible-playbook --syntax-check -i hosts site.yml`.  I would like to squash the lint noise we're getting with PRs on the jessie branch at least.
",mikeashley,2016-03-14 08:53:30
465,2016-03-13 11:27:28,"This has been addressed, right?  Ready to close?
",mikeashley,2016-03-14 08:53:30
465,2016-03-14 06:50:42,"can be closed. sorry didnt had time to work on this further.

i don't know if syntax check shows it but the deprecationw arning showed
for me when i normally executed the playbook

On Sun, Mar 13, 2016 at 12:27 PM, Mike Ashley notifications@github.com
wrote:

> This has been addressed, right? Ready to close?
> 
> ‚Äî
> Reply to this email directly or view it on GitHub
> https://github.com/sovereign/sovereign/issues/465#issuecomment-195939268
> .

## 

Friends applaud, the comedy is over. -- Last words of Ludwig von Beethoven
",fengor,2016-03-14 08:53:30
465,2016-03-14 08:53:30,"Ok, I think this is as designed.  On master we are asking for Ansible 1.6+.  If version 1.9.3 or newer is installed, the user will see deprecation warnings.  If someone believes we should use Ansible >= 1.9.3 on master, then let's have an issue for that.
",mikeashley,2016-03-14 08:53:30
464,2016-01-15 07:36:19," Until you are able to patch affected systems, the recommended workaround is to use

<S_CODE_TOKEN>

That is, add the option UseRoaming no to your /etc/ssh/ssh_config (or your user's ~/.ssh/config) file, or start your ssh client with -oUseRoaming=no included on the commandline.

We will be updating this article with more information as it becomes available.

UPDATE: This affects OpenSSH versions 5.4 through 7.1. 
",fengor,2016-01-15 11:18:49
464,2016-01-15 07:37:01,"https://github.com/sovereign/sovereign/pull/463
",fengor,2016-01-15 11:18:49
464,2016-01-15 10:55:23,"Thanks for the PR. Some questions:

What happens if the SSH version is too old to understand ""UseRoaming""

Isn't this issue fixed by the updated packages that were released already?

When was ""becomes"" added to Ansible? We should not break backward compatability too quickly here. For example, Ubuntu 14.04 still ships currently has Ansible 1.7.2
",neuhaus,2016-01-15 11:18:49
464,2016-01-15 11:05:53,"OpenSSH Releae 5.4 (first affected version) is from 2010-03-07. Anyone using an openssh version that old has major other problems.

The updated Packages should fix the issue yes but i think making sure can't hurt in this case.

The becomes should have been a different pull request my bad. Good Point about the packaged ansible version in distros. I'll revert that change.
",fengor,2016-01-15 11:18:49
463,2016-01-15 07:32:38,"Added ""UseRoaming no"" to ssh.config to fix openssh client bugs CVE-2016-0777 and CVE-2016-0778

see: http://undeadly.org/cgi?action=article&sid=20160114142733
",fengor,2016-01-15 11:18:08
463,2016-01-15 11:18:00,"Adding the UseRoaming appears not to have any bad effects so why not.
",neuhaus,2016-01-15 11:18:08
463,2016-01-15 11:18:39,"Resolves #464 
",neuhaus,2016-01-15 11:18:08
462,2016-01-10 05:19:26,"This role provides Radicale ~~with postgresql backend~~. The Radicale Project is a complete CalDAV (calendar) and CardDAV (contact) server solution. Check out http://radicale.org

People who don't need owncloud or fear the added attack surface to their server can use this for calendar and contact sync. Although both can run at the same time without conflict, a way to select either solution might be beneficial. 
",simontretter,2017-01-07 02:02:52
462,2016-01-15 11:22:52,"Nice. Going to test the role next week but I fully approve the idea behind it.
",fengor,2017-01-07 02:02:52
462,2016-01-16 13:00:47,"Nice! I don't have a huge amount of trust in OwnCloud either.
Please add some documentation. 
Is there a way to migrate the data in CalDAV/CardDAV for OwnCloud users? That would also be something for the documentation.
Is there a way we can make sure we don't activate both the OwnCloud and Radicale roles? I think they would collide.

Have you tested it? With which distribution(s)?
Also, does the Radicale configuration work with Android, iOS and OS X? Does it work with Thunderbird? Are plugins required for Thunderbird? Thanks.
",neuhaus,2017-01-07 02:02:52
462,2016-01-19 08:28:44,"@neuhaus the time I can devote to this is limited, but I will add documentation once the role is well tested. For now, I don't know of a nice way to migrate the data. Radicale and Owncloud technically don't collide, you can run them at the same time. The question is whether you want to tolerate the feature overlap in a standard installation. 
To develop, I am using vagrant / debian78. I am still waiting for progress on the letsencrypt role to start deploying on live servers.

Radicale works well on Android (davdroid), iOS and OS X. As for Thunderbird, I don't think it will work (then again, I have not found any Caldav / Carddav implementation that works well with Thunderbird).
Please have a look at the Radicale user documentation for specific clients:
http://radicale.org/user_documentation/
",simontretter,2017-01-07 02:02:52
462,2016-02-17 12:42:56,"This is the first new role in awhile. Personally, I'd like to use this role rather than owncloud.

What about making this the first standalone galaxy role, sovereign-radicale. @lukecyca raised this issue recently here https://github.com/sovereign/sovereign/issues/440#issuecomment-162928760.
",ariddell,2017-01-07 02:02:52
462,2016-03-07 16:23:17,"LGTM!  I think we should merge this in as-is instead of using galaxy to keep everything together until we can decide later to break roles apart. 
",jplock,2017-01-07 02:02:52
462,2016-03-07 16:27:44,"If this is going to be merged into master and jessie then there needs to be another PR for jessie.
",ariddell,2017-01-07 02:02:52
462,2016-03-07 17:26:09,"One thing I just noticed, what version of radicale is available through the package?  They also publish versions via pip and the latest release is 1.1 which is not backward compatible.  I'm thinking we should try to source the package from pip and lock the release version.
",jplock,2017-01-07 02:02:52
462,2016-03-09 10:29:58,"Here's a radicale distribution packages version list:
- Wheezy has radicale 0.6.3-1
- Trusty has radicale 0.8
- Jessie has radicale 0.9
- Xenial will have radicale 1.1.1

My assumption is that @simontretter tested his patch with the 0.6.3 package.

Does anyone know more about the compatibility problems that we may be facing?
If there is a problem getting these different versions to work do to version differences we should consider doing a [PyPi installation of v1.1.x](https://pypi.python.org/pypi/Radicale/).

Also, the radicale team [recommends](http://radicale.org/news/) that users upgrade to 1.1.x as soon as possible because ""Many improvements in this release are related to security"".
Reading the list of improvements, I'd say the previous versions have security issues.

@simontretter do you have time to upgrade your patch to radicale 1.1?
",neuhaus,2017-01-07 02:02:52
462,2016-03-11 11:37:15,"@neuhaus Here you go. This is untested as I am traveling. 

I very much dislike mixing different package management software and having to package myself. In this instance, I see no other option. 
",simontretter,2017-01-07 02:02:52
462,2016-03-11 12:07:20,"Thanks! i hope I can test this a bit this weekend.
",neuhaus,2017-01-07 02:02:52
462,2016-03-11 13:00:22,"@simontretter The patch contains the file `roles/radicale/files/etc_logrotate.d_radicale` which is not used. It's a copy of `roles/radicale/files/etc_logrotate_radicale` which is the one that gets copied to `/etc/logrotate.d/radicale`
",neuhaus,2017-01-07 02:02:52
462,2016-03-11 13:06:43,"@neuhaus I removed it.
",simontretter,2017-01-07 02:02:52
462,2016-09-09 09:13:26,"I am interested in this given the changes with the ownCloud organization.  @simontretter Have you been using this role?  Are there any changes you recommend?  Any interest in supporting it on Jessie?  I really appreciate the work you've put into this.

For those looking for an alternative to ownCloud, is there a recommendation for how to support file syncing?  That is mostly what I use ownCloud for today.
",mikeashley,2017-01-07 02:02:52
462,2016-09-09 09:52:53,"@mikeashley There still is some work needed. First problem as mentioned is that to have consistency through all supported linux flavours, we would need to use the pip version. I would want to avoid that (or at least wait for a proposal on how to update pip installed packages). 

Any suggestions on how to handle this? I would put some more work in next week to test the recent radicale version and then give you a more qualified answer.
",simontretter,2017-01-07 02:02:52
462,2016-09-10 11:02:24,"I am not familiar with how Python package management works so can't offer any guidance on how to best approach it.  For what it's worth, the jessie branch supports just Debian 8 today, but I anticipate that somebody will add support for Xenial after we switch it over to master.
",mikeashley,2017-01-07 02:02:52
462,2016-10-01 14:44:32,"@mikeashley here is an update. This installs radicale via apt on Ubuntu >=16. Debian and older Ubuntu versions get the pip variant. I had to switch from the database backend to the filesystem one because that seems to be the only reliable one. Does /decrypted/radicale seem like a good spot to put the data? I also integrated radicale with apache. This means radicale now goes through https://dav.mydomain.com on port 443 and apache handles TLS. 

I tested in on Debian wheezy syncing between Evolution and davdroid. 
All you need to know is to get started: 
https://dav.mydomain.com/yourusername/nameofaddressbooktocreate
https://dav.mydomain.com/yourusername/nameofcalendartocreate

Now what's left to do is to properly implement the apache authentication to replace the radicale one. And maybe use fail2ban for it.

http://radicale.org/user_documentation/#idauthentication

@neuhaus Bittesch√∂n. everything is on radicale 1.1.1 now. 
",simontretter,2017-01-07 02:02:52
462,2016-10-08 22:23:04,"Thanks for the update.  Have you updated your branch to run under Jessie?  There is a merge conflict suggesting you are still basing on the old master (now the wheezy branch).
",mikeashley,2017-01-07 02:02:52
462,2016-10-28 06:06:51,"I don't want to take this thread too far off topic, but as someone planning to get sovereign up and running, I was wondering what is causing people's mistrust of ownCloud. @neuhaus and @mikeashley, can you shed some light for me? Thanks!
",simonplend,2017-01-07 02:02:52
462,2016-11-01 16:07:56,"I rebased this branch on the master branch and ran into some minor glitches while setting up a new Sovereign system today.
1. The `python3-passlib` seems no longer be available in Debian 8.6, I simply removed all `python3` packages from the [radicale.yml](https://github.com/simontretter/sovereign/blob/13ec85d65f92e1f9c0c7971efefd953780f47240/roles/radicale/tasks/radicale.yml#L4-L10) file, it seems to work without these.
2. It references the `{{ selfoss_domain }}` variable the [etc_apache2_sites-available_radicale.j2](https://github.com/simontretter/sovereign/blob/13ec85d65f92e1f9c0c7971efefd953780f47240/roles/radicale/templates/etc_apache2_sites-available_radicale.j2) file which does not work when you choose not to include selfoss. Why doesn't it simply use the `{{ radicale_domain }}` variable? The error log also points to selfoss, a copy & paste oversight?
3. The SSL config in the [etc_apache2_sites-available_radicale.j2 ](https://github.com/sovereign/sovereign/pull/462/files#diff-ba2fec315fa8bfa74d861d521237cd18R10) template can't be loaded by Apache. Probably should use `SSLEngine On`.
4. The certificate paths in [config.j2](https://github.com/simontretter/sovereign/blob/13ec85d65f92e1f9c0c7971efefd953780f47240/roles/radicale/templates/config.j2#L27-L31) point to the wrong location as we use Let's Encrypt now, see the `/etc/letsencrypt/live/{{ domain }}/` directory.
5. Also needs to add the `dav` subdomain to the Let's Encrypt [list](https://github.com/sovereign/sovereign/blob/a518f9c0353384cfb315d276a3419864fb9846ae/roles/common/files/letsencrypt-gencert#L3) or it won't be included in the certificate.
6. No Debian expert here but it seems you need to enable the service before you can use it now: `sudo systemctl enable radicale`.
7. The role does not configure the firewall, it should open port `5232` which it does not.
8. Minor one: old style variables are depreciated in newer Ansible versions so [`radicale_accounts`](https://github.com/sovereign/sovereign/pull/462/files#diff-b09d9d7eea6c54e7c1f737d48e0cc2a3R55) becomes `'{{ radicale_accounts }}'`.

Thanks for this branch, really prefer a simple CardDAV and WebDAV solution over the full fledged OwnCloud! The only thing that's still missing in Sovereign. :wink:
",cimm,2017-01-07 02:02:52
462,2017-01-07 02:02:52,"I'm closing this due to a lack of traction. At this point, I thing more effort should go into documentation and maintenance of existing features than adding new ones. ",simontretter,2017-01-07 02:02:52
461,2016-01-09 03:11:05,"Nice default setting. 
See https://github.com/siacs/Conversations/issues/1385
and http://conversations.im/omemo/
",simontretter,2016-01-09 09:19:02
460,2016-01-03 10:03:26,"resolves #453 

This is not really tested but this is trivial.
",skriems,2016-01-03 14:26:06
460,2016-01-03 14:26:03,"Thanks for submitting this
",jplock,2016-01-03 14:26:06
459,2016-01-03 02:39:37,"started with a fresh digitalocean debian 7 x64 1gb server.
all tasks go well until  [mailserver | import sql postfix].

<S_CODE_TOKEN>

just can't figure out where the problem lies ... even tried without virtual_aliases at all but i'm getting the same error.

relevant part of user.yml:

<S_CODE_TOKEN>

really hoping you're able to help...
thank you very much!
",moranon,2016-01-03 16:24:57
459,2016-01-03 06:08:08,"The origin of the file /etc/postfix/import.sql is at:

https://github.com/sovereign/sovereign/blob/master/roles/mailserver/templates/mailserver.sql.j2

and the first line of that file says:

""-- If tables are not dropped, have to truncate before insert or use ""insert or replace"" (not postgres compatible)""

I've been encountering this error, too, and haven't figured out yet what to do about it.
",jmcgnh,2016-01-03 16:24:57
459,2016-01-03 16:08:25,"If I add a second virtual domain the error is slightly different:

<S_CODE_TOKEN>
",moranon,2016-01-03 16:24:57
459,2016-01-03 16:24:57,"Dang nevermind, was a big logical mistake I made.
Thought domain_pk_id was incremental because of second commented virtual_user but it just points to the related pk_id!
Maybe it should be made easier to see in user.yml or more examples added in testing.yml
",moranon,2016-01-03 16:24:57
459,2016-01-03 22:14:34,"Ah, that was a good enough hint to get me past the impasse, too. Also somewhat misunderstood what the testing.yml and user.yml files were trying to do.
",jmcgnh,2016-01-03 16:24:57
458,2016-01-01 21:31:38,"I probably got this wrong, but I'm putting a stake in the ground based
on work I've done on the Roundcube module and adding Let's Encrypt
support to the common module.
",mikeashley,2016-01-16 14:45:52
458,2016-01-16 14:46:03,"Looks good, thanks!
",neuhaus,2016-01-16 14:45:52
457,2016-01-01 14:50:45,"Here is a proposal to move from 0.9.5 to 1.1.4 that stops using Debian packages that have been unreliable.

I aimed for idempotency and therefore leave the user with some post-deploy finalization work to do.  I don't really like this, but I think idempotency is more important, and this also sets up for easier upgrades in the future.  Is this tradeoff ok?
",mikeashley,2016-01-16 13:14:49
457,2016-01-09 00:23:06,"Tests are passing for both wheezy and trusty.  The meaningful difference between the two is Apache 2.2 versus Apache 2.4.
",mikeashley,2016-01-16 13:14:49
457,2016-01-15 14:33:30,"I'm against building Roundcube from source as long as packages are available from trusted source.

I'd rather wait for Xenial to upgrade Roundcube to 1.1.4 using their standard package. For Jessie we can use the jessie-backports repository to get Roundcube 1.1.4.
Meanwhile, issue #417 needs to be fixed by someone with some spare time to look into it.
",neuhaus,2016-01-16 13:14:49
457,2016-01-16 12:06:47,"I no longer trust the roundcube packages on debian.  The wheezy backport has been troublesome (see #417, and it's currently breaking in sovereign's test environment).  I suspect that the package is trying to do too much, roundcube simply isn't designed for packaging, or some combination of the two.  Upgrades through the package especially scare me at this point.
",mikeashley,2016-01-16 13:14:49
457,2016-01-16 13:14:49,"If it turns out that the version 1.1.4 packages give us problems we can use this pull request. For now, let's stick with the packages. Thanks.
",neuhaus,2016-01-16 13:14:49
456,2015-12-31 13:40:33,"The roundcube backport on wheezy is at 0.9.5 while the latest stable release of roundcube is 1.1.4.  Furthermore, the roundcube package has been dropped from jessie due to lack of maintainer support.  For compatibility across distributions I'm recommending we instead install from a released stable distribution instead of a package.
",mikeashley,2016-01-16 12:06:10
456,2016-01-15 11:20:28,"Ubuntu trusty is also at 0.9.5 and it seems that Ubuntu ""Xenial"" 16.04 [will ship](http://packages.ubuntu.com/search?keywords=roundcube) with Roundcube 1.1.4.
Roundcube also has a nice SIEVE plugin that lets you maintain your SIEVE filtering rules.
Roundcube for Jessie [is available](https://packages.debian.org/search?keywords=roundcube) from the jessie-backports repository.

So, once we hit April we will have our two major distributions running the same version again. Is it really an issue?
",neuhaus,2016-01-16 12:06:10
456,2016-01-16 12:06:10,"Yes, in April the major distributions will be running the same version again.  I've addressed the problem for me personally, so if we want to use packages, I am ok waiting until April.
",mikeashley,2016-01-16 12:06:10
456,2016-01-16 13:18:45,"Thank you!
",neuhaus,2016-01-16 12:06:10
455,2015-12-31 00:22:48,"Happy New Year.  Here is a different approach to using LetsEncrypt to replace the wildcard certificate we currently use.  As before, this is a draft pull request to advance the discussion in issue #426.  It's incomplete but illustrates the approach.

In contrast to my first pull request #451, this generates only one certificate using Subject Alternative Names to list the subdomains that Sovereign roles may use.  Since we are not using a wildcard certificate, roles are always going to have their fingers in certificate generation.  Given that, I went for broke and listed subdomains explicitly.

Based on feedback from #451, I put the LetsEncrypt stuff in a separate task list but elected to keep it in the common role.  It just doesn't seem warranted to put it in a separate role.  Also, I added a cron script to renew the certificate periodically (once a month in this draft).

Feedback welcome.  I prefer this approach over what I did in #451.
",mikeashley,2016-01-01 14:30:29
455,2015-12-31 01:11:36,"This looks really good. Thanks! I'll try to find some time to try it out.
",ariddell,2016-01-01 14:30:29
455,2015-12-31 10:49:51,"I just pushed a rebase.  I realized that virtual host configuration of SSL can be abstracted just like it is now, so the changes to the blog, owncloud, and other similar roles aren't necessary.

I also went ahead and made the necessary updates to the xmpp and ircbouncer roles.
",mikeashley,2016-01-01 14:30:29
455,2016-01-01 14:30:29,"Moving discussion back to first pull request to consolidate and doing force pushes to update that branch.
",mikeashley,2016-01-01 14:30:29
454,2015-12-29 20:51:52,"Rather than having to open a tunnel to monit and ZNC, I think it would be much nicer to serve these resources only over the VPN instead.

Additionally it would be nice to be able to set certain subdomains (git, cloud, mail) to only be accessible via the VPN.

I'm assigning this to myself and working on it now, I just thought I'd create an issue in case anyone knows how to make this happen and could save me some time.

I have a thread over on the OpenVPN forums about how to do this, but so far no one has responded: https://forums.openvpn.net/topic20571.html
",NickBusey,2016-01-07 19:19:19
454,2015-12-30 01:03:29,"It looks like for other subdomains like git, cloud, mail, you can just point your DNS to the VPN IP rather than the actual server IP (10.8.0.1). Still looking into how to serve monit and ZNC without a tunnel.
",NickBusey,2016-01-07 19:19:19
454,2016-01-07 19:19:19,"I ended up using M/Monit to access monit more easily, and don't need easy access to ZNC config. Closing this.
",NickBusey,2016-01-07 19:19:19
453,2015-12-28 14:23:22,"Hi there,
 as I do my own firewalling and don't want ufw to interfere, I run the playbook with --skip-tags=ufw, but found several places that needs extra tags: ufw:

TASK: [xmpp | Set firewall rules for Prosody] *********************************
failed: [<host>] => (item=5222) => {""failed"": true, ""item"": 5222}
msg: Failed to find required executable ufw

Places added: (grep -n ufw places):
roles/vpn/tasks/openvpn.yml:138:  tags: ufw
roles/xmpp/tasks/prosody.yml:46:  tags: ufw
roles/mailserver/tasks/dovecot.yml:93:  tags: ufw
roles/mailserver/tasks/postfix.yml:74:  tags: ufw
roles/ircbouncer/tasks/znc.yml:67:  tags: ufw
",hvisage,2016-01-03 14:26:06
453,2015-12-28 15:13:08,"Would you mind submitting a pull request?
",jplock,2016-01-03 14:26:06
453,2015-12-28 15:15:40,"Yes I do mind ;(
Bug me again in the new year then I‚Äôll make some time to do the whole fork/etc. stuff (I‚Äôm a sysadmin, these gitting still gets to me ‚Ä¶) 

> On 28 Dec 2015, at 5:13 PM, Justin Plock notifications@github.com wrote:
> 
> Would you mind submitting a pull request?
> 
> ‚Äî
> Reply to this email directly or view it on GitHub https://github.com/sovereign/sovereign/issues/453#issuecomment-167586161.

---

Hendrik Visage
Envisage Systems / Envisage Cloud Solutions
084-612-5345 or 083-675-5506
hvisage@envisage.co.za
",hvisage,2016-01-03 14:26:06
452,2015-12-27 22:36:23,"It took me some time to figure out how to access the monit status page, hopefully this will save some others some time.
",NickBusey,2016-01-16 14:49:42
452,2016-01-16 14:49:38,"Thanks. Personally I prefer using DynamicForward (SSH SOCKS proxy feature, but this will do)
",neuhaus,2016-01-16 14:49:42
451,2015-12-27 01:23:03,"This is a draft pull request to advance the discussion in issue #426.  I am interested in feedback on the approach and recommendations on how to improve it.  It is incomplete but is enough to see how it will work.  Known issues:
1. stopping/starting apache is awkward, especially if you don't really need a certificate; and
2. no story for certificate renewal.

What else am I missing? Also, I am an Ansible rookie, so suggestions on how to code this better are welcome.

I am using the official client since LetsEncrypt is still in beta.
",mikeashley,2016-02-07 14:59:55
451,2015-12-27 12:56:26,"This looks really good. Could we create a new role ('acme') rather than putting more stuff in common? We can run `acme` right after common.

As I'm sure you're aware, with let's encrypt's 3 month expiration I think automatic renewal has to be in. I guess we need a cron job?

Thanks again for this.
",ariddell,2016-02-07 14:59:55
451,2015-12-28 09:56:30,"Allen, thank you for the encouragement.  I agree using cron is probably the way to go for renewing certificates.

I am not sure a separate role makes sense.  I believe that would introduce a new dependency for modules that need certificates.  Can that be managed automatically without risk of a misconfigured site.yml?
",mikeashley,2016-02-07 14:59:55
451,2015-12-28 10:37:06,"One thing to check about the renewal step is if the relevant apps/services need to be restarted to use the new certificate. I suspect they will all need to be restarted.

re: acme role: Having a separate role would increase the readability of the code. That it's a mandatory role (like `common`) is just something we need to state explicitly. Handling dependencies is clearly not something that ansible does very well.
",ariddell,2016-02-07 14:59:55
451,2016-01-01 14:29:14,"My apologies.  I'm still figuring out the right way to use GitHub's pull request workflow.  I'm moving the second draft pull request from #455 back to this pull request to consolidate.

This is a different approach to using LetsEncrypt to replace the wildcard certificate we currently use. In contrast to what I originally proposed, this generates only one certificate using Subject Alternative Names to list the subdomains that Sovereign roles may use. Since we are not using a wildcard certificate, roles are always going to have their fingers in certificate generation. Given that, I went for broke and listed subdomains explicitly.

Based on feedback above, I put the LetsEncrypt stuff in a separate task list but elected to keep it in the common role. It just doesn't seem warranted to put it in a separate role. Also, I added a cron script to renew the certificate periodically (once a month in this draft).
",mikeashley,2016-02-07 14:59:55
451,2016-01-01 14:38:06,"Note: Allen suggested making the letsencrypt email optional instead of required.  The client strongly encourages it when running in interactive mode.  References: [the docs](https://letsencrypt.readthedocs.org/en/latest/using.html#configuration-file) and community note about [registering unsafely](https://community.letsencrypt.org/t/register-unsafely-without-email/4342).
",mikeashley,2016-02-07 14:59:55
451,2016-01-01 17:57:29,"e-mail is optional in the ACME spec (https://ietf-wg-acme.github.io/acme/), which I think should be considered authoritative relative to some comments on a forum.

We have a private registration key. The email would only be used if we lose access to the private key. But even in that case we likely wouldn't need it anyway since we presumably control the DNS we can just re-register with let's encrypt. I can't figure out any situation where providing the email to let's encrypt would be _desirable_ in the present context, much less mandatory.

Edit: what about backing up the private registration key to tarsnap -- isn't this a good idea anyway?.
",ariddell,2016-02-07 14:59:55
451,2016-01-01 20:33:04,"Good catch on keys backup!

You're right, the forum thread doesn't mean too much, but I pointed to it since this topic does come up on their forums.  I don't know how to reconcile ""optional in the spec"" with the standard client's strong language when the address is omitted.

Examples of when it would be useful for LE to notify you: major changes in their service and security problems with their certificates.

For the target user of Sovereign, what's the right way to default this: require the email address or make it optional?  I think expecting an email address is the right default since that is what the LE team wants.  Do we not trust them with an email address?

Finally, I don't personally feel that strongly about this.  I can go either way.  I'm just looking for some consistent design intent from the Sovereign maintainers so that I know how to make decisions like this when putting together roles.
",mikeashley,2016-02-07 14:59:55
451,2016-01-01 21:45:08,"Hopefully someone else can cast their vote here. I only feel strongly about it not being _required_; it's just contact information that the user should feel free to provide or not (that much is clear from the spec). If the email isn't provided the thing should still work.

I'm happy to help with any of these final details.
",ariddell,2016-02-07 14:59:55
451,2016-01-01 22:04:25,"There is a bug with this design.  It requires the user to add DNS records for all subdomains whether or not she will use them.  This is because LE will look up each subdomain listed in the request.
",mikeashley,2016-02-07 14:59:55
451,2016-01-02 00:40:41,"Any chance it can fail gracefully? That is, if the user didn't add a record for `news.domain` or `read.domain`, it just doesn't issue a certificate? (or creates something signed by the `domain` private key?)
",ariddell,2016-02-07 14:59:55
451,2016-01-09 16:05:04,"Tests are passing on wheezy and trusty.  I still need to fix up the implementation of certificate renewal.
",mikeashley,2016-02-07 14:59:55
451,2016-01-09 16:18:17,"Can we leave the readme instructions for using your own certificate in place?
",jplock,2016-02-07 14:59:55
451,2016-01-09 16:21:09,"With this approach, supporting both LE certificates and your own wildcard certificate will take some work.  I'm wondering how many people would buy a certificate or use a self-signed certificate if certificates are available at no cost from LE.  Thoughts on this?
",mikeashley,2016-02-07 14:59:55
451,2016-01-09 16:25:40,"For me, I'm using a wildcard cert I just renewed for a few years. If this gets merged, it's going to override that certificate everywhere. I'm just saying it would be nice to try and phase this in optionally. If others don't feel the same way, that's fine. I'll just have to maintain my own fork.
",jplock,2016-02-07 14:59:55
451,2016-01-09 17:01:35,"Perhaps we could introduce this in the Jessie branch since people will
be expecting things to break during that transition?

I think LE is important and we should definitely make it the default.

Also -- what's wrong with just switching over to LE for your TLS
certificate? LE will issue a certificate even if you have a certificate
from another CA, right?

On 01/09, Mike Ashley wrote:

> With this approach, supporting both LE certificates and your own wildcard certificate will take some work.  I'm wondering how many people would buy a certificate or use a self-signed certificates are available at no cost from LE.  Thoughts on this?
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/sovereign/sovereign/pull/451#issuecomment-170257390
",ariddell,2016-02-07 14:59:55
451,2016-01-09 22:37:34,"I like Allen's idea: introduce it in the Jessie branch.  I am currently running Wheezy, and my purchased certificate expires in February.  I would need to keep this work branched from master also unless the Jessie branch is close to ready.  Maybe make the branch from master available for the adventurous who don't want to buy a certificate.
",mikeashley,2016-02-07 14:59:55
451,2016-01-10 00:21:21,"Agreed. I like the idea of introducing it on the jessie branch. I'm still on wheezy.
",jplock,2016-02-07 14:59:55
451,2016-01-10 10:55:30,"I rebased to catch up to master and resolve a conflict.  I also took the opportunity to clean up the branch to make it easier to review.  Services are restarting correctly after certificate renewal now.
",mikeashley,2016-02-07 14:59:55
451,2016-01-16 13:54:12,"Just a reminder: this PR is currently going to be merged into master (rather than the jessie branch). It seems like there's agreement it should be merged into the jessie branch.

When this is done I'm ready to test it + the jessie branch. Thanks for all your work on this @mikeashley.
",ariddell,2016-02-07 14:59:55
451,2016-01-16 14:41:27,"How do you feel about [using a more minimal ACME client](https://github.com/sovereign/sovereign/issues/426#issuecomment-161972594)? I'm not a big fan of the bloated standard client myself.
",neuhaus,2016-02-07 14:59:55
451,2016-01-16 15:35:51,"I started with the official client since LE is in beta.  If there is a simpler client that does what we want directly, we should switch.
",mikeashley,2016-02-07 14:59:55
451,2016-01-16 15:37:03,"@neuhaus I appreciate the detailed review.  Thank you!

Next push of this PR will be based on the jessie branch unless there are objections.
",mikeashley,2016-02-07 14:59:55
451,2016-01-17 18:35:41,"I rebased onto the jessie branch.  Also, these last seven commits address feedback from @neuhaus.  I haven't yet tried invoking the LE client in a way that avoids having to stop Apache.
",mikeashley,2016-02-07 14:59:55
451,2016-01-18 00:10:23,"I don't know how you change the target of the PR. Is it even possible?

I take it this is ready for testing? I'll plan on testing it out sometime this week.
",ariddell,2016-02-07 14:59:55
451,2016-01-18 01:18:32,"Good question.  Rebasing definitely seems to have confused github.  I rebased onto commit 89d0c076592820f91bc3f6c4759ef1d56e4b4127 (currently the head of the jessie branch).

I deployed what I had based on master to my own server several days ago, and it's working fine.  I smoke-tested this branch on a Debian 8.1 server, and it looked ok.  It needs more testing at this point.

The jessie branch still seems a little rough.  I had to disable z-push, because the task failed.  ZNC also failed to run, because the task assumes a group and owner called 'znc', but the jessie branch switches to an apt package that installs as root.  In short, you will probably need to fiddle.  I definitely recommend starting with a minimal set of roles.
",mikeashley,2016-02-07 14:59:55
451,2016-01-18 01:21:21,"I took a brief look at running the LE client with webroot authentication.  To do it will require running the gauntlet of virtual host configurations various roles set up.  My guess is that Apache is flexible enough to do what needs done, but it will take some homework to figure out the right changes to the virtual host configurations.  My understanding of Apache configuration is pretty basic.  Somebody fluent could probably knock it out much faster than me.
",mikeashley,2016-02-07 14:59:55
451,2016-01-18 10:03:00,"My expectation is that with the standard setup we will have multiple virtualhosts with different documenroot only on port 443. On port 80 we have one Apache instance that will answer HTTP requests for all hostnames, deal with requests for everything starting with `/.well-known/` by itself and redirect to the HTTPS services for all other requests. That way we can deal with the ACME stuff easily and all other requests get served with encryption ASAP.
If you need help with that let me know.
",neuhaus,2016-02-07 14:59:55
451,2016-01-18 10:09:34,"That is my thinking as well.  Help would be appreciated.  I am traveling next weekend so may not be able to spend time on this until the weekend of Jan 30.  If nobody has made progress, I'll take a swing at it then.
",mikeashley,2016-02-07 14:59:55
451,2016-01-19 00:17:07,"On a fresh Jessie install I'm hitting a fatal SSLStapling error. I think this might have been fixed somewhere else.

<S_CODE_TOKEN>
",ariddell,2016-02-07 14:59:55
451,2016-01-19 01:21:36,"Yes, I hit the same on the jessie branch.  I disabled SSLStapling for 
testing purposes.
",mikeashley,2016-02-07 14:59:55
451,2016-01-21 19:51:31,"FYI: LE supports DNS validation now. https://twitter.com/letsencrypt/status/689919523164721152
",ariddell,2016-02-07 14:59:55
451,2016-01-21 19:53:38,"That's cool, however DNS is not yet part of sovereign (it should be IMHO). I run djbdns/tinydns on my sovereign box.
",neuhaus,2016-02-07 14:59:55
451,2016-01-21 21:47:57,"DNS would be great to provide.

Here's the part of the ACME spec relevant to DNS verification: https://ietf-wg-acme.github.io/acme/#rfc.section.7.5

On 01/21, Sven Neuhaus wrote:

> That's cool, however DNS is not yet part of sovereign (it should be IMHO). I run djbdns/tinydns on my sovereign box.
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/sovereign/sovereign/pull/451#issuecomment-173689890
",ariddell,2016-02-07 14:59:55
451,2016-01-30 04:53:40,"So as per the current master CONTRIBUTING.md, new modules are required to update the letsencrypt tasklist in the common role. Since it is still not merged, is this to be ignored?
",simontretter,2016-02-07 14:59:55
451,2016-01-30 10:40:12,"It should be ignored.  It should also be pulled since we're automatically enumerating the registered subdomains now.  I'll make sure that happens in the final PR.
",mikeashley,2016-02-07 14:59:55
451,2016-02-06 10:45:36,"I looked at the Apache configuration changes discussed above to avoid stopping Apache during certificate generation and renewal.  It's not clear to me how to best do it.  Three possible ways:
1. Use Redirect, but this does not appear to be expressive enough.
2. Use mod_rewrite, but this isn't recommended.
3. Run a second web server, e.g., nginx, on port 80 and run Apache on 443.

A complication is that autoconfig is set up to serve HTTP and HTTPS due to ambiguity in the documentation (or so says the comments on autoconfig.conf).

Does Apache need to be restarted anyway after certificate renewal in order to load the new certs?  Some other services like dovecot do need to be bounced.
",mikeashley,2016-02-07 14:59:55
451,2016-02-06 11:03:56,"I think using mod_alias is the best way to do it. I am currently using an alias on nginx, but I've never tried it on apache. The [documentation](http://httpd.apache.org/docs/2.2/mod/mod_alias.html) says you just need to specify `Alias /.well-known/acme-challenge /var/www/letsencypt_challenge/acme-challenge`
",tynsh,2016-02-07 14:59:55
451,2016-02-06 11:53:27,"Here is what I am doing on my server:
I want to have a redirect for all virtual hosts that redirects all requests from port 80 to https on port 443. At the same time, I want to add ""www"" if it's missing.
However, the requests for ACME should go through without being redirected.
So I put this block in every virtualhost listening on port 80:

<S_CODE_TOKEN>

Note that the domain name in question also appears in the `RedirectMatch` line. I don't think you can do a general solution without using mod_rewrite. But it's ansible so by putting variables in the templates we easily replace the domain name / host name in the configuration files.

As far as restarting apache after changing certificates is concerned, you can run ""`apachectl graceful`"", it will restart the server without interrupting running requests (no downtime, no service interruption). Also it will not restart the server if there is an error in the configuration.
",neuhaus,2016-02-07 14:59:55
451,2016-02-06 12:54:29,"Ok.  I was trying to find a way to avoid a customization to every virtual host config, but I'll go ahead with your approach.  Thanks for the snippet.  Also thanks for the recommendation on apache restart.  I'll use that as well.
",mikeashley,2016-02-07 14:59:55
451,2016-02-06 14:36:48,"The idea of serving port 80 with nginx sounds appealing. It's consistent
with the way nginx gets used in other settings (e.g., as a proxy). We
could also move out all the redirect handling from Apache (from 80 to
443) which has caused some problems in the past. It's a nice separation
of concerns, IMHO.

(I'm also in favor of just switching to nginx although I recognize
that's a separate issue.)

On 02/06, Mike Ashley wrote:

> I looked at the Apache configuration changes discussed above to avoid stopping Apache during certificate generation and renewal.  It's not clear to me how to best do it.  Three possible ways:
> 1. Use Redirect, but this does not appear to be expressive enough.
> 2. Use mod_rewrite, but this isn't recommended.
> 3. Run a second web server, e.g., nginx, on port 80 and run Apache on 443.
> 
> A complication is that autoconfig is set up to serve HTTP and HTTPS due to ambiguity in the documentation (or so says the comments on autoconfig.conf).
> 
> Does Apache need to be restarted anyway after certificate renewal in order to load the new certs?  Some other services like dovecot do need to be bounced.
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/sovereign/sovereign/pull/451#issuecomment-180734006
",ariddell,2016-02-07 14:59:55
451,2016-02-06 14:54:20,"Any more input?  I am tempted to prototype the nginx path to see it looks cleaner.

@ariddell I am curious to know what problems the current redirect handling has caused in the past.
",mikeashley,2016-02-07 14:59:55
451,2016-02-06 15:11:15,"For example, #360 and #425. I wouldn't say these are necessarily
""problems"" but I do think these are annoyances which would be
ameliorated by clearly separating the task of redirecting from 80
to 443 from the task of serving content on 443. It's hard to separate
the tasks any more than by having different programs do them. It's also
a separation which is consistent with the way nginx is often used.

On 02/06, Mike Ashley wrote:

> Any more input?  I am tempted to prototype the nginx path to see it looks cleaner.
> 
> @ariddell I am curious to know what problems the current redirect handling has caused in the past.
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/sovereign/sovereign/pull/451#issuecomment-180781696
",ariddell,2016-02-07 14:59:55
451,2016-02-06 15:13:58,"I also love the idea (implicit, I realize) that port 80 is no longer for
serving traffic but really it's just a dedicated port for
""communicating"" with an ACME service like Let's Encrypt.

On 02/06, Mike Ashley wrote:

> Any more input?  I am tempted to prototype the nginx path to see it looks cleaner.
> 
> @ariddell I am curious to know what problems the current redirect handling has caused in the past.
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/sovereign/sovereign/pull/451#issuecomment-180781696
",ariddell,2016-02-07 14:59:55
451,2016-02-06 17:43:37,"@neuhaus A think a bug with your recommended approach is that the initial certificate generation will fail, because the roles that put down the virtual host configurations have not run yet.  It will succeed on the second and subsequent runs of the playbook.
",mikeashley,2016-02-07 14:59:55
451,2016-02-06 18:22:12,"@ariddell Ha!  #360 burned me on the blog role virtual host changes for LE as well.
",mikeashley,2016-02-07 14:59:55
451,2016-02-06 18:38:07,"@mikeashley if no VirtualHost is configured in Apache it should use the default host. As long as the `Alias` is configured there, it will work.

@aridell I don't mind switching to nginx completely, but I'm not fond of using two different pieces of HTTP server software on one machine. It just wastes RAM (which is the most expensive resource on a rented server). It also doubles the attack surface. Apache is perfectly capable of serving this redirect (as is nginx, of course).

We can try to get rid of all `VirtualHost` instances on port 80 and use `mod_redirect` on the default instance listening on port 80 to do the redirects in a generic way and an `Alias` to serve the ACME files if you guys prefer that.

That said, I'm not the one who is implementing this feature so if you love this idea, don't mind my babbling.
",neuhaus,2016-02-07 14:59:55
451,2016-02-07 14:59:55,"Ok, I got enough feedback.  Thank you!

I am rescinding this PR.  I'll submit a new PR after the jessie catchup PR is merged and after I've finished a stab at not stopping Apache to generate or renew certificates.
",mikeashley,2016-02-07 14:59:55
451,2016-06-11 13:04:41,"Just to follow up on the question of providing one's e-mail address to Let's Encrypt:

[Let's Encrypt leaked thousands of email addresses, asks to not post lists](https://community.letsencrypt.org/t/email-address-disclosures-preliminary-report-june-11-2016/16867)
",ariddell,2016-02-07 14:59:55
450,2015-12-22 12:52:40,"HI there,

 any plans to consider https://letsencrypt.org/ for certificates in future?
",hvisage,2015-12-22 13:57:15
450,2015-12-22 13:57:15,"Grrr... I searched on letsencrypt not Let's Encrypt ;(
https://github.com/sovereign/sovereign/issues/426
",hvisage,2015-12-22 13:57:15
449,2015-12-20 09:22:59,"**P.S**: This took me a while to figure out, which is why this issue description is more verbose than is necessary.

I recently faced this issue when I renewed my SSL certificates from AlphaSSL. I copied over the new private and public keys to `roles/common/files` and everything was fine in the web-facing portion (`read`, `blog`, `mail` etc). However, my Dovecot started failing with private key issues. So I started going through the usual phases of debugging whether my private and public keys match, testing my certificate with the `pem` file and so on.

When all those worked as expected (as in no issues with my keys themselves), I turned to the sovereign repository to figure out what could be causing the issue (first by checking reported issues and then by looking at commits), which is when I landed on [this](https://github.com/sovereign/sovereign/commit/ca8a3713207206998aecdbf00894a64e0ec8cf3e) commit.

Long story short, I had to remove the `/etc/ssl/certs/wildcard_combined.pem` file already present in the server so that Ansible would create a new one for me. The issue is because Ansible doesn't check for changed contents in the `shell` command we are running, instead it checks only for presence or absence of the file.

The Ansible [assemble](http://docs.ansible.com/ansible/assemble_module.html) command seems like a possible fix, but I'm not sold on it yet. Any other options to fixing this issue?
",balajisivaraman,2015-12-21 09:06:50
449,2015-12-21 09:02:56,"Duplicate of #412 which is a duplicate of #190 - the problem is not fixed so I'm not closing it.
",neuhaus,2015-12-21 09:06:50
449,2015-12-21 09:06:50,"Resolved by #430 
",neuhaus,2015-12-21 09:06:50
448,2015-12-16 11:24:19,"it has been brought to my attention that no such provision exists currently, is there a 3rd party package that can be incorporated?
",ghost,2016-05-21 10:29:49
448,2015-12-16 12:17:24,"Duplicate of #447
",neuhaus,2016-05-21 10:29:49
448,2015-12-16 12:18:21,"OK sorry it's you again, let's rephrase this issue to make it a feature request
",neuhaus,2016-05-21 10:29:49
448,2015-12-16 12:19:56,"See also #418
",neuhaus,2016-05-21 10:29:49
448,2015-12-22 10:26:39,"OK we have several choices here. We can point to some GUIs in the README. We can test some and point out potential problems. Or we can include a GUI. Opinions?
",neuhaus,2016-05-21 10:29:49
448,2015-12-23 19:23:35,"including a GUI would be awesome.
",ghost,2016-05-21 10:29:49
448,2015-12-23 20:19:05,"I don't think this belongs in Sovereign.

A configuration GUI that runs on the server is antithetical to configuration management tools such as Ansible. We already have some components that require configuration through a GUI, and they just don't sit right in the setup procedure, requiring hand-wavy instructions and poor reproducibility if you have to reprovision your server..
",lukecyca,2016-05-21 10:29:49
448,2016-01-16 13:18:17,"If you reprovision your server, won't restore it from backup (including DB backup)? We already provide a backup solution. If you use the backup, the users would be preserved even if they were added after the initial installation.
",neuhaus,2016-05-21 10:29:49
448,2016-01-24 08:44:26,"I can recommend Postfixadmin as a powerful web and CLI based Postfix management tool.
http://sourceforge.net/projects/postfixadmin/
The project is active and close to its 3.0 release.
Even so the Debian maintainer keeps an ancient 2.3.7 in Debian, it is trivial to build a current Debian package from the sources since it already contains the necessary data.

Ansible and Postfixadmin are not antithetical as incorrectly claimed above, but in fact complement each other. One is for setting up and configuring the server, the other for the day to day usage and management of the mail service. For example: You wouldn't use Ansible to create your user account and projects on Github either or would you?  Instead you would use it to configure the Github servers and maybe the Github software on to of them.
",neuffer,2016-05-21 10:29:49
448,2016-04-16 12:12:51,"@neuffer did you install that after you had built your server? Or are you just suggesting it. I had tried it before but never got it to mesh with an existing install :/
",shaneonabike,2016-05-21 10:29:49
448,2016-04-18 06:52:22,"On 16. April 2016 14:13:00 MESZ, wrote Shane notifications@github.com:

<S_CODE_TOKEN>

Suggesting it, but for me postfix & postfixadmin together with
postgresql are a given and dovecot pretty much as well as this is my
current setup.

Whether I do my teck refresh ""hand crafted"" as before or use sovereign
or some other framework is up for discussion.

Cheers
  Mike
",neuffer,2016-05-21 10:29:49
448,2016-04-18 14:21:41,"Mmmm ok. I had also come across this great tool VIMBadmin which also looks really promising but I am unsure as to whether I can install that with an existing one either _sigh_
",shaneonabike,2016-05-21 10:29:49
448,2016-04-18 18:46:22,"On 18.04.2016 16:21, Shane wrote:

> Mmmm ok. I had also come across this great tool VIMBadmin which also
> looks really promising but I am unsure as to whether I can install
> that with an existing one either /sigh/

I am sure I am able to integrate postfixadmin with Sovereign once it is
set up with a current version of Debian testing.
I know next to nothing about Ansible and Python is definitely not my
language of choice but I think I'll manage.

My integration effort just might not be Sovereign compatible (i.e. no
yaml config / playbook or whatever). I don't know yet how many configs
I'll need to amend.
At the very least the postfix and Dovecot configs, some Postgresql,
possibly Roundcube,

I might out myself as dense and backward here, but I don't really see
what Ansible/Sovereign gives me beyond a one-off installation script.
While tracking Debian testing I'll always encounter config changes that
I'll need to resolve manually. How does Ansible/Sovereign help
me there? I'd REALLY appreciate some enlightenment here.

And yes, my private mail servers have been tracking Debian since
~0.93R6. First with what would later be called unstable,
then I switched to testing when testing was introduced in Debian. First
running sendmail, then since ~1999 postfix.
Sticking to the stable release was never my thing, at least not for my
private servers. :-)
",neuffer,2016-05-21 10:29:49
448,2016-04-18 19:09:20,"@neuffer The idea with Ansible is precisely that it is _not_ a one-time install tool, but the single source of truth for your server's configuration. All configuration changes are made via Ansible and are thus tracked in a VCS and fully reproducible. Ideally you should be able at any point to backup your data, destroy your server, create a brand-new server with the same OS, run Ansible against it, restore your data, and be right back in business.

Given that the whole point of Ansible is reproducible servers, it is more difficult when tracking an unstable underlying distribution target. You can certainly have an Ansible config targeting ""the latest Debian testing"", it just means that Ansible config is likely to need updating more frequently as changes are made in the underlying OS.

You should really never touch a configuration file manually/directly on a server managed by Ansible.
",carljm,2016-05-21 10:29:49
448,2016-05-21 10:29:49,"This discussion seems to have run its course.  I am going to go ahead and close this issue.
",mikeashley,2016-05-21 10:29:49
447,2015-12-15 22:51:33,"is it available?
",ghost,2015-12-16 11:17:18
447,2015-12-16 09:45:45,"You're not mentioning the services that you are interested in.

Apache can of course support multiple domains, for example using multiple virtual hosts.

Prosody also supports virtual hosts.

I'm assuming you are referring to email. The setup we use does support multiple domains. There is no official GUI, I'm using [VEA](https://github.com/neuhaus/vea) myself, but it's certainly not for everyone.
",neuhaus,2015-12-16 11:17:18
447,2015-12-16 10:48:59,"yes, I'm mainly interested in setting up multiple mailboxes for different domains.
",ghost,2015-12-16 11:17:18
447,2015-12-16 11:17:18,"This is easy to do currently in ansible, look at the variable `mail_virtual_users` in `user.yml`.

I'll close this. If there's interest in a GUI tool that should be a separate issue I think.
",ariddell,2015-12-16 11:17:18
446,2015-12-13 19:42:48,"Cherry pick this commit from the `jessie` branch
",jplock,2015-12-16 10:42:05
446,2015-12-16 10:42:09,"thanks
",neuhaus,2015-12-16 10:42:05
446,2016-02-09 03:24:09,"This breaks it for me on new installs (ubuntu 14.04, ansible 2.0.0.2).

`fatal: [8.8.8.8]: FAILED! => {""changed"": false, ""failed"": true, ""module_stderr"": """", ""module_stdout"": ""Traceback (most recent call last):\r\n  File
\""/home/google/.ansible/tmp/ansible-tmp-1454985227.82-826161849662/git\"", line 2938, in <module>\r\n    main()\r\n  File \""/home/google/.ansible/tmp/ansible-tmp-1454985227.82-826161849662/git\"", line 756, in
main\r\n    remote_head = get_remote_head(git_path, module, dest, version, remote, bare)\r\n  File \""/home/google/.ansible/tmp/ansible-tmp-1454985227.82-826161849662/git\"", line 383, in get_remote_head\r\n
elif is_remote_branch(git_path, module, dest, remote, version):\r\n  File \""/home/google/.ansible/tmp/ansible-tmp-1454985227.82-826161849662/git\"", line 439, in is_remote_branch\r\n    if version in
out:\r\nTypeError: 'in <string>' requires string as left operand, not float\r\n"", ""msg"": ""MODULE FAILURE"", ""parsed"": false}`

EDIT: Found the fix. In the default vars, both wallabag and selfoss version numbers have to be wrapped in quotation marks like this:
selfoss_version: ""2.14""
wallabag_version: ""1.9.1""
",simontretter,2015-12-16 10:42:05
446,2016-02-09 14:13:36,"Thanks. Can you please make a PR for this fix?
",neuhaus,2015-12-16 10:42:05
446,2016-02-09 14:16:10,"Never mind. I commited the fix.
",neuhaus,2015-12-16 10:42:05
446,2016-02-09 14:19:22,"Thanks. You have the power ;-)
",simontretter,2015-12-16 10:42:05
445,2015-12-10 19:11:04,"I don't have system for check it right now but it should help.
",Friz-zy,2016-02-17 12:36:49
445,2015-12-17 06:04:57,"Thanks so much for your work on this.

Let's merge the systemd stuff into the jessie branch and split the mtu fix out.

Is there any ansible pattern for ""if X is defined, then Y""? It would be nice to avoid putting the 'tun-mtu' in the variable name itself. 
",ariddell,2016-02-17 12:36:49
445,2015-12-18 09:14:26,"Sorry, I want split two pull requests but github automatically pushed second commit to opened PR =\

Yes, Ansible has this pattern:

<S_CODE_TOKEN>
",Friz-zy,2016-02-17 12:36:49
445,2015-12-18 11:33:45,"So can we do something like `{% if variable is defined %}tun-mtu {{ variable }} {% endif %}`?

Can we be more explicit about the instructions for iOS users? Can they set the variable to `None` or something instead of commenting the line out?

If you don't want to deal with github's PR system I'm happy to split out your commits (when they're done) and cherry-pick them into separate pull requests.
",ariddell,2016-02-17 12:36:49
445,2015-12-18 12:08:56,"You gave me good advice with cherry-pick ;)
I'll split it to two different PR.

Yep, It's a good point: because it's a jinja template we can check if variable exists and not false\empty. Nice solution!
",Friz-zy,2016-02-17 12:36:49
445,2016-02-17 12:36:49,"This still needs some work. @Friz-zy you mentioned you would split this into different PRs. Looking forward to them.
",ariddell,2016-02-17 12:36:49
444,2015-12-10 13:54:01,"Some reading:
https://weakdh.org/sysadmin.html (last paragraph about OpenSSH)
https://weakdh.org/imperfect-forward-secrecy-ccs15.pdf (chapter 4.3 regarding SSH)

Generating a new `moduli` file  with 2048 bit primes seems like the best solution, however it takes a long time.
It took 38 minutes on an Intel Atom N2800 and 9 minutes on a Xeon X5660. It can of course be done in the background.

Is this something we want to do?

If not, we can at least explicitly configure 
`KexAlgorithms` in `/etc/ssh/sshd_config` and leave out `diffie-hellman-group1-sha1`.

Input welcome.
",neuhaus,
444,2015-12-12 14:32:00,"debops does this with https://github.com/debops/ansible-dhparam
",ariddell,
444,2016-01-15 13:41:52,"Is the time dependent on the power of the system or available of randomness? 
",fengor,
444,2016-01-15 14:18:58,"I think you need a certain amount of random entropy but then it's mostly CPU power
",neuhaus,
443,2015-12-10 11:23:39,"See https://bettercrypto.org/
- TLS 1.2
- Use regenerated DH parms. #373
- Other security related work, see https://bettercrypto.org/

Previous issue: #399
",ypid,2016-01-16 13:57:29
443,2015-12-10 13:11:33,"DH group is fixed since pull request #441 
",neuhaus,2016-01-16 13:57:29
443,2016-01-16 13:57:29,"TLS 1.2 is already working just fine. Closing this bug.
",neuhaus,2016-01-16 13:57:29
442,2015-12-10 11:22:41,"See https://bettercrypto.org/
- TLS 1.2
- Use regenerated DH parms. #373
- Other security related work, see https://bettercrypto.org/

Previous issue: #399
",ypid,2016-05-21 11:04:33
442,2015-12-10 13:14:00,"DH parameters are generated in pull request #441, however they are not yet used. See also issue #373 
Apache 2.2 - can't do it
Apache 2.4.7 (Ubuntu Trusty) - append dhparam to certificates
Apache 2.4.8 combined with OpenSSL 1.0.2+ enable a configuration directive.
",neuhaus,2016-05-21 11:04:33
442,2016-03-13 11:31:50,"I am considering this for jessie/xenial.  What are the actual changes being proposed?
",mikeashley,2016-05-21 11:04:33
442,2016-03-13 15:38:15,"Look at https://httpd.apache.org/docs/current/mod/mod_ssl.html search for ""dh param""
",neuhaus,2016-05-21 11:04:33
442,2016-05-21 10:28:46,"Restating the scope of this suggestion, since using regenerated DH params is covered in #373.  At the moment, on jessie, the SSLProtocol configuration is `SSLProtocol ALL -SSLv2 -SSLv3`.
",mikeashley,2016-05-21 11:04:33
442,2016-05-21 11:04:33,"I am going to close this suggestion.  The current configuration under jessie supports TLS 1.0, 1.1, 1.2, which I think makes sense for backwards compatibility with clients.  I did a test against my server using https://www.ssllabs.com/ssltest/index.html and got good results (summary: A+ rating).
",mikeashley,2016-05-21 11:04:33
441,2015-12-10 10:46:20,"Implement postfix part of issue #373 
",neuhaus,2015-12-10 10:53:43
440,2015-12-08 08:53:35,"Per our discussion at #427, lets discuss here how we will properly support jessie (and/or upcoming releases).

Currently master is based on wheezy and trusty and we've got the [jessie](https://github.com/sovereign/sovereign/tree/jessie) branch, which contains wheezy-breaking changes.

I wanted to provision sovereign on my jessie server, so I picked up the jessie branch, but later found out that there are changes in master that I'd like to have, and then it started becoming a mess. I believe the idea is that the jessie branch merges master every now and then to be up to date.

I believe dropping support for one of the currently supported distros is not an option, right? They are all still deployed at scale I suppose.

Is it realistic to include jessie support in master through conditionals? For example #394 is not so trivial to solve. Someone who has a better picture of the overall thing, what do you think?
",danmilon,2016-09-16 09:40:52
440,2015-12-08 09:08:54,"I'd vote for a sovereign ""2.0"" which exclusively supports jessie. The shift to systemd is a big one.
",ariddell,2016-09-16 09:40:52
440,2015-12-08 13:54:49,"I think this is the right way to go as well, especially considering the security status of oldstable: one year after current stable (jessie) release (https://www.debian.org/security/faq#lifespan)
",sread,2016-09-16 09:40:52
440,2015-12-08 14:37:19,"We'll have the same situation on our hands in April 2016 with the release of Ubuntu 16.04 LTS (""Xenial"").
I'd prefer to keep backward compatibility unless there is a good reason not to, at least for half a year or so until after we have started to support a new LTS/stable version to give people time to migrate and the new distribution time to settle.
So far I haven't seen anything that makes backward compatibility impossible. Did I overlook something?
",neuhaus,2016-09-16 09:40:52
440,2015-12-08 15:19:49,"The argument in favor of having a backwards incompatible release for
Jessie and Xenial (they'll be roughly compatible, right?) is that it's
easier to audit and maintain the ansible scripts when you don't have all
the special cases to worry about. Supporting Debian 7+8+14.04+16.06 is a
lot of diversity.

On 12/08, Sven Neuhaus wrote:

> We'll have the same situation on our hands in April 2016 with the release of Ubuntu 16.04 LTS (""Xenial"").
> I'd prefer to keep backward compatibility unless there is a good reason not to, at least for half a year or so until after we have started to support a new LTS/stable version to give people time to migrate and the new distribution time to settle.
> So far I haven't seen anything that makes backward compatibility impossible. Did I overlook something?
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/sovereign/sovereign/issues/440#issuecomment-162900989
",ariddell,2016-09-16 09:40:52
440,2015-12-08 16:03:57,"This would be a good time to consider splitting off some roles into their own repos and using Ansible Galaxy to deploy them. Then each role's OS support can be declared independently, and the transition can happen in stages. Our more popular roles will likely get support for more distros/versions, and the less popular ones won't.

Using ansible galaxy would bring some other advantages: people could use our roles √† la carte and they'd be listed in the galaxy directory.
",lukecyca,2016-09-16 09:40:52
440,2015-12-08 18:09:03,"That makes a lot of sense.
",ariddell,2016-09-16 09:40:52
440,2015-12-08 18:39:25,"For what it's worth, I follow this repo because I believe in the project, but I'm not currently using any of the roles because they're all bundled up together. That batteries-included bundle structure goes against the grain of how Ansible is designed to work‚Äîparticularly with respect to roles.

Consider this a +1 for splitting up the roles. It's then much easier to support multiple versions of a distro, since you're mostly importing different package lists, or swapping different config lines according to `ansible_distribution_version`. 
",conorsch,2016-09-16 09:40:52
440,2015-12-08 21:05:39,"The [DebOps](http://debops.org/) ansible project is very well organized and we can use it as an example.
",danmilon,2016-09-16 09:40:52
440,2015-12-08 21:37:12,"Thanks @danmilon. It's great to have these examples.

DebOps looks interesting. I do like the repo per role approach. I'm still not entirely clear on how you deal with interdependencies. If DebOps is any guide, it will be some work to break apart our roles into standalone roles.
",ariddell,2016-09-16 09:40:52
440,2015-12-09 14:03:25,"+1 to what @conorsch said. Every week for so I think about spinning this up, but a m hesitant to put so many eggs into wheezy knowing the upgrade path to jessie could be bumpy.
",KyleOndy,2016-09-16 09:40:52
440,2016-01-10 12:10:35,"I would prefer to support only two distributions: debian stable and something more bleeding edge (Ubuntu has gotten the nod).  Testing multiple versions is a pain for not a lot of benefit.

I do not like splitting roles into different repos.  It would introduce another level of configuration management.  Furthermore, cross-role interdependencies is not hypothetical.  We're going to have it with Let's Encrypt support (pull request #451).

I don't see the additional complexity well motivated.  Make a version break with jessie and xenial and keep moving.  Am I missing something?
",mikeashley,2016-09-16 09:40:52
440,2016-01-18 10:09:19,"We need a certain time period where we continue to support oldstable to give people time to migrate.
",neuhaus,2016-09-16 09:40:52
440,2016-01-18 10:41:54,"@neuhaus That would be good, but would it be ok to keep such support on a separate branch?
",mikeashley,2016-09-16 09:40:52
440,2016-01-18 10:48:58,"@mikeashley I don't see why not
",neuhaus,2016-09-16 09:40:52
440,2016-02-13 14:59:34,"Just to confirm: the current master branch is for Wheezy/Trusty, and the current jessie branch is for Jessie/Wily.  The jessie branch has numerous references to Trusty.  I want to switch these over Wily to make a clean break between Debian 7 and Debian 8.  Are we agreed on this?
",mikeashley,2016-09-16 09:40:52
440,2016-02-13 15:16:19,"It's Jessie/Xenial (or whatever the next LTS is).

I vote for removing support for (and all references to) trusty from jessie. It makes sense to change the LTS version of ubuntu that's being supported.
",ariddell,2016-09-16 09:40:52
440,2016-02-14 00:21:22,"It's Xenial (Ubuntu 16.04 LTS) and I agree.
",neuhaus,2016-09-16 09:40:52
440,2016-02-14 12:21:43,"This needs the discussion label.
",mikeashley,2016-09-16 09:40:52
440,2016-02-21 16:43:18,"I think we are ready to start testing if PRs #503 and #504 are merged onto jessie.  I can at least deploy with no errors in vagrant and to a test instance at Linode.  There are issues to resolved, and I am sure we have bugs, but I think we need to start testing to see where we really stand.

I think a good goal is to get the jessie branch stable before Ubuntu Xenial releases in April.  That way we'll be adding Xenial support against a stable version of sovereign.

Bring on the bug reports!
",mikeashley,2016-09-16 09:40:52
440,2016-02-21 17:25:44,"Once #503 and #504 are merged, I'll start on some heavy testing. I'm hoping to get a production server up and running in the next month or so based on Jessie branch. 
",carljm,2016-09-16 09:40:52
440,2016-03-07 00:47:57,"We're ready for testing.  PRs #503 and #504 are merged.  Webmail is absent, but there is a PR pending to reinstate it.  I would omit ownCloud testing for now; there's a PR pending for ownCloud 8.2 support.  Rmilter still needs configured (Issue #394), but it doesn't affect mail delivery.

It would be great if folks could try out the LE support.  I am too close to it at this point.  Documentation is probably lacking, and it would be good to know where people stub their toes.  If you want to take baby steps, perhaps just start with the common, mailserver, and blog roles.

Also, please watch out for encfs failure (Issue #468).  I have not been able to reproduce it.
",mikeashley,2016-09-16 09:40:52
440,2016-03-07 09:55:27,"I absolutely agree that moving from a big monolithic repo with all the roles to to one repo per role (which are automatically downloaded using ansible-galaxy) and one meta-repo which combines the packages is the right thing to do. At the moment, it is not practical to use just a few of the roles which goes against the spirit of ansible very much and reduces the number of people who can use - and contribute - to the sovereign packages.
",Yannik,2016-09-16 09:40:52
440,2016-03-07 10:03:33,"@Yannik How does the current approach reduce the number of people who can use and contribute to the sovereign packages?
You can just activate the roles you want and deploy it. Same for changes.
",neuhaus,2016-09-16 09:40:52
440,2016-03-07 10:07:18,"@neuhaus Most people using ansible will simply add a dependency to a specific role their `requirements.yml` and then add the necessary variables to their host_vars/group_vars/playbook to use a role. This is not possible with sovereign. The roles are very tightly coupled at the moment which makes using them even harder. A separation of concerns into individual repos would help with this naturally.
",Yannik,2016-09-16 09:40:52
440,2016-03-07 10:54:16,"Yes, some of our roles are dependent on others.  For example, webmail assumes a configuration defined by mailserver.  Several roles depend on how common sets up /decrypted.  However, a metaconfiguration won't avoid that.

One could introduce additional abstraction into the sovereign roles to avoid hard dependencies of one role on another, but why would you introduce that complexity without a need?  Sovereign isn't designed to provide a set of reusable roles.  Sovereign is designed to provide a reasonably secure personal cloud server.  If that's the goal, how does our current approach limit users and contributors?
",mikeashley,2016-09-16 09:40:52
440,2016-03-07 11:01:23,"To quote @conorsch (and @danmilon @KyleOndy @lukecyca):

> For what it's worth, I follow this repo because I believe in the project, but I'm not currently using any of the roles because they're all bundled up together. That batteries-included bundle structure goes against the grain of how Ansible is designed to work‚Äîparticularly with respect to roles.
> 
> Consider this a +1 for splitting up the roles. It's then much easier to support multiple versions of a distro, since you're mostly importing different package lists, or swapping different config lines according to ansible_distribution_version.

I do like the project, but I am unable to use any of the roles because of the current monolithic structure of the project. And many people seem to be in the same situation. Having software reusable is the right approach in 99% of the cases. 
I don't see a strong argument for a monolithic structure in sovereign.
",Yannik,2016-09-16 09:40:52
440,2016-03-07 14:07:31,"I'd very much like to split up the roles. Ansible galaxy now seems like a reasonable tool (usable without using galaxy.ansible.com) which could facilitate splitting up the roles. I think the question is with which role to start.
",ariddell,2016-09-16 09:40:52
440,2016-03-07 15:55:07,"I agree with @mikeashley in that I don't think we should break apart the roles.  There's nothing preventing users from excluding roles using tags.  We could also define ansible `meta` properties to manage which roles depend on other roles if needed.
",jplock,2016-09-16 09:40:52
440,2016-03-07 15:59:11,"It does make me curious about how (practically speaking) others use Sovereign. I'm just now working on my first Sovereign server, but the only method of use that I've seriously considered is having my own local private branch of the repo, and merging in regularly from the mainline branch it's based on (`jessie` branch in my case). Given the need to set `vars/user.yml`, add tarsnap key, etc, it seems like that's pretty much a requirement. And once you're doing that anyway, it seems easy enough to also comment out roles from `site.yml`, modify roles as needed, even add new ones (I plan on doing some of all three).

So while I think modularity has some benefits in theory, I don't think I see enough benefit in this case to justify the additional coordination costs that would be imposed on the maintainers when making changes.
",carljm,2016-09-16 09:40:52
440,2016-03-07 16:02:41,"@carljm that's basically what I do as well.  I've got a personal private fork of sovereign with my local modifications (like `vars/user.yml`) that I periodically pull from upstream.  I've then commented out the services that I definitely don't want to use (like `newebe`) and then re-run the playbooks.  I don't want to have to keep lots of repos up to date or use git modules personally.
",jplock,2016-09-16 09:40:52
440,2016-03-07 16:14:15,"I'll think about making a POC (using the `requirements.yml` approach mentioned by @Yannik) just so folks could see what it might look like. In practice, I do what @jplock describes but I'd like to also add one or two custom roles and it's hard to do that with the existing setup.
",ariddell,2016-09-16 09:40:52
440,2016-03-07 16:15:26,"@ariddell Why is it hard to add custom roles with the existing setup?
",carljm,2016-09-16 09:40:52
440,2016-03-07 16:20:10,"It's not hard it's just a little tricky. I think one of the reasons is that sovereign doesn't follow normal conventions like `group_vars`. Another reason is that the roles are tightly dependent on each other. To be honest, it's not too hard. I'll report back once I get my jessie VPS running.
",ariddell,2016-09-16 09:40:52
440,2016-03-07 17:01:11,":clap: I look forward to the PoC.
If sovereign violates ansible conventions I do think we should change it to adhere to the standard unless it means a lot of extra work.
",neuhaus,2016-09-16 09:40:52
440,2016-03-07 18:46:49,"@mikeashley re LE support, one oddity I noticed is that the README mentions setting the `subdomains` var in `vars/user.yml`, but no such var exists or is referenced anywhere. As far as I can tell, the top-level `{{ domain }}` is the only one included in the LE cert request? See https://github.com/sovereign/sovereign/blob/jessie/roles/common/tasks/letsencrypt.yml#L34

Not sure if this is an actual problem (the cert seems to be working for SMTP and IMAP at least, so far, even at the `mail.` subdomain) or just a documentation inconsistency.
",carljm,2016-09-16 09:40:52
440,2016-03-07 22:37:27,"@carljm The documentation is out of date.  It documents the penultimate design that I was able to simplify.  We'll need to correct the README.  Thanks for the catch!
",mikeashley,2016-09-16 09:40:52
440,2016-03-07 22:40:40,"@mikeashley PR submitted in #514.
",carljm,2016-09-16 09:40:52
440,2016-04-16 19:58:03,"I upgraded my production server today from Wheezy to Jessie.  I reran the playbook from the jessie branch to finalize the server's configuration, and it worked great.  I'll put some notes on the wiki for others to reference.  My goal was to make this happen before Xenial released.  Success!  And thank you to everybody who has helped get the jessie branch in shape!
",mikeashley,2016-09-16 09:40:52
440,2016-05-21 10:01:54,"When should we flip the jessie branch to master and master to wheezy?
",mikeashley,2016-09-16 09:40:52
440,2016-05-21 12:59:06,"I'll try to do some testing this week. I think we should definitely take this chance to make backwards-incompatible changes that need to be made -- are all of them marked? 
",ariddell,2016-09-16 09:40:52
440,2016-05-21 13:05:44,"In this context, what do you mean by backwards incompatible?  The owncloud upgrade can't be reverted, for example.  Is that the sort of thing you are thinking?  I did start a wiki page with upgrade notes also.
",mikeashley,2016-09-16 09:40:52
440,2016-05-21 13:34:21,"By backwards incompatible I mean just about anything that would have required some manual adjustments during a normal upgrade (that is, without the wheezy->jessie switch). The Postfix submission port is a good example. I think there might be some others.
",ariddell,2016-09-16 09:40:52
440,2016-09-11 09:51:18,"Are we ready to flip the jessie branch to master and the master branch to wheezy?  The webmail role is reinstated.  There is a migration page on the wiki.  I'm ready to pull the trigger.
",mikeashley,2016-09-16 09:40:52
440,2016-09-11 13:57:01,"Yes. Let's do this.
",ariddell,2016-09-16 09:40:52
440,2016-09-11 14:04:02,"Go for it!
",neuhaus,2016-09-16 09:40:52
440,2016-09-11 20:50:23,"Done.  I merged jessie onto master.  I also created a new branch `wheezy` for any future commits against Debian 7-based systems.
",mikeashley,2016-09-16 09:40:52
440,2016-09-16 09:40:52,"I think we can close this issue.  As a final step I cleared the jessie tag from issues that applied only to the old jessie branch.  If there are issues that apply only to Debian 7-based systems (the wheezy branch), we can use a wheezy tag to label.
",mikeashley,2016-09-16 09:40:52
439,2015-12-05 11:15:33,"Change default network buffer size
Should increase tcp tunnel speed for openvpn < 2.3.9
https://community.openvpn.net/openvpn/ticket/461
",Friz-zy,2015-12-05 16:57:02
439,2015-12-05 12:37:39,"Thanks for this! Would you mind adding a note about which version of openvpn has this included so we can know when it's no longer needed (perhaps the release after Jessie)?
",ariddell,2015-12-05 16:57:02
439,2015-12-05 12:38:40,"@Friz-zy on another note, do you have a working openvpn config for jessie? We're missing that.
",ariddell,2015-12-05 16:57:02
439,2015-12-05 13:08:00,"Even unstable sid right now [uses 2.3.7](https://packages.debian.org/search?keywords=openvpn) so it will be not so soon...
About config: what's the problem?
Unfortunately, I am using an older version of Ubuntu with not the most fresh openvpn.
",Friz-zy,2015-12-05 16:57:02
439,2015-12-05 14:30:22,"But there is a release which includes the fix, right? We should note that.

re: config, jessie uses systemd, so a few things need to change.
",ariddell,2015-12-05 16:57:02
439,2015-12-05 15:50:16,"Fix will be in openvpn 2.3.9, but I don't know what distro will include it.
With systemd you have a problem with rc.local, haven't it?
I can fix it by rc-local.service, if you want.
",Friz-zy,2015-12-05 16:57:02
439,2015-12-05 16:56:20,"Oh, I'm sorry -- I didn't realize you included the version number in the
first place.

On 12/05, Filipp Frizzy wrote:

> Fix will be in openvpn 2.3.9, but I don't know what distro will include it.
> With systemd you have a problem with rc.local, haven't it?
> I can fix it by rc-local.service, if you want.
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/sovereign/sovereign/pull/439#issuecomment-162213355
",ariddell,2015-12-05 16:57:02
439,2015-12-14 14:14:19,"I can no longer connect to my VPN from my iPhone or iPad after this change.  Desktop works fine though.  Any thoughts?
",jplock,2015-12-05 16:57:02
439,2015-12-14 14:19:40,"Hm, can you change

<S_CODE_TOKEN>

to

<S_CODE_TOKEN>

or delete it and post results here?
",Friz-zy,2015-12-05 16:57:02
439,2015-12-14 14:48:20,"So after some trial and error, this PR is actually fine.  The problem I'm running into is with the `openvpn_mtu` change in https://github.com/sovereign/sovereign/pull/429.  I had to comment that out to be able to connect.  I'm running Debian Wheezy.

<S_CODE_TOKEN>
",jplock,2015-12-05 16:57:02
438,2015-12-04 22:22:32,"See #433 for more context.
",danmilon,2015-12-05 08:39:17
438,2015-12-05 08:39:31,"Thank you!
",neuhaus,2015-12-05 08:39:17
437,2015-12-04 14:31:08,"The selfoss role is named ""news"". This is confusing, it could also mean usenet news.

I suggest we change the role name from ""news"" to ""rssreader"", ""rss"" or ""syndication"".
",neuhaus,2015-12-05 09:50:10
437,2015-12-05 09:15:34,"Let's just get a jumpstart on #414 and call it after the software.
",ariddell,2015-12-05 09:50:10
437,2015-12-05 09:50:10,"I had forgotten about #414. Closing this as duplicate.
",neuhaus,2015-12-05 09:50:10
436,2015-12-02 20:29:25,"Per discussion on #429 (after the merge). This project is about encouraging users to run services themselves and not rely on for-profit corporations such as Google.
",ariddell,2015-12-04 12:22:09
436,2015-12-04 12:22:18,"Thanks
",neuhaus,2015-12-04 12:22:09
435,2015-11-26 08:47:30,"I'm able to ssh login to **10.10.24.127** without password, while running the ansible playbook, I encountered the following error:

<S_CODE_TOKEN>
",haozhenxiao,2015-11-26 08:47:54
435,2015-12-02 12:47:11,"What was the solution?
",neuhaus,2015-11-26 08:47:54
434,2015-11-24 14:29:11,"See #406.
",danmilon,2015-11-24 14:41:35
434,2015-11-24 14:39:17,"force pushed. please review again.
",danmilon,2015-11-24 14:41:35
433,2015-11-20 11:56:28,"I got this mail from cron/logrotate:

<S_CODE_TOKEN>

i think the permissions I set in this PR are more appropriate.
",danmilon,2015-12-04 22:22:54
433,2015-12-04 12:02:03,"With these permissions, I get the same error.

<S_CODE_TOKEN>

<S_CODE_TOKEN>

`Writeble by a group which is not ""root""` is what it doesn't like probably.
Not sure why it worked when both user and group is `www-data`.
Is there any reason why we dont want it that way?
",danmilon,2015-12-04 22:22:54
433,2015-12-04 14:24:47,"If there is a successful attack on the webserver, the attacker can run things as user `www-data`.
Stuff owned by www-data can then be modified, such as permission on a directory owned by www-data.
If the user www-data merely has write permissions on a directory, he cannot change its permission.

So the error message comes from logrotate, not from selfoss apparently.
",neuhaus,2015-12-04 22:22:54
433,2015-12-04 14:37:50,"Could you please try the suggested fix, adding a ""su"" line to `/etc/logrotate.d/selfoss`copied from `etc_logrotate_selfoss`?

Like this:

<S_CODE_TOKEN>
",neuhaus,2015-12-04 22:22:54
433,2015-12-04 14:51:31,"You are right, it worked like that. If you believe that from a security standpoint its OK, I can send a PR.

<S_CODE_TOKEN>

<S_CODE_TOKEN>

<S_CODE_TOKEN>
",danmilon,2015-12-04 22:22:54
433,2015-12-04 22:22:54,"See #438.
",danmilon,2015-12-04 22:22:54
433,2015-12-05 08:40:03,"Merged #438
",neuhaus,2015-12-04 22:22:54
432,2015-11-20 07:49:58,"Sovereign installs MySQL if I am correct but it looks like it doesn't touch the password for the `root` database user. The `root` user does not have a password by default in MySQL. Shouldn't we add a variable to set the `root` password during install?
",cimm,2016-10-03 20:03:34
432,2015-12-02 12:53:17,"It's been a while since I've done a fresh install, but doesn't the mysql-server package itself ask the user for a DB root password during install?
",neuhaus,2016-10-03 20:03:34
432,2015-12-02 17:42:15,"Ansible installs mysql-server unattended and doesn't ask for the root password. I was able to set the mysql root pw using these tasks https://github.com/nodiscc/srv01/blob/ansible/roles/apache2/tasks/apache2.yml#L81
",nodiscc,2016-10-03 20:03:34
432,2015-12-10 09:34:25,"A pull request is very welcome!
",neuhaus,2016-10-03 20:03:34
432,2016-05-21 18:01:00,"Database server setup has gotten sloppy in general.  Every module that needs a database assumes it has to set it up, and this leads to duplicated or inconsistent configuration.  The right thing to do is to move database server installs and initial setup to the common role.  The lack of an admin password for mysql can be addressed there.

Yes, a pull request would be welcome!
",mikeashley,2016-10-03 20:03:34
432,2016-10-03 13:53:57,"PR #593 moves the DB setup to the common role.
",wsteitz,2016-10-03 20:03:34
432,2016-10-03 20:03:34,"OK, postgres has been taken care of.
The only thing that still uses MySQL is OpenDMARC, and we want to get rid of having two DB servers so I don't expect the MySQL installation to move to the ""common"" roles, instead I think it will disappear. Closing. Thanks for the PR, @wsteitz !
",neuhaus,2016-10-03 20:03:34
431,2015-11-19 22:59:03,"For self signed certificates, when the server adds the HSTS header, firefox will refuse to connect to it, and won't even let you add to add an exception. So I added a variable that by default adds the header.

I am not sure how well we can communicate the existence of this option with the users. Should I add it in the README?
",danmilon,2015-12-04 22:15:38
431,2015-11-30 12:43:52,"ping, anyone there?
",danmilon,2015-12-04 22:15:38
431,2015-12-02 12:45:39,"If you add a new option, it needs to be documented.
How do other browsers behave with regards to self-signed certificated and the HSTS header?
",neuhaus,2015-12-04 22:15:38
431,2015-12-04 14:36:54,"I tried with chromium and it allows you to override even with HSTS and self signed. I believe we should work on lets encrypt certs instead of self signed, so we wont need this at all. What do you think?
",danmilon,2015-12-04 22:15:38
431,2015-12-04 14:40:05,"Agreed. See issue #426 
",neuhaus,2015-12-04 22:15:38
431,2015-12-04 14:57:39,"I can't reproduce this, Firefox (Iceweasel 42.0-1) allows me to override with self-signed cert AND HSTS headers (it just doesn't enforce HSTS).
",nodiscc,2015-12-04 22:15:38
431,2015-12-04 22:15:38,"Indeed now that I put back HSTS I cant reproduce it also. There are some bugs reported for firefox (e.g. [800882](https://bugzilla.mozilla.org/show_bug.cgi?id=800882)). Since I fixed the issue by editing [SiteSecurityServiceState.txt](http://superuser.com/questions/539580/how-can-i-remove-a-website-accidentally-added-to-firefoxs-list-of-hsts-sites#comment1276327_912277), noone else has reported it, and I can't reproduce it, I'll close this.
",danmilon,2015-12-04 22:15:38
431,2015-12-08 17:47:33,"For reference, see this screenshot of firefox 42.
![screen shot 2015-12-08 at 19 45 45](https://cloud.githubusercontent.com/assets/1139595/11663368/817d6b7c-9de4-11e5-9780-0f0a3a06c441.png)
",danmilon,2015-12-04 22:15:38
430,2015-11-19 22:19:43,"I was stupidly using the certificates provided in the repo, and then I generated some self-signed ones but found out that they were not properly installed. The `creates=/etc/ssl/certs/wildcard_combined.pem` was making the task to skip which it shouldn't. So I fixed that, and also thought it should restart apache by itself.
",danmilon,2015-12-21 09:06:35
430,2015-11-24 14:23:53,"Can you please make a separate PR for the SSL stapling issue?
",neuhaus,2015-12-21 09:06:35
430,2015-11-24 14:30:33,"See #434 
",danmilon,2015-12-21 09:06:35
430,2015-11-24 14:33:35,"I also removed the SSL stapling from this PR.
",danmilon,2015-12-21 09:06:35
430,2015-12-21 09:06:31,"fixes #190, #412 and #449 
Thank you!
",neuhaus,2015-12-21 09:06:35
429,2015-11-14 17:33:09,"Variables:
- change `chiper` to ""AES-256-CBC""
- change `auth` to ""SHA512""
- add `verb` level
- add `tun-mtu` for disguising
- add `tls-version-min` and `tls-cipher`

Config:
- add google dns
- add new variables

Src:
- blog.g3rt.nl/openvpn-security-tips.html
- community.openvpn.net/openvpn/ticket/401
- witch.valdikss.org.ru
",Friz-zy,2015-11-16 06:34:16
429,2015-11-14 18:23:19,"Thanks for this!

(I've been (slowly) working on figuring out the changes needed for jessie in #401)
",ariddell,2015-11-16 06:34:16
429,2015-11-14 18:33:17,"Thanks for your work ;)
If I have a little more time, I'll try to join because I know ubuntu better than centos.
",Friz-zy,2015-11-16 06:34:16
429,2015-11-15 18:33:47,"Thanks. (By the way, I think dnsmasq was added so that dns requests could be routed via the server, see #236)
",ariddell,2015-11-16 06:34:16
429,2015-11-15 18:46:10,"I uses pure openvpn with pushing google dns and no one additional options on client and dnsleaktest.com detects google server =)
",Friz-zy,2015-11-16 06:34:16
429,2015-11-16 08:50:44,"Thanks!
",Friz-zy,2015-11-16 06:34:16
429,2015-12-02 13:02:10,"Ubuntu Trusty comes with openvpn 2.3.2 btw
",neuhaus,2015-11-16 06:34:16
429,2015-12-04 09:07:29,"Nice work ;)
I have another additions for you ;)
I'll send a request later
",Friz-zy,2015-11-16 06:34:16
429,2015-12-14 16:00:15,"Per my comment on #439, the default MTU is causing problems for me with iOS devices.  Can we change the default to something other than `1300`?  I'm running Debian Wheezy.

<S_CODE_TOKEN>
",jplock,2015-11-16 06:34:16
429,2015-12-14 16:37:08,"I found an [old bug](https://community.openvpn.net/openvpn/ticket/334): looks like ios client doesn't understand *-mtu options. Unfortunately I don't have an ios for tests...
I think in your case you can only disable it.
@ariddell, should we add a comment into config about IOS?
",Friz-zy,2015-11-16 06:34:16
429,2015-12-14 18:16:31,"The client doesn't understand link-mtu in the .ovpn, right? Can you just set it manually? Or does iOS refuse to let you set the MTU at all?

I suppose adding a comment wouldn't hurt. Perhaps someone can confirm that you can manually set the MTU on iOS?

(It will be great to disaggregate these roles since one could add this information to the README of the vpn role.)
",ariddell,2015-11-16 06:34:16
429,2015-12-14 18:40:34,"Can we comment out the MTU option by default and let people uncomment it if they they'd like to?
",jplock,2015-11-16 06:34:16
429,2015-12-14 22:49:34,"I feel odd about accommodating a broken iOS client. What could be more basic than asking clients to set a lower MTU?
",ariddell,2015-11-16 06:34:16
429,2015-12-16 10:28:22,"From what I understand, we used to have no default MTU set in the server, why don't we just remove the default MTU again?
",neuhaus,2015-11-16 06:34:16
429,2015-12-16 11:07:18,"It's easy to detect openvpn traffic by mtu fingerprint (even cipher and hash sum algorithm), look at witch.valdikss.org.ru
We can use msfix instead but I couldn't get it well configured and it still can be invalid for ios...
",Friz-zy,2015-11-16 06:34:16
429,2015-12-16 11:15:45,"I've had to lower the MTU in other contexts -- it's a very normal
operation. Is there any clue as to why the iOS client doesn't support
it?

I suppose this comes down to privacy (i.e., fingerprinting resistance)
vs. iOS support. While I'm likely somewhat biased in that I don't use
iOS, the fingerprinting resistance seems like a sensible change and very
much in the spirit of sovereign.

On 12/16, Filipp Frizzy wrote:

> It's easy to detect openvpn traffic by mtu fingerprint (even cipher and hash sum algorithm), look at witch.valdikss.org.ru
> We can use msfix instead but I couldn't get it well configured and it still can be invalid for ios...
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/sovereign/sovereign/pull/429#issuecomment-165068408
",ariddell,2015-11-16 06:34:16
429,2015-12-16 11:41:17,"Maybe we can add new option or variable as a solution?
Something like 'disable this if you uses ios clients, default is Enabled'.
I don't have any information about ios client except google search but I find this situations at least strange too...
",Friz-zy,2015-11-16 06:34:16
429,2015-12-16 11:58:10,"We're going to add a variable to account for a broken client? I'd prefer to leave the fingerprintability for now than go down that route.
",ariddell,2015-11-16 06:34:16
429,2015-12-16 12:16:10,"Fine with me - add the MTU to the configuration and make sure to mention it in the README and in a comment in the config file that it is incompatible with iOS.
",neuhaus,2015-11-16 06:34:16
429,2015-12-16 12:19:34,"I agree with @neuhaus
",Friz-zy,2015-11-16 06:34:16
429,2015-12-16 12:27:13,"So it will be a config option that just specifies the MTU  -- but if
it's None it removes the link-mtu line entirely?

On 12/16, Sven Neuhaus wrote:

> Fine with me - add the MTU to the configuration and make sure to mention it in the README and in a comment in the config file that it is incompatible with iOS.
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/sovereign/sovereign/pull/429#issuecomment-165089789
",ariddell,2015-11-16 06:34:16
429,2015-12-16 12:34:05,"Sounds good, if we add a variable, it will help users that want to work with iOS because their changes won't be overwritten all the time.
",neuhaus,2015-11-16 06:34:16
429,2015-12-16 12:41:11,"Great, @Friz-zy, will you submit a PR?
",ariddell,2015-11-16 06:34:16
429,2015-12-16 13:05:42,"Yep, I'll do it today later
",Friz-zy,2015-11-16 06:34:16
429,2015-12-16 20:54:41,"Pushed to https://github.com/sovereign/sovereign/pull/445
",Friz-zy,2015-11-16 06:34:16
428,2015-11-11 16:52:07,"In the jessie branch, I'm having trouble figuring out how to move forward with a solr problem I'm having in the testvm:
- In Debian 8: solr-tomcat depends on tomcat7
- In Ubuntu 14.04: solr-tomcat depends on tomcat6
- We pull in tomcat8 (a8a090573831c87abd233cdbcb5cbac822a2ba8d) but I can't get tomcat8 to sucessfully load the /etc/tomcat8/server.xml file introduced in b3dc1b00e9f50ab38c192e2efdcee04bcba50639

So I guess my question is why do we have a custom server.xml file at all (not clear from git history) and are we sure the version of solr in the repos (3.6.2) is compatible with tomcat8?
",sread,2016-03-04 21:00:16
428,2015-12-10 09:41:30,"According to http://packages.ubuntu.com/xenial/solr-tomcat on Ubuntu 16.04 solr-tomcat (currently version 3.6.2+dfsg-8) will also depend on tomcat7.

On Ubuntu, tomcat7 is part of ""main"" whereas tomcat8 is in ""universe"" which means it may not get security updates.
",neuhaus,2016-03-04 21:00:16
428,2016-02-14 11:49:50,"PR #488 addresses this.  Also, this issue needs the jessie label.
",mikeashley,2016-03-04 21:00:16
427,2015-11-05 18:52:49,"Debian Jessie now also uses the a2enconf and conf-available/conf-enabled system, so there is no need to have separate entries for jessie and trusty any longer.

Tested only on jessie but nothing changes for trusty.
",sread,2016-01-18 09:45:04
427,2015-11-17 22:32:21,"Yup, :+1: I bumped into this also. Should be ok to merge.
",danmilon,2016-01-18 09:45:04
427,2015-12-02 12:59:57,"We're also supporting Wheezy. This change will break Wheezy I think.
Could you please change your pull request so it has a special treatment for wheezy and a default for everything else?
",neuhaus,2016-01-18 09:45:04
427,2015-12-05 17:03:12,"I can definitely do that, but before i do: a lot of the changes in this branch by @al3x from Sept (e.g. 69abd70297a89051c3caa40b304dc134c53d048d) are already incompatible with Wheezy as far as I can tell. So perhaps we can clarify the goals of each branch / long term...
",sread,2016-01-18 09:45:04
427,2015-12-07 10:24:00,"OK that's news to me (that the jessie branch breaks compatibility with wheezy) but I can live with it. Git branches are so useful :+1: 
It will however make maintaining changes across branches a bit more tedious.
",neuhaus,2016-01-18 09:45:04
427,2015-12-07 22:17:15,"Yes I was starting worry about the same thing, as some fixes on master are relevant to jessie but not applied and so the two branches are diverging. 

As for this PR, master already special cases wheezy vs trusty. There is no difference in handling between trusty and jessie so I think if we just apply to jessie branch it should be fine (for now).

(That's a lot of code names in one sentence...)
",sread,2016-01-18 09:45:04
427,2015-12-07 22:19:57,"Just wait for April when we add Xenial to the mix...
",neuhaus,2016-01-18 09:45:04
427,2016-01-16 14:52:47,"No need to break compatability for this, it's easy to change this in a way that won't break on wheezy:

<S_CODE_TOKEN>

please change the pull request accordingly.
",neuhaus,2016-01-18 09:45:04
427,2016-01-17 18:17:45,"@neuhaus Done!
",sread,2016-01-18 09:45:04
427,2016-01-18 09:45:08,"Thanks!
",neuhaus,2016-01-18 09:45:04
426,2015-11-05 10:52:46,"[Let's encrypt](https://letsencrypt.org) is a new free and automated certificate authority that will enter productive mode this month.

I plan to add support for it to sovereign to replace the need for an expensive wildcard certificate, however it will be quite a bit of work so any help is appreciated.
",neuhaus,2016-03-06 16:04:36
426,2015-11-12 02:20:22,"The link is wrong, correct one is https://letsencrypt.org/
",masterkorp,2016-03-06 16:04:36
426,2015-11-12 10:17:00,"+1 was coming in to suggest the very same...  Will be very cool to have automated letsencrypt SNI setup for the custom domain(s) in question...
",tracker1,2016-03-06 16:04:36
426,2015-11-12 10:48:26,"Fixed the link. So, do you guys want to help? :-) Got suggestions regarding which client to use? There is the official one of course (written in python), but there are also alternatives.
",neuhaus,2016-03-06 16:04:36
426,2015-11-12 19:13:55,"If python is already in the dependencies, I'd just go with the default/official client.
",tracker1,2016-03-06 16:04:36
426,2015-11-14 20:24:43,"Did a bit of research, since we're not the only ones interested in this. thefinn93 ( https://github.com/thefinn93/ansible-letsencrypt ) ansible role looks like a good starting point, see also ( https://community.letsencrypt.org/t/completely-automated-setup/3121/2 )
",sread,2016-03-06 16:04:36
426,2015-12-04 13:51:31,"The official client is not very popular because it tries to do too many things and has many dependencies.
Here are some simple alternatives:
- https://github.com/kuba/simp_le
- https://github.com/diafygi/acme-tiny/
- https://github.com/xenolf/lego _(needs golang)_
- https://github.com/barosl/letsencrypt-simple
- https://github.com/hlandau/acme _(needs golang)_
",neuhaus,2016-03-06 16:04:36
426,2015-12-06 18:02:49,"What do you think the overall architecture should be? I can try to tackle this. All needs to happen in the host where things are being provisioned, right?

One problem I thought of, is that you don't know which roles are activated, thus which domains to ask the certificate for. One solution to that is one certificate for each service.
",danmilon,2016-03-06 16:04:36
426,2015-12-07 11:02:18,"The DNS part is outside of the scope of the sovereign project. I.e. the user has to make sure the DNS records are in-place. The playbook should make sure to check a DNS record before trying to create a Let's encrypt certificate.
",neuhaus,2016-03-06 16:04:36
426,2015-12-07 13:04:21,"I'm talking about [SANs](https://en.wikipedia.org/wiki/SubjectAltName). When you ask LetsEncrypt for the cert, if you're going to install one cert for all services, you need to ask for which subdomains the certificate will be valid. LetsEncrypt does not support wildcard certificates.

And there will be a validation for each subdomain you ask, so it needs to work, cant be arbitrary.

That's why you need to know which roles are being provisioned, in order to ask only for them.
Or else have independent certificates for each service.
",danmilon,2016-03-06 16:04:36
426,2015-12-07 13:10:10,"In the ""common"" role we can do the installation of an ACME client and generate an account key.

Then there are two tasks that need to be done for every virtualhost:
1. Get a certificate rightaway so Apache can start using it.
2. Set up a cronjob for automatic renewal every X days

For now, I suggest we just do it for one role and then find out what the best way is to do it for several roles. There is no way to loop over the roles in ansible from what I've seen.
",neuhaus,2016-03-06 16:04:36
426,2015-12-07 13:12:55,"Okay, so that would be one certificate for each service. Yeah, I don't see any downside to that. When we see that it works flawlessly we can drop self signed certs entirely.

I'll work on that.
",danmilon,2016-03-06 16:04:36
426,2015-12-07 13:13:45,"Then there are some non-HTTPS services such as Mail (IMAP and SMTP) and Jabber where we can probably also use the certificates.

The hostnames are currently assigned in the `vars/default.yml` file:

<S_CODE_TOKEN>

etc.
",neuhaus,2016-03-06 16:04:36
426,2015-12-07 13:14:58,"Does Let's encrypt support putting all SANs in a single certificate? I hadn't considered that possibility.
",neuhaus,2016-03-06 16:04:36
426,2015-12-07 13:15:34,"Yeah, SANs are for a single certificate.
",danmilon,2016-03-06 16:04:36
426,2015-12-07 13:18:51,"OK, that would give us less files to deal with but it's more of a hassle if a site owner changes the roles every other day. 
Getting one certficiate with all SANs would probably requires less changes, it'd be somewhat like a wildcard certificate. We just need to document the steps necessary whenever role that involve certificates are added or removed.
",neuhaus,2016-03-06 16:04:36
426,2015-12-07 13:20:29,"Regarding ACME client, let's go with https://github.com/kuba/simp_le ?
",neuhaus,2016-03-06 16:04:36
426,2015-12-07 13:28:36,"If we get rid of all webservers listening on port 80, we can set up a single one that deals with ACME challenges for _all_ hostnames.
For all requests other than `/.well-known/acme-challenge/` the webserver can redirect to **https**://`$SERVER_NAME`/ with the original path remaining intact.
",neuhaus,2016-03-06 16:04:36
426,2015-12-07 13:36:25,"One important thing, the folder /.well-known/acme-challenge/ in the webroot should not be owned by www-data, we don't want certificates at risk whenever www-data is compromised.
",neuhaus,2016-03-06 16:04:36
426,2015-12-07 13:36:26,"1. Yes, I'm using `simp_le` for now.
2. Yes, we can do that with port 80 and apache.
3. We need to also point out that even if you don't include all roles, you need to set up the DNS for all of them, or else lets encrypt will fail.
",danmilon,2016-03-06 16:04:36
426,2015-12-07 13:38:35,"Regarding 3.
The ansible script could check which hostnames have been configured in DNS and do the certificate tasks only for those that are pointing to it... and complain about the others. 
Every role could check its own hostname and warn if it isn't configured or pointing elsewhere.
",neuhaus,2016-03-06 16:04:36
426,2015-12-07 14:15:05,"I'm still not decided on single-cert per service vs one with SANs. The first is cleaner and the tedious part (set cron job and apache vhost to handle acme challenges can be written in a modular way and imported from other roles). I'd like to try to do it that way first to see if there are more implications. If it works, are you OK with that?
",danmilon,2016-03-06 16:04:36
426,2015-12-07 14:19:21,"I'm fine with either way. I agree that separate certificates are easier to automate.
Also I think we can do all ACME challenges and redirects with a single vhost on port 80.
",neuhaus,2016-03-06 16:04:36
426,2015-12-07 22:30:03,"I've been thinking about this and agree that webroot auth, simp_le and separate certs is the way to go. I was thinking that a handler might do the trick for triggering setup per service.
Looks like you're off to the races but let me know if I can help.
",sread,2016-03-06 16:04:36
426,2015-12-09 13:56:59,"There's this, already ansibilized: https://github.com/debops/acme-tiny

edit: nevermind, doesn't look finished
",ariddell,2016-03-06 16:04:36
426,2015-12-09 14:04:04,"I don't see anything related to ansible in that repo...
",neuhaus,2016-03-06 16:04:36
426,2015-12-09 14:16:39,"You're right. I assumed all their repos were ansible repositories.

Here are the issues where they (DebOps) discuss ACME support:
- https://github.com/debops/ansible-pki/issues/30
- https://github.com/debops/ansible-nginx/issues/84

Looks like they're almost there (for nginx)
",ariddell,2016-03-06 16:04:36
426,2015-12-12 11:55:40,"Hello everyone, developer of [DebOps](http://debops.org/) here. :-) I've written a role that can handle certificates (actually most of the PKI structure) in Ansible and let me tell you one thing - don't do it in pure Ansible, it's unmanageable. Write a script that can do all necessary actions like key/cert generation, install it on the host and use Ansible to configure it an launch all necessary tasks. Just don't put the logic in the role/playbook itself.

I'm currently working on a `acme-tiny`-based implementation of the PKI, with ACME being added to ""internal"" sets of certificates handled by a set of CAs managed by Ansible Controller, and ""external"" set of certificates managed by a custom script provided by the user - each set of finished certificates (I call that a ""realm"") will automatically pick either external, ACME, or internal certs depending on their availability, so that internal hosts not reachable from the Internet can also have certificates. It doesn't really mater what certificates a service uses, as long as the clients have a maching trusted CA certificate, so my goal here is to have a valid set at all times.

As for the support in `nginx` (maybe you could consider switching, hint, hint), it's [already done](https://github.com/debops/ansible-nginx/pull/91) in my `debops.nginx` role. You can also read [notes about the design](https://github.com/debops/ansible-nginx/blob/master/docs/acme-support.rst) to see how it is supposed to work.
",drybjed,2016-03-06 16:04:36
426,2015-12-12 12:25:00,"Hi @drybjed. Thanks for coming over here to comment.

I've been trying out debops myself and I do like some of the tricks being used to make ansible roles more module (the debops.etc_services is quite nice). On balance, I think it _should_ be a model for how to modularize our roles.

I'm not a fan of `debops.pki`, which is how debops manages certs -- but I take it neither are you @drybjed? How easy would it be to use `debops.nginx` and your `acme` role without using any other `debops` roles? (In particular, sovereign uses ufw (not ferm).)

If we use ACME/Lets-Encrypt we also need to make those certificates available for the mail server -- do I have that right? How complicated will this be?

(If there's interest in re-using debops' solution, I'd be willing to audit/review the code.)
",ariddell,2016-03-06 16:04:36
426,2015-12-12 12:50:57,"Hey @ariddell :-) Ironically, Sovereign was one of the catalysts for making DebOps - I just wanted to do it better ;P

Current `debops.pki` available in the `master` branch was my first attempt at making any sort of Public Key Infrastructure, and it shows. It's like a house of cards, you change one thing and everything falls apart. I wrote it almost a year ago, and always planned to redo it after some time, when I found out what worked and what didn't. Now I'm ready to write it again, this time better and easier to control, and with more bells and whistles like ACME.

There is no ""DebOps ACME"" role, the ACME support will be incorporated into `debops.pki`. The reason is, not all hosts that can be managed by DebOps are expected to be reachable by the Let's Encrypt CA over the Internet, and I still want them to use TLS connections. So the support for different types of certificates will be kind of stackable - by default the internal certificates will be used, if ACME are present they will be preferred, and any external certificates provided by the user via a script will take precedence (think their own company PKI infrastructure).

Don't think of the set of certificates signed by Let's Encrypt as only for the webserver, it's a mistake. X.509 certificates are agnostic. You just need to make sure that you provide them in a standardized location and configure your various services to use them. Coincidentally, that's what `debops.pki` aims to do, to make a stable and known environment for other roles to use certificates. For example path to where certificates are stored is saved as an Ansible local fact, which other Ansible roles can use to configure certificate support in their services. That way, I don't need to worry about `nginx` role maintaining its own set, it just hooks up to `debops.pki` infrastructure if it's present, automatically.

As for using Sovereign with DebOps roles... One issue might be heavy use of role dependencies in roles like `debops.nginx` or similar. I'm currently in the middle of refactoring things to move ""hard"" role dependencies into [the corresponding playbook](https://github.com/debops/debops-playbooks/tree/master/playbooks/service) of each role - after that you could use them in Sovereign without much issue, apart from handling missing firewall support, for example. But it will take some time, other things like ACME took precedence. You can right now disable `debops.nginx` role dependencies by setting `nginx_dependencies: False` in the Ansible inventory, that way they will be just skipped.
",drybjed,2016-03-06 16:04:36
426,2015-12-12 13:16:00,"@drybjed very glad to hear about these efforts. I'd love to see `debops` become even more modular.

So it looks like sovereign could get by with a pki role which is lighter than debops's debops.pki. We _do_ anticipate that every host using sovereign will be able to talk to the Let's Encrypt ACME server. I think this would allow for a great deal of simplification. Sovereign may be able to get away with a single, simple `acme` role.

Perhaps this is a good place to start the modularization it sounds like we all seem to want (#440): a branch/repo of sovereign that just installs nginx (or apache) and fetches a certificate from lets-encrypt. Each role could have its own repo, following debops' example.
",ariddell,2016-03-06 16:04:36
426,2016-01-16 13:10:44,"The pull request #462 (adding Radicale support) would also benefit from a Let's encrypt cert.
",neuhaus,2016-03-06 16:04:36
426,2016-01-16 13:35:20,"The rewrite of `debops.pki` role to make it easier to use and add external and ACME certificate support is partially done in [this PR](https://github.com/debops/ansible-pki/pull/33). In the PR there are instructions for how to use it and debug it if necessary. I'm looking for more people to test the code and find issues. If anybody wants to try it with Sovereign, I would be interested to see the results.

The Ansible role should be self-contained, although it uses resources on Ansible Controller like `bash` and `openssl` which should be in the recent versions.
",drybjed,2016-03-06 16:04:36
426,2016-02-04 09:44:09,"Welcome, just a quick update. The `debops.pki` role has been updated, you can [grab it from GitHub](https://github.com/debops/ansible-pki), new code is also [available on Ansible Galaxy](https://galaxy.ansible.com/debops/pki/), there's also [excellent documentation](http://docs.debops.org/en/latest/ansible/roles/ansible-pki/docs/). Check it out :-)
",drybjed,2016-03-06 16:04:36
426,2016-02-14 11:58:54,"An update from me.  I've gotten good feedback on the drafts of LE support I submitted.  There's agreement to support LE on the jessie branch, so I have LE support on the back burner while we work to get the jessie branch stable.  (Getting closer!)

I used a draft PR to base what I am doing on my own server (wheezy).  It's working fine, and it was nice to avoid paying to re-up my certificate.  I'm glad to be getting stick time with LE before we officially support it.
",mikeashley,2016-03-06 16:04:36
426,2016-02-14 16:19:42,"Thanks for your work on this! Really looking forward to seeing it in the Jessie branch. (Kind of holding off on my own sovereign deployment until that happens, actually.) If you can point me to a branch or PR that you think is basically ready, I'd give it a try. 
",carljm,2016-03-06 16:04:36
426,2016-03-06 08:55:46,"I am also very interested in LE support and ready to try it out as i am setting up a new server with sovereign. 
",hpk42,2016-03-06 16:04:36
426,2016-03-06 16:04:36,"I'll close this since #504 addresses it.
",ariddell,2016-03-06 16:04:36
425,2015-11-04 20:30:51,"I'm finding that my blog isn't accessible via http, only via https. The intended behaviour is to issue a redirect to https, as well as a `Strict-Transport-Security` to tell the browser to use https for subsequent requests to the hostname. I suspect this hid the issue from me for a long time.

To test your own site: `curl -v example.com`. Expected behaviour is to get a 301 redirect, but actual behaviour is a 403 Forbidden.

I've isolated the issue to the status vhost used for monitoring apache, originally added last year by @philandstuff. If I disable that vhost, it works as intended again.

I have a handful of other local modifications, so I'd appreciate it anyone else can try reproduce this issue. This could be the issue that @almereyda was describing in #250.
",lukecyca,2015-12-12 16:31:20
425,2015-11-05 10:50:37,"Interesting. Can you please run Apache in debug mode (parameter -X) and have a look at what's going on?
",neuhaus,2015-12-12 16:31:20
425,2015-11-07 05:24:35,"I found the solution at https://github.com/sovereign/sovereign/issues/360 fixed this particular issue.
",iboxifoo,2015-12-12 16:31:20
425,2015-12-10 10:03:07,"Does changing fqdn.conf to ""ServerName localhost"" also fix the issue for you, @lukecyca ?
",neuhaus,2015-12-12 16:31:20
425,2015-12-12 16:31:20,"This is indeed a duplicate of #360.
",lukecyca,2015-12-12 16:31:20
424,2015-11-03 21:44:49,"Thanks-to: https://github.com/mtpereira/ansible-common/commit/8e693b3db3b15c440428f378e13ce8d04186d637

cf https://github.com/sovereign/sovereign/pull/422
",spk,2015-11-09 07:50:37
424,2015-11-05 10:57:49,"Looks good to me but I don't have time to test it
",neuhaus,2015-11-09 07:50:37
424,2015-11-09 07:50:33,"This looks good. Thanks!
",ariddell,2015-11-09 07:50:37
423,2015-10-30 23:10:05,"I ran a check on http://mail-tester.com and found out I was missing a header to be set for DMARC. SInce I missed it, maybe someone else missed it as well, so maybe it could go into the README.
",pjaspers,2015-11-05 15:48:33
423,2015-11-05 15:48:29,"This looks good to me.
",ariddell,2015-11-05 15:48:33
422,2015-10-30 16:29:21,"Hi, Just removing `shell` to `copy` with `content` option that IMHO is cleaner.
Cheers
",spk,2015-11-03 02:12:09
422,2015-11-03 02:12:09,"But not idempotent
",spk,2015-11-03 02:12:09
422,2015-11-03 20:03:11,"@spk May I ask in what case this would break? Trying to learn more about ansible and your patch looks fine to me.
",nodiscc,2015-11-03 02:12:09
422,2015-11-03 21:31:12,"Hi @nodiscc, it does not break anything but even if this not changed the `dest` ansible will see as changed every time we play the playbook, it should be idempotent if not change has been made.
Maybe there is a solution on the Internet
",spk,2015-11-03 02:12:09
422,2015-11-03 21:33:52,"Yes https://github.com/mtpereira/ansible-common/blob/8e693b3db3b15c440428f378e13ce8d04186d637/tasks/timezone-debian.yml
",spk,2015-11-03 02:12:09
422,2015-11-03 21:47:57,"@nodiscc I've submitted another PR, thanks for the question it help me to fix the problem!
",spk,2015-11-03 02:12:09
421,2015-10-29 14:47:15,"Hey folks

I was just going to write this on the wiki but I noticed that we don't have permissions.

For people who want to setup sftp for people to access their www folder you will need to disable the google authentication. Otherwise, programs like Filezilla won't cooperate and you will not be allowed access unless you setup a google authentication file.

Sooo... 
# Modify your PAM configuration

`sudo /etc/pam.d/sshd`
change `auth required pam_google_authenticator.so` by adding the `nullok` at the end

Essentially, this tells the google authenticator to allow the login so that someone can setup google authentication.

Ref: https://github.com/google/google-authenticator/blob/master/libpam/README.md
",shaneonabike,2016-05-21 10:12:57
421,2016-03-14 09:08:59,"I think it's a great idea to use the wiki to document some different uses of sovereign, especially multiuser deploys.  Are you still having trouble creating wiki pages?
",mikeashley,2016-05-21 10:12:57
421,2016-03-14 14:34:27,"Perhaps there should be a variable which one can set to false somewhere (or perhaps the default should be to disable google authenticator?)
",ariddell,2016-05-21 10:12:57
421,2016-05-21 10:12:57,"This discussion seems to have run its course.  I am going to go ahead and close this issue.
",mikeashley,2016-05-21 10:12:57
420,2015-10-29 08:56:37,"It'd be great to have a meeting of developers and users of this project at [FOSDEM 2016](https://fosdem.org/2016/) in Brussels, Belgium.
Please comment on this issue if you plan to be there.
We can try to get a room for the meeting if enough people sign up here.
",neuhaus,2016-01-31 07:07:35
420,2016-01-15 13:39:56,"I planned on being there but it is a 50:50 chance i won't be able to make it this year. If anyone stays around for CfgMgmtCamp afterwards I'd be up for a meet though
",fengor,2016-01-31 07:07:35
420,2016-01-16 12:23:11,"I will be at FOSDEM 2016 and I'm interested
",spk,2016-01-31 07:07:35
420,2016-01-16 12:58:15,"Great! I've contacted the organizers and asked if we can have a room for an hour or so. We can discuss sovereign, the direction it is taking and also answer questions for people who are new to the project.
If we can't get a room, I suggest we just meet at the Beer event on Friday night at the Delirium caf√©.
",neuhaus,2016-01-31 07:07:35
420,2016-01-16 15:28:43,"The FOSDEM organizers replied: We can get a BoF room by reserving it at the event itself on Saturday morning.
",neuhaus,2016-01-31 07:07:35
420,2016-01-30 10:17:52,"I reserved the BoF room at FOSDEM for us for today, Saturday 18:00-18:30. 
See you there!
",neuhaus,2016-01-31 07:07:35
420,2016-01-30 10:20:14,"The room no. is H.3228
",neuhaus,2016-01-31 07:07:35
419,2015-10-27 14:10:59,"These patches where necessary to provision a Jessie image with Vagrant without error
",rokaz,2015-10-27 17:10:22
419,2015-10-27 17:10:20,"Thanks!
",jplock,2015-10-27 17:10:22
418,2015-10-22 20:27:11,"Does Sovereign provide a command line tool to manage email accounts? Otherwise, if not, is it possible to run an web admin on top of it without compromising the installed setup?

Thank you!
",libnull,2015-10-26 14:04:03
418,2015-10-23 09:31:20,"There's no command-line tool to manage email accounts. You have to edit the `user.yml` file.
",ariddell,2015-10-26 14:04:03
418,2015-10-25 06:59:25,"I am successfully using http://www.vimbadmin.net to manage quite a few accounts and domains on a server that uses the same stack as sovereign. Sadly at the moment I wouldn't have any time to compile my own Ansible playbooks into a format that would work with this distribution (they are quite customized to my setup and not very modular).
",florianbeer,2015-10-26 14:04:03
418,2015-10-26 14:03:31,"Thank you both for the reply!

@florianbeer I will give Vimbadmin a try.
",libnull,2015-10-26 14:04:03
418,2015-12-10 10:11:00,"@libnull  How did it go with vimbadmin?
You can also try [VEA](https://github.com/neuhaus/vea) as long as you make sure it resides in a password protected area and is only accessible by trusted users.
",neuhaus,2015-10-26 14:04:03
417,2015-09-30 13:44:42,"I am on a Debian 7 Wheezy 64bit KVM VM on Proxmox. I followed the exact steps from the Readme.
While running the Playbook I get following error:

<S_CODE_TOKEN>

When I run the playbook again, it doesn't fail at that point, but doesn't create the database.
I get the error ""DATABASE ERROR: CONNECTION FAILED!"", when I try to connect to Roundcube.

/var/log/postgresql/postgresql-9.1-main.log:
2015-09-30 13:19:26 UTC FATAL:  database ""roundcube"" does not exist

/var/log/roundcube/errors:
[30-Sep-2015 13:37:18 +0000]: DB Error: SQLSTATE[08006] [7] FATAL:  password authentication failed for user ""roundcube""
FATAL:  password authentication failed for user ""roundcube"" (GET /)
",m0rth1um,2016-09-12 00:34:06
417,2015-10-11 15:13:21,"I have the same problem. Debian 7 Wheezy 64 Bit KVM VM on another hoster.

EDIT: Re-running the playbook a second time somehow fixed it.
EDIT2: Running dpkg-reconfigure roundcube-core fixed the login problem. I accepted the local files.
",vlow,2016-09-12 00:34:06
417,2015-12-09 16:48:28,"I am having this issue on 64bit Wheezy VMs with both Linode and Digital Ocean.

<S_CODE_TOKEN>

I could not get the database working with `sudo dpkg-reconfigure roundcube-core` under the deploy user,
",KyleOndy,2016-09-12 00:34:06
417,2016-09-12 00:34:06,"This is addressed in the move to Debian 8.
",mikeashley,2016-09-12 00:34:06
416,2015-09-29 15:10:25,"because why the fuck not?
",rehwanne,2015-11-09 07:51:52
416,2015-09-29 18:30:48,"i mean: 
internal_hashed

<S_CODE_TOKEN>

internal_plain

<S_CODE_TOKEN>
",rehwanne,2015-11-09 07:51:52
416,2015-09-30 15:48:45,"This looks great. What clients don't support this SCRAM protocol? https://prosody.im/doc/plain_or_hashed
",ariddell,2015-11-09 07:51:52
416,2015-09-30 16:06:24,"Gajim and Pidgin both support it, and I dont know of a client that doesnt.
",rehwanne,2015-11-09 07:51:52
416,2015-11-03 19:42:12,"IMHO Clients that dont support SCRAM should not be used anyway.
",rehwanne,2015-11-09 07:51:52
416,2015-11-05 15:47:37,"I don't use prosody so I can't test this. Perhaps someone else is an XMPP user?
",ariddell,2015-11-09 07:51:52
416,2015-11-06 00:56:21,"I've always been using `internal_hashed` and it works fine with all clients I tested.
",nodiscc,2015-11-09 07:51:52
416,2015-11-09 07:51:43,"Great. Thanks for this.
",ariddell,2015-11-09 07:51:52
415,2015-09-27 15:40:46,"Not sure if this is the right place, but I'll leave it for discussion.

While I think sovereign is mostly targeted at single individuals/small groups that want to host their own mail server et.al there's a use case for people migrating a bigger (but not really big) mail setup of, say 10-20 imap accounts and a few dozen aliases.

While there are some basic instructions to migrate a single account, there's nothing about the bigger scale things, and especially testing the spam filtering beforehand.

Right now I do plan to migrate, so if I find out stuff, I plan to document that.
Then again this might already play into full-on sysadmin mode and might be out of scope.
",winks,2016-03-09 10:22:17
415,2015-10-30 10:35:02,"imapsync seems to be the most potent tool for migrating IMAP accounts.
I look forward to the documentation you plan to write.
",neuhaus,2016-03-09 10:22:17
415,2016-02-29 08:39:08,"Hi @winks, any updates on this?
",neuhaus,2016-03-09 10:22:17
415,2016-03-07 16:43:30,"Sorry, blew off the migration for time issues and don't have any immediate plans unless my mail server magically self-destructs.
",winks,2016-03-09 10:22:17
415,2016-03-09 10:22:16,"OK, I'll close it for now. Feel free to reopen it later on.
",neuhaus,2016-03-09 10:22:17
414,2015-09-22 20:50:26,"Most roles are non-specific to their specific package being installed (e.g. `ircbouncer`, `blog` or `vpn`) but some are named like the software package they are using:
- `owncloud`
- `tarsnap`
- `newebe`

Those should probably be called `filehosting`, `backup` and `socialnetwork` or something.

Addendum: owncloud is used for CalDAV, CardDAV and as filehosting, so maybe this needs to stay.
",winks,2016-05-21 17:02:25
414,2015-09-24 13:38:33,"Perhaps we should just use the package names across the project?
",al3x,2016-05-21 17:02:25
414,2015-09-24 14:04:16,"I've spent a lot of time working with puppet and the usual best practice is to have roles, profiles and components (more on this [here, for example](http://garylarizza.com/blog/2014/02/17/puppet-workflow-part-2/)

While this is overblown for this project (as it's not a whole infrastructure set of boxes) I think the idea of 'Profiles: technology-specific wrapper classes' and 'Roles: business-specific wrapper classes' is a good one, for example calling the role (ansible role now) `webserver` and not `apache`.

But this is nitpicking, and 'use package names' in this scope is perfectly fine as well, it should just be consistent :)
",winks,2016-05-21 17:02:25
414,2015-09-24 18:27:59,"Hello, I am currently working on adding roles to sovereign (mostly web applications) and have come to the following conclusion: roles should be named after the software's name, in case there are several available alternatives for a particular role (eg. `mediawiki` and `dokuwiki`). An alias/default as the generic role name (eg. `wiki` defaults to `dokuwiki`) would also be welcome - I am very new to ansible and don't know if this is possible.
",nodiscc,2016-05-21 17:02:25
414,2015-09-25 12:04:34,"I've seen people using the software/package name for the role name, e.g., https://github.com/CenterForOpenScience/cos-ansible-base/tree/master/roles

I'm still not sure about what the recommended approach is for dealing with ""hard"" interdependencies -- when two roles are interdependent, such as when one piece of software needs to modify another piece of software's config in some non-trivial way (apache makes this easy with conf.d directories but it's not always the case).
",ariddell,2016-05-21 17:02:25
414,2015-09-27 12:08:19,"I concur with @nodiscc - if we name the roles after the software, it makes it easier to manage several alternatives.
",neuhaus,2016-05-21 17:02:25
414,2015-09-27 14:53:53,"I like this idea
",jplock,2016-05-21 17:02:25
414,2015-09-27 15:33:09,"OK, so as people seem to agree on a naming scheme, the question is how to this in a non-breaking way.
I guess if you just cloned the repo and commented out some things in `site.yml` you're fine as long as you make sure to comment stuff that had been renamed as well. I think this would apply to most of the people using it.
",winks,2016-05-21 17:02:25
414,2015-09-27 15:52:32,"Could we just start with new role names in `jessie`? I'm anticipating backing up the /encrypted directory and doing a fresh install.
",ariddell,2016-05-21 17:02:25
414,2015-09-27 19:37:59,"I agree with @ariddell in that we should just update the `jessie` branch to the latest as that will eventually be merged into `master`.
",jplock,2016-05-21 17:02:25
414,2016-05-21 17:02:25,"Although I did not change existing module names, I did add guidance to `CONTRIBUTING.md` on the jessie branch.  See commit 37a85a8debf9dcfc8f9b53a08477f53e9eb9f907.
",mikeashley,2016-05-21 17:02:25
413,2015-09-22 20:43:18,,winks,2015-09-22 23:46:23
413,2015-09-22 23:46:19,"Thanks!
",jplock,2015-09-22 23:46:23
412,2015-09-21 19:38:19,"Honestly, I cannot wait until Let's Encrypted releases their public keys for everyone life is going to be so much easier for everyone.

But until then... I seem to be having an issue I was wondering if I could get some help on.

Specifically, I signed my own keys and now for some reason both dovecot and postfix are not happy campers.

dovecot: Error: service(imap-login): command startup failed
postfix/smtpd : warning: cannot get RSA priate key from file

Sep 21 19:31:55 localhost postfix/smtpd[10619]: warning: TLS library problem: error:0B080074:x509 certificate routines:X509_check_private_key:key values mismatch:x509_cmp.c:330:

I read that this can be an issue relating to self-signed because they do no include 'localhost' and therefore are not working properly. Should I be modifying something to make this work? I cannot get my Roundcube or Thunderbird to connect....
",shaneonabike,2015-09-24 13:38:56
412,2015-09-21 19:49:57,"Heya - I got this issue a few weeks ago when I changed up my certificates and keys. In the end, it turned out to be because the following line in common/roles/security.yml doesn't know it needs to update the combined wildcard_combined.pem file:
- name: Create a combined version of the public cert with intermediate and root CAs
  shell: cat /etc/ssl/certs/wildcard_public_cert.crt /etc/ssl/certs/wildcard_ca.pem >
    /etc/ssl/certs/wildcard_combined.pem creates=/etc/ssl/certs/wildcard_combined.pem

I corrected by manually deleting wildcard_combined.pem from the server and re-running. And then completely forgot to raise a bug report for it. Oops.
",MisterWS,2015-09-24 13:38:56
412,2015-09-21 21:00:19,"BAM! Genius.. I have yet to check if this combine certificate exists elsewhere but that was my problem!
",shaneonabike,2015-09-24 13:38:56
411,2015-09-18 02:01:54,"The open-source version of the Google Authenticator Android App is abandoned; Google is not incorporating upstream changes https://github.com/google/google-authenticator-android

Is this an issue for people? Is there something better on the horizon?
",ariddell,2015-09-18 11:49:13
411,2015-09-18 03:46:08,"There is [FreeOTP](https://fedorahosted.org/freeotp/)
",vchuravy,2015-09-18 11:49:13
411,2015-09-18 11:49:10,"To be honest, what really bothers me is that there's no way to turn it
off completely since it's nested inside roles/common and roles/vpn.  It
seems like it should have its own role.

I realize interdependencies among roles is not easy to manage with
ansible.

I'll close this for now. I suppose maintaining a
google-authenticator-free fork isn't much work at all.

On 09/17, Valentin Churavy wrote:

> There is [FreeOTP](https://fedorahosted.org/freeotp/)
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/sovereign/sovereign/issues/411#issuecomment-141335571
",ariddell,2015-09-18 11:49:13
410,2015-09-11 15:22:21,"Hey

Thanks for adding the openDMARC technology into sovereign. I noticed that it uses mysql, but in the install scripts this isn't being installed. 

= OS =
Ubuntu 14.04

= Problem =

<code>
msg: unable to connect to database, check login_user and login_password are correct or ~/.my.cnf has the credentials

FATAL: all hosts have already failed -- aborting
</code>

= Solution =
I had to manually install the mysql-server in order for everything to be hunky doory...

Then I placed the proper information in my .my.cnf file since I modified the root password for mysql.
",shaneonabike,2015-09-20 00:51:30
409,2015-09-08 00:51:00,"This fixes #375.

It turns out that everything was already set up and the only work was to tell postfix to use lmtp instead of lda. Tested on Debian 7.

Please review.
",miloshadzic,2015-09-20 00:45:16
408,2015-08-19 11:34:11,"Are there good arguments in favor of creating a `deploy` user? Why not eliminate the step and leave it up to the user? In looking at other mature projects using ansible I don't see many that go the route taken by sovereign. Eliminating the step seems like a useful (if minor) simplification.

If you do happen to have a deploy user, then running a playbook with it should be as simple as

<S_CODE_TOKEN>

I suppose if there's interest in this I'd create a PR against the jessie branch.
",ariddell,2015-08-21 02:34:12
408,2015-08-19 23:11:38,"I guess a potential argument in favour is not using root by default (as many people would). Even though this project isn't the easiest thing in the world to run yourself, there would still be plenty of people who would just clone the repo and blindly run as root.

Potentially a nod / initial inspiration from here?
http://plusbryan.com/my-first-5-minutes-on-a-server-or-essential-security-for-linux-servers

I'm not too sold on that idea. I agree with giving the user the option to select the remote user they want - as of right now it requires too many modifications.
",nicbarker,2015-08-21 02:34:12
408,2015-08-20 00:52:03,"I'm curious about the pros and cons here. It did surprise me that on installation (non-cloud) Debian 8 does seem to default to having you create a root user and password whereas Ubuntu basically makes you use sudo.

I certainly think turning off root password login is a good idea. And adding the main user to sudoers also seems like a good idea. At that point, however, why not just use that main user to login and do deployment? (main user is added here: https://github.com/sovereign/sovereign/blob/5f192bd5bbc2ab4436a44d9f3e465867ddeb3bca/roles/common/templates/sudoers.j2)
",ariddell,2015-08-21 02:34:12
408,2015-08-20 00:59:55,"That sounds like a sensible idea. I think this stems from the situation that modern VPS hosting companies like Linode and Digital ocean are creating. Their vanilla, non-configured VPS instance usually has you log in to root via auto generated password, or to root via pub key.

Most people just roll with the default configuration and log in / install everything as root, and as a result get into a permissions mess where it's just easier for them to stay as root indefinitely. Not exactly a wonderful situation from a security perspective!
",nicbarker,2015-08-21 02:34:12
408,2015-08-20 01:35:42,"Please keep the ""deploy"" account.  It is a good practice and teaches
enterprise-type methods.

Without it, either root or a personal ID will become the default. In a
business environment, that personal ID will be all over the place and
tied to the business environment indefinitely; even after that admin has
left.

On 08/19/2015 09:00 PM, Nic Barker wrote:

> That sounds like a sensible idea. I think this stems from the situation that modern VPS hosting companies like Linode and Digital ocean are creating. Their vanilla, non-configured VPS instance usually has you log in to root via auto generated password, or to root via pub key.
> 
> Most people just roll with the default configuration and log in / install everything as root, and as a result get into a permissions mess where it's just easier for them to stay as root indefinitely. Not exactly a wonderful situation from a security perspective!
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/sovereign/sovereign/issues/408#issuecomment-132840433
",TheFu,2015-08-21 02:34:12
408,2015-08-20 06:50:09,"@TheFu I believe that @ariddell is not suggesting that the playbooks should default to the root user, but simply that rather than enforce the usage of a user called ""deploy"", you should be able to choose which non privileged user you want.
",nicbarker,2015-08-21 02:34:12
408,2015-08-20 12:32:16,"Right, I think the question is this: should using `deploy` be a
requirement (as it is now) or a strong recommendation?
Also -- how insecure _is_ the default Digital Ocean setup (and the one
enforced by sovereign, IIRC)? You have a root login but it's ssh public
key only.  Surely if someone compromises _your ssh key_ figuring out the
username you're using to login is pretty trivial, right? Or am I missing
something?

On 08/19, Nic Barker wrote:

> @TheFu I believe that @ariddell is not suggesting that the playbooks should default to the root user, but simply that rather than enforce the usage of a user called ""deploy"", you should be able to choose which non privileged user you want.
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/sovereign/sovereign/issues/408#issuecomment-132909955
",ariddell,2015-08-21 02:34:12
408,2015-08-20 23:01:31,"(Disclaimer: I'm a bit of a security nut)
So when I set up a new VPS these days the configuration I usually end up going with is:
- Disable ssh access to the root user (only way to actually use root is to `sudo su root`)
- Create a new non privileged user called ""deploy"" or something that has sudo access via an arbitrarily long password
- Install things using this user

There are two main security reasons why I do this:
- If your key does get compromised in some way, the attacker will only have non privileged access to the server, and will still have to break your password in order to get root access.
- It's too easy and tempting to install software as root if you ssh in as root (a lot of people do). If the attacker manages to get arbitrary code execution through an exploit in one of your services, they aren't able to do nearly as much damage if the service is running as a non privileged user.
",nicbarker,2015-08-21 02:34:12
408,2015-08-21 02:34:12,"I think this is probably the way to go. I gather you invoke `ansible-playbook` with `-K` so you have to enter the sudo password, right?

The current README encourages passwordless sudo. I think root with public key login isn't much different from passwordless sudo with a non-root public key login. 

As the `deploy` user doesn't seem to be bothering anyone else, I'll close this.
",ariddell,2015-08-21 02:34:12
407,2015-08-17 13:38:57,"Yesterday trying to upgrade Sovereign on my debian 7 VPS along few issues, I got problem install opendmarc. I fixed it with changes in this PR.
- fix mail_db_opendmarc_username/mail_db_opendmarc_password variable  not found.
- python-mysqldb package is required. Add it to opendmarc task.
",hippich,2015-09-20 00:46:04
407,2015-09-08 01:06:30,"Hm, did not realize it. Somehow after merging latest branch I did not get these in default.yml.. I guess this should be closed then. Thanks for looking into it!
",hippich,2015-09-20 00:46:04
407,2015-09-08 01:09:15,"@hippich no need to close it IMHO. There are still issues with OpenDMARC and your PR fixes at least one(the missing python-mysqldb package required by ansible).
",miloshadzic,2015-09-20 00:46:04
407,2015-09-08 20:27:47,"See also #397 
",mccutchen,2015-09-20 00:46:04
407,2015-09-09 15:46:49,"@mccutchen I saw it. I actually tried to rework OpenDMARC for postgres but it's too much work.
",miloshadzic,2015-09-20 00:46:04
406,2015-08-16 15:57:03,"It appears that debian wheezy has apache 2.2.x in their repositories and SSLUseStapling option as available starting 2.4.x.
",hippich,2015-11-24 14:41:35
406,2015-08-18 09:49:02,"Confirmed. For now, please upgrade to Apache 2.4 (from backports) or remove that option.
",neuhaus,2015-11-24 14:41:35
406,2015-09-13 14:31:11,"I added a wiki page for this to help people out. Maybe we could add something to the README also just to flag this or at least tell people to head to the [wiki](https://github.com/sovereign/sovereign/wiki/Apache-Stapling-%28Compatibility-only-with-Apache-2.4%29) if they are having issues. 

@hippich do you think you could provide more info on the wiki if people want to upgrade their apache. I want to do that but was curious as to whether I needed to upgrade my PHP also. I suspect not right?
",shaneonabike,2015-11-24 14:41:35
406,2015-09-13 20:06:45,"@shaneonabike, i just removed SSLUseStapling from my configs.
",hippich,2015-11-24 14:41:35
406,2015-11-06 21:34:39,"It seems that based on this [page](https://www.digitalocean.com/community/tutorials/how-to-configure-ocsp-stapling-on-apache-and-nginx) we need to have an SSLStaplingCache:

   SSLStaplingCache shmcb:/tmp/stapling_cache(128000)

and this needs to be defined outside  `<VirtualHost></VirtualHost>` so it can't go in the existing ssl.conf includes. A conf-available/ssl-stapling-cache.conf file ((a2enconf enabled) worked for me (although the actual stapling fails due to the self-signed cert in the vagrant box).
",sread,2015-11-24 14:41:35
406,2015-11-18 11:53:26,"What @sread said. I run into this issue also. @al3x what is the proposed sollution for jessie? I can send a PR.
",danmilon,2015-11-24 14:41:35
406,2015-11-18 12:21:05,"Debian Jessie comes with Apache 2.4 so SSLUseStapling works there.
We should remove it for Debian 7 because it breaks the default.
",neuhaus,2015-11-24 14:41:35
406,2015-11-18 12:24:37,"Wait, isn't this already fixed since July 16th in commit 1be1afe?

It explicitly checks for wheezy:

<S_CODE_TOKEN>

Please clarify otherwise I will consider this issue to be fixed.
",neuhaus,2015-11-24 14:41:35
406,2015-11-18 16:27:30,"I believe there are two problems: 
1. Apache < 2.3.3 (fixed as you say)
2. Lack of defined SSLStaplingCache causes apache to fail to start

The confusion is due to my mistake of hijacking the bug (same result, different cause)
",sread,2015-11-24 14:41:35
406,2015-11-24 13:46:53,"Thanks @danmilon, have you tested it on wheezy and something else?
",neuhaus,2015-11-24 14:41:35
406,2015-11-24 14:01:15,"Jessie only. But the added tasks dont interfere with wheezy so it shouldn't be affected. 
",danmilon,2015-11-24 14:41:35
406,2015-11-24 14:08:43,"The thing is it's wheezy that's broken so I'd like someone with wheezy to give it a quick test before I merge it.
",neuhaus,2015-11-24 14:41:35
406,2015-11-24 14:15:51,"Well, with wheezy no ssl stapling is configured at all currently.
Previously wheezy was broken because ssl stapling was added in apache 2.4. but 1be1afe fixed that.
And jessie was broken because the ssl stapling was not fully configured (missing ssl stapling cache directive).

Currently ssl stapling is properly configured on jessie (tested)
and it is omitted on wheezy.

BTW I dont see backport of apache for wheezy.

Anyway, someone on wheezy can test whether apache is broken, incl. #430.
",danmilon,2015-11-24 14:41:35
406,2015-11-24 14:44:06,"Thanks all!
",neuhaus,2015-11-24 14:41:35
405,2015-07-30 23:26:53,"Fix and added on travis
",spk,2015-07-31 15:57:57
405,2015-07-31 15:57:58,"Thanks. Good to know about ansible-lint.
",ariddell,2015-07-31 15:57:57
405,2015-07-31 16:04:45,":sparkles: 
",spk,2015-07-31 15:57:57
404,2015-07-30 20:40:53,"Please add https://github.com/trustedsec/artillery to complement fail2ban on all hosts. Admittedly it is sort of redundant to fail2ban but it contains a useful blacklist of attack nodes and obfuscates hosts actively used ports.

Tor support: I would love to see an optional runtime flag for making all (or partial) services accessible via a HiddenServer at build time.

SSH hardening see https://github.com/hardening-io/chef-ssh-hardening for an example of the right way to do it. I don't know of any existing ansible playbooks for this.
",Andrew415,2016-02-29 08:38:21
404,2015-07-30 21:30:50,"https://github.com/hardening-io/ansible-ssh-hardening
",spk,2016-02-29 08:38:21
404,2015-08-09 02:26:24,"When writing enhancement request (or bug reports), please put only one issue/request in one bug report.
",neuhaus,2016-02-29 08:38:21
404,2016-02-29 08:38:21,"Need separate issues for this or they'll never get tackled.
",neuhaus,2016-02-29 08:38:21
403,2015-07-30 18:58:53,"Report will print: ""missing whois program""
",spk,2015-09-20 00:45:31
402,2015-07-28 01:03:36,"roles/mailserver/templates/etc_opendkim_TrustedHosts.j2

Should probably use {{ mail_server_hostname }} rather than mail.{{ domain }}
",drewscott,2015-09-20 00:53:28
402,2015-07-28 03:28:16,"also in vars/defaults.yml
webmail_domain: ""{{ mail_server_hostname }}""

This would then just allow a user to specify the mail subdomain in one place ie mail_server_hostname: ""emailsubdomain.{{ domain }}""
",drewscott,2015-09-20 00:53:28
401,2015-07-27 12:37:23,"Since I need to use openvpn for another project, I thought I'd get started on this one. I think most of the needed changes are just systemd related (e.g., starting dnsmasq needs to be handled by systemd)

One thing I'm not sure about is where the openvpn firewall rules should be put. Is `/etc/rc.local` the place for them? Would putting them in `/etc/ufw/before.rules` make more sense? @jlund

For reference, this is the current rc.local

<S_CODE_TOKEN>
",ariddell,2017-02-06 17:42:32
401,2015-08-19 16:14:27,"Not sure if you're still working on this, @ariddell, but yes, `/etc/ufw/before.rules` is where I'd put the iptables rules. See here for an example: https://github.com/conorsch/ansible-digitalocean-vpn/blob/master/configure-server/files/ufw_before.rules
",conorsch,2017-02-06 17:42:32
401,2015-09-12 23:27:31,"Hi @conorsch, where does forwarding get enabled in your setup (e.g., the `iptables -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT` line above) ? Any ideas about why dnsmasq is being restarted in the current sovereign setup (see above)?

---

Actually, this is the real question: @conorsch, doesn't your setup need the REJECT rule that's in the current setup? Otherwise you're allowing packet forwarding generally, right?
",ariddell,2017-02-06 17:42:32
401,2015-09-14 17:59:06,"@ariddell The forwarding gets enabled here: https://github.com/conorsch/ansible-digitalocean-vpn/blob/master/configure-server/tasks/ufw.yml#L21 You're right that the role allows general forwarding of packets‚Äîthat's a lazy hack, and precisely why I'm interested in getting a more stable and reusable role working as part of sovereign, so I can borrow it. =) 

Regarding the dnsmasq service restart, I haven't tested my role thoroughly for leakage, so let's test further before removing.
",conorsch,2017-02-06 17:42:32
401,2017-02-06 13:29:44,"I suggest we close this issue until we have a PR, what do you think?",neuhaus,2017-02-06 17:42:32
401,2017-02-06 18:34:52,"@neuhaus @ariddell Consider this for inclusion: https://github.com/Stouts/Stouts.openvpn

It seems the pragma for sovereign is to commit roles directly to version control, rather than use submodules or galaxy requirements, so it may not be trivial to incorporate. That said, if it saves you any time writing custom openvpn logic, have at it!",conorsch,2017-02-06 17:42:32
400,2015-07-22 23:54:53,"I've got OpenDMARC up and running; I'm not really sure if it's running properly though; certainly _some_ emails have not been getting received.

I've also noticed that when I enter a TXT record in my DNS my SMTP stops working, but only when I'm using a mail client. Roundcube still seems to send emails okay. When I remove the TXT record mail client's SMTP works again.

The TXT record i used is the simplest available:

`v=DMARC1; p=none`

Guess I'm asking for some guidance on validating an OpenDMARC setup and if the TXT record is necessary for DMARC to function properly. Any help would be gladly received.
",iboxifoo,2015-09-20 01:01:17
400,2015-07-25 22:22:07,"It looks as though the culprit was ownership & permissions on the `/var/run/opendmarc/opendmarc.dat` file. This was resulting in this common error every time OpenDMARC was processing anything:

`/var/run/opendmarc/opendmarc.dat: fopen(): Permission denied`

Doing a `chown` to the opendmarc user and group instead of root removes this error and all messages are now being processed. Looks as though this also solves the issue I was having with SMTP too.

(It's the `etc_opendmarc_report.sh.j2` file for the cronjob run once a day which resets the permissions to root.)
",iboxifoo,2015-09-20 01:01:17
399,2015-07-18 13:22:47,"See https://bettercrypto.org/
Related to #373.

Affected:
- Apache (Only TLS 1.2? Other enhancements ‚Ä¶)
- OpenVPN (stronger RSA keys?)
",ypid,2015-12-10 10:59:49
399,2015-12-10 10:59:49,"This is an important topic, but to increase the chance of stuff getting done, please split it up into smaller issues, one per role.

This issue just refers to an ever-changing website and is too vague.
",neuhaus,2015-12-10 10:59:49
399,2015-12-10 11:26:35,"@neuhaus This was just something I noticed. I personally prefer how the DebOps project does things so I am not using sovereign. I opened issues for Apache and Postfix.
",ypid,2015-12-10 10:59:49
398,2015-07-18 12:40:21,"See https://github.com/jchaney/owncloud/pull/12
",ypid,2016-09-16 12:46:31
398,2016-05-21 09:58:37,"Currently they are downloaded when the role runs.  The suggestion is to download them, do whatever it takes to believe they are correct, and then include them directly in the role.  This avoids automatically trusting the keys in the event the owncloud site is hacked, etc.
",mikeashley,2016-09-16 12:46:31
398,2016-05-21 16:58:38,"The [apt_key](https://docs.ansible.com/ansible/apt_key_module.html) might also come in handy: https://github.com/debops/ansible-owncloud/blob/370d90ebd6b6bc96be72cc0a8bb497f3f3759795/tasks/main.yml#L3-L7
",ypid,2016-09-16 12:46:31
398,2016-09-16 12:46:31,"This is fixed with the changes that happened in the move to Debian 8.
",mikeashley,2016-09-16 12:46:31
398,2016-09-16 13:29:43,"Hm, you mean [that apt_key task](https://github.com/sovereign/sovereign/blob/master/roles/owncloud/tasks/owncloud.yml#L20)? Please refer to https://github.com/nextcloud/vm/issues/11 (and excuse my harsh tone in that issue)
In short: Please enforce OpenPGP pubkey fingerprints. Ideally sovereign would have a Code signing policy like DebOps for example ([ref](https://docs.debops.org/en/latest/debops-policy/docs/code-signing-policy.html)).

Ref: https://github.com/debops/ansible-owncloud/blob/bec00dfb5a56fe472e7d87aec900a864daad19c2/tasks/system_package_management.yml#L20
",ypid,2016-09-16 12:46:31
398,2016-09-16 22:03:51,"Appreciate the pushback.  I dug a little deeper and was surprised to see that the owncloud key is signed by the organization's build server key, and the signature path stops there.  It's true that if their infrastructure is compromised, they could upload new code, a new key, and nobody would be the wiser.

Unfortunately, I don't see a good way to validate their key.  A quick google for the key hashes didn't turn up anything.  We could download their key, but that would only tell us of a future key change.  Then, we wouldn't know if that's an intended key rotation or compromised infrastructure.

To me, this just adds support for dropping OwnCloud.
",mikeashley,2016-09-16 12:46:31
398,2016-09-17 07:16:52,"Thanks for the feedback.

> We could download their key, but that would only tell us of a future key change.

That would be something I think :wink: If that happens you could start to investigate.

> To me, this just adds support for dropping OwnCloud.

[Agreed](https://github.com/debops/ansible-owncloud/issues/45) :wink:
",ypid,2016-09-16 12:46:31
397,2015-07-16 16:15:47,"When setting up a sovereign dev VM for the first time, I ran into a problem with some missing dependencies and a missing var for the OpenDMARC setup.

These changes allowed the VM to finish provisioning successfully, but I have not yet gotten as far as, you know, verifying that OpenDMARC is working as expected.  Any advice on how best to do that would be appreciated!
",mccutchen,2015-09-20 00:46:42
397,2015-07-16 16:31:21,"Will OpenDMARC work with postgres as that's what we're installing by default?
",jplock,2015-09-20 00:46:42
397,2015-07-16 16:44:28,"@jplock I think that's theoretically possible, given its dependency on OpenDBX (from [the docs](http://www.trusteddomain.org/opendmarc/README)):

> To compile and operate, this package requires the following:
> - OpenDBX (http://www.linuxnetworks.de/doc/index.php/OpenDBX) which acts as a middleware layer between OpenDMARC and your SQL backend of choice

But the schema and OpenDMARC config that's already committed in this repo assume MySQL and I couldn't find any useful info on using Postgres instead.  [This unanswered question on the mailing list](http://www.trusteddomain.org/pipermail/opendmarc-users/2013-October/000194.html) from 2013 is the only reference I could find, though maybe someone else around here has some expertise and/or better Google-fu than me!
",mccutchen,2015-09-20 00:46:42
397,2015-07-30 20:32:46,":+1: 
",sethetter,2015-09-20 00:46:42
397,2015-08-16 08:05:22,"+1, this branch fixes the OpenDMARC install process for me.
",nicbarker,2015-09-20 00:46:42
396,2015-07-16 00:35:45,"On wheezy, disable the apache SSL config changes related to stapling (introduced #389).

I also took the liberty of consolidating the repeated SSL configuration in a single include file, though I can back that out if that's an unwelcome change.  It's probably worth drawing your attention to the location I chose for this new SSL config:  `/etc/apache2/ssl.conf`

Some other obvious locations I considered:
- `/etc/apache2/conf.d/ssl.conf` ‚Äî¬†this won't work because anything in this directory apparently gets included by default in `httpd.conf`, and this leads to an invalid apache because of (I think) repeated `SSLEngine on` directives (I can dig up the specific error if that would be useful)
- `/etc/apache2/conf-available/ssl.conf` ‚Äî¬†on wheezy, the `conf-available` directory is present _after_ a new machine has been provisioned, but it's not present at the point where I'm writing this config file.  It would obviously be easy to add a task to create that directory, if that would be preferable!

This is my first brush w/ sovereign, and I ran into this issue and one more (for which I'll open another PR) while trying to play around with the dev VM.

I hope these changes are useful!
",mccutchen,2015-08-17 14:12:49
396,2015-08-17 14:12:31,"LGTM, thanks!
",jplock,2015-08-17 14:12:49
395,2015-07-05 20:27:21,"i forgot to switch repos, sorry.
",nootropics,2015-07-05 20:30:54
394,2015-06-30 13:25:22,"dspam is removed as of Debian 8: https://tracker.debian.org/pkg/dspam
Is there a good replacement?
",plotters,2016-03-14 09:11:12
394,2015-06-30 16:51:10,"That's a shame. Apparently it's not maintained upstream: https://tracker.debian.org/news/558416
",ariddell,2016-03-14 09:11:12
394,2015-06-30 18:38:35,"That's going to be a minor PITA to swap out. Guess it's SpamAssassin for us, or maybe [Anti-Spam SMPT Proxy](https://en.wikipedia.org/wiki/Anti-Spam_SMTP_Proxy)?
",al3x,2016-03-14 09:11:12
394,2015-07-01 06:41:47,"I found no packages for ASSP on Debian, let's pick something that has packages available and in the default distribution. Spamassassin is probably the most straightforward choice.
",neuhaus,2016-03-14 09:11:12
394,2015-07-02 12:04:15,"This is really bad! Dspam was working so well for me, now I'm much more on the fence about upgrading to Jessie :(
",florianbeer,2016-03-14 09:11:12
394,2015-07-18 22:15:47,"Any thoughts on this one:  https://www.rspamd.com/ ?
",plotters,2016-03-14 09:11:12
394,2015-07-18 23:18:56,"Looks like a really strong choice. Actively maintained, good feature list, Google Summer of Code support.
",al3x,2016-03-14 09:11:12
394,2015-09-24 13:37:24,"Just pushed [the beginnings of an Rspamd](https://github.com/sovereign/sovereign/commit/ecaa4c23308adbdb5d76937296090ca7a6cc5944) implementation in our `jessie` branch.

Still need the task to configure [Rmilter](https://rspamd.com/rmilter/) to be aware of [Rspamd](https://www.rspamd.com/doc/integration.html). Postfix configuration will pick up Rmilter and should ""just work"" from there.
",al3x,2016-03-14 09:11:12
394,2016-03-08 16:14:05,"I'm working on finishing this out, and ran into a question. Apparently rmilter also has DKIM signing and validation support (using OpenDKIM under the hood). Should I disable that in the rmilter config, and use rmilter only for rspamd, and continue using OpenDKIM's own milter? Or should we just let rmilter handle both, and reduce from three down to two milters? Any opinions?
",carljm,2016-03-14 09:11:12
394,2016-03-14 09:11:12,"We can close this since rspamd is integrated.  I created issue #529 to consider removing OpenDKIM's milter.
",mikeashley,2016-03-14 09:11:12
393,2015-06-23 20:41:14,"Hello,

I'm trying to create a ready-to-use cloud image on Scaleway.
My commit adds a tag 'deps' on all aptitude tasks, so I can easily run the non-dynamic tasks by calling something like: `ansible-playbook --tags=deps site.yml`.
Then, the user can edit `vars` and continue the installation with a lots of time saved.

I don't break the original tagging feature and if you call `ansible-playbook --tags=vpn` it will call all vpn tasks (deps and non-deps ones).
",moul,2015-06-25 00:17:01
393,2015-06-23 21:18:30,"Thanks so much, this is very useful. Before we merge, would you mind adding a quick explanation of how to use the `deps` tag to the `README.md`? Just want to make sure that other people see it and benefit from your work ‚ò∫Ô∏è
",al3x,2015-06-25 00:17:01
393,2015-06-24 15:14:10,"Done. Tell me if it's ok for you.
I should have a real example to show up soon.
",moul,2015-06-25 00:17:01
393,2015-06-24 16:01:10,"What about a slightly more verbose ""dependencies"" or ""depends""? 
",ariddell,2015-06-25 00:17:01
393,2015-06-24 16:43:52,":+1: for more verbose, I prefer ""dependencies""
",moul,2015-06-25 00:17:01
392,2015-06-22 15:32:42,"The ""Create encfs"" task uses printf to feed information to encfs. Unfortunately, it breaks when encfs_password contains a ""$"". Try this to see the problem:

<S_CODE_TOKEN>

Personally, I was able to work around it, but I thought you should know.
",jahabrewer,2015-07-01 21:41:56
391,2015-06-21 00:27:26,"For correct implementation of the fix for logjam attack (https://github.com/sovereign/sovereign/pull/372), state=latest is needed to grab sufficient version of Dovecot. If not then https://github.com/neuhaus/sovereign/commit/37aa7e2cb5eb5cf89eb521080c96cd4b8bf4248e doesn't work.
",iboxifoo,2015-06-22 13:00:33
391,2015-06-22 13:00:41,"Nice find, thanks.
",neuhaus,2015-06-22 13:00:33
390,2015-06-19 13:47:36,"After a server restart, all mails sent to my sovereign installation started to bounce back. This seemed to be due to postgrey not running. After changing POSTGREY_OPTS in /etc/default/postgrey from ""--inet=10023"" to ""--inet=127.0.0.1:10023"", it could be started again.

I am sure most of you have no reason to disable ipv6 and prefer to have postgrey and postfix interacting over ipv6 instead of ipv4. In my case, the default behaviour of using ipv6 caused troubles though. 
",simontretter,2015-07-01 21:42:59
390,2015-07-01 21:42:59,"Noted, thanks. Hopefully if this is an issue for anyone they'll find this issue and your fix.
",al3x,2015-07-01 21:42:59
389,2015-06-16 08:41:24,"See https://wiki.mozilla.org/Security/Server_Side_TLS for details.
Removes RC4 cipher. Fixes issue #341.
Also explicitly disabled SSLCompression and enables OCSP stapling.

We should put all these settings in
/etc/apache2/mods-enabled/ssl.conf
to avoid duplication...
",neuhaus,2015-06-16 18:57:43
389,2015-07-02 08:06:51,"OK, need to remove the stapling options then. I can't do it before Tuesday.
",neuhaus,2015-06-16 18:57:43
388,2015-06-13 21:24:05,"Apparently there is a security fix in version 1.7.2, sovereign still uses 1.7.1
The current version is 1.9.0

Someone needs to check if config changes are necessary...
",neuhaus,2015-09-20 01:07:59
388,2015-06-19 05:34:24,"I just tried wallabag_version: 1.7.2. No obvious problems so far.
",simontretter,2015-09-20 01:07:59
388,2015-06-19 06:42:21,"Thanks. Could you also try 1.9.0?
",neuhaus,2015-09-20 01:07:59
388,2015-06-19 07:11:34,"Same for 1.9.0, no obvious things going wrong. Note though that the actual git version number is 1.9 (not 1.9.0). 
",simontretter,2015-09-20 01:07:59
387,2015-06-13 14:55:36,"Currently, sovereign builds collectd 5.4.1 from source.

On Ubuntu Trusty and Debian Jessie we can use the official packages instead. They ship with collectd 5.4.0 and 5.4.1, respectively.
",neuhaus,2015-09-24 13:39:17
387,2015-06-13 16:14:01,"Also, I noticed that since August 2014 the collectd-librato plugin has been deprecated.
See https://github.com/librato/collectd-librato/blob/master/README.md
It should be replaced using the Collectd Write HTTP plugin, apparently.
I don't know anything about collectd and/or librato so preferably someone else should make this change.
",neuhaus,2015-09-24 13:39:17
387,2015-09-24 13:39:17,"This is done in the `jessie` branch.
",al3x,2015-09-24 13:39:17
386,2015-06-13 09:49:44,"Already present [here](https://github.com/sovereign/sovereign/blob/master/roles/common/tasks/main.yml#L31)
",spk,2015-06-13 10:09:59
386,2015-06-13 10:10:09,"Thanks.
",neuhaus,2015-06-13 10:09:59
386,2015-06-13 10:40:59,":beers: 
",spk,2015-06-13 10:09:59
385,2015-06-13 08:41:51,"Hello @al3x 

just wondering - why do you use the dhoppe boxes for the jessie branch instead of the box-cutter ones?
",neuhaus,2015-06-13 21:05:23
385,2015-06-13 21:05:18,"Because box-cutter didn't release boxes for Jessie final [onto Atlas](https://atlas.hashicorp.com/boxes/search?utf8=‚úì&sort=updated&q=box-cutter) until several days ago. We can move back to those if you like.
",al3x,2015-06-13 21:05:23
385,2015-06-13 21:39:30,"Sure, there's a box-cutter image for jessie 8.1 now.
",neuhaus,2015-06-13 21:05:23
384,2015-06-12 11:40:19,"Target System: Debian 7 x64
Ansible Version: 1.9.0.1

Output:

<S_CODE_TOKEN>

Link is valid. Any suggestions for a workaround?
",felixkiss,2015-06-13 09:30:06
384,2015-06-12 12:13:02,"Workaround for now: Download it manually, place it in `/root` and comment out `Download Google authenticator pam module` task
",felixkiss,2015-06-13 09:30:06
384,2015-06-13 08:52:54,"I just tested it here, works for me

<S_CODE_TOKEN>

Is it reproducible?
",neuhaus,2015-06-13 09:30:06
384,2015-06-13 09:30:06,"I changed my VPS to Ubuntu 14.04 and it worked fine as well. 

I don't know what caused the 403 but I'm closing the issue as not reproducible. 
",felixkiss,2015-06-13 09:30:06
383,2015-06-08 15:55:45,"I just want a simple mailserver so I comment everything except for common and mailserver. However it complains at Check for existing encfs and Create encfs. Both fail.
Is there no way to switch it off?
",hhirsch,2015-07-01 21:44:18
383,2015-06-08 23:22:30,"Please see #120
",lukecyca,2015-07-01 21:44:18
383,2015-06-09 05:28:10,"I see. So putting all my config files in a location where they clearly don't belong is considered a fix. There is no proper way to make it work with encfs?

TASK [common : Check for existing encfs] ****************************************
fatal: [xxxx]: FAILED! => {""changed"": false, ""end"": ""2015-06-09 05:26:10.145517"", ""stdout"": """", ""cmd"": ""ls /encrypted/_"", ""start"": ""2015-06-09 05:26:10.132995"", ""delta"": ""0:00:00.012522"", ""stderr"": ""ls: cannot access /encrypted/_: No such file or directory"", ""rc"": 2, ""invocation"": {""module_name"": ""command"", ""module_args"": {""_raw_params"": ""ls /encrypted/*"", ""_uses_shell"": true}}, ""stdout_lines"": [], ""warnings"": []}

TASK [common : Create encfs] ****************************************************
fatal: [xxxx]: FAILED! => {""changed"": true, ""end"": ""2015-06-09 05:26:14.001475"", ""stdout"": ""Error decoding volume key, password incorrect"", ""cmd"": ""printf \""p\nclear\"" | encfs /encrypted /decrypted --public --stdinpass && touch /decrypted/test"", ""start"": ""2015-06-09 05:26:10.994871"", ""delta"": ""0:00:03.006604"", ""stderr"": """", ""rc"": 1, ""invocation"": {""module_name"": ""command"", ""module_args"": {""_raw_params"": ""printf \""p\nclear\"" | encfs /encrypted /decrypted --public --stdinpass && touch /decrypted/test"", ""_uses_shell"": true}}, ""stdout_lines"": [""Error decoding volume key, password incorrect""], ""warnings"": []}
",hhirsch,2015-07-01 21:44:18
383,2015-06-09 05:46:56,"If you are wanting to disable encfs, then #120 is the quickest solution since all of the other configuration assumes those specific filesystem locations. Please understand that sovereign aims to be a one-size-fits-most personal cloud server including email, blog, irc, vpn, etc. If you require a more tailored solution you will have to do some customizing yourself. You are welcome to use our work as a starting point, of course.

If you are ok using encfs, but are asking why it is failing, then that is something we can help you with. If you've simply commented out all the roles in `site.yml` except `common` and `mailserver`, that _should_ work. It appears from the output you provided that you used `clear` as your encfs_password. Perhaps encfs requires a longer password.
",lukecyca,2015-07-01 21:44:18
383,2015-06-09 06:02:19,"I try that. Might as well use sovereign as it was intended. Very fast reply, thank you.
",hhirsch,2015-07-01 21:44:18
383,2015-06-09 06:09:57,"A longer password did not work. To be fair though. I did run the playbook once before I set the passwords for encfs. So that might have destroyed it.
",hhirsch,2015-07-01 21:44:18
383,2015-06-09 11:39:49,"What options do I have?
",hhirsch,2015-07-01 21:44:18
383,2015-06-09 16:37:03,"I'm not sure what is going on. Before I suggest blowing it all away and trying again, let's try a few things...

What distro/version are you running? What VPS service (if any)?

Can you try `rm -rf /decrypted /encrypted` and then running the playbook again?
",lukecyca,2015-07-01 21:44:18
383,2015-07-01 21:44:18,"Please reopen if this is still an issue. Default configuration of using encfs seems to work for most users.
",al3x,2015-07-01 21:44:18
382,2015-06-06 16:27:45,"TASK [common : Update apt cache] ************************************************
fatal: [172.22.22.9]: FAILED! => {""msg"": ""BECOME-SUCCESS-kzrnofpndwfopugwlqyrjlwohrmsvhaz\r\nTraceback (most recent call last):\r\n  File \""/home/deploy/.ansible/tmp/ansible-tmp-1433607390.18-22285734784911/apt\"", line 2085, in <module>\r\n    main()\r\n  File \""/home/deploy/.ansible/tmp/ansible-tmp-1433607390.18-22285734784911/apt\"", line 423, in main\r\n    cache.update()\r\n  File \""/usr/lib/python2.7/dist-packages/apt/cache.py\"", line 440, in update\r\n    raise FetchFailedException 

this goes on and on.
We use apt-cacher-ng.  If it is configured, the deb-mirror method doesn't work. Had to restore from a system backup to get it working again.

Ansible 2.0.0 - dev version (had v1.5, updated)
Ubuntu 14.04 server on both sides.
ssh connection is working.

Commented out the first stanza in roles/common/tasks/main.yml to get passed this issue. My ansible-fu isn't strong enough to check whether a proxy is configured for ansible or not. The setup is not standardized across debian/ubuntu servers.  This is mine:
$ more /etc/apt/apt.conf.d/02proxy 
Acquire::http { Proxy ""http://istar:3142""; };
",TheFu,2015-06-13 11:05:23
382,2015-06-13 08:57:30,"So do you think apt-cacher-ng is the culprit?
Does it work if you remove the proxy configuration?
",neuhaus,2015-06-13 11:05:23
382,2015-06-13 10:49:07,"Yes. It is a known issue in apt-cacher-ng.  
Downgraded to Ansible 1.9.x and attempted an install. It got further (but was stuck somewhere else).
",TheFu,2015-06-13 11:05:23
382,2015-06-13 11:05:23,"OK. Please get it fixed in apt-cacher-ng then. Thanks.
",neuhaus,2015-06-13 11:05:23
381,2015-06-05 08:28:24,,neuhaus,2015-06-05 14:55:23
381,2015-06-05 12:43:31,"LGTM, but unfortunately I can't merge this from github.
",jplock,2015-06-05 14:55:23
381,2015-06-05 12:45:04,"I guess @al3x will fix our access rights when he's woken up. :-)
",neuhaus,2015-06-05 14:55:23
381,2015-06-05 14:58:33,"I've also fixed the collaborator status on the repo to include everyone in the committers group.
",lukecyca,2015-06-05 14:55:23
381,2015-06-13 07:45:58,"Thanks.
",neuhaus,2015-06-05 14:55:23
380,2015-06-04 18:03:19,"I'm concerned about becoming a bottleneck for future work on Sovereign. I'd like to move the project to the https://github.com/sovereign organization that @lukecyca grabbed a while ago, and in the process add some other maintainers who can push changes to `master` without waiting for my approval.

Right now, @lukecyca is the only other maintainer, and he's also quite busy. I'd like to invite @neuhaus, @ariddell, @synchrone, @jplock, @lvillani and whoever else would like to put their hands up to join as maintainers.

Sound good? Any objections?
",al3x,2015-06-13 21:07:25
380,2015-06-04 18:27:13,"Great idea
",lukecyca,2015-06-13 21:07:25
380,2015-06-04 18:33:35,"Sounds great to me
",jplock,2015-06-13 21:07:25
380,2015-06-04 20:09:53,"Thumbs up from me!

-Sven

> Am 04.06.2015 um 20:03 schrieb Alex Payne notifications@github.com:
> 
> I'm concerned about becoming a bottleneck for future work on Sovereign. I'd like to move the project to the https://github.com/sovereign organization that @lukecyca grabbed a while ago, and in the process add some other maintainers who can push changes to master without waiting for my approval.
> 
> Right now, @lukecyca is the only other maintainer, and he's also quite busy. I'd like to invite @neuhaus, @ariddell, @synchrone, @jplock, @lvillani and whoever else would like to put their hands up to join as maintainers.
> 
> Sound good? Any objections?
> 
> ‚Äî
> Reply to this email directly or view it on GitHub.
",neuhaus,2015-06-13 21:07:25
380,2015-06-04 20:12:23,"Let's use this opportunity to set up some guidelines for everything that is added to the master branch. 
My suggestion: Commits should be tested on Debian stable and Ubuntu LTS.

-Sven

> Am 04.06.2015 um 20:03 schrieb Alex Payne notifications@github.com:
> 
> I'm concerned about becoming a bottleneck for future work on Sovereign. I'd like to move the project to the https://github.com/sovereign organization that @lukecyca grabbed a while ago, and in the process add some other maintainers who can push changes to master without waiting for my approval.
> 
> Right now, @lukecyca is the only other maintainer, and he's also quite busy. I'd like to invite @neuhaus, @ariddell, @synchrone, @jplock, @lvillani and whoever else would like to put their hands up to join as maintainers.
> 
> Sound good? Any objections?
> 
> ‚Äî
> Reply to this email directly or view it on GitHub.
",neuhaus,2015-06-13 21:07:25
380,2015-06-04 20:12:41,":+1: 
",case,2015-06-13 21:07:25
380,2015-06-04 21:04:27,"Sure! re: @neuhaus, perhaps it might be a good time to write a `CONTRIBUTING.md` (which github will show users submitting PRs)? For more elaborate examples, there's zeromq's ""Development Process"" http://rfc.zeromq.org/spec:22 and OpenStack's Hacking guidelines: http://docs.openstack.org/developer/hacking/
",ariddell,2015-06-13 21:07:25
380,2015-06-05 02:44:19,"I've completed the migration to the new GitHub organization. Thanks again for grabbing that, @lukecyca.

I've sent invitations to the contributors who've posted in this thread. I'm going to leave the issue open for several more days to let others put their hands up if they'd also like to be considered for the commit bit.

@ariddell: we now have a `CONTRIBUTING.md` document. I don't think it'll end up being as exhaustive as OpenStack's, but right now it's just a stub.
",al3x,2015-06-13 21:07:25
380,2015-06-05 03:04:14,"Great work, @al3x! I like that our org's identicon looks a bit like a castle turret. I guess that's as good a pictogram for ""Sovereign"" as any.

![](https://avatars2.githubusercontent.com/u/6289855)
",lukecyca,2015-06-13 21:07:25
380,2015-06-05 22:07:37,"@al3x Thanks for the invite! Since I've been inactive for a while, though, I prefer to submit contributions ""the usual way"" by forcing my stuff to go through review via pull requests so as to avoid making more harm than good :wink: 
",lvillani,2015-06-13 21:07:25
380,2015-06-08 12:45:35,"I think there are some points we need to discuss, should we do it in issues like this one or perhaps set up a mailing list?

Here are some areas of discussion for this project:
- future project direction
- software choices such as Apache vs. Nginx
- configuration choices (e.g. more secure vs. better interoperability)

If there's a consensus that a mailing list is a good idea, I can take care of getting one.
",neuhaus,2015-06-13 21:07:25
380,2015-06-08 15:43:05,"I'd prefer to see these be discussed in issues . We can add a ""discussion"" label in the issues settings for the project.

> On Jun 8, 2015, at 05:45, Sven Neuhaus notifications@github.com wrote:
> 
> I think there are some points we need to discuss, should we do it in issues like this one or perhaps set up a mailing list?
> 
> Here are some areas of discussion for this project:
> 
> future project direction
> software choices such as Apache vs. Nginx
> configuration choices (e.g. more secure vs. better interoperability)
> ‚Äî
> Reply to this email directly or view it on GitHub.
",al3x,2015-06-13 21:07:25
380,2015-06-13 08:18:46,"Sounds good, please add the ""discussion"" label.
While you're at it, do you also want to add a ""jessie"" and ""trusty"" label?
",neuhaus,2015-06-13 21:07:25
380,2015-06-13 21:07:25,"All three labels added.

Nobody else has put their hands up for commit privileges, so I'm closing this.
",al3x,2015-06-13 21:07:25
380,2016-02-09 14:21:12,"If @mikeashley is interested in commit privilege, I think he deserves it by now :-)
",neuhaus,2015-06-13 21:07:25
380,2016-02-10 08:48:35,"I'm interested.  Thank you for the consideration.
",mikeashley,2015-06-13 21:07:25
380,2016-02-19 16:23:28,"@ariddell thankfully opened issue #501 for this
",neuhaus,2015-06-13 21:07:25
379,2015-06-03 08:41:51,"It would be nice to generate an iOS mobileconfig file with the settings for mail, CalDAV and CardDAV.
This is similar to the Thunderbird autoconfig.

We don't even have to reinvent the wheel, instead we can just copy most of the stuff!
Here are some URLs with more information
https://github.com/mail-in-a-box/mailinabox/issues/258
https://github.com/mail-in-a-box/mailinabox/pull/261

https://github.com/mail-in-a-box/mailinabox/commit/c872e6a9f01f2947387d06fdd659cc91d797cd73
",neuhaus,
379,2015-06-03 17:27:20,"Yup, that'd be a nice enhancement.
",al3x,
378,2015-06-02 23:29:55,"A fair amount of spam is getting through. I've checked the dspam_stats data per #311 and #196 and it is registering when it incorrectly tags spam as ham. Is there a simple way to adjust the aggressiveness? I'd settle for some false negatives at this point.
",ariddell,2015-06-03 21:20:08
378,2015-06-03 17:32:33,"Maybe check out http://www.kirya.net/articles/setting-up-dspam-as-a-filter-for-postfix-on-debian/ ? I'm not sure about a ""simple way"" to tweak dspam, since it has so many settings.
",al3x,2015-06-03 21:20:08
378,2015-06-03 21:20:08,"This is probably a better issue to file with dspam, or a post for the dspam mailing list.
",al3x,2015-06-03 21:20:08
377,2015-05-31 17:41:50,"just cleaning up your master.cf a bit
",Yannik,2015-05-31 21:31:11
376,2015-05-31 10:22:01,"Hi,
I'm using this useful packages, maybe it can be integrated in sovereign too.
Cheers
",spk,2015-05-31 21:31:00
375,2015-05-30 14:21:06,"Quote from http://wiki2.dovecot.org/LDA:
`The Dovecot LDA is a local delivery agent, which takes mail from an MTA and delivers it to a user's mailbox, while keeping Dovecot index files up to date. Nowadays you should probably use the LMTP server instead, because it's somewhat easier to configure (especially related to permissions) and gives better performance.`

This basically sums up why I'd recommend you to use dovecot lmtp instead of lda. lda is a short running process which is started everytime a mail is delivered while dovecot lmtp is long running and doesn't have the associated overhead of starting a process each time.
",Yannik,2015-09-20 00:45:16
375,2015-05-30 14:22:18,"You will need to set `virtual_transport = lmtp:unix:private/dovecot-lmtp` in `main.cf` and enable dovecot lmtp if it isn't already enabled (didn't check this for your setup).
",Yannik,2015-09-20 00:45:16
375,2015-06-13 20:24:43,"Can you do a pull request please?
",neuhaus,2015-09-20 00:45:16
375,2015-06-28 10:59:20,"Sorry, I got no ressources/time for that atm.
",Yannik,2015-09-20 00:45:16
374,2015-05-30 14:13:10,"I noticed that the submission protocol is disabled in [master.cf](https://github.com/al3x/sovereign/blob/master/roles/mailserver/files/etc_postfix_master.cf).

According to [RFC6409](https://tools.ietf.org/html/rfc6409), the submission protocol / port 587 is 
- the port which should be used for mails from a MUA (mail user agent)
- must require authentication
- for client->server communication.

Port 25/465 are for message relay, which is server->server communication. Port 465 uses SSL/TLS before the smtp communication starts, while 25 shall promote starttls via smtp protocol which may be used to upgrade the connection to use SSL/TLS. Port 465/ssmtp has been deprecated in 1998(!).

Even though this settings seems to exist since the first commit to the project, there has been a bit of discussion about this: https://github.com/al3x/sovereign/pull/318
This discussion is ended by stating that STARTTLS is less secure then using ssmtp, because ISPs previously tampered with the STARTTLS flag. In this case, this is untrue the submission protocol/port 587 should definitely be used. By using `smtpd_tls_auth_only = yes` in [master.cf](https://github.com/al3x/sovereign/blob/master/roles/mailserver/templates/etc_postfix_main.cf.j2#L46), it is already ensured that clients can only authenticate when using tls, mitigating any tampering from ISPs.

I happened to stumble upon this when looking through your project, but don't actually use it, and therefore don't have a complete overview of your config. Because of this, even though I'm a professional mailserver admin, I ask you to create a PR for this yourself keeping your complete config in mind.
",Yannik,2016-09-11 09:48:07
374,2015-05-30 14:13:57,"Your [autoconfig](https://github.com/al3x/sovereign/blob/master/roles/mailserver/templates/var_www_autoconfig_mail_config-v1.1.j2) must be adjusted accordingly.
",Yannik,2016-09-11 09:48:07
374,2015-05-30 17:26:40,"@Yannik Thanks for taking the time to leave these useful reports.
",ariddell,2016-09-11 09:48:07
374,2015-05-30 18:10:27,"Yes indeed! Lots to work on in the coming days.

> On May 30, 2015, at 10:26, Allen Riddell notifications@github.com wrote:
> 
> @Yannik Thanks for taking the time to leave these useful reports.
> 
> ‚Äî
> Reply to this email directly or view it on GitHub.
",al3x,2016-09-11 09:48:07
374,2015-06-03 08:33:35,"@Yannik Thank you for opening this issue.
If there is an active man-in-the-middle attack (such as stripping STARTTLS), the clients must be configured to enforce STARTTLS, otherwise the attacker can talk plain text to the client and use STARTTLS while talking to the server.

That said, I think adding the submission port is The Right Thing.
",neuhaus,2016-09-11 09:48:07
374,2015-06-04 20:59:19,"@neuhaus Yeah, that's true. We need something like HSTS for smtp :)
",Yannik,2016-09-11 09:48:07
374,2016-02-06 15:41:56,"@Yannik Until we have HSTS for smtp, what are the practical consequences of simply disabling/firewalling submissions on port 25 (but still allowing them on 587). I realize this is a bad idea -- but is it a horrible idea?
",ariddell,2016-09-11 09:48:07
374,2016-02-06 18:30:09,"Port 25 needs to remain open for mail arriving from other MTAs (not MUAs).
",neuhaus,2016-09-11 09:48:07
374,2016-02-06 19:37:32,"Oh, I thought there was a secure port for MTAs as well. In that case, can you block any submissions from MTAs which don't use STARTTLS on port 25? Or is this a horrible idea?
",ariddell,2016-09-11 09:48:07
374,2016-02-06 20:41:07,"You can configure Postfix to reject unencrypted mails received via port 25 (set `smtpd_tls_security_level` to `encrypt` instead of `may`), however that will result in a lot of undelivered email, so we should not make that the default. Let's hope that soon this will be more feasible.

What we already do is support AUTH only via TLS (`smtpd_tls_auth_only` is set to `yes`).
",neuhaus,2016-09-11 09:48:07
374,2016-02-06 21:08:36,"Personally, I wouldn't mind receiving fewer emails. What MTAs are not encrypting these days?
",ariddell,2016-09-11 09:48:07
374,2016-02-06 21:57:25,"I checked a few emails and it appears that more than 25% of emails reach my server without TLS. YMMV. Perhaps you only get mail from gmail? In that case, there is no privacy anyway üò¢ 
",neuhaus,2016-09-11 09:48:07
374,2016-02-07 12:56:02,"25% is far more than I would have expected. Thanks!
",ariddell,2016-09-11 09:48:07
374,2016-02-27 20:17:02,"It looks like I'm not crazy. If/when this gets finalized, it would be cool if sovereign could support it.

IETF Draft: SMTP Require TLS Option

https://datatracker.ietf.org/doc/draft-fenton-smtp-require-tls/
",ariddell,2016-09-11 09:48:07
374,2016-02-27 22:33:23,"I only read a few passages of the proposal: It seems a) unrelated to this issue b) not very useful to me. 
Some providers already allow their users to select whether an email should only be delivered if it can be done in an encrypted fashion. (see for example https://mailbox.org/en/ensuring-emails-are-sent-securely/). 
It also a) requires sysadmins of the receiving servers to change their system b) users to adapt (apart from software updates needed for MTAs and MUAs). It effectively secures MTA->MTA traffic.
DANE is superior for this IMO and needs only the sysadmins of the receiving system to implement changes. (Even though it definitely is harder to achieve than to just update your MTA to a version which supports REQUIRETLS)

So, back to this issue: It largely depends whether an MUA is configured to figure out whether the remote smtp server supports TLS automatically at each connection, or whether it is done once at the setup of the account (may be assisted to choose the right values using autoconfiguration). Most often, it's probably the latter option that is used. If an downgrade attack occurs after this initial account setup, the user is secure as the connection will fail because it's client is configured to use STARTTLS.

So, there is not really an issue with enabling this (and shutting down SMTPS/ port 465).

Btw, this is a utility you can test stripping STARTTLS with: https://github.com/tintinweb/striptls
In this case (as this utility supports so many other ways to manipulate STARTTLS connections, you probably want to use `striptls --listen 0.0.0.0:588 --remote localhost:25 --vectors=SMTP.StripFromCapabilities`. Now you can just set your client to connect to port 588 and you will see whether the stripping attack works or not.

Works like a charm - fortunately, only when a client is configured to not always use STARTTLS.

Thunderbird will give you an error like this for example:

> An error occurred while sending mail: Unable to establish a secure link with Outgoing server (SMTP) %S using STARTTLS since it doesn't advertise that feature. Switch off STARTTLS for this server or contact your service provider.
",Yannik,2016-09-11 09:48:07
374,2016-02-27 22:41:55,"You're right. I just need to set `smtpd_tls_security_level` to `encrypt`, right?

Sorry about taking this issue off track. We do need to fix the port issue ASAP.
",ariddell,2016-09-11 09:48:07
374,2016-02-27 22:43:58,"You can do that for the submission port, but don't do it for port 25.

Quote:

> You can ENFORCE the use of TLS, so that the Postfix SMTP server announces STARTTLS and accepts no mail without TLS encryption, by setting ""smtpd_tls_security_level = encrypt"". According to RFC 2487 this MUST NOT be applied in case of a publicly-referenced Postfix SMTP server. This option is off by default and should only seldom be used. 
",Yannik,2016-09-11 09:48:07
374,2016-05-21 13:08:14,"I am considering fixing this and submitting a PR.  I think it will break client configurations, and we'll all have to fix up our clients.  Are we ok with that?  It's a little painful for me, since I have a few family members I will have to help through the change, but I consider it worth it to make this right.
",mikeashley,2016-09-11 09:48:07
374,2016-05-21 13:31:20,"This should definitely be fixed.
",ariddell,2016-09-11 09:48:07
374,2016-05-21 15:12:56,"Having both ports open for a while should not be a problem, right?

## 

> Am 21.05.2016 um 15:31 schrieb Allen Riddell notifications@github.com:
> 
> This should definitely be fixed.
> 
> ‚Äï
> You are receiving this because you were mentioned.
> Reply to this email directly or view it on GitHub
",neuhaus,2016-09-11 09:48:07
374,2016-05-21 16:20:28,"In principal, no, it's not a problem.  In PR #560 I closed 465 since leaving it open defers the transition users would need to make when 465 is eventually closed.  I think it is easier to communicate the change at the same time we switch to Jessie.
",mikeashley,2016-09-11 09:48:07
374,2016-09-11 09:48:07,"I closed 465 with commit 16dc7d now that we're closed to the Jessie switch.  This is documented on the migration page on the wiki in the handful of backwards-incompatible changes we have.  I believe this last patch resolves this issue.
",mikeashley,2016-09-11 09:48:07
373,2015-05-21 11:09:53,"See https://weakdh.org/sysadmin.html

We need to generate a 2048+ bit dhparam file (using `openssl dhparam`) and use it for Apache, OpenVPN and Postfix.
I have submitted the pull request #372 to fix this in Dovecot (it generates dhparam files on its own).
",neuhaus,
373,2015-05-21 11:13:46,"This could be done in the file  `roles/common/tasks/ssl.yml` I suppose
",neuhaus,
373,2015-05-21 11:24:25,"It will break Java 6 clients because they do not support DH parameters > 1024 bits.
However, the end of public updates for Java 6 was in Feb 2013 anyway.
",neuhaus,
373,2015-05-21 18:35:04,"`roles/common/tasks/ssl.yml` does seem the natural home for this task.

I don't think we need to support EOL'd software like Java 6.
",al3x,
373,2015-09-22 21:28:18,"Prosody also supports a `dhparam` option in the `ssl = {}` section.
",winks,
373,2015-12-10 10:56:46,"Solved for Postfix.

Apache is a bit more tricky:
Wheezy ships with Apache 2.2. Too old.
Trusty ships with Apache 2.4.7 and OpenSSL 1.0.1f. There, the dhparams can be appended to the certificates.

For Jessie and Xenial, starting with Apache 2.4.8 and OpenSSL 1.0.2, there is a new mechanism:

<S_CODE_TOKEN>
",neuhaus,
373,2015-12-10 11:17:43,"[debops.dhparam](https://github.com/debops/ansible-dhparam) might be worth checking out ‚Ä¶
",ypid,
373,2016-01-16 14:02:35,"@ypid debops.dhparam looks good but it requires Ansible 1.9 and it doesn't help with the Apache 2.2/Apache 2.4 issue.
",neuhaus,
373,2016-05-21 12:49:51,"I investigated this on the jessie branch for Apache.  Debian 8 stable uses openssl 1.0.1k, so the DH parameters would need to be appended to the site certificates.

However, the current server configuration seems to already mitigate logjam.  I tested my server from [here](https://weakdh.org/sysadmin.html), and it reported my server as safe.  I also reviewed the report returned for my site by the [Qualys SSL Labs tester](https://www.ssllabs.com/ssltest/index.html).  It indicated that we're not using common DH primes, and we're not reusing DH public server params.

Does anything actually need to be done for Apache?  I'm not a security expert; just reporting what I'm seeing.  Could somebody more qualified assess this?
",mikeashley,
373,2016-05-21 12:59:22,"I think openvpn is ok.  The server configuration uses DH parameters.  The key size in the defaults is 2048 bits.  The task list generates the parameters.  These were done as part of Joshua Lund's commits on 2013-10-07.

Summary of where I think we're at: postfix and dovecot are ok, openvpn is ok, apache needs a look (see previous comment).
",mikeashley,
373,2016-09-16 12:37:52,"I looked at this again.  We are running Apache 2.4.10 on master.  I reviewed the [mod_ssl documentation](http://httpd.apache.org/docs/current/mod/mod_ssl.html).  It looks like we are ""ok"" with no changes, since mod_ssl uses standardized DH parameters corresponding to key length.  Logjam appears to be mitigated.

However, we may still want to use the custom DH parameters we are generating for postfix for some additional security as well as consistency.  It's easy enough to reference the parameters using the new [SSLOpenSSLConfCmd](http://httpd.apache.org/docs/current/mod/mod_ssl.html#sslopensslconfcmd) directive, but we would need to use OpenSSL 1.0.2 from Debian backports.

I'm recommending we do this and close this issue.  Any feedback?
",mikeashley,
373,2016-09-16 12:41:03,"Yes, we finally reached the stage described in [my comment from last December](https://github.com/sovereign/sovereign/issues/373#issuecomment-163578499)!
",neuhaus,
373,2016-09-17 12:36:28,"I am still troubleshooting why I can't get Apache to accept the `SSLOpenSSLConfCmd` directive.

Upgrading the libssl1.0.0 package from jessie-backports is not sufficient.  It does update libssl to 1.0.2h, but the next problem appears to be that `mod_ssl.so` in jessie does not have support for `SSLOpenSSLConfCmd` compiled into the module.  At least, `strings mod_ssl.so` does not give me any references to `SSLOpenSSLConfCmd`.  I am guessing its build was configured with a version of libssl < 1.0.2.  I can confirm this hypothesis by building apache 2.4.10 from source with a version of libssl >= 1.0.2 and then checking its `mod_ssl.so`.

I'm posting this in case somebody can tell me I'm on the wrong track or if somebody is using `SSLOpenSSLConfCmd` and can share their configuration with me.
",mikeashley,
373,2016-09-17 13:04:43,"Read the source code for mod_ssl in Apache 2.4.10.  Indeed, it elides support for the `SSLOpenSSLConfCMD` directive if compiled against an unsupporting version of libssl.  Skimming dependencies, I think we'll need to go after the Apache package from Debian testing.
",mikeashley,
373,2016-10-22 11:22:18,"Or wait for Apache 2.4.23 to land in backports, which is where I am leaning.  I am concerned about breaking dependencies if we pull from Debian testing.  Logjam is currently mitigated, and it doesn't seem worth the configuration headache to use custom DH parameters.
",mikeashley,
373,2016-10-24 12:29:08,"Is there an open issue already on debian regarding the Apache 2.4.10 issue?
What does Apache 2.4.23 improve in this regard?
",neuhaus,
373,2016-10-30 09:30:25,"Pulled the jessie tag since it's master now.
",mikeashley,
372,2015-05-21 11:03:59,"See also: https://weakdh.org/sysadmin.html
",neuhaus,2015-05-21 18:34:07
372,2015-05-21 18:40:35,"Running this, I'm getting:

<S_CODE_TOKEN>

<S_CODE_TOKEN>
",jplock,2015-05-21 18:34:07
372,2015-05-21 18:41:57,"Interesting. Works for me with `dovecot-core 1:2.2.13-11`.
",al3x,2015-05-21 18:34:07
372,2015-05-21 18:45:45,"I'm running wheezy.  Is that version from wheezy-backports?  https://packages.debian.org/wheezy-backports/dovecot-core
",jplock,2015-05-21 18:34:07
372,2015-05-21 19:00:48,"I'm trying out Jessie, so perhaps it's only available in the latest Debian release.
",al3x,2015-05-21 18:34:07
372,2015-05-22 05:09:32,"Works for me with dovecot-core 2.2.9-1ubuntu2.1.
I suppose Wheezy ships with Dovecot 2.1 that lacks this feature :-(
I'll look into this later this weekend.

> Am 21.05.2015 um 20:40 schrieb Justin Plock notifications@github.com:
> 
> Running this, I'm getting:
> 
> NOTIFIED: [mailserver | restart dovecot] *************************************\* 
> failed: [x.x.x.x] => {""failed"": true}
> msg: doveconf: Fatal: Error in configuration file /etc/dovecot/conf.d/10-ssl.conf line 53: Unknown setting: ssl_dh_parameters_length
> doveconf: Error: managesieve-login: dump-capability process returned 89
> doveconf: Fatal: Error in configuration file /etc/dovecot/conf.d/10-ssl.conf line 53: Unknown setting: ssl_dh_parameters_length
> doveconf: Fatal: Error in configuration file /etc/dovecot/conf.d/10-ssl.conf line 53: Unknown setting: ssl_dh_parameters_length
> doveconf: Error: managesieve-login: dump-capability process returned 89
> doveconf: Fatal: Error in configuration file /etc/dovecot/conf.d/10-ssl.conf line 53: Unknown setting: ssl_dh_parameters_length
> doveconf: Fatal: Error in configuration file /etc/dovecot/conf.d/10-ssl.conf line 53: Unknown setting: ssl_dh_parameters_length
> doveconf: Error: managesieve-login: dump-capability process returned 89
> doveconf: Fatal: Error in configuration file /etc/dovecot/conf.d/10-ssl.conf line 53: Unknown setting: ssl_dh_parameters_length
> root@mail:/etc/dovecot/conf.d# dpkg -l | grep dove
> ii  dovecot-antispam                      2.0+20120225-3                amd64        Dovecot plugins for training spam filters
> ii  dovecot-core                          1:2.1.7-7+deb7u1              amd64        secure mail server that supports mbox, maildir, dbox and mdbox mailboxes
> ii  dovecot-imapd                         1:2.1.7-7+deb7u1              amd64        secure IMAP server that supports mbox, maildir, dbox and mdbox mailboxes
> ii  dovecot-lmtpd                         1:2.1.7-7+deb7u1              amd64        secure LMTP server for Dovecot
> ii  dovecot-managesieved                  1:2.1.7-7+deb7u1              amd64        secure ManageSieve server for Dovecot
> ii  dovecot-pgsql                         1:2.1.7-7+deb7u1              amd64        PostgreSQL support for Dovecot
> ii  dovecot-pop3d                         1:2.1.7-7+deb7u1              amd64        secure POP3 server that supports mbox, maildir, dbox and mdbox mailboxes
> ii  dovecot-sieve                         1:2.1.7-7+deb7u1              amd64        sieve filters support for Dovecot
> ii  dovecot-solr                          1:2.1.7-7+deb7u1              amd64        Solr full text search support for Dovecot
> ‚Äî
> Reply to this email directly or view it on GitHub.
",neuhaus,2015-05-21 18:34:07
372,2015-06-08 23:50:57,"I got the same errors as @jplock when I upgraded my box to the current master head. I had to upgrade dovecot using wheezy-backports:

<S_CODE_TOKEN>

Then I re-ran the playbook.

Not a huge deal if we're moving to Jessie soon, but master is unfortunately broken right now.
",lukecyca,2015-05-21 18:34:07
372,2015-06-09 00:52:19,"Should be fixed by 34448d5
",al3x,2015-05-21 18:34:07
372,2015-06-09 09:15:00,"I ran the playbook including @al3x's fix, but now I'm unable to retrieve mail, either through IMAP or Roundcube. `mail.err` reports `fatal: no SASL authentication mechanisms` and `roundcube/errors` reports `IMAP Error: Login failed for.... Could not connect to ssl://127.0.0.1:993: Connection refused in /usr/share/roundcube/program/lib/Roundcube/rcube_imap.php on line 184 (POST /?_task=login&_action=login)`

Any ideas? (I'm still on wheezy) Thanks.
",iboxifoo,2015-05-21 18:34:07
372,2015-06-09 09:17:25,"@iboxifoo Try removing the line with ""ssl_dh_parameters_length = 2048"" from your dovecot ssl config file `/etc/dovecot/conf.d/10-ssl.conf`
Then restart dovecot (run `sudo service dovecot restart`)
Which version of dovecot is installed on your system now? Check using `dpkg -l dovecot-core`
",neuhaus,2015-05-21 18:34:07
372,2015-06-09 09:22:15,"@neuhaus That did the trick! Any implications in commenting out line? Thanks
",iboxifoo,2015-05-21 18:34:07
372,2015-06-09 09:26:58,"@iboxifoo You should eventually put it back in when you upgrade to Dovecot 2.2+ (which comes with Debian Jessie for example).
Without it you are using 1024 bit DH params which are considered weak.
You can read all about it at https://weakdh.org/
",neuhaus,2015-05-21 18:34:07
372,2015-06-09 09:31:11,"got it. thanks so much.

> On Jun 9, 2015, at 2:27 AM, Sven Neuhaus notifications@github.com wrote:
> 
> @iboxifoo You should eventually put it back in when you upgrade to Dovecot 2.2+ (which comes with Debian Jessie for example).
> Without it you are using 1024 bit DH params which are considered weak.
> You can read all about it at https://weakdh.org/
> 
> ‚Äî
> Reply to this email directly or view it on GitHub.
",iboxifoo,2015-05-21 18:34:07
372,2015-06-12 21:51:02,"I was able to upgrade `dovecot`, but now I'm having issues with `dspam`:

<S_CODE_TOKEN>

Any suggestions?
",jplock,2015-05-21 18:34:07
372,2015-06-13 07:37:20,"Did you install the dovecot packages manually?
If so, try also installing `dovecot-antispam` manually from wheezy-backports using
`sudo apt-get -t wheezy-backports install dovecot-antispam`
",neuhaus,2015-05-21 18:34:07
372,2015-06-13 10:05:51,"OK, I hope it's fixed now in commit 8b5ed21e3892caacd28fe4fd13368ea3f27f6b9f.
The dovecot-solr package was also affected.
@jplock Thanks for reporting this.
",neuhaus,2015-05-21 18:34:07
372,2015-06-13 20:23:07,"I found and fixed another issue with the wheezy-backports change in commit 570bebac704f5515dcc88c82746de160400f397d. librrd2-dev (required for collectd) also needs to be from wheezy-backports to avoid package conflicts.
",neuhaus,2015-05-21 18:34:07
371,2015-05-21 08:00:03,"Had some issues with newebe, so I wanted to run the role separately. 
Maybe you have some use out of this
",Reprazent,2015-05-21 18:26:55
370,2015-05-11 15:04:43,"Debian 8 ""Jessie"" is now the stable release of Debian, the primary supported Linux distribution for Sovereign. We should get the playbooks and Vagrant configuration up to date for it.
",al3x,2016-03-07 00:51:41
370,2015-05-19 19:09:46,"Interested in this as well. What needs to be changed? I'm guessing systemd is the biggest change?
",miloshadzic,2016-03-07 00:51:41
370,2015-05-21 11:06:40,"I'm also willing to help here.
",neuhaus,2016-03-07 00:51:41
370,2015-05-30 14:30:37,"For dovecot, you guys will want to diff your existing `/etc/dovecot` against `/usr/share/dovecot`. I recommend merging file-by-file using vimdiff. There are quite a few changes.
",Yannik,2016-03-07 00:51:41
370,2015-06-04 05:44:56,"This work will be happening in https://github.com/al3x/sovereign/tree/jessie if anyone wants to pitch in.
",al3x,2016-03-07 00:51:41
370,2015-06-24 08:43:33,"Happy to help with this. Any suggestions on what needs working on? Or just try it out and send PRs?
",keybits,2016-03-07 00:51:41
370,2015-06-25 00:23:48,"My approach was going to be to just keep running the playbooks against my local Vagrant instance until everything works :) Nothing particularly focused.
",al3x,2016-03-07 00:51:41
370,2015-07-01 21:47:43,"Just wanted to let folks know that if they want Jessie support, don't wait on me. I have little to no time to work on Sovereign for the foreseeable future. Hopefully the community can step up here.
",al3x,2016-03-07 00:51:41
370,2016-03-07 00:51:41,"Looks like Issue #440 is where this is getting discussed.  Closing this issue to clean up.
",mikeashley,2016-03-07 00:51:41
369,2015-05-10 18:29:07,"After I first ran sovereign things were working swingly, but all my emails were ending up in peoples spam folders (on a new IP and server) which seemed weird.

I read around and finally came across DMARC (https://stackoverflow.com/questions/11683580/spam-is-being-sent-using-my-domain-what-can-i-do) and an opensource version to implement that (http://blog.hamzahkhan.com/2014/02/08/securing-postfix-mail-server-greylisting-spf-dkim-dmarc-tls/).

I am going to give that a shot on my server and report back. I thought it could be useful for others since having blocked email right out of the box isn't so great :/ 
",shaneonabike,2015-07-01 21:38:49
369,2015-05-11 14:08:10,"I finished installing DMARC and it seems to be fairly good. I will report back later to let you know whether this actually is reducing the chances of my emails being thrown into spam folders. According to the docs it should

Also sorry actually this tutorially is a bit better http://www.skelleton.net/2015/03/21/how-to-eliminate-spam-and-protect-your-name-with-dmarc/#dmarc_postfix

There's also a nice little wizard here that helps you generate a dmarc http://kitterman.com/dmarc/assistant.html
",shaneonabike,2015-07-01 21:38:49
369,2015-05-11 15:02:17,"I haven't had major issues with outgoing email from my Sovereign server being marked as spam, but I agree that we should support DMARC. I'll try to get it going on my box as well. Pull requests are always appreciated :)
",al3x,2015-07-01 21:38:49
369,2015-05-11 16:25:54,"<S_CODE_TOKEN>
",shaneonabike,2015-07-01 21:38:49
369,2015-05-11 17:40:01,"Great idea. I'm going to read up on this too.
",lukecyca,2015-07-01 21:38:49
369,2015-05-11 18:22:47,"I got it implemented on my server as per that skelleton.net blog post earlier today. So far so good. I want to live with it for a couple days before I submit a PR, see if there are any issues.

One thing that post details is how you'd make anti-spam software aware of DMARC. It provides examples for SpamAssassin, but we use dspam. It remains to be seen whether that additional step is necessary.
",al3x,2015-07-01 21:38:49
369,2015-05-15 19:33:50,"Yeah I noticed that too... I finally got a post back from Google recognizing my DMARC which is cool. Here's the referencing documentation in the XML I got.. http://support.google.com/a/bin/answer.py?answer=2466580

In that they indicate that they don't accept forensic posts and I am cautious to think that Yahoo or others do either.
",shaneonabike,2015-07-01 21:38:49
368,2015-04-22 19:30:29,"I‚Äôm having trouble setting up sovereign on a blank DigitalOcean droplet. I‚Äôm using Debian 7 and I‚Äôve enabled in site.yml only the services that I need but even if I enable all the issue persists.

When the box is set up I can‚Äôt connect to the smtp server on neither port 25 nor 465. IMAP works good. What‚Äôs even more strange is that I can connect when I am on certain networks like in one coffeshop or using [Cloak](http://getcloak.com) via their Netherlands route.

I‚Äôve also enabled OpenVPN but through it I can‚Äôt connect neither to the IMAP nor SMTP ports.

I think it‚Äôs a firewall issue but I‚Äôm not good familiar enough with ufw/iptables to know how to solve it on my own.
",miloshadzic,2015-05-01 09:39:03
368,2015-04-22 21:51:58,"So, SMTP works but only on some network connections? Chances are good that your home or work ISP or network administrator is filtering certain types of traffic.
",al3x,2015-05-01 09:39:03
368,2015-04-23 07:59:51,"Thanks. I think you're probably right but I'm not sure how to mitigate it. I thought that connecting to the vpn that's on the same host would work but it doesn't (possibly for a different reason though):

<S_CODE_TOKEN>

The same will happen for port 443 which otherwise works which makes me think this is a different issue.
",miloshadzic,2015-05-01 09:39:03
368,2015-04-27 13:39:51,"Ok problem 1 was indeed filtering by the ISP. I've never encountered that so I was pretty surprised.

Problem 2 I've solved by editing my `/etc/hosts` to be:

<S_CODE_TOKEN>

And now I can fetch email while connected to the VPN. My last question is whether I'm doing something wrong with this change?
",miloshadzic,2015-05-01 09:39:03
367,2015-04-20 17:56:33,"A minor change really
",miloshadzic,2015-04-20 18:36:50
366,2015-04-16 23:25:10,"In order for `ansible-playbook -i ./hosts site.yml` to work, you need to add the deploy user to sudoers, otherwise you need to pass the -K flag to `ansible-playbook`
",poops,2015-04-24 11:22:23
366,2015-04-17 03:11:53,"deploy should not be hardcoded as some people might  change it in site.yml to another username.
",simontretter,2015-04-24 11:22:23
366,2015-04-17 04:18:48,"@simontretter this is added to the documentation section where deploy is already hardcoded, and is optional to setup.
",poops,2015-04-24 11:22:23
366,2015-11-14 21:13:07,"For what it's worth: I didn't know you had to install the `sudo` package as well. Might be useful to add to the readme?
",cimm,2015-04-24 11:22:23
366,2015-12-02 13:04:46,"Isn't sudo installed by default? If not, @cimm please submit a pull request :+1: 
",neuhaus,2015-04-24 11:22:23
366,2015-12-02 13:07:18,"@neuhaus Was testing it on Debian 8, not 7 as it says in the README, my bad. Sorry.
",cimm,2015-04-24 11:22:23
365,2015-04-06 17:23:52,"Sorry I realize that this is off topic but I figured maybe someone might be able to help. I added another tool on my server and it is being forced directly to SSL rather than allowing non-SSL.

Is there somewhere that I can configure it to be simply non-SSL or allow both? I can't quite figure out if there is some forced SSL in the configuration files of sovereign.

Thanks heaps
Shane

PS - For the record I didn't buy a wildcard certificate b/c I didn't have the cash and am awaiting the release of the Let's Encrypt everywhere functionality! (ref: https://letsencrypt.org/howitworks/)
",shaneonabike,2015-04-06 17:28:55
365,2015-04-06 17:28:55,"@shaneonabike Check out, for example: https://github.com/al3x/sovereign/blob/master/roles/git/templates/etc_apache2_sites-available_cgit.j2#L1-L5

You'll find similar sections in the other Apache configuration files used for various services in Sovereign. To get your desired non-SSL, you can move the body of the `<VirtualHost *:443>` block below into the top `<VirtualHost *:80>` section, removing the `Redirect permanent /` directive. You can delete the SSL-relative directives, of course :)

Not sure what your experience level with this stuff is, but it might be helpful to know that port 443 is used for HTTP over SSL, while port 80 is used for unencrypted HTTP traffic. Wherever you see port 443, that's probably something you'll want to change for your setup. Good luck!
",al3x,2015-04-06 17:28:55
365,2015-04-06 18:26:18,"Hmm.... that's what I thought too. But in doing so it still tries to use the main certificate and b/c it's not wildcard it never works... super strange. It's like something is redirecting all *.example.com to https...

I also tried to simply disable the main redirect on example.com.conf but that didn't change anything either cause I thought maybe that was why it was redirecting all sites to https.
",shaneonabike,2015-04-06 17:28:55
365,2015-09-12 19:56:59,"Just in case people tumble upon my post actually what you need to do is disable the apache configuration 00-status.conf. This configuration in sites-enabled actually prevents anything from calling port 80 unless it is internally coming from 127.0.0.1
",shaneonabike,2015-04-06 17:28:55
364,2015-04-01 21:48:38,"Hey I wanted to point out that the configuration rolled out for the blog is slightly limited. I wanted to suggest a few additions...

Basically, adding the directory index ""index.php"" as well as some further directory symlink following.

Why? Well after the first install I made these modifications, but then when the server needs to be rebooted I need to rerun playbook which replaces this file. Anyway, this helps most systems that use html and php I think.:)

<code>
    DirectoryIndex          index.html index.php
    Options                 -Indexes

<S_CODE_TOKEN>

</code>
",shaneonabike,2015-04-22 21:53:10
364,2015-04-22 21:53:10,"The blog entry is intended for static site generators like Jekyll. If people are installing blogging packages that rely on PHP, like WordPress, they should set up a custom configuration.
",al3x,2015-04-22 21:53:10
363,2015-03-21 14:13:59,"Is there a postgresql backports repository available?

Bug created by patch to fix #362
",ariddell,2015-03-21 18:44:01
363,2015-03-21 14:27:51,"For the record, I've been using 9.3 with owncloud on trusty without any problems. I don't use the webmail role, so YMMV.
",ariddell,2015-03-21 18:44:01
362,2015-03-07 06:59:40,"After having pulled the latest changes in sovereign, owncloud' setup fails with 

<S_CODE_TOKEN>

I've checked and there doesn't seem to be a postgresql-9.3 available for wheezy in the repositories configured by the current sovereign setup.

My question is: is postgresql-9.3 actually necessary? 
",lbsnrs,2015-03-08 03:06:05
362,2015-03-08 02:58:47,"Yes, the database is necessary. ownCloud depends on it, but so does our email setup. 
",al3x,2015-03-08 03:06:05
362,2015-03-08 03:03:34,"I think we should downgrade this to 9.1 to stay consistent with the rest of the playbooks. 
",jplock,2015-03-08 03:06:05
361,2015-02-25 12:54:51,"Hi,

could you add a note about how to proceed after a reboot?
I just added a filesystem for /encrypted (10GB) and found out how to re-mount it with encfs /encrypted /decrypted + passphrase.

So, one reboots the server one needs to do that manually? 
(makes sense to force entering the pw, i get that much)

But after this it seems the daemons have some problem, specifically roundcube won't access some folders any more with a permission issue.

Having an idea how reboot is normally handled would be good. Running on a VPS means sometimes there will be a reboot for external reasons anyway.
",FlorianHeigl,2015-02-25 18:36:20
361,2015-02-25 18:36:20,"Yes, you need to enter the password for any encrypted volumes on reboot. This is not Sovereign-specific, but rather a function of how EncFS works.

It is possible that some daemons may need to be restarted after you enter your password for the encrypted volume, as they may have stalled out while looking for resources that will only be available once the volume is decrypted and visible to the daemon user accounts.
",al3x,2015-02-25 18:36:20
361,2015-02-25 21:57:13,"For reference, i.e. #120 pointed at this. it's just annoying that it's nowhere in the docs.
",FlorianHeigl,2015-02-25 18:36:20
361,2015-03-07 22:55:22,"Thanks for adding the section about remounting the encfs-volume to the readme. But I think it would be even more helpful, if the specific command to remount the volume (`encfs /encrypted /decrypted --public`) would be mentioned in this section . I've never worked with encfs before and found it a little counter-intuitive to need to sift through the playbook to find the one command I need to enter after every reboot.
",whisdol,2015-02-25 18:36:20
360,2015-02-24 21:41:10,"Apparently under trusty if you have

<S_CODE_TOKEN>

in `/etc/apache2/conf-available/fqdn.conf`

and also have `ServerName mydomain.org` in your apache2 configuration for the blog you can
screw up your _http://mydomain.org_ (https will still work). I fear people might not notice this because of HTST pinning.

This might only show up in edge cases (I have an additional configuration in `sites-enabled`), but the error message is no help. It's:

`AH01797: client denied by server configuration: /var/www/`

The problem is fixed by putting anything else (e.g., ""localhost"") in fqdn.conf.

I think I have this right. Perhaps an Apache guru could explain what happened and why the fix works.
",ariddell,
360,2015-04-09 08:06:58,"Thanks, I suffered this issue too, and solved it with your suggestion. I found the file in `/etc/apache2/conf.d/fqdn` and put `ServerName localhost`.
",cjchacon,
360,2015-12-10 10:01:37,"Will putting only ""localhost"" in fqdn.conf make bug #187 reappear?
",neuhaus,
360,2015-12-12 16:36:57,"Confirmed that setting `/etc/apache2/conf.d/fqdn` to `ServerName localhost` solves this problem (as well as #187) for me.
",lukecyca,
360,2016-09-16 12:57:32,"I wonder if Apache still has the problem originally described in this issue?  I was not able to reproduce it, and I set my fqdn to `ServerName {{ domain }}`.  @ariddell Do you know what version of Apache you were running when you reported this?
",mikeashley,
360,2016-09-24 09:28:10,"I'll consider this ""cannot reproduce.""  Please reopen if we find this problem on the current master branch.
",mikeashley,
360,2016-10-27 19:09:10,"This issue just bit me again after upgrading to jessie (`master` branch).

The suggested workaround (changing `fqdn.conf` to `ServerName localhost`) fixed it as before.
",lukecyca,
360,2017-02-09 02:28:10,"This is _still_ an issue for me. Every once in a while an upgrade reverts my fix, and I go a few months with a broken website (it works for _me_ because HTST).

My local workaround is:
<S_CODE_TOKEN>

I'm on Debian Jessie.",lukecyca,
359,2015-02-24 21:18:12,,synchrone,2015-02-25 23:01:27
358,2015-02-24 21:12:58,"Because of some dependencies being installed in postfix role, owncloud fails when ran in separation. So we duplicate them here as well
",synchrone,2015-02-25 23:01:42
357,2015-02-24 21:08:29,"Connection to imap server fails because of mcrypt module not being installed by default in trusty
",synchrone,2015-02-25 23:01:53
356,2015-02-18 08:15:22,"Add group ""fuse"" to main user only as part of the ""encfs"" tag. This allows the user to make encfs optional.

Also, always create the /decrypted directory, even if encfs tag is skipped.

Helps with issue #120.
",neuhaus,2015-02-25 23:02:07
355,2015-02-17 21:21:45,"Hey there

I am trying to turn off the main SSL for the main site since I am using my own created one and want folks to come to my site without feeling ensecure about accepting my SSL certificate.

Can anyone guide me through how to do that? I've tried several modifications to the apache2 config to no avail!
",shaneonabike,2015-02-18 15:51:22
355,2015-02-17 21:51:23,"https://startssl.com/ will give you a free certificate. Soon https://letsencrypt.org/ will as well.
",ariddell,2015-02-18 15:51:22
355,2015-02-18 03:52:49,"Hmm.... but that only works for the main example.com site. So installing that then breaks all the other subdomains like mail.example.com, etc. I am now receiving errors like

NET::ERR_CERT_AUTHORITY_INVALID 

The other certificate that I created myself was a wildcard certificate. Do I need to go through and create one for every subdomain? And how do I do that if I have subdomains that aren't created by this script?
",shaneonabike,2015-02-18 15:51:22
355,2015-02-18 15:51:22,"I ended up generating one SSL certificate for each site as mentioned. To those trying to figure this out you simply need to do the following

Within each conf file you will need to change the following code.

<code>
    SSLEngine on
    SSLProtocol ALL -SSLv2 -SSLv3
    SSLHonorCipherOrder On
    SSLCipherSuite ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:ECDH$
    SSLCertificateFile      /etc/ssl/certs/NEW_SSL_CRT.crt
    SSLCertificateKeyFile   /etc/ssl/private/NEW_SSL_KEY.key
    SSLCACertificateFile    /etc/ssl/certs/COMBINED_INTERMEDIATE_ROOT.pem
</code>

Now if you are using startssl they you can simply modify the existing SSLCACertificate and replacing the wildcard_ca.pem file. This might make your life a little easier.

Also you need to copy all of these files into /etc/ssl/private and /etc/ssl/certs and modify the permissions to match the rest.
",shaneonabike,2015-02-18 15:51:22
354,2015-02-16 19:25:55,"Fixes #349 
",jplock,2015-02-25 23:02:19
353,2015-02-10 01:05:21,"Hey there

Alright so in the installation we are installing postgreSQL but unfortunately for those folks who want to install Drupal it makes life hard (b/c it's not supported that greatly especially with Aegir).

I was wondering if there is an easy way to switch it to MySQL or perhaps a version that I could pull instead?
",shaneonabike,2015-02-25 18:39:26
353,2015-02-10 01:29:20,"Ok... actually if I see it properly I just need to do a more advanced config right.. Finding all the references to pgsql and replacing that with mysql. Had this been done before and then it was changed to use pgsql.

If so perhaps making a central config for the database type could be good then it allows people more flexibiity?
",shaneonabike,2015-02-25 18:39:26
353,2015-02-10 23:09:49,"Alright so I just noticed that this was switched in January. For htose that want a quick solution they can follow the clone and checkout before this change was made here https://github.com/al3x/sovereign/pull/129#issuecomment-73799387

I still think it could be good to have the option in the configuration?
",shaneonabike,2015-02-25 18:39:26
353,2015-02-25 18:39:26,"I'd be open to a pull request that provides the option of MySQL or Postgres. Generally, we've tried to pick a single reasonable default where possible.
",al3x,2015-02-25 18:39:26
353,2015-02-25 18:41:48,"Sure that sounds great! I prefer not to handle my own version of this... and be able to keep getting updates.... BUT I don't know how to code conditions in ansible.. so I'll need to read into that first before we can proceed... unless you got suggestions
",shaneonabike,2015-02-25 18:39:26
353,2015-02-25 18:42:03,"BTW I did get this working on my local repo
",shaneonabike,2015-02-25 18:39:26
353,2015-02-25 18:56:40,"This is a good starting point: http://docs.ansible.com/playbooks_conditionals.html
",al3x,2015-02-25 18:39:26
352,2015-02-09 19:18:55,"I have read through the documentation but I cannot see how sovereign can be configured for multiple emails easily? Am I missing something or can someone guide me on that process? Is this scalable for many email addresses that someone might want to setup?
",shaneonabike,2015-02-09 19:29:33
352,2015-02-09 19:29:33,"Yes, it can easily handle multiple addresses, aliases, and even multiple mail domains. Just add more elements to the `mail_virtual_*` variables in vars/user.yml and rerun the playbook.

If you're adding more domains for email, you'll want to following the DKIM/SPF setup instructions (located in the README) for each domain.

If this doesn't answer your question, please re-open the issue.
",lukecyca,2015-02-09 19:29:33
352,2015-02-09 19:33:50,"Ahhh silly me... after you pointed that out I found this 

mail_virtual_users:
- account: ""{{ main_user_name }}""
  domain: ""{{ domain }}""
  password_hash: TODO
  domain_pk_id: 1
  #  - account: ""{{ TODO }}""
  #    domain: ""{{ domain }}""
  #    password_hash: TODO
  #    domain_pk_id: 2

And now realize I can add as many as I want for the same domain as long as I increase the domain_pk_id!

COOL!
",shaneonabike,2015-02-09 19:29:33
352,2015-02-09 19:39:45,"You increment `domain_pk_id` for every new domain you add. You use the same `domain_pk_id` for all addresses under a given domain.
",lukecyca,2015-02-09 19:29:33
352,2015-02-11 03:09:53,"Just so that other folks know it's important to remove the brackets... so if you wanted multiple emails you would put

> mail_virtual_users:
> - account: ""{{ main_user_name }}""
>   domain: ""{{ domain }}""
>   password_hash: TODO
>   domain_pk_id: 1
> - account: ""user2""
>   domain: ""{{ domain }}""
>   password_hash: TODO
>   domain_pk_id: 1

Sorry about the formatting I cannot figure out to make it present properly :/
",shaneonabike,2015-02-09 19:29:33
351,2015-02-07 06:43:28,"The current configuration assumes that the VPS/server only has one IP address. For certain usages, it might be interesting to use more than one IP. Can we make this easier? 

The first thing I tried was to add an ipaddr variable that ufw can make use of like this:
ufw: rule=allow port={{ item }} to_ip={{ ipaddr }} proto=tcp
",simontretter,2015-02-25 18:41:34
351,2015-02-25 18:41:34,"For things like firewall rules, you could have users maintain a list of IP addresses associated with their server, then iterate through that list to apply the rules using Ansible's looping constructs. That will work even in the majority use case that only a single IP address is associated with a server.
",al3x,2015-02-25 18:41:34
350,2015-02-06 15:43:45,"I know it's still in beta, and this is actually more so of a gauge of interest but how interesting would it be having [Mailpie](https://www.mailpile.is/) instead of Roundcube?
",jalcine,2015-02-25 18:43:05
350,2015-02-25 18:43:05,"Mailpile has been discussed in previous issues. I'm open to it, and I appreciate the project's focus on privacy. However, because Sovereign is intended to provide a reliable personal cloud and not an experimental playground, we've tried to only use well-tested software for critical services like email.
",al3x,2015-02-25 18:43:05
349,2015-02-05 01:15:44,"I replaced `share=gtfprde` in **roles/news/templates/var_www_selfoss_config.ini.j2** with `share=gtfprdew` (added w for wallabag) and added `wallabag = https://read.{{domain}}`. 
This works even better for me than the firefox plugin. You might want to consider this.
",simontretter,2015-02-17 00:23:37
348,2015-02-02 08:37:48,"Current sovereign is broken out of the box on Ubuntu and Debian. Most severe problem ist that no external mail can be received. Dovecot throws no errors. Internal mailing works.
",simontretter,2015-02-02 10:35:05
348,2015-02-02 08:49:33,"I'm up to date with my Sovereign install and I can receive external email.
",tilsammans,2015-02-02 10:35:05
348,2015-02-02 08:57:08,"clean install here and a lot of different issues. 
edit: ok nevermind. the openvz solution of my provider overwrites the hostnames in a weird way, thats why the problems occurred on both distros.
",simontretter,2015-02-02 10:35:05
348,2015-02-02 10:42:23,"Glad to hear! :+1: 
",tilsammans,2015-02-02 10:35:05
347,2015-01-31 21:07:43,"I haven't tested this yet, just putting it up here for refinement. I'm making some room for some VMs so I can test it with both Wheezy and Trusty (and perhaps Jessie).
",neuhaus,2015-06-03 21:19:37
347,2015-06-03 21:19:37,"We do need to move to using packaged versions of znc. This PR is way out of date, unfortunately, so I'm closing it.
",al3x,2015-06-03 21:19:37
346,2015-01-28 14:30:33,"Hi,

Having a bookmark management app like https://github.com/sebsauvage/Shaarli aside of Wallabag would be really nice.

Wallabag already supports sharing links to Shaarly (http://doc.wallabag.org/en/Administrator/Hidden_options.html)

Bests
",silopolis,2015-02-25 18:44:35
346,2015-02-25 18:44:35,"Please feel free to submit a pull request for whatever open source services you think would be a welcome addition to Sovereign. However, I would caution that Shaarli does not appear to have been updated in the last year. We try to use actively maintained software for Sovereign, as it's more likely to be secure and reliable.
",al3x,2015-02-25 18:44:35
345,2015-01-19 13:08:09,"- Generate the individual cert/key/csr for each client with their name instead of using client for everything
- Modify the ""sysctl""
- We don't need to copy the ca.crt and ta.key files into the clients config directories because we already register them and add them to the ovpn file
- Fetch the single ovpn files for individual client that contains everything and save them into the clients directory in the same place, where we will run the playbook

Verified the downloaded ovpn file(s) on Windows and Linux clients.

Thanks for writing such a wonderful playbook.
",arbabnazar,2015-06-03 21:08:21
345,2015-01-21 08:58:47,"@al3x @jlund @boothead @lukecyca @jplock @lvillani , please review the changes, hope this will help. 
Thanks
- Install the iptables-persistent to save the iptables rule instead of adding it to the rc.local
- Get the result of iptables -L -v command and register the result so that we can add and save the iptables rules if it doesn't have them already
- Instead of copy the rc.local as template, adding the dnsmasq service's restart line in it becasue may be there are another lines in it and accidently the provided template overwrite those lines on the production server
- Change the prompt message 
",arbabnazar,2015-06-03 21:08:21
345,2015-01-21 09:06:36,"I'm not sure whether `iptables-persistent` plays well with `ufw`.
",lvillani,2015-06-03 21:08:21
345,2015-01-21 09:17:59,"@lvillani thanks for the comment, I don't think so it can create any problem as here it will just save the defined rule. Can you please tell me, what kind of problem it can create if they work along. Thanks
",arbabnazar,2015-06-03 21:08:21
345,2015-01-21 19:06:50,"Looks good. Rather than add a dependency on `iptables-persistent`, what about using `ufw`, e.g., writing to `/etc/ufw/before.rules`. See http://ubuntuforums.org/showthread.php?t=1250127
",ariddell,2015-06-03 21:08:21
345,2015-01-21 19:10:41,"@ariddell thanks, definitely look into this and will update it. regards
",arbabnazar,2015-06-03 21:08:21
345,2015-02-25 23:12:16,"@arbabnazar Would still love to incorporate this PR with `ufw` support! :smile_cat: 
",al3x,2015-06-03 21:08:21
345,2015-03-22 05:37:45,"@al3x, you want me to remove the iptables-persistent or use it with ufw. Please elaborate. Thanks
",arbabnazar,2015-06-03 21:08:21
345,2015-03-22 06:09:21,"I'd like you to remove iptables-persistent, using ufw in its place.
",al3x,2015-06-03 21:08:21
345,2015-06-03 21:08:21,"Please reopen if you can contribute a patch using ufw.
",al3x,2015-06-03 21:08:21
344,2015-01-17 16:14:03,"Hi, I'm not sure whether I'm doing something wrong here, or there's something up with my setup, but Roundcube is ridiculously slow with syncing contacts to the Address Book from my Owncloud carddav.

This is my setup:

VPS: Digital Ocean Debian 7 VM
Roundcube Version: 0.9.x from the Wheezy Backports recent commit.
Owncloud: 7.0.4
CardDav URL: https://cloud(dot)(domain)(dot)com/remote.php/carddav/addressbooks/(OC Username)/contacts

Here's what I did: I copied the Owncloud CardDav URL, went to Roundcube Settings -> CardDav and added a new Address Book with that URL. Initially, I set the sync frequency to every 1 hour, but beyond importing the first contact, Roundcube did nothing. I changed the frequency to every 1 minute with the same result as well.

It's been two days and Roundcube has now imported about 15 contacts. It is still happening. It doesn't stop, but I have no idea what this issue is. Deleting the address book and re-adding it also doesn't help.

To confirm whether it wasn't an issue with my Owncloud server, I setup CardDav syncing with my Nokia Lumia 720 running Windows Phone 8.1 through the ICloud account hack. It synced everything up immediately. It doesn't have any issues syncing up changes I make either way as well.

EDIT: I can't see anything suspicious in the logs as well. No error gets written to roundcube/errors.log, which tells me everything is functioning normally.

Any help would be greatly appreciated?
",balajisivaraman,2015-06-04 06:02:22
344,2015-02-25 18:46:35,"I do not personally use Roundcube with my Sovereign deployment, so I haven't run into this issue. If you have any updates please let us know.
",al3x,2015-06-04 06:02:22
344,2015-03-21 04:06:58,"For Roundcube, I use:

<S_CODE_TOKEN>

and it works just fine.

For my iPhone, however, I use:

<S_CODE_TOKEN>

and it works just fine.

Don't know if it helps but this is what works for me:
- Roundcube version 1.1.0
- OwnCloud version 8.0.2

(I manually upgraded both)

@al3x Do you use something else for webmail or do you not use webmail at all? (just curious)
",norm2k,2015-06-04 06:02:22
344,2015-03-21 18:45:29,"@norm2k I just don't use webmail at all. I use native clients on Mac and iOS.
",al3x,2015-06-04 06:02:22
344,2015-04-01 19:49:17,"@norm2k, I just upgraded to Owncloud 8.0.2, and it doesn't help, unfortunately. I do use Outlook/Windows Mobile for all my mail, but sometimes I am in the unfortunate position of having to check/respond to my mail through Roundcube. In those days, not having my contacts at hand does cause me some trouble.

@al3x, If it's not too much of a trouble, we can just leave this issue open for a while, and I'll try to find some time to figure out what's causing this.
",balajisivaraman,2015-06-04 06:02:22
343,2015-01-15 20:50:02,"This commit makes it so that sudo privileges are automatically set for the main user account via /etc/sudoers.d/. I have tested this on Debian Wheezy with Vagrant, and it appears to work as expected (running e.g. `""sudo vim /etc/sudoers""` works without password, as does `""sudo su -""`). This should make obsolete pull request  #309 (also from me, will close). I have also removed from the README the lines about adding this functionality via `visudo`, as it is no longer needed.

Please note I am not an expert on this, so it would be good to have someone look this over/test it out and ensure that I haven't missed something. If I did this in a non-ideal way, I'd like to learn how to do it better next time. This is my first real OSS commit via git/github, so accept with caution.
",dr-nate,2015-02-25 23:10:20
343,2015-01-29 05:57:54,"Good idea
",neuhaus,2015-02-25 23:10:20
343,2015-04-17 04:13:23,"Having the leading + in the sudoers file doesn't work for me in Debian 7.8. Using sudo still prompts me for a password. Removing the + solves the issue for me.
",poops,2015-02-25 23:10:20
342,2015-01-15 18:45:05,"Sorry but I forgot to clean the refference to the template from security.yml . Related to #336
",mariusv,2015-01-16 23:04:31
341,2015-01-15 18:11:33,"RC4 has had some bad press lately, I think we should disable it (in Apache etc.). This breaks only IE6 on Windows XP afaik.
If there are no objections I'll make a PR.
",neuhaus,2015-07-01 21:46:08
341,2015-01-15 18:14:35,"it could break on some old androids, but in my opinion that's ok.
",stephenjamieson,2015-07-01 21:46:08
341,2015-01-15 18:35:04,"Android 2.3.7 doesn't even support [SNI](https://en.wikipedia.org/wiki/Server_Name_Indication) which means we are already incompatible. 
(_Uhh, never mind, the official sovereign uses a wildcard certificate, not SNI_.) 

I have a site configured without RC4 and according to https://www.ssllabs.com/ssltest/ the only `Protocol or cipher suite mismatch` is with IE6+XP.
",neuhaus,2015-07-01 21:46:08
341,2015-02-25 18:47:14,"@neuhaus Please do submit a PR :sunglasses: 
",al3x,2015-07-01 21:46:08
341,2015-06-13 21:38:27,"Not sure what the best `SSLCipherSuite` is (there doesn't seem to be a big difference - i have these three in use they all do the trick:

<S_CODE_TOKEN>
",neuhaus,2015-07-01 21:46:08
341,2015-06-16 08:18:55,"Mozilla has some recommendations and a config builder at https://wiki.mozilla.org/Security/Server_Side_TLS

Here is the recommended SSLCipherSuite for the ""modern"" setting:
`SSLCipherSuite ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!3DES:!MD5:!PSK`

I will make a pull request with that one.
",neuhaus,2015-07-01 21:46:08
340,2015-01-11 10:10:14,"ahbl is no longer being maintained and has been configured to return a
positive value for every host.  This means I get a cron warning every
day reporting that my mailserver is in ircbl.ahbl.org and
dnsbl.ahbl.org.

lukecyca/check-rbl#1 has removed ahbl from the blacklists that it
checks.  This just pulls in that change.

Unfortunately, ansible's get_url won't update files which have been
downloaded already unless you set force=yes, which will cause ansible to
pull down the file from github on every single run, which isn't really
acceptable.  I have filed ansible/ansible-modules-core#625 to ask that
get_url redownload if and only if the sha256sum differs.  In the
meantime, you have to manually delete /opt/check-rbl.pl before rerunning
ansible to pull in the update.  However, at least this will work fine
for new installs.

Related to #338 (though I don't know if it truly fixes it).
",philandstuff,2015-01-11 17:36:22
339,2015-01-10 19:16:50,"Hardened SSH configuration as per https://stribika.github.io/2015/01/04/secure-secure-shell.html

Ciphers, Kex and MAC can be set via defaults.var
",fengor,2015-02-25 23:10:51
339,2015-01-11 17:54:10,"Looks good to me. Can we get one other person to review this and/or try it out before I merge?
",lukecyca,2015-02-25 23:10:51
339,2015-01-13 20:15:17,"Added some tasks to set Timezone to UTC.
",fengor,2015-02-25 23:10:51
339,2015-01-15 16:47:01,"@fengor It looks like there was some debate about the recommendations in that post which resulted in some changes. Would you mind incorporating the latest changes (ex: including GCM)?
",al3x,2015-02-25 23:10:51
339,2015-01-15 17:18:26,"couldnt get the @openssh.com ciphers to work with the default openssh packaged with my debian on the VPS so i trimmed the cipherlist to those included with it.

I can incldue a commented out line with the new recommendations in the defautls var for an easy switch though.
",fengor,2015-02-25 23:10:51
339,2015-02-21 18:56:36,":+1: LGTM
",cweagans,2015-02-25 23:10:51
338,2015-01-08 01:11:54,"The guy who runs ahbl.org has [wildcarded all dnsbl lookups](http://ahbl.org/content/last-notice-wildcarding-services-jan-1st) to return positive.  This results in:

<S_CODE_TOKEN>

Pulling it from `check-rbl.pl` will solve the cron error, but is ahbl.org used in any lookups by Postfix?
",oskapt,2015-01-15 16:34:17
338,2015-01-10 01:42:42,"Just merged a fix at https://github.com/lukecyca/check-rbl/pull/1. Would you mind bumping the version in `roles/mailserver/tasks/checkrbl.yml`, testing it, and submitting a PR?

> but is ahbl.org used in any lookups by Postfix?

Nope, we're not using it from postfix. See https://github.com/al3x/sovereign/blob/master/roles/mailserver/templates/etc_postfix_main.cf.j2
",lukecyca,2015-01-15 16:34:17
337,2015-01-02 11:26:08,"Does anyone get this error after logging in recently? I've checked the db connection and the logs but I can't find anything wrong. There's not much documentation or other ways to troubleshoot that I am aware of.
",reedlaw,2015-01-17 02:18:59
337,2015-01-17 00:15:41,"Yes I've been getting this too but haven't figured out the problem yet.

Edit: The issue appears to be a new column ""filter"" is needed in the selfoss database. I didn't figure out how to add it but I did manage to remove the database and recreate it (unfortunately losing all of the data, so I don't recommend going that route), and now selfoss is working again.
",ventolin,2015-01-17 02:18:59
337,2015-01-17 02:18:59,"@ventolin, thanks! I was able to fix mine by going into the `psql` console and executing the following:

<S_CODE_TOKEN>

There should be a migration for this but I'm satisfied with this fix. Hopefully others will find this issue.
",reedlaw,2015-01-17 02:18:59
337,2015-03-28 10:34:09,"I am having this problem right now with the most recent selfoss version. I dropped the table, now it works again. 

<S_CODE_TOKEN>

To do this, I head to change the authentication method in pg_hba.conf to md5 (it was peer) for local connections.
",simontretter,2015-01-17 02:18:59
337,2015-05-03 04:08:21,"@simontretter  that worked for me but you can avoid chaging the authentication method by connecting as follows:
`psql -h 127.0.0.1 -U selfoss selfoss`
and use the password from `vars/user.yml`.
",reedlaw,2015-01-17 02:18:59
337,2016-11-22 02:08:53,Same issue now upgrading from 2.15 to 2.16. Dropping the filter column doesn't solve it this time.,simontretter,2015-01-17 02:18:59
336,2014-12-14 21:49:39,"This is addressing the issue https://github.com/al3x/sovereign/issues/331 also I had the same issue and tested in  different Ubuntu Trusty environment. Issue causes fail2ban not being able to start.
",mariusv,2015-01-15 17:46:29
336,2014-12-18 13:01:37,"`etc_fail2ban_jail.local.j2` is a template already, I suggest we use something like this instead of two different files:

<S_CODE_TOKEN>

or to cover all versions of Ubuntu:

<S_CODE_TOKEN>

Note: This is untested.
",neuhaus,2015-01-15 17:46:29
336,2014-12-18 16:07:33,"One template seems right. I'm not sure where Ubuntu 12.04 puts the logpath. Might not hurt to just restrict it to trusty.
",ariddell,2015-01-15 17:46:29
336,2015-01-15 17:56:26,"Nice, thanks.
",neuhaus,2015-01-15 17:46:29
335,2014-12-12 00:52:23,"One can get a free SSL cert from https://www.startssl.com/, but it only gives one subdomain. However, if services were switched to domain.com/mail and domain.com/news etc. then the certificate could be used.
",alexjj,2015-01-15 16:50:35
335,2014-12-12 01:28:38,"This has been covered before... but with something like https://github.com/encharm/http-master it might be a lot more doable. 
",stephenjamieson,2015-01-15 16:50:35
335,2014-12-12 15:30:37,"Sorry I didn't find the previous issue.
That's one option, I was thinking just changing the config for the web
server.

I'll try it out myself and see how i get on and offer anything back if it
works.
On Thu, Dec 11, 2014 at 17:28 stephenjamieson notifications@github.com
wrote:

> This has been covered before... but with something like
> https://github.com/encharm/http-master it might be a lot more doable.
> 
> ‚Äî
> Reply to this email directly or view it on GitHub
> https://github.com/al3x/sovereign/issues/335#issuecomment-66719458.
",alexjj,2015-01-15 16:50:35
335,2014-12-13 15:38:45,"I had trouble finding the old issue as well.

I tried doing this at one point and found that doing it with Apache was not easy.

Hopefully Let's Encrypt will hand out wildcard certs soon and this problem will be solved.
",ariddell,2015-01-15 16:50:35
335,2014-12-18 12:29:47,"It's possible to use sovereign with a bunch of single-hostname certificates right now, but somewhat of a hassle and manual work.
",neuhaus,2015-01-15 16:50:35
335,2015-01-10 19:20:46,"you can get wildcart certs from cacert.org
",fengor,2015-01-15 16:50:35
335,2015-01-10 20:52:09,"cacert is a great service but until it's part of mainstream browsers I might as well just use a self-signed one. 
",alexjj,2015-01-15 16:50:35
335,2015-01-15 16:50:35,"Please reopen if there's a good solution to doing subdirectories instead of subdomains with Apache.
",al3x,2015-01-15 16:50:35
334,2014-11-29 14:14:56,"Hi,

I've set up my site on a version of sovereign but have noticed that the HTTP - HTTPS redirect in apache isn't always followed by some devices (most notably IOS and Android). The culprit is in roles/blog/templates/etc_apache2_sites_available_blog.j2.

I replaced the rewrite rule with the following and it all works now:

<S_CODE_TOKEN>

Just thought I'd let everyone know.
",stevelord,2015-01-15 18:26:18
334,2014-12-18 12:33:00,"Works for me. In fact, I have used a permanent redirect for this exact purpose for years and never had an issue with it.
",neuhaus,2015-01-15 18:26:18
334,2015-01-15 16:54:12,"@stevelord A PR with this change would be much appreciated.
",al3x,2015-01-15 18:26:18
334,2015-01-15 18:12:50,"Before this change is merged, could we have at least one concrete example of a client that has an issue with it?
_Works for me_ on _iOS 7.1.2_ (I can test more software if you tell me which one has this issue).
",neuhaus,2015-01-15 18:26:18
334,2015-01-15 18:23:36,"To examine this issue, I configured two apache virtual hosts using this configuration:

<S_CODE_TOKEN>

Here's what the HTTP requests look like, with headers. 
First, the permanent redirect version:

<S_CODE_TOKEN>

And here is the redirect using `mod_rewrite`:

<S_CODE_TOKEN>

Code 301 (permanent redirect) is semantically correct, 302 is a _temporary redirect_ which is not what we want. I don't see any reason why any client would have a problem with a 301 redirect. They are used all over the web. This change should **not** be merged.
",neuhaus,2015-01-15 18:26:18
334,2015-01-15 18:26:18,"Agreed. Thanks for reviewing, @neuhaus.
",al3x,2015-01-15 18:26:18
334,2015-01-15 18:26:39,"OK, one thing I noticed is that it's important to have a trailing slash, i.e.
        Redirect permanent / https://test1.example/

If you omit the slash, visiting the url `http://test1.example/foo` will redirect to
`https://test1.examplefoo`. With a trailing slash the redirect will go to `https://test1.example/foo`, which is better.

The file in question `roles/blog/templates/etc_apache2_sites_available_blog.j2` has the trailing slash so we're good.
",neuhaus,2015-01-15 18:26:18
333,2014-11-21 03:42:38,"Hello,

I was wondering if I could get a list of tags, like `ansible-playbook -i ./hosts --tags=ufw site.yml`? This would be awesome to have, and would go great with the README.

Thank you.
",tehmainframe,2015-01-15 16:47:12
333,2014-11-28 08:54:32,"I find typing in: `grep tags= -r .` shows all possible tags.
",stevelord,2015-01-15 16:47:12
333,2014-12-18 12:38:35,"`grep -hr tags= .|sed -e 's/.*tags=//'|sort|uniq`
will get you just the list of tags
",neuhaus,2015-01-15 16:47:12
332,2014-11-13 03:42:21,"On fresh installs of Debian 7.6, the current order of steps will lock you
out of SSH. This change will enable UFW only after creating firewall rules for http, https, ssh,
and DNS. Fix comes from @Debugreality in issue #303:
",apsanz,2015-01-15 16:42:30
332,2014-11-17 02:10:24,":+1: 

I was about to submit this PR myself because I came up against the same thing. 

Had to rebuild my server a few times due to ufw locking me out before the rule was set which allowed SSH access
",victorquinn,2015-01-15 16:42:30
332,2014-11-17 11:22:52,"Thanks for the fix @apsanz. Looks perfect.
",ariddell,2015-01-15 16:42:30
331,2014-11-10 15:52:38,"I believe I have this right -- and I'll submit a patch if I do -- but perhaps someone else running Ubuntu 14.04 can confirm.

The `dovecot-pop3imap` section of `/etc/fail2ban/jail.local` has:

<S_CODE_TOKEN>

On Ubuntu 14.04 (and possibly Jessie?) the relevant log file is `/var/log/mail.log` (with period). 
",ariddell,2015-01-15 17:46:42
331,2014-12-14 21:50:28,"Yep, you are right. Just sent the PR https://github.com/al3x/sovereign/pull/336
",mariusv,2015-01-15 17:46:42
331,2014-12-18 13:10:16,"Confirmed. I updated the pull request, I don't think a separate template is required.
",neuhaus,2015-01-15 17:46:42
331,2015-01-15 16:51:27,"@mariusv I'd really like to merge your PR. Would you mind adding the conditional logic to the existing template?
",al3x,2015-01-15 17:46:42
331,2015-01-15 17:28:58,"@al3x , yep..sorry, I was a bit bussy. Done..removed duplicated template and added logic for Ubuntu as in my tests all Ubuntu have the same path
",mariusv,2015-01-15 17:46:42
331,2015-01-15 17:46:42,":tada: 
",al3x,2015-01-15 17:46:42
330,2014-11-09 20:24:11,"I tried to run this and it failed twice while creating firewall rules for DNS. Once that fails I am locked out of SSHing into the server and need to rebuild the whole VPS. I rebuilt and the same thing happened. Here is were it fails:

<S_CODE_TOKEN>

I assume it has to do with the deny everything rule. The DNS was already set up for this server and I have my email hosted somewhere else so I have MX record pointing to another domain. Could this be causing the failure?
",apsanz,2014-11-10 17:57:29
330,2014-11-10 17:26:45,"Sorry this looks like it as a duplicate of issue #303. I am not sure why that issue was close because it still happening in the master. Can I submit a pull request with @Debugreality's fix? 
",apsanz,2014-11-10 17:57:29
329,2014-11-09 05:56:17,"When trying to refresh some selfoss rss feeds, I get an error related to processing images:

<S_CODE_TOKEN>

Installing the php5-gd dependency fixes this (on Ubuntu, at least). I went ahead and made the selfoss php dependencies explicit, too.
",cantsin,2015-01-15 16:38:28
328,2014-11-08 05:54:34,"See discussion in taoeffect/empress#18. Creating an issue here to invite more voices.
",taoeffect,2015-02-25 18:48:27
328,2014-11-08 13:31:17,"Yes, I think this would be a great idea. At minimum, the test script could ensure that `common` + each role alone would work.

I forget where I hit this -- I think I wanted owncloud without webmail and mail and there was a problem with the postgres database not being available.
",ariddell,2015-02-25 18:48:27
328,2014-11-08 20:14:08,"So what we need is to, as @al3x pointed out, actually begin splitting up Sovereign into separate modules the can be used individually or as part of a ""Sovereign Package"". That last part is the hard part to figure out, and @PiPeep had some suggestions (see his comments there).
",taoeffect,2015-02-25 18:48:27
328,2015-02-25 18:48:27,"Still open to a more modularized Sovereign. I'm closing this issue for lack of activity, but please reopen if there's going to be active work on this.
",al3x,2015-02-25 18:48:27
327,2014-11-05 13:25:21,"After running the playbook on a fresh node I can't access my webmail. Roundcube says ""Login failed"" every time I try logging in, and in /var/log/mail.log I see this:

`Nov  5 12:45:05 bastion dovecot: imap-login: Aborted login (auth failed, 1 attempts in 2 secs): user=<konstantin>, method=PLAIN, rip=127.0.0.1, lip=127.0.0.1, TLS, session=<b+zV8hsH+wB/AAAB>`

I am sure I use correct password, and that the hash in the `vars/user.xml` is also correct.

Coincidentally, Selfoss also doesn't seem to work, and these are the only services that use hashed passwords (I don't use ZNC). Everything else seems to be working fine.

Any troubleshooting suggestions are welcome.
",approximate,2015-01-15 16:47:37
327,2014-11-13 09:48:18,"–ö–æ—Å—Ç—è, –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–¥–æ –≤–≤–æ–¥–∏—Ç—å –≤ –≤–∏–¥–µ konstantin@your.domain
",darvin2000,2015-01-15 16:47:37
327,2014-11-13 21:31:31,"Yeah, that worked for Roundcube, thanks for solving this one. 

What about Selfoss then? Neither plain username nor full email work, anything else I am missing?
",approximate,2015-01-15 16:47:37
327,2014-11-14 05:31:19,"About Selfoss. Generating hash and paste to user.yml not working for me. You should go to news.your.domain/password , generate hash and paste it into /var/www/selfoss/config.ini.
",darvin2000,2015-01-15 16:47:37
326,2014-11-05 08:53:32,"Currently you require a single certificate which is used by everything, so you suggest a wildcard certificate. It would be useful to allow to use different certificates instead (eg one for cloud.domain.com, one for mail.domain.com, etc). This would allow to use startssl to generate valid certificates for free.

If a specific certificate file exists (eg cloud) it is used, otherwise it fallbacks to the wildcard certificate
",xdmx,2015-02-25 18:49:33
326,2014-11-05 16:10:25,"I had this running on a branch in my repository, and it was working, however I could not run the test suite as my version of Python would not work with SNI.

The branch needs updating as a lot of development has gone on since I forked it.
",ssoriche,2015-02-25 18:49:33
326,2014-11-08 20:10:35,"I've created a corresponding issue in https://github.com/taoeffect/empress/issues/34
",taoeffect,2015-02-25 18:49:33
326,2014-11-08 20:11:16,"(Note, see also issue #328 - Modularizing Sovereign).
",taoeffect,2015-02-25 18:49:33
326,2014-11-08 20:43:00,"Looks like it might have to be done with a single cert with [multiple `alt_names`](https://github.com/taoeffect/empress/issues/34).
",taoeffect,2015-02-25 18:49:33
326,2014-11-08 21:15:29,"Somewhere it should be mentioned that for $60 every two years you can create _unlimited_ wildcard certificates with startssl. It's not documented very well (likely intentionally) on startssl.
",ariddell,2015-02-25 18:49:33
326,2014-11-08 21:28:46,"Whether it's CA-signed or self-signed, there's still the issue of needing to do multiple domains in a single cert. So the `openssl.cnf` file and the `alt_names` thing will likely need to be done.
",taoeffect,2015-02-25 18:49:33
326,2014-11-08 21:35:06,"Copy/pasting [comment from Empress issue](https://github.com/taoeffect/empress/issues/34#issuecomment-62279750):

> In that [first link](http://www.postfix.org/TLS_README.html) they say that Postfix doesn't support SNI. We'll need to evaluate whether the workaround they mention is acceptable. If it's not we will have to ditch Postfix.
",taoeffect,2015-02-25 18:49:33
326,2014-11-08 23:06:32,"After skimming more closely the [postfix docs](http://www.postfix.org/TLS_README.html) about this, I'm reminded that we're currently doing [Opportunistic TLS](http://www.postfix.org/TLS_README.html#client_tls_may), and that I don't think actually verifies the validity of the cert. So this isn't an issue (for postfix/SMTP) unless that is changed to the secure setting.
",taoeffect,2015-02-25 18:49:33
326,2014-11-10 20:31:46,"@ariddell true, it's just that I'm not very comfortable to send all documents they require (passport + national id). Being able to have separated certs for each domain/service I could create them for free and without any document, but just with the domain verification
",xdmx,2015-02-25 18:49:33
326,2014-11-18 17:30:45,"Well, wait a few months and we'll have free wildcard certs: https://letsencrypt.org/2014/11/18/announcing-lets-encrypt.html
",ariddell,2015-02-25 18:49:33
326,2015-02-25 18:49:33,"Closing for lack of activity, but still open to a PR.
",al3x,2015-02-25 18:49:33
325,2014-11-04 08:55:40,"Postfix: Disable SSLv2 and SSLv3 for 'mandatory SSL' mode connections to completely mitigate the POODLE issue.
",neuhaus,2015-01-15 16:37:57
325,2014-11-04 16:34:59,"Does it actually have any effect on smtpd, given that we are using `smtpd_tls_security_level = may`? Did you run any sort of tls handshake tester or poodle tester against your server before/after this change?
",lukecyca,2015-01-15 16:37:57
325,2014-11-04 16:39:34,"I think it will help because we use `smtpd_tls_auth_only = yes`, am I mistaken?
",neuhaus,2015-01-15 16:37:57
325,2014-11-04 22:34:51,"I think you're right. I just wanted to know if you'd run any test on your server before/after the change to show that it's working as intended.
",lukecyca,2015-01-15 16:37:57
325,2014-11-05 13:47:44,"I enabled it and it's still working, other than that: No
",neuhaus,2015-01-15 16:37:57
325,2014-12-18 12:25:47,"I added the `smtp_tls_protocols` and `smtpd_tls_protocols` directives as well.
",neuhaus,2015-01-15 16:37:57
324,2014-11-04 08:51:25,"Disable SSLv3 in Dovecot imap server to avoid POODLE vulnerability
",neuhaus,2014-11-04 15:54:24
323,2014-11-03 20:28:01,"Add a status vhost to apache, so that monit's http monitoring will work.
It doesn't particularly matter to the monit check what this vhost does
as long as it returns 200, but I thought it would be nice to use
apache's builtin status functionality.  Ideas cribbed from [1].  It
might also be possible to use monit's apache-status functionality to
alert on more sophisticated criteria, but this will do for now.

Open question: does collectd support apache-status? Might it also be
interested in this vhost?

Fixes #299.

[1] http://mmonit.com/wiki/Monit/MonitorApacheStatus
",philandstuff,2015-01-15 16:36:48
323,2014-11-03 20:30:03,"answering my own question: [collectd supports apache-status](https://collectd.org/wiki/index.php/Plugin:Apache).  That might be an interesting (separate) feature.
",philandstuff,2015-01-15 16:36:48
322,2014-11-01 23:29:31,"Continuing with permissions audit (see #321), the postgresql backup that's created by `/root/tarsnap.sh` in `/decrypted` is world-readable.

This should be fixed by having a `umask 077` call within the cron script prior to this line:

https://github.com/al3x/sovereign/blob/5f6160f914c647ddb6a3d8e47d1b5a46fbf6b22c/roles/tarsnap/files/tarsnap.sh#L61

Needless to say, without this, it is dangerous as it will expose every single password and user in the database to all users on the system.
",taoeffect,2014-11-02 16:21:10
321,2014-11-01 23:03:21,"So, while going through sovereign I've been noticing many significant security flaws, of which this is but one. Will be documenting them here in the issues.

To start, the tarsnap private key is world-readable:

<S_CODE_TOKEN>

https://github.com/al3x/sovereign/blob/d84572cfc643c7728749ccc91b81d37844324909/roles/tarsnap/tasks/tarsnap.yml#L67

This must be fixed an ansible `mode=600`. More to come.
",taoeffect,2014-11-02 16:21:10
321,2014-11-02 16:27:43,"Thank you for reporting this and #322, @taoeffect.

While I agree that these files should have more restrictive permissions, please keep in mind that machines configured with Sovereign are not intended to be shell servers. The vast majority of Sovereign installations have only two users that are not for services/daemons: `root` and `deploy`. The `deploy` user is typically given passwordless sudo rights, so a compromise of that user is already ""game over"". Under regular circumstances, there simply aren't any other users on a Sovereign box who'd be snooping around for files with lax permissions.

Still, we want Sovereign to be solidly secure out of the box, so if you find any other permissions that should be restricted please let us know. Cheers!
",al3x,2014-11-02 16:21:10
321,2014-11-03 03:25:32,"> Under regular circumstances, there simply aren't any other users on a Sovereign box who'd be snooping around for files with lax permissions.

There are a bunch; `cat /etc/passwd` to see them. Every one of the daemons is a potential threat. As long as they're able to read from the file system, they would be able to read any world-readable files (when compromised).
",taoeffect,2014-11-02 16:21:10
321,2014-11-03 03:28:58,"Thanks for fixing this so quickly btw! :+1: 
",taoeffect,2014-11-02 16:21:10
321,2014-11-04 08:58:07,"Thanks for going over the permissions!
",neuhaus,2014-11-02 16:21:10
321,2014-11-04 22:50:24,"@neuhaus yep! i didn't finish though, just looked through the mailserver parts that are relevant to me.

@al3x sorry about my initial reply btw, it was poorly worded and I edited it shortly after, but if you only saw the GitHub email I apologize for the lackluster wording it had!
",taoeffect,2014-11-02 16:21:10
320,2014-11-01 15:11:46,"(Forgive me, I don't know the right verbs to use when messing with playbooks.)

This works when site.yml is unmodified:
  % ansible-playbook -i ./hosts --extra-vars=""testing=true"" site.yml

However, you will get a failed deploy of roundcube if you stage the playbooks twice like this:
- common and mailserver
- common, mailserver, and webmail

(You can reproduce by commenting out the playbooks in site.yml to just common and mailserver and then returning webmail to the set.

It appears that deploying like this causes the roundcube package to autoconfigure to a mysql database instead of postgres.  I do not know why it configures correctly when all the books are deployed together.  I fiddled with debconf-{get,set}-selections to convince dpkg to configure correctly but failed.  I must be missing something about debian package configuration.

I am somewhat interested in running down this bug but am stuck on the package manager.  Any suggestions?
",mikeashley,2014-11-03 06:44:36
320,2014-11-02 16:43:19,"Can you please post output from your failing Ansible run?
",al3x,2014-11-03 06:44:36
320,2014-11-02 22:04:22,"I tried and was unable to reproduce this when running from a clean Debian 7 VM.

I believe I had a bad VM snapshot when testing this.  I had a snapshot I made after running the common and mailserver playbooks.  I must have tampered with the VM prior to snapshotting, because mysql is installed.  I believe that's what led the roundcube package install script to use mysql instead of postgres.

When starting from a clean Debian 7 VM, mysql is not installed after running the common and mailserver playbooks.  Adding webmail and running again works fine.  Postgres is used for roundcube's database as expected.

Recommend this issue be closed.

For posterity, here's the tail of the botched deploy:

NOTIFIED: [mailserver | import sql postfix] **********************************\* 
changed: [192.168.56.101]

NOTIFIED: [webmail | set roundcube password] *********************************\* 
failed: [192.168.56.101] => {""changed"": true, ""cmd"": [""sudo"", ""-u"", ""postgres"", ""psql"", ""-d"", ""roundcube"", ""-c"", ""ALTER USER roundcube with password 'testPassword';""], ""delta"": ""0:00:00.260263"", ""end"": ""2014-11-02 16:45:43.786420"", ""rc"": 2, ""start"": ""2014-11-02 16:45:43.526157"", ""warnings"": []}
stderr: psql: FATAL:  database ""roundcube"" does not exist

FATAL: all hosts have already failed -- aborting

NOTIFIED: [mailserver | restart postfix] *************************************\* 
FATAL: no hosts matched or all hosts have already failed -- aborting

FATAL: all hosts have already failed -- aborting

NOTIFIED: [mailserver | restart postfix] *************************************\* 
FATAL: no hosts matched or all hosts have already failed -- aborting

FATAL: all hosts have already failed -- aborting

PLAY RECAP *******************************************************************\* 
           to retry, use: --limit @/home/mike/site.retry

192.168.56.101             : ok=117  changed=24   unreachable=0    failed=1   
",mikeashley,2014-11-03 06:44:36
319,2014-11-01 15:04:06,"Debian 7.7 uses Roundcube 0.7.x, which is pretty old.  There appear to be lots of fixes and improvements in the 0.9.x and 1.0.x series.  Suggest moving to 0.9.x using the package in wheezy backports.

Changes:
- Added backports to apt configuration.
- Updated roundcube task to use the roundcube backport.
- Updated roundcube's main.inc.php configuration file to use the one included in the backport distribution.  Migrated configuration parameters from the existing configuration file except in cases where it looked like the Roundcube team was changing defaults that were not touched by Sovereign's configuration.  I may have gotten some wrong; needs review by a Sovereign maintainer.

This was tested in the development environment and has been deployed on my own server.
",mikeashley,2015-01-15 16:36:17
319,2014-11-04 09:06:36,"This patch (more specifically, the changes to `roles/webmail/tasks/roundcube.yml`) will break installs on Ubuntu 14.04.
Can you figure out a way to make it compatible with both Debian and Ubuntu?
Ubuntu 14.04 ships with roundcube 0.9.5-4 btw.
",neuhaus,2015-01-15 16:36:17
319,2014-11-06 08:27:44,"It looks like Ubuntu support is marginal.  What's the advantage of supporting multiple distributions when it adds testing and development burden?
",mikeashley,2015-01-15 16:36:17
319,2014-11-06 09:26:02,"Ubuntu isn't that much different from Debian, it's based on Debian anyway so it doesn't take much to support it. I'm using sovereign with Ubuntu 14.04.
Ubuntu has the advantage of long term support and the current distribution 14.04 LTS has more recent packages than Debian 7 so some packages such as gitolite3 do not require compilation etc.
Also, if we widen the audience for the project by including Ubuntu it will result in more contributions.

Regarding this patch: It wouldn't be much work to make it compatible with both Debian 7 and Ubuntu 14.04 and they would both use the same 0.9.x version then which seems like a good idea. For an example, look at `roles/owncloud/tasks/owncloud.yml`.

Something like this would do the trick (untested) for the file `roles/webmail/tasks/roundcube.yml`:

<S_CODE_TOKEN>
",neuhaus,2015-01-15 16:36:17
319,2014-11-06 09:49:05,"@mikeashley Check out the branch https://github.com/neuhaus/sovereign/tree/patch-1
I took your changes and made the necessary modifications for Ubuntu support. I can't add my commit to this pull request, so I've send a pull request to you instead (https://github.com/mikeashley/sovereign/pull/2 )
",neuhaus,2015-01-15 16:36:17
319,2014-11-06 10:08:43,"Thank you for the patch to roundcube.yml.  Indeed, a straightforward fix.  What is the story for handling configuration file differences if different distributions use different package versions?  Don't worry about it until it's a problem?  It makes me a little nervous, since a package installed with an incorrect configuration file might appear to work at first glance but fail in mysterious ways down the road.
",mikeashley,2015-01-15 16:36:17
319,2014-11-06 10:18:31,"I'd say we deal with varying package versions on a case by case basis.
My guess is we will start adding more and more different config file templates for different package versions eventually (when Debian 8 is out for example).
",neuhaus,2015-01-15 16:36:17
319,2014-11-06 10:48:49,"Do you propose ever dropping support for a distribution?  I see support in Sovereign for Ubuntu 12 and Ubuntu 14.  Wouldn't you expect people using Ubuntu to go to 14?  Wouldn't you expect people on Debian 7 to go to Debian 8 when it is released?

You suggestion leads to the following development cycle.

1) Have an idea for a new role or an improvement to an existing role.
2) Manually implement the role on every supported distribution.
3) Find any differences in the configurations, across VMs.  Don't miss anything!
4) Implement Ansible scripts with static configuration files and specialized templates per distribution.
5) Update testing scripts to check that the different packages were set up correctly.

Best case: the packages are the same, but I still have to do work proportional to the number of distributions supported to verify that.  Worst case, there are differences, and I need to carefully work out the differences and set up the configuration files.  Then, I have to understand all versions of the packages in enough detail to write proper tests to ensure I got it correct in the Ansible playbooks.

Do I have this right?  Is it ok to expect this from contributors?  Can you do anything less and still trust that a pull request is legitimate?
",mikeashley,2015-01-15 16:36:17
319,2014-11-06 10:58:52,"I would suggest we drop support for old distributions eventually. It mostly depends on finding people willing to support their distribution in this project.

I'm not involved in the support for Ubuntu 12.04, I believe it is incomplete.

Regarding the development cycle:
I believe it could work like this
1) Have an idea for a new role or an improvement to an existing role.
2) Implement the role on the distribution(s) your personally are able/willing to test
3) Ask for help regarding the other distributions, if necessary

Given that Ubuntu is also based on Debian, the number of differences appears to be manageable.
",neuhaus,2015-01-15 16:36:17
319,2014-11-07 00:35:09,"Tested this updated pull request on Debian 7.  I have not tested the updated playbook on Ubuntu.  As for configuration files, both Ubuntu 14 and Debian 7 are using Roundcube 0.9.5, so using one set of configuration files is probably ok.
",mikeashley,2015-01-15 16:36:17
319,2015-01-17 18:54:58,"I'm having issues on an existing install on Debian when running the playbook. I'm pretty sure the task is hanging here (i.e. I left it for almost an hour):

> TASK: [webmail | Install Roundcube from wheezy-backports]

When I first ran the playbook I received an email from debconf. Subject line was:

> Configuring roundcube-core -- Empty passwords unsupported with PostgreSQL

Don't know if these were connected because later I received a cron warning there was signing issues with wheezy backports.

Wonder if anyone can give some pointers here. Thanks.
",iboxifoo,2015-01-15 16:36:17
319,2015-01-20 15:57:08,"Apologies if this reply is in the wrong spot.

I ended up having the same problem this morning; here's how I fixed it.
1. Killed the apt-get process.  In hindsight this was a bad move (because it left the dpkg processes running), so try skipping this step.
2. Doing a _ps|grep dpkg_ showed three relevant processes:
   1. /usr/bin/dpkg --force-confdef --force-confold --status-fd 21 --configure roundcube-pgsql:all roundcube-core:all roundcube-plugins:all roundcube:all
   2. /usr/bin/perl -w /usr/share/debconf/frontend /var/lib/dpkg/info/roundcube-core.postinst configure 0.7.2-9+deb7u1
   3. /bin/sh /var/lib/dpkg/info/roundcube-core.postinst configure 0.7.2-9+deb7u1
3. I killed the third one, the roundcube postinit script.  This cleanly stopped the perl and dpkg processes (and probably would have allowed for a graceful exit of the apt-get process, but I don't know what ansible would have done).
4. I then ran _dpkg --configure -a_ to try completing the roundcube install.
   1. I refused the dbconfig-common installation, as I figured the db was already set up.
   2. I kept the local configuration file - the only differences between the local file and the new file were that the new file didn't have the db information.
   3. It asked to do a db update, I selected yes.
   4. It then asked for the password of the db admin user, with a note that this should not be required for postgres.  However, entering an empty password displays the error ""Empty passwords unsupported with PostgreSQL"" (this was most likely the cause of the hang).  So instead I entered the postgres admin password.
   5. Finally I allowed the update of main.inc.php.

After this process completed, roundcube appeared to be updated and working, so I ran the ansible playbook again and this time it completed without error.  
",kigero,2015-01-15 16:36:17
319,2015-03-02 00:31:56,"Thanks for the detailed writeup, @kigero! I ran into the same issue and was able to solve it by following your example. I skipped step 1 as you recommended and the apt-get process did stop on its own (ansible exited with errors).
",ventolin,2015-01-15 16:36:17
318,2014-11-01 14:58:16,"Port 587 for smtp does not appear to match the mailserver configuration and leads to incorrect autoconfiguration.  Changed to 465 and tested with Icedove.
",mikeashley,2014-11-04 15:53:08
318,2014-11-04 09:03:10,"I don't agree with this pull request. Port 587 is correct, it is the submission port, designed for authorized mail clients (RFC 6409)

Wikipedia states at https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol

_""Although some servers support port 465 for legacy secure SMTP in violation of the specifications, it is preferable to use standard ports and standard ESMTP commands according to RFC 3207 if a secure session needs to be used between the client and the server.""_
",neuhaus,2014-11-04 15:53:08
318,2014-11-04 09:59:34,"When deploying on Debian 7, postfix listens on 465, not 587.  Roundcube is configured to submit to 465 as well.  Are you suggesting changing the configuration of postfix and roundcube instead?  Is this a Debian-only problem?
",mikeashley,2014-11-04 15:53:08
318,2014-11-04 15:52:48,"This PR makes sovereign consistent with itself (using port 465 throughout), so it's merge-able.

I agree that 587 is more correct and that we should switch to it. @neuhaus, could open an issue to that effect (and submit a pull request if you are inclined).
",lukecyca,2014-11-04 15:53:08
318,2014-11-14 22:15:02,"I closed our [corresponding issue](https://github.com/taoeffect/empress/issues/24) in Empress because [STARTTLS is less secure that SSL/TLS](https://stackoverflow.com/questions/15796530/what-is-the-difference-between-ports-465-and-587), and apparently [it's ""required""? for 587 (or that's the purpose of that port)](https://stackoverflow.com/questions/15796530/what-is-the-difference-between-ports-465-and-587).

The ""correct"" answer in that serverfault link is bunk. He's looking at it from the perspective of server-to-server communication which is crappily secured atm, but for client-to-server communication [STARTTLS does nothing](https://twitter.com/taoeffect/status/533059866093686784).

So, I recommend closing this issue here as well.
",taoeffect,2014-11-04 15:53:08
318,2014-11-14 22:18:18,"Updated comment above to add this link re port 587 and STARTTLS: https://stackoverflow.com/questions/15796530/what-is-the-difference-between-ports-465-and-587
",taoeffect,2014-11-04 15:53:08
318,2014-11-15 07:22:16,"1. the roundcube connection is on the loopback interface so even if it's not encrypted, there's no issue
2. server-to-server SMTP always uses port 25, that's not what this issue is about
3. clients should be configured to force TLS on. If STARTTLS gets stripped by an active attacker on port 587, it will get noticed right away.
4. port 465 is deprecated
",neuhaus,2014-11-04 15:53:08
318,2014-11-15 07:23:51,"I'll open a separate issue about this so this issue can be closed
",neuhaus,2014-11-04 15:53:08
317,2014-10-16 02:14:34,"I noticed this after rebooting my virtual box with Debian wheezy.

Adding the following to the end of encfs.yml works but I'm not sure if this is the best solution as it adds your encryption password in plain text. Also rc.local is not the recommended way to add on boot scripts.

# Need to set up to mount on boot
- name: remount encfs on boot
  lineinfile: dest=/etc/rc.local regexp='encfs /encrypted /decrypted --public --stdinpass' insertbefore='^exit 0' line='printf ""{{ encfs_password }}"" | encfs /encrypted /decrypted --public --stdinpass'
",Debugreality,2014-10-16 02:31:36
317,2014-10-16 02:31:36,"Rebooting will indeed unmount the encfs volume. To remount it, simply run your playbook against it.

See #71 and #139 for discussion on this issue.
",lukecyca,2014-10-16 02:31:36
317,2015-02-18 08:18:48,"Having to enter the passphrase for encfs after the reboot is exactly the whole point of encrypting a filesystem in the first place.

If someone confiscates or steals your server you want them unable to access your files.
",neuhaus,2014-10-16 02:31:36
316,2014-10-15 05:41:18,"In response to the POODLE SSL 3.0 exploit vulnerability released to the
public today
http://googleonlinesecurity.blogspot.com/2014/10/this-poodle-bites-exploiting-ssl-30.html
",patrickod,2014-10-20 17:31:02
316,2014-10-15 22:51:45,"I believe the negative is required, so the line should be:

<S_CODE_TOKEN>
",lukecyca,2014-10-20 17:31:02
316,2014-10-15 23:35:12,"Indeed. Will update tonight, night time and sed cause such things :)
",patrickod,2014-10-20 17:31:02
316,2014-10-18 17:31:40,"Now updated w/ `-SSLv3` where required 
",patrickod,2014-10-20 17:31:02
316,2014-10-20 17:31:07,"Thanks!
",lukecyca,2014-10-20 17:31:02
315,2014-10-08 18:18:28,"Currently the NamedVirtualHost line doesn't get added on Ubuntu because of the switch to mod_gnutls.c. 
Without this, you can't host multiple domains (with HTTPS) on the same site under Ubuntu (using SNI).
",ariddell,2014-10-23 11:55:36
315,2014-10-23 11:55:36,"Apparently NamedVirtualHost is deprecated and doesn't have any effect. I thought it was required for SNI.

https://httpd.apache.org/docs/2.4/upgrading.html
",ariddell,2014-10-23 11:55:36
314,2014-10-06 10:41:04,"[Mailpile](https://mailpile.is) seems like a much better webmail interface than Roundcube, in both looks and functionality, it could be used as the default webmail. Thoughts?
",mitchelldm,2014-10-31 21:48:48
314,2014-10-06 13:07:44,"Mailpile looks like a good alternative, eventually, but for now it's still in the beta stages.  Roundcube has been around for quite some time and works quite well for most needs.
",stephenjamieson,2014-10-31 21:48:48
314,2014-10-31 21:48:48,"Until Mailpile is 1.0 and has been battle-tested, I'm not comfortable including it in Sovereign. Agreed that it looks more appealing, though!
",al3x,2014-10-31 21:48:48
313,2014-10-01 21:32:29,"Hey, running the install and getting a 404 on one of the URLs it's trying to fetch:

<S_CODE_TOKEN>
",natew,2014-10-08 17:40:52
313,2014-10-01 21:51:22,"Seems like the ""wheezy"" folder is missing:

http://ppa.launchpad.net/ansible/ansible/ubuntu/dists/

When looking for:

http://ppa.launchpad.net/ansible/ansible/ubuntu/dists/wheezy/main/source/Sources
",natew,2014-10-08 17:40:52
313,2014-10-04 19:06:25,"Is there something I've set up incorrectly possibly to make it point to wheezy? Is it recommended to use a different version of Debian?
",natew,2014-10-08 17:40:52
313,2014-10-06 00:55:06,"Ansible only provides a repository for Ubuntu through launchpad. Debian has to get it somewhere else.
",jrgifford,2014-10-08 17:40:52
313,2014-10-08 17:40:52,"Was caused by running this _from_ Debian. As a brand new user of ansible, found the docs a bit fuzzy on where all the commands should be run from. But, makes sense. Thanks for the help.
",natew,2014-10-08 17:40:52
312,2014-10-01 16:30:01,"Running Debian 7 and getting the following when trying to run the playbook after getting through all the other steps in the readme:

<S_CODE_TOKEN>

Line 19 of /etc/ssh/ssh_config:

<S_CODE_TOKEN>

I am totally new to ansible though, is it trying to target some other machine?
",natew,2014-10-01 21:31:02
312,2014-10-01 16:33:09,"Check your `hosts` file in the sovereign root directory. Last paragraph of [Step 4](https://github.com/al3x/sovereign#4-configure-your-installation).
",lukecyca,2014-10-01 21:31:02
312,2014-10-01 16:52:47,"Ah thanks, I guess overlooked because all the lines of password generation.

So, wasn't sure what was meant by ""enter your hosts IP"", so I just entered the IP of the box I am already on. Now I get this (I replaced my IP with `__XXX__` here):

<S_CODE_TOKEN>
",natew,2014-10-01 21:31:02
312,2014-10-01 17:07:39,"The IP in the hosts file should be that of the server you want to provision. Typically this is a Virtual Private Server (VPS) that you rent from Amazon, Rackspace, Linode, DigitalOcean, or similar. It could also be a real server that you've freshly installed with Debian 7.

The error you're getting now is because ansible cannot ssh to the host you've asked it to provision. It doesn't seem to have an authorized key. See step 3 in the (setting up authorized keys).
",lukecyca,2014-10-01 21:31:02
312,2014-10-01 21:31:02,"Ah man just accidentally deleted the last comment. I'll start a new thread. Thanks for the help.
",natew,2014-10-01 21:31:02
312,2015-02-11 02:34:48,"Also if others are looking through this and are confused the idea is that you are cloning this repository to your local machine and then it connect to the remote one!
",shaneonabike,2014-10-01 21:31:02
311,2014-10-01 03:50:22,"What is proper procedure to train DSPAM when it gets too aggressive with marking email as spam? I assume I just need to move mail from Junk to Inbox, but wanted to be sure.
",hippich,2014-10-01 20:08:16
311,2014-10-01 06:06:48,"If it is set up and working correctly, you simply need to move a message out of the Junk/Spam folder for it to register as a false positive.

You can have a look at your stats and compare them with mine. With 3255 spams and 2006 hams correctly identified, I also had 297 spams marked as ham, and 0 hams marked as spam.

<S_CODE_TOKEN>

See also #196 for more info.
",lukecyca,2014-10-01 20:08:16
311,2014-10-01 20:08:16,"thanks
",hippich,2014-10-01 20:08:16
310,2014-09-17 14:00:19,"I've been trying to get sovereign set up on a DO debian 7 droplet but keep getting this error with encfs. Does anyone have any idea what it might be about?

> TASK: [common | Create encfs] ************************************************\* 
> failed: [178.62.243.52] => {""changed"": true, ""cmd"": ""printf \""p\nREDACTED\"" | encfs /encrypted /decrypted --public --stdinpass && touch /decrypted/test"", ""delta"": ""0:00:05.542570"", ""end"": ""2014-09-17 13:54:25.265302"", ""rc"": 1, ""start"": ""2014-09-17 13:54:19.722732""}
> stderr: fuse: device not found, try 'modprobe fuse' first
> fuse failed.  Common problems:
> - fuse kernel module not installed (modprobe fuse)
> - invalid options -- see usage message
>   stdout: Creating new encrypted volume.
>   Please choose from one of the following options:
>   enter ""x"" for expert configuration mode,
>   enter ""p"" for pre-configured paranoia mode,
>   anything else, or an empty line will select standard mode.
>   ?> 
>   Paranoia configuration selected.
> 
> Configuration finished.  The filesystem to be created has
> the following properties:
> Filesystem cipher: ""ssl/aes"", version 3:0:2
> Filename encoding: ""nameio/block"", version 3:0:1
> Key Size: 256 bits
> Block Size: 1024 bytes, including 8 byte MAC header
> Each file contains 8 byte header with unique IV data.
> Filenames encoded using IV chaining mode.
> File data IV is chained to filename IV.
> File holes passed through to ciphertext.
> 
> -------------------------- WARNING --------------------------
> The external initialization-vector chaining option has been
> enabled.  This option disables the use of hard links on the
> filesystem. Without hard links, some programs may not work.
> The programs 'mutt' and 'procmail' are known to fail.  For
> more information, please see the encfs mailing list.
> If you would like to choose another configuration setting,
> please press CTRL-C now to abort and start over.
> 
> Now you will need to enter a password for your filesystem.
> You will need to remember this password, as there is absolutely
> no recovery mechanism.  However, the password can be changed
> later using encfsctl.
> 
> FATAL: all hosts have already failed -- aborting
> 
> PLAY RECAP *******************************************************************\* 
>            to retry, use: --limit @/Users/capanema/site.retry
> 
> 178.62.243.52              : ok=14   changed=9    unreachable=0    failed=1  

When I run ""modprobe fuse"" as suggested:

> root@mail:~# modprobe fuse
> ERROR: could not insert 'fuse': Unknown symbol in module, or unknown parameter (see dmesg)

And fuse has been installed, as per:

> TASK: [common | Install encfs & fuse] ****************************************\* 
> changed: [178.62.243.52] => (item=encfs,fuse,libfuse-dev)

I have no idea of what's going on.
",guicapanema,2014-09-17 15:11:54
310,2014-09-17 14:45:29,"Digital Ocean supplies their own kernels to your VM, regardless of what you've installed through apt.  

See https://github.com/al3x/sovereign/issues/147#issuecomment-42434828
",lukecyca,2014-09-17 15:11:54
310,2014-09-17 15:11:54,"I so sorry for repeating the question -- hadn't spotted it. Cheers!
",guicapanema,2014-09-17 15:11:54
309,2014-09-15 10:15:50,"Adding the suggested line in the wrong place will cause you to
be locked out after initial deployment.

Arguably you should know what you're doing with these things,
but for those who don't have deep background in sys admin this
can be an unexpected gotcha (Ansible pre 1.7 does not error).
",dr-nate,2015-01-15 20:51:23
309,2015-01-15 16:57:41,"Would like to merge a PR that uses the option @malvim suggested.
",al3x,2015-01-15 20:51:23
309,2015-01-15 20:51:23,"Closing because it should be solved by #343.
",dr-nate,2015-01-15 20:51:23
308,2014-09-11 14:47:23,"These can only serve to confuse people.
",ariddell,2014-10-08 18:16:00
307,2014-09-11 13:49:11,"Using openssl is consistent with previous instructions and has the notable
virtue of being cross-platform.
",ariddell,2014-09-11 14:35:16
306,2014-09-09 16:48:27,"Love the project, long-time listener, first time caller.

Is [supporting 12.04](https://github.com/al3x/sovereign/commit/7c9084fcba5c77d318efeaf42222b08af7c2a762#commitcomment-6595791) a goal of the project?
",bigfleet,2014-10-31 21:49:07
306,2014-09-09 17:52:34,"I was on 12.04, currently on 14.04. Only using ZNC, OpenVPN, news, and monitoring though.
",hectcastro,2014-10-31 21:49:07
306,2014-09-11 05:37:22,"Personally, I'll spend my time on supporting newer versions of Debian, but I'm not interested in Ubuntu compatibility. I'll happily accept pull requests, though!
",al3x,2014-10-31 21:49:07
306,2014-09-11 07:06:54,"I'm on 12.04 and Sovereign runs fine.
",tilsammans,2014-10-31 21:49:07
306,2014-09-11 07:07:49,"The bug I spotted in the other comment has been fixed, btw. :smile: 
",tilsammans,2014-10-31 21:49:07
306,2014-10-18 06:50:36,"I believe that @neuhaus has corrected many issues with getting Sovereign running on Ubuntu 14.04. He'd be the best person to check with.
",the-solipsist,2014-10-31 21:49:07
306,2014-10-18 19:19:53,"## I'm not running Ubuntu 12.04 anywhere, so I can't really support it. If you have concrete issues I can try to help though.

Von unterwegs

> Am 18.10.2014 um 08:50 schrieb the-solipsist notifications@github.com:
> 
> I believe that @neuhaus has corrected many issues with getting Sovereign running on Ubuntu 14.04. He'd be the best person to check with.
> 
> ‚Äî
> Reply to this email directly or view it on GitHub.
",neuhaus,2014-10-31 21:49:07
305,2014-09-08 18:08:09,"By default, postfix shouldn't listen on port 25, other than on localhost. The following diff should be incorporated:

<S_CODE_TOKEN>
",ipartola,2014-09-10 13:38:24
305,2014-09-10 13:38:24,"Doh! Yes, port 25 should be open to receive mail...
",ipartola,2014-09-10 13:38:24
304,2014-09-08 17:58:48,"The error message as follows:

<S_CODE_TOKEN>

This is on a fresh Ubuntu 14.04 install.
",ipartola,2014-11-02 16:31:04
304,2014-11-02 16:31:04,"If anyone else runs into this issue, please reopen.
",al3x,2014-11-02 16:31:04
304,2015-08-20 13:21:33,"I've had the same issue on a (almost) vanilla install with Vagrant. I use master version, on which I integrated the PR #397 .
",RomainEndelin,2014-11-02 16:31:04
304,2015-08-20 14:08:01,"Strange enough, it actually worked when re-running the playbook.
",RomainEndelin,2014-11-02 16:31:04
303,2014-09-08 15:51:22,"Currently, roles/common/tasks/ufw.yml task Deny everything and enable UFW seems to enable the firewall too early on. This means that all connections will be dropped before the exception for ssh is made. This is very problematic when running ansible over SSH on a remote host. Ideally, the firewall should be enabled as the last step in this task.
",ipartola,2014-11-02 16:30:18
303,2014-09-08 21:22:34,"I have not seen this problem, and I am using Ansible over SSH to a remote host.
",tilsammans,2014-11-02 16:30:18
303,2014-09-09 14:52:52,"Had the same issue on Debian 7. The issue is that the ""Deny everything and enable UFW"" step fails with ""ERROR: problem running ufw-init"" which AFAIK isn't an issue. I added ""ignore_errors: yes"" to this step and it fixes the issue.
",pyrho,2014-11-02 16:30:18
303,2014-09-09 17:36:46,"I've never encountered this problem although it does seem like the order in `ufw.yml` might be adjusted.
",ariddell,2014-11-02 16:30:18
303,2014-10-16 01:57:55,"I had the same issue and split up the deny everything and enable UFW into separate commands with enable after ssh rules. Seems to work, see config below:

\- name: Deny everything
  ufw: policy=deny

\- name: Set firewall rule for DNS
  ufw: rule=allow port=domain

\- name: Set firewall rule for mosh
  ufw: rule=allow port=60000:61000 proto=udp

\- name: Set firewall rules for web traffic and SSH
  ufw: rule=allow port={{ item }} proto=tcp
  with_items:
    - http
    - https
    - ssh

\- name: Enable UFW
  ufw: state=enabled
",Debugreality,2014-11-02 16:30:18
303,2014-10-16 10:48:05,"Aren't the tests run against Debian 7? It's strange that the problem isn't more widespread.
",ariddell,2014-11-02 16:30:18
303,2015-02-12 02:42:21,"This hasnt been resolved for me and I was completely locked out of my server after the apache was attempted to be restarted
",shaneonabike,2014-11-02 16:30:18
302,2014-09-07 16:48:33,"Vagrant provisioning currently fails without irc_timezone set in
vars/testing.yml.  This is probably due to changes introduced in
al3x/sovereign#300 to permit the znc timezone to be configured.  The
file vars/users.yml already has a TODO entry for irc_timezone.
",cthachuk,2014-09-08 17:52:32
301,2014-09-06 20:54:34,,jlund,2014-09-07 00:10:52
300,2014-09-01 10:09:45,"Since 1.0, znc has allowed you to specify the user's timezone:
conveniently, in tzinfo format.  This allows the user to configure and
specify that timezone.

This matters because it affects the timestamps that znc issues when
playing back the buffer after a disconnection.

for more info see:
- http://wiki.znc.in/ChangeLog/1.0#Timezones
- http://wiki.znc.in/Configuration

There is also a zpush_timezone configuration option, which could at some
point be unified with irc_timezone into a common configuration item.
",philandstuff,2014-09-01 17:12:47
299,2014-09-01 09:33:49,"The apache2 monitoring config for monit has the lines:

<S_CODE_TOKEN>

The problem is that requesting `http://localhost` results in a 403 response with the message ""you don't have permission to access / on this server"".  Monit then considers the 403 to be a failed check, and so reports ""Connection failed"" and eventually gives up on monitoring apache2 entirely.
",philandstuff,2015-01-15 16:36:48
299,2014-09-01 09:34:48,"I'm not sure the best way to resolve this. In the past, I've added a monitoring-only vhost or path to apache (or nginx) for the purposes of being pinged by nagios (or monit).  Would a PR with something like that be considered for inclusion?
",philandstuff,2015-01-15 16:36:48
299,2014-11-02 16:28:57,"@philandstuff Yes, I'd absolutely include a monitoring-only Apache virtual host.
",al3x,2015-01-15 16:36:48
298,2014-09-01 09:05:08,"The tomcat6 user doesn't have the right privileges to run the
/etc/init.d/tomcat6 script.  Removing these lines allows monit to
restart tomcat if it stops for any reason, and makes the tomcat6 monit
config more consistent with other monit configs elsewhere.
",philandstuff,2014-09-07 00:10:26
298,2014-09-01 09:06:54,"eek, reading this over it might not be clear what the actual problem is.  The problem is this: from the monit web UI, if you try to stop or start the tomcat service, it will fail.
",philandstuff,2014-09-07 00:10:26
297,2014-08-30 00:13:54,"Whenever I try to connect to Roundcube, all I get is `Connection to storage server failed.`.

I can't connect to IMAP or SMTP either.

My `mail.err` reads:

<S_CODE_TOKEN>

My `mail.log` reads:

root@mail:/home/deploy# tail /var/log/mail.log
    Aug 29 20:12:53 mail postfix/smtpd[6193]: disconnect from localhost[127.0.0.1]
    Aug 29 20:12:53 mail dovecot: imap-login: Error: SSL: Stacked error: error:0608308E:digital envelope routines:EVP_PKEY_get1_EC_KEY:expecting a ec key
    Aug 29 20:12:53 mail dovecot: imap-login: Fatal: Can't load ssl_cert: error:0906D066:PEM routines:PEM_read_bio:bad end line
    Aug 29 20:14:53 mail postfix/postscreen[6294]: CONNECT from [127.0.0.1]:35425 to [127.0.0.1]:25
    Aug 29 20:14:53 mail postfix/postscreen[6294]: WHITELISTED [127.0.0.1]:35425
    Aug 29 20:14:53 mail postfix/smtpd[6295]: warning: cannot get RSA certificate from file /etc/ssl/certs/wildcard_combined.pem: disabling TLS support
    Aug 29 20:14:53 mail postfix/smtpd[6295]: warning: TLS library problem: error:0906D066:PEM routines:PEM_read_bio:bad end line:pem_lib.c:802:
    Aug 29 20:14:53 mail postfix/smtpd[6295]: warning: TLS library problem: error:140DC009:SSL routines:SSL_CTX_use_certificate_chain_file:PEM lib:ssl_rsa.c:730:
    Aug 29 20:14:53 mail postfix/smtpd[6295]: connect from localhost[127.0.0.1]
    Aug 29 20:14:53 mail postfix/smtpd[6295]: disconnect from localhost[127.0.0.1]

Also, it seems to cause fail2ban to stop working:

<S_CODE_TOKEN>
",pedrovanzella,2014-11-02 16:38:23
297,2014-08-31 15:16:38,"Okay, I figured this one out: all certs need to end in a blank line, otherwise when catting the ----begin cert---- and the ---end cert--- lines get mushed together.

Still, I'm getting a ""service not available"" when I log in, and I get on my `mail.err`:

<S_CODE_TOKEN>

On my `/var/log/roundcube/errors` I get:

<S_CODE_TOKEN>

[This](http://askubuntu.com/questions/460837/mcrypt-extension-is-missing-in-14-04-server-for-mysql) is a fix for this bug so far.

This seems to be a problem with Ubuntu 14.04, since I'm getting 

<S_CODE_TOKEN>

On my `/var/log/z-push/z-push-error.log` as well.

Editing `/etc/php5/mods-available/imap.ini` to read
    extension=/usr/lib/php5/20121212/imap.so

Fixes the problem with z-push as well. This is the same fix as the Roundcube one.
",pedrovanzella,2014-11-02 16:38:23
297,2014-10-21 21:03:45,"I had the same error but a different solution. Also on Ubuntu 14.04 (fresh and clean install).

In my case the ecrypted volume was not mounted. Running `ansible-playbook -i ./hosts site.yml` a second helped. I don't know why.
",razem-io,2014-11-02 16:38:23
297,2014-10-22 11:52:55,"I had the same issue of the encfs encrypted volume not being mounted, multiple times. Running `ansible-playbook -i hosts site.yml --tags=encfs` remounts the volume and the problem goes away.

Is there a monit task/agent/whatever that monitors the state of a volume (mounted/unmounted)? That could help in identifying what's going on. If not, where would one look for the cause of this volume being unmounted?
",malvim,2014-11-02 16:38:23
297,2014-11-02 16:38:23,"@malvim The volume being unmounted should show up in `/var/logs`, but it's definitely not expected behavior that it would randomly become unmounted. I've been running the same Debian VPS for over a year and the encfs volume has never unmounted.

I do encourage anyone running into issues with Ubuntu to try Debian instead. It seems to be far more reliable.
",al3x,2014-11-02 16:38:23
297,2014-11-03 04:29:18,"@al3x It might sound strange but I actually switched from Debian 7.6 fresh installation to Ubuntu. Just because I had the same error there. But running the task encfs did not help to get rid of it. I did another clean install with Debian. This time ran into another issue with the mail server telling me that the database backend could not be reached. Because of this randomness I switched to Ubuntu. Here everything seems to be working nice besides encfs. Before this project I was running mailinabox which also had problems. It was because of the advanced partition layout my hoster delivers after a clean install. Perhaps the same applies here? That is my partition layout:
- /dev/md2 1008G 2.1G 955G 1% /
- none 4.0K 0 4.0K 0% /sys/fs/cgroup
- udev 7.7G 4.0K 7.7G 1% /dev
- tmpfs 1.6G 588K 1.6G 1% /run
- none 5.0M 0 5.0M 0% /run/lock
- none 7.7G 0 7.7G 0% /run/shm
- none 100M 0 100M 0% /run/user
- /dev/md1 488M 69M 394M 15% /boot
- /dev/md3 1.7T 75M 1.7T 1% /home

It should be about the same for Debian. 
",razem-io,2014-11-02 16:38:23
297,2015-02-12 05:15:26,"I tried to rerun as suggested and that didn't work and now I seem to be experiencing the same problem as mentioned above. Any help would be awesome!

<code>

[12-Feb-2015 05:14:49 +0000]: IMAP Error: Login failed for email@host.com from IP. Could not connect to ssl://127.0.0.1:993: Unknown reason (fsockopen() function disabled?) in /usr/share/roundcube/program/lib/Roundcube/rcube_imap.php on line 184 (POST /?_task=login&_action=login)

</code>
",shaneonabike,2014-11-02 16:38:23
297,2015-02-12 14:15:16,"Could this be related? https://bbs.archlinux.org/viewtopic.php?id=187063
",shaneonabike,2014-11-02 16:38:23
297,2015-07-30 01:34:01,"Login to server or VPS and run: service dovecot restart
",talaweb,2014-11-02 16:38:23
297,2015-09-21 19:20:08,"Unfortunately, that didn't do anything and it seems that dovecot cannot startup the imap-login?
",shaneonabike,2014-11-02 16:38:23
296,2014-08-30 00:12:45,"I can't log in into ZNC. I've tried generating the password with the python script and with ZNC itself, but I always get a invalid login. The username should be the IRC name, right?

The python3 script on the readme doesn't work, by the way:

<S_CODE_TOKEN>

As for the others, every time I generate a hash, it's different, but I suspect that is expected behaviour, hence the salt.
",pedrovanzella,2014-09-11 05:37:41
296,2014-08-31 23:13:42,"Figured it out:

The hash was never being updated when I ran ansible again, because the config file already existed.

Also, the SSL cert was concatenated wrong, missing the newlines. You might want to check for that. It was also not replaced when I ran ansible again.
",pedrovanzella,2014-09-11 05:37:41
295,2014-08-17 18:34:14,"Quotes also removed around salts and hashes in existing examples because, AFAIK,
base64-encoded strings contain no characters which must be escaped in YAML (the
following are not in base64: '!', ':', '|', '>').

Closes #293
",ariddell,2014-08-17 18:45:40
295,2014-08-17 18:45:43,"Thanks!
",lukecyca,2014-08-17 18:45:40
294,2014-08-16 21:55:56,"I've been trying to setup a VPN client that I can easily turn off and on via Ubuntu's NetworkManager. Things currently work but only barely. Perhaps someone has figured this out? I've turned off my firewall. If I ""Export"" my OpenVPN settings they appear to match what al3x has given in the gist.

<S_CODE_TOKEN>

Should I try messing around with MTU? 
",ariddell,2014-08-20 01:20:54
294,2014-08-20 01:20:54,"I messed around with tunnel MTU. Problem solved.
",ariddell,2014-08-20 01:20:54
293,2014-08-16 17:54:54,"The two `python3` commands in the README for generating password hashes don't seem to be working. I'm using Python 3.3.2 on OS X. When I try them with ""password"", the first one gives just a salt (I think). The second one crashes.

<S_CODE_TOKEN>

@ariddell, it looks like you worked on these commands. Could you have a look and let me know if I'm doing something wrong?

Also, it would be good to use `getpass` so that users aren't compelled to leave their password cleartext in their bash history! Something like:

<S_CODE_TOKEN>
",lukecyca,2014-08-17 18:45:40
293,2014-08-16 21:08:07,"I double checked and I think it might be a platform issue. OS X abhorrs glibc apparently ([stackoverflow discussion](http://stackoverflow.com/questions/13052047/python-crypt-in-osx/13053068#13053068)).

I'm sure there's a python package that mimics the functionality but for the time being I should add a note about it being linux only.

(edit: `passlib` seems to have it all, I'll write something up) 
",ariddell,2014-08-17 18:45:40
292,2014-08-16 15:32:52,"ZNC module compilation can fail on memory-limited systems, causing ZNC
to not work properly. But even after the failure, make install still
creates /usr/local/bin/znc. Thus Ansible would skip the ZNC build and
install step on future runs, despite ZNC not being correctly installed,
causing the playbook to appear to complete successfully and requiring
manual troubleshooting.
",catern,2014-08-16 16:30:18
291,2014-08-11 08:09:02,,lvillani,2014-08-11 20:38:34
290,2014-08-09 23:17:42,"Installs python-lxml as a newebe dependency.

Related to issue #289 .
",pellegrino,2014-08-11 20:38:20
289,2014-08-09 16:35:14,"The newebe install fails on Debian 7 64 when pip tries to compile lxml.

All the dependencies seem to be install, since:

<S_CODE_TOKEN>
",yuvadm,2014-11-02 16:39:50
289,2014-08-09 16:38:04,"Manually installed

<S_CODE_TOKEN>

and that fixed it.
",yuvadm,2014-11-02 16:39:50
289,2014-11-02 16:39:50,"`python-lxml` is installed as part of the main Newebe playbook, so this should be resolved for future users.
",al3x,2014-11-02 16:39:50
288,2014-08-07 17:52:13,"This commit moves the monitoring role to the bottom of site.yml so that
it is executed after all other roles.

This is needed because the monitoring role conditionally installs Monit
configuration file based on whether some other packages have been
installed or not (such as ZNC).

This patch also adds a comment to the ""monitoring"" entry within the
""roles"" list and a `roles/monitoring/README.md` file telling users why
the monitoring role has to come last.

Resolves #284
",lvillani,2014-08-08 16:33:18
288,2014-08-07 20:35:30,"Got bit by this as well, since the ZNC role doesn't include the monit configuration any more.
",evaryont,2014-08-08 16:33:18
287,2014-08-07 15:26:53,"Resolves #114
",lvillani,2014-08-08 16:33:44
286,2014-08-07 08:55:18,"This is already touched on in #46 but I think the issue needs to be looked at again.

I'm getting errors like:

<S_CODE_TOKEN>

Without knowing too much about Dovecot's implementation of dbox, I believe this is trying to use an atomic rename to change a transaction log. Filesystem renames are usually atomic, so you move dovecot.index.log to dovecot.index.log.2, and then write out dovecot.index.log. If you lose power/crash while writing, you have the .2 to recover with.

As such, this seems like a possibility for data corruption if this doesn't succeed and there is for example a power loss while writing this file. I'm guessing when the rename fails, Dovecot silently overwrites dovecot.index.log and hopes it finishes.

The cause appears to be that the mail directories are set to 644 owned vmail:dovecot, but while being worked on they change to vmail:vmail, and then dovecot can't change them.

My permissions on one of the mentioned folders look like this:

<S_CODE_TOKEN>

I'm not quite sure to solve this, as I don't know the function of the vmail user/group or how it's used. I could just chown vmail:dovecot and call it a day, but I'm guessing this will pop up again. Anyone know the best way to resolve this?
",T3hUb3rK1tten,
286,2014-08-07 14:52:52,"I've had this problem since day one. I've never noticed any actual symptom, but your analysis seems to be on the right track.
",lukecyca,
286,2017-01-04 18:07:35,"Shouldn't the mail directories be owned by vmail:vmail instead of vmail:dovecot.
This is also suggested in http://wiki.dovecot.org/HowTo/SimpleVirtualInstall, because now dovecot gives errors that it can not change the group permission if the world and group permissions are not the same.",gyger,
285,2014-08-05 13:13:59,"See https://prosody.im/doc/depends/luasec/prosody

This would allow the following:

<S_CODE_TOKEN>
",antagonismorg,2015-06-13 20:51:08
285,2014-08-06 01:00:51,"I just wanted to add a note for whoever implements this:
While Debian is the official platform for Sovereign, the repos for [Ubuntu 14.04 have Luasec 0.5-1](http://packages.ubuntu.com/trusty/lua-sec), so for those cases where Sovereign is being run on Ubuntu 14.04, it _shouldn't_ install luasec-prosody.  Since Luasec 0.5 is relatively recent, I'm guessing the Debian repos haven't packaged it yet.
",the-solipsist,2015-06-13 20:51:08
285,2015-06-13 14:22:02,"Jessie comes with lua-sec 0.5
",neuhaus,2015-06-13 20:51:08
285,2015-06-13 20:51:08,"Since 570bebac704f5515dcc88c82746de160400f397d we install the **lua-sec** 0.5 package on Ubuntu Trusty and Debian Jessie where it is available.
And since commit edf65c530a07ebcf15b457457a9139bfad13406f we use **lua-sec-prosody** on Ubuntu Precise and Debian Wheezy. 
Fixed.
",neuhaus,2015-06-13 20:51:08
284,2014-08-04 03:45:50,"When ansible tries to ""copy monit service config file into place"" for ZNC, it fails because it can't find the file. The file exists, but it's in the monit role rather than the ircbouncer role. I'm not sure whether it should be moved into the ircbouncer role, or if the ircbouncer ansible task needs to point to the monit role area somehow.
",ventolin,2014-08-08 16:33:18
283,2014-08-03 13:11:49,,lvillani,2014-08-03 17:18:01
282,2014-07-30 13:09:24,,lvillani,2014-07-31 16:00:25
281,2014-07-30 10:08:13,,lvillani,2014-07-31 16:01:04
280,2014-07-30 07:47:17,"- Add test
- Fixed Newebe's playbook failing on first run on a fresh Debian 7 VM
- Restart supervisord on changes
- Security: Use /usr/sbin/nologin as login shell for newebe user
- Speed: Consolidate all 'apt' entries into one
- Strip trailing whitespaces
- Update to take advantage of apache2_module from Ansible 1.6
- Use file path=... state=absent instead of ""rm"" command to delete files
",lvillani,2014-07-31 16:01:38
279,2014-07-30 06:09:19,"I'm running a Linode in the UK with stock configuration and the rbl checker always causes an email to be sent to root@ telling me my IP is listed on multi.uribl.com

However, I found out this is the real issue: the DNS used by my Linode server (again, straight out of the box) causes multi.uribl.com to refuse my query.

<S_CODE_TOKEN>

If you visit that page you can read that 

> URIBL provides public lookups over DNS for low volume usage. If you spam check a large amount of email, or you use a shared DNS platform for resolution, you may receive a response saying the query was refused. That said, Public DNS providers such as OpenDNS or Google Public DNS are effected due to the high volume of queries they generate, as are many other internet service providers (ISP) that use caching nameservers for their customer base.""
",lbsnrs,2014-08-16 18:08:53
279,2014-07-30 06:31:17,"I get this too on digital ocean for both multi.uribl.com and black.uribl.com. I guess too many people are querying it via these VPS providers.

We could remove URIBL from the check, or... any other solutions?
",lukecyca,2014-08-16 18:08:53
279,2014-08-01 12:27:01,"Yeah, I think it should be removed from the check, I don't think there's an easy way for it to be fixed upstream in the perl script
",lbsnrs,2014-08-16 18:08:53
279,2014-08-01 20:05:27,"Yup, I'm seeing the same ""refused"" behavior from Linode. Time to axe URIBL.
",al3x,2014-08-16 18:08:53
279,2014-08-16 18:10:40,"To get this change on your own server, log in and manually delete `/opt/check-rbl.pl` and then re-run your updated playbook.
",lukecyca,2014-08-16 18:08:53
278,2014-07-30 03:50:43,"I was getting an error regarding ""/var/www/owncloud/data"" directory not found on Ubuntu 14.04. The 6.x version of Owncloud in the official repo causes this, and upgrading to 7.0 via the OpenSUSE repo seems to fix it for me.
",jamilbk,2014-07-31 16:00:18
278,2014-07-30 15:10:47,"Thanks for catching that! I've updated accordingly.
",jamilbk,2014-07-31 16:00:18
277,2014-07-28 22:57:36,"The folks behind edx/configuration provide CloudFormation rules that specify the infrastructure. This seems like the right approach, especially if there's a platform-neutral way to do it (maybe [Terraform](http://www.terraform.io/)). Given how important DKIM and SPF settings are to the core functionality of sovereign, it seems like it would be great if there were a way to automate setting those values in DNS.
",ariddell,2015-06-04 06:11:07
277,2014-08-01 19:55:55,"This would be a huge win, for sure.
",al3x,2015-06-04 06:11:07
277,2014-08-07 17:44:37,"In the mean time, perhaps writing the correct DNS records to a file?
",evaryont,2015-06-04 06:11:07
277,2015-06-04 06:11:07,"This is a great suggestion that doesn't seem to have an easy platform-neutral solution to implement. The necessary DNS records are written to files for DKIM, at least.
",al3x,2015-06-04 06:11:07
276,2014-07-28 12:14:17,"Untested though, I don't use ansible to manage my server.
",thomwiggers,2014-08-01 19:54:13
276,2014-07-28 13:34:36,"They changed around some of the database schema in this release.  I'm also concerned with how this works with the older 0.7 roundcube version on debian wheezy.
",jplock,2014-08-01 19:54:13
276,2014-08-01 19:54:11,"It seems like this might have [issues with Roundcube after 0.9](https://github.com/christian-putzke/Roundcube-CardDAV/issues/75), but there don't appear to be reported issues specific to 0.7. Merging.
",al3x,2014-08-01 19:54:13
275,2014-07-28 10:57:43,"I think /etc/aliases is ignored in the current setup (or at least it seems to be being ignored). Is this desired? It's confusing to have postmaster aliased to root in two places (in /etc/aliases and then again in the mail_virtual_aliases db), for example. There's also a `monit: root` that gets added by monit, I think. I believe it's currently ignored.
",ariddell,2014-08-01 20:03:38
275,2014-08-01 19:56:53,"Yes, `/etc/aliases` should be ignored in favor of the aliases stored in the database.
",al3x,2014-08-01 20:03:38
274,2014-07-27 21:44:50,"What is proposed way to manage existing and adding new mail users? I believe I can add new user's folders by adding it into /vars/user.yml, but virtual_user table entries are not added.

Also, if I change password hash in /vars/user.yml for virtual user, this changed hash will not get updated in postgresql.

I used to use Postfixadmin GUI interface for managing virtual users. May be this could be integrated in to playbook somehow?
",hippich,2014-08-01 19:57:03
274,2014-07-28 08:48:42,"I've managed email addresses via `user.yml` without a problem. It should update all the correct entries, including the password hashes. The output should show this; when you run the playbook the output should have all the email addresses you added. I would not recommend using other tools such as Postfixadmin, this is likely to interfere with Sovereign. You're meant to manage everything using Sovereign only.
",tilsammans,2014-08-01 19:57:03
274,2014-08-06 01:38:49,"@tilsammans: Thanks for that clarification.  Do you run the playbook again with only the mail role enabled?
",the-solipsist,2014-08-01 19:57:03
274,2014-08-06 11:06:52,"I have a few other roles enabled as well.
",tilsammans,2014-08-01 19:57:03
274,2014-08-06 13:44:41,"@tilsammans If other roles are enabled, wouldn't they override changes that have been made since the last time they were run?  Wouldn't this mean that _all kinds of changes_ (including adding a new IRC chan to ZNC, changing of a user's password in Prosody, etc.) will have to be done through a Ansible rather than through the interface that software provides?
",the-solipsist,2014-08-01 19:57:03
274,2014-08-06 13:50:23,"Of course, everything on the server must be done through Ansible, you never SSH into it to tweak something.
",tilsammans,2014-08-01 19:57:03
274,2014-08-06 23:45:01,"@the-solipsist Keep in mind that you can also use `ansible-playbook --tags=SOME_TAG` to limit what Ansible tasks get executed. The tags are more or less tag-per-major-task, so updating email users should be pretty self-contained (and quick) if you do it that way.
",bdyck,2014-08-01 19:57:03
273,2014-07-25 21:49:33,,lvillani,2014-07-28 20:18:46
272,2014-07-25 21:47:35,"Adjust cipher suite assertions to match what's currently reported by the
server.

Remove WebTests.test_znc_http test since ZNC web interface isn't exposed to
the Internet.

(Tested only with Debian 7 VM from the Vagrantfile)
",lvillani,2014-07-28 20:19:09
271,2014-07-24 09:10:56,"Subsequent runs of wallabag's playbook result in the 'install' directory being
recreated, (after the ""Clone wallabag"" step) kicking wallabag's first time
setup procedure.

With this patch we automatically remove the 'install' directory if wallabag's
configuration file appears to be in place before cloning the repository.
",lvillani,2014-07-24 19:40:32
270,2014-07-24 01:25:30,"Solves the chicken-or-the-egg problem of generating a dovecot and znc salted
password hash without already having dovecot and znc installed. That is, people
are installing sovereign typically do not have dovecot and znc installed and
have no way of generating the required salted password hashes.

Python 3 standard library generates SHA512-CRYPT salted password hashes by
default so it is particularly convenient for configuring dovecot:

<S_CODE_TOKEN>

For ZNC, the required command is slightly more verbose.
",ariddell,2014-07-24 19:41:11
270,2014-07-24 18:28:51,"**NOTE**: I am **not** a core contributor to this project, so take my review with a pinch of salt.

Unfortunately it doesn't work for me under OS X, at least with Python 3 installed from Brew.

The problem is that under OS X `crypt.methods` equals to `[<crypt.METHOD_CRYPT>]` and that crypt.crypt() uses the first method available unless one is specified. Because of this behavior I suggest to change the command used to generate the Dovecot password to force `crypt.METHOD_SHA512` because you cannot guarantee that it will be the default for method-less calls to `crypt.crypt()`.

As for the command not working under OS X I think it should be sufficient to make it clear that they work only under Linux, thus should be run on the server (or any platform which provides `crypt.METHOD_SHA512` and `crypt.METHOD_SHA256` for that matter).
",lvillani,2014-07-24 19:41:11
270,2014-07-24 19:03:11,"I'm really surprised this doesn't work on OS X. What's platform specific about SHA512? It does indicate that Python 3.3 or higher is required. I'll adjust the commit.
",ariddell,2014-07-24 19:41:11
270,2014-07-24 19:43:46,"@ariddell According to documentation ""(not all methods are available on all platforms)"". Indeed, by looking at the source code it appears to be a thin wrapper over the crypt (3) POSIX function. POSIX 2008.1 says ""The encrypt() function shall provide access to an implementation-defined encoding algorithm."" Glibc on Linux allows callers to put a special string (e.g. ""$1$"", ""$5$"") at the beginning of the salt string to select the algorithm. As I interpret it, the specification allows basically everyone to do as they see fit.
",lvillani,2014-07-24 19:41:11
269,2014-07-23 21:09:28,"Update the Vagrantfile so that it is possible (and easier) to spin up Debian
7, Ubuntu 12.04 and Ubuntu 14.04 VMs. Although Vagrant allows spinning up all
of them simultaneously, there may be conflicts assigning host names and IP
addresses.

This Vagrantfile also enables the vagrant-cachier plugin (if installed) to
cache downloaded packages across subsequent runs of the same VM.

Running ""vagrant up"" will bring up only the Debian VM since it is the
officially supported Linux distributions. Ubuntu 12.04 and Ubuntu 14.04 must
be started explicitly by running either ""vagrant up precise"" or ""vagrant up
trusty"".
",lvillani,2014-07-24 19:38:51
268,2014-07-22 17:10:41,"Wallabag 1.7.1 fixes a couple of security vulnerabilities, adds ePUB
export and more.

For a list of changes since 1.6.1b see:
- https://www.wallabag.org/blog/2014/05/29/1-7-epub-multi-users-available/
- https://www.wallabag.org/blog/2014/07/15/wallabag-1-7-1/
",lvillani,2014-07-22 19:06:10
267,2014-07-22 16:41:26,"Is there a reason we don't simply copy the users public key directly instead of telling them to copy and rename it manually?
",adrinux,2014-09-11 05:36:01
267,2014-07-22 19:08:08,"While this is a sensible default, I'm not comfortable with automating the copying of a user's public key to a remote server. Perhaps we can prompt for confirmation first?
",al3x,2014-09-11 05:36:01
267,2014-07-22 19:56:41,"I think that could get tedious, at least on repeated test runs during development.
It's a fair point though, particularly since it's for the deploy user, not their own account ‚Äì its not that outrageous though, surely anyone running sovereign is familiar with the idea of copying their ssh public key to a server for ssh access :)

For my own project, lowar, I actually specify that a set of ssh keys need to be generated for the deploy user, and then automatically upload those. The setup play is here: https://github.com/adrinux/Lowar/blob/master/skeleton/play-setup.yml

I had wondered about suggesting porting this to sovereign instead of having people manually setup the deploy user ‚Äì perhaps that's a better option if you're happy with generating keys specifically for the deploy user.
",adrinux,2014-09-11 05:36:01
267,2014-07-23 21:26:16,"I think the option you took for Iowar is a great one. It's a simple step that users can always modify or ignore if they'd prefer to use their existing keypair. Would you mind porting it and then we'll get this merged and closed out?
",al3x,2014-09-11 05:36:01
267,2014-07-28 11:21:50,"Will do. Though I'm not sure at the moment where to put the keys ‚Äì with Lowar I made a point of keeping all personal configuration separate from the library of roles, using the ansible configuration variable ['roles_path'](http://docs.ansible.com/intro_configuration.html#roles-path). But that's a whole new issue in itself...

Sovereign takes a different approach of having people modify and add to the roles themselves, and generally put personal config in the same repo, or at least directory.

For the moment: Where should we put the generated deploy users ssh keys?
",adrinux,2014-09-11 05:36:01
267,2014-07-28 19:08:43,"It should probably be configurable, but a sensible default would be a `.ssh/` directory inside the Sovereign working directory.
",al3x,2014-09-11 05:36:01
266,2014-07-22 15:00:49,"This is in effect a fix for gitolite installation when ssh key forwarding is not configured/working, as per the error I reported here https://github.com/al3x/sovereign/issues/261

It adds githubs public key to the deploy user's known_hosts file prior to trying to clone gitolite from github.

cons:
- Public key is hard coded, this will break and require a change if github updates their key (but how often does that happen?)
- I'm not sure the gitolite role is the best place to add this, I'd do it as part of setting up the deploy user account, but sovereign currently does that manually...but it's where its currently needed to get the vagrant testing box up and running without manual intervention.
",adrinux,2014-08-01 19:49:32
266,2014-07-28 22:46:38,"Check out the `accept_hostkey` parameter on the [Ansible Git module](http://docs.ansible.com/git_module.html). That should do the trick without hardcoding a key that GitHub might eventually replace.
",al3x,2014-08-01 19:49:32
266,2014-08-01 21:29:31,"Fwiw I actually did use accept_hostkey to begin with but backtracked before submitting a PR. accept_hostkey effectively turns off host key checking for that host and results in a (presumably very small) risk of a MITM attack,  just assumed sovereign would be a more paranoid project ‚Äì I guess not :)
",adrinux,2014-08-01 19:49:32
265,2014-07-22 08:34:02,"This pull request removes use of transitional packages and adds initial support for Apache 2.4 (used in Ubuntu Trusty) which employs a different layout for its configuration files.
",lvillani,2014-07-22 16:28:44
265,2014-07-22 13:06:54,"Done, also performed a test run on my server (seems to work so far).
",lvillani,2014-07-22 16:28:44
264,2014-07-22 08:26:57,"This pull request contains a couple of improvements to the Vagrant configuration file such as using the same base box for both Virtualbox and VMware, adding references to Ubuntu base boxes (commented by default) and using shortcuts to configure VM memory.
",lvillani,2014-07-22 16:28:06
263,2014-07-21 13:26:30,"When the ZNC web port changed in 8f4c9ea5f3ba46c24a1972266df5de01017e0129, it broke monit monitoring
",jplock,2014-07-21 14:58:09
262,2014-07-16 14:41:46,"Tried to follow the suggested [Development Environment setup](https://github.com/al3x/sovereign/wiki/Development-Environment) but got a 404 error (vagrant and vmware fusion on osx).
- The url in vagrantfile for the vmware_fusion compatible box has error 404.
- The commented source of that box leads to deprecated project, the repo's contents having been moved to https://github.com/box-cutter/debian-vm
- Vagrant boxes built with that new repo are now available on Vagrant Cloud, I used the one for 'Debian Wheezy 7.5 (64-bit)' https://vagrantcloud.com/box-cutter/debian75

For me Vagrant provision is now failing with a [github hostkey](https://github.com/al3x/sovereign/issues/261) issue but that seems entirely separate from the missing box error ‚Äì so I haven't yet been able to run the sovereign tests...
",adrinux,2014-07-16 16:22:18
261,2014-07-16 14:40:38,"Working through https://github.com/al3x/sovereign/wiki/Development-Environment and provision is failing with vagrant due to github unknown hostkey:

<S_CODE_TOKEN>
",adrinux,2014-07-22 15:05:14
261,2014-07-16 14:59:30,"accept_hostkey is an ansible git module parameter http://docs.ansible.com/git_module.html but is ignored if StrictHostKeyChecking is off ‚Äì and the sovereign vagrantfile sets it to off.

~~Seems like the answer is to add github to global know_hosts on osx. (It's already in mine)~~
Does this work for other people but only fail for me? Or does the git role in sovereign need some changes?
",adrinux,2014-07-22 15:05:14
261,2014-07-16 20:48:07,"So doing as ansible suggests and adding accept_hostkey to the gitolite.yml works. At the cost of not checking github's host key, presumably.
https://github.com/adrinux/sovereign/commit/d6c97f65e5d816de4bf8b4bbe15467c52229fd2d

Not sure this should be changed or not. Certainly setting up ssh agent forwarding doesn't seem to work. I think I solved this problem in another project by copying github's key into the known_hosts file of the deploy user...
",adrinux,2014-07-22 15:05:14
261,2014-07-22 15:05:14,"Closing this in favour of #266 
",adrinux,2014-07-22 15:05:14
260,2014-07-15 13:24:55,"Compress Postgres backup file.  Relates to #257 
",jplock,2014-07-15 14:24:31
259,2014-07-14 16:29:29,"requirements.txt only lists Ansible 1.3, whereas README.textile says Ansible 1.6+ and has a much more comprehensive discussion of whats required.

TODO only lists 'ensure log rotation' ‚Äì if that's still a problem it should have an issue created, if not the issue queue provides a much more comprehensive list of tasks. This file seems to be superfluous.

I suggest neither of these files are still required.
",adrinux,2014-07-16 02:40:35
259,2014-07-14 17:31:42,":+1: 
",jrgifford,2014-07-16 02:40:35
258,2014-07-10 08:37:08,"What do you think about adding a SIP server to this project? That way the users would get a SIP address like username@mydomain.com and whenever they do (possibly encrypted) VoIP calls via SIP to other users, the meta data for their end of the call remains on their own server.

That way the sovereign project could supply a decentralized alternative to OStel (https://dev.guardianproject.info/projects/ostel/wiki ).

If you are open to the idea I could start working on it. 
",neuhaus,2015-06-04 06:05:57
258,2014-07-11 01:52:03,"I like the idea. Maybe it could use https://www.plivo.com/ to provide a dial-in number and serve as a Skype number replacement.
",reedlaw,2015-06-04 06:05:57
258,2014-08-09 15:20:43,"I really like this idea as well. I'm new to the project and to ansible, but would like to help out with it if someone is trying to do it. 
",pellegrino,2015-06-04 06:05:57
258,2014-08-12 13:45:53,"I'm pretty new to Ansible myself. I guess we could use Asterisk. Are you on Debian or on Ubuntu?
",neuhaus,2015-06-04 06:05:57
258,2015-02-16 16:21:25,"There is an interesting cookbook: https://guardianproject.info/wiki/OSTN_cookbook
",simontretter,2015-06-04 06:05:57
258,2015-06-04 06:05:57,"Open to a PR, as with any additional service, but closing this for now out of lack of interest/momentum.
",al3x,2015-06-04 06:05:57
257,2014-07-10 06:09:06,"Changed tarsnap.sh to not shut down postgresql, instead use the pg_dumpall command to create a .sql backup file in /decrypted/. Much better than shutting down the entire db server, sometimes I had weird problems where it wouldn't come back after stopping, and monit had no clue what to do.

Before adding in the ""cd /home/"" I was getting errors (and hence emails) from pg_dumpall saying ""could not change directory to ""/root"""". This was because the sudo -u postgres would stay in /root/ and pg_dumpall checked permission on the current directory even if it didn't need them. I couldn't find a way to suppress the error without suppressing other errors, so I added the cd in.
Postgres doesn't need write access to /decrypted/, since by the time bash gets to ""> /decrypted/postgresql-backup.sql"" it's back at root privileges.
",T3hUb3rK1tten,2014-07-11 13:45:38
257,2014-07-10 08:39:33,"This is great. We also get rid of the hardcoded postgresql 9.1 path var/lib/postgresql/9.1/main that breaks on systems with more recent versions of PostgreSQL such as Ubuntu 14.04.
",neuhaus,2014-07-11 13:45:38
257,2014-07-15 14:38:41,"Would it be helpful to do a date-aware backup that retains past backups?

<S_CODE_TOKEN>

Basically, storage is cheap and it's always handy to have around...
",tilsammans,2014-07-11 13:45:38
257,2014-07-15 14:40:52,"> Would it be helpful to do a date-aware backup that retains past backups?

Each one will be included in a datestamped tarsnap archive, so I don't think it's necessary to accumulate them from one archive to the next.
",lukecyca,2014-07-11 13:45:38
257,2014-07-15 14:41:28,"Ah gotcha, of course it's using tarsnap for it. Much better!
",tilsammans,2014-07-11 13:45:38
256,2014-06-27 06:52:55,"<S_CODE_TOKEN>
",tilsammans,2014-08-01 20:03:31
256,2014-06-27 14:57:34,"Does our dspam configuration even use these files? I'm pretty sure we've got all the notification emails disabled.
",lukecyca,2014-08-01 20:03:31
256,2014-06-27 15:09:35,"I got the welcome one as soon as the config was fixed! I am fine with disabling them all though. 

> Op 27 jun. 2014 om 16:57 heeft Luke Cyca notifications@github.com het volgende geschreven:
> 
> Does our dspam configuration even use these files? I'm pretty sure we've got all the notification emails disabled.
> 
> ‚Äî
> Reply to this email directly or view it on GitHub.
",tilsammans,2014-08-01 20:03:31
255,2014-06-27 06:51:09,"Monit is configured to always monitor ZNC, even when that role has been disabled.

<S_CODE_TOKEN>
",tilsammans,2014-08-01 20:02:23
254,2014-06-22 02:21:45,"This change set builds `collectd` from source and configures it in one of the following ways:
- If Librato credentials are present, `collectd` will be configured to send data points to Librato using the `collectd-librato` plugin.
- If no Librato credentials are present, `collectd` will be configured to write RRD files locally (`/opt/collectd/var/lib/collectd/rrd by default`).

Aims to resolve https://github.com/al3x/sovereign/issues/253.
",hectcastro,2014-06-22 17:37:41
254,2014-06-22 16:12:15,"+1
",jplock,2014-06-22 17:37:41
253,2014-06-15 00:38:13,"For example, add the installation and configuration of [collectd](http://collectd.org/) to the monitoring role.

Would this contribution be of interest to anyone?
",hectcastro,2014-06-22 17:37:40
252,2014-06-13 16:26:21,"My selfoss logs were using 10GB of space because they weren't being rotated properly.
",jplock,2014-06-13 17:08:46
251,2014-06-10 04:46:50,"As per the message in the latest Dovecot debs:

> You already have ssl certs for dovecot.
> However you should move them out of /etc/ssl
> and into /etc/dovecot and update the configuration
> in /etc/dovecot/conf.d/10-ssl.conf accordingly.
> See /usr/share/doc/dovecot-core/README.Debian.gz for details.
",al3x,2016-09-24 09:26:41
251,2016-05-21 14:04:29,"The dovecot documentation seems contradictory.  The README recommends copying the certificates to `/etc/dovecot`.  The [online documentation](http://wiki2.dovecot.org/SSL/DovecotConfiguration) still refers to `/etc/ssl`, also noting that the certificates are read with root permissions before dropping priviliges.  Is a change actually needed?
",mikeashley,2016-09-24 09:26:41
251,2016-09-16 09:52:46,"We've deviated on how SSL certificates are installed since adding support for Let's Encrypt.  Keys are stored in `/etc/letsencrypt/archive` and readable only with root permission or by those in the `ssl-cert` group.  This is documented in `DESIGN.md` for the role.  It'll need revisited if/when we switch to a packaged version of LE.  In the meantime, I think we're ok on this.
",mikeashley,2016-09-24 09:26:41
250,2014-06-09 13:55:31,"http `example.com`, `read.`, `news.`and `git.` redirected only to https://`example.com` > forbidden.

Occured on a fresh Debian 7 Minimal VM.
I still keep that image, if you want me to investigate this.

Only customization:
Tarsnap deactivated.
",almereyda,2014-06-27 00:14:34
250,2014-06-09 13:56:49,"<S_CODE_TOKEN>
",almereyda,2014-06-27 00:14:34
250,2014-06-27 00:14:34,"In order to investigate this issue I'd need more information. For example, httpd log output from when you attempt to make those requests.
",al3x,2014-06-27 00:14:34
249,2014-06-03 04:24:20,"Appears to be typo at the 'Create encfs' task.  This was preventing install for me.
",pcj,2014-06-04 01:32:53
248,2014-05-28 17:44:45,"No need to build our own package on Ubuntu trusty
",neuhaus,2014-06-06 16:18:55
248,2014-05-28 18:14:17,"I think you're missing a couple files in this commit.
",al3x,2014-06-06 16:18:55
248,2014-05-28 19:34:22,"What do you mean?
I'm providing an additional file, roles/git/tasks/gitolite_packaged.yml
that gets used only on Ubuntu trusty.

It's similar to pull request #244 
",neuhaus,2014-06-06 16:18:55
248,2014-05-28 19:46:56,"Where do `home_git_.gitolite.rc` and `gitolite.pub` come from?
",al3x,2014-06-06 16:18:55
248,2014-06-06 05:04:10,"`home_git_.gitolite.rc` is in the `roles/git/files/` directory.
`gitolite.pub` is created by the user, it's mentioned in `README.md`

The files shouldn't be any different than the original gitolite.yml
",neuhaus,2014-06-06 16:18:55
247,2014-05-28 17:11:24,"See http://wiki2.dovecot.org/VirtualUsers/Home#Home_vs._mail_directory

This would be very easy to implement:
Currently, we set home in
roles/mailserver/files/etc_dovecot_conf.d_auth-sql.conf.ext:  `args = uid=vmail gid=vmail home=/decrypted/%d/%n`

So, in the file roles/mailserver/files/etc_dovecot_conf.d_10-mail.conf we could just set `mail_location = maildir:~/Maildir` instead of the current `mail_location = maildir:/decrypted/%d/%n/Maildir`

**HOWEVER**, this would break existing site unless we move the existing mail!
",neuhaus,2014-06-27 00:20:27
247,2014-06-27 00:20:27,"The current configuration does use two separate directories. The home directory is `home=/decrypted/%d/%n` and the mail directory is `/decrypted/%d/%n/Maildir`.

We're effectively doing what's described under list item 1. in the section ""Ways to set up home directory"".

We don't want to store anything mail-related outside of the `/decrypted` directory, otherwise it won't be encrypted at rest.
",al3x,2014-06-27 00:20:27
246,2014-05-19 18:07:13,"OpenSSH 6.3 or later supports combining OATH auth with public key auth. This would be great to have in sovereign!
It is described at https://www.insecure.ws/linux/openssh_oath.html
With previous versions, google authenticator is only used for password authentication.

Unfortunately, Debian wheezy ships with OpenSSH 6.0 but Ubuntu trusty comes with OpenSSH 6.6.
",neuhaus,
246,2014-10-22 11:56:46,"+1, this would be nice
",malvim,
246,2014-11-04 09:17:27,"What is the general opinion regarding features that are not yet supported in debian stable? Should we wait for the next version of debian stable to include them? Use backports? Or try to use them on platforms that offer them?
",neuhaus,
246,2015-01-15 16:49:30,"My preference is to keep Sovereign aligned with Debian stable, primarily.
",al3x,
246,2015-01-15 18:03:47,"OK, let's put this on hold until debian stable ships with OpenSSH 6.3+ (or until someone else makes a nice PR ;-) )
",neuhaus,
246,2015-05-30 14:27:48,"Debian stable now ships OpenSSH 6.7.
",Yannik,
245,2014-05-19 18:01:12,"This pull requests fixes issue #166 
",neuhaus,2014-05-28 16:54:38
244,2014-05-19 17:46:36,"No need to build it from source on Ubuntu trusty
",neuhaus,2014-05-28 16:56:32
244,2014-05-22 16:31:22,"This won't work on Debian Wheezy as the package is not available.
",jplock,2014-05-28 16:56:32
244,2014-05-22 17:12:56,"That's why google_auth_mod.yml is only used for Ubuntu Trusty, not for Wheezy. The patch also changes roles/common/tasks/main.yml.
",neuhaus,2014-05-28 16:56:32
244,2014-05-22 17:57:01,"Ahh ok, sorry I missed that.
",jplock,2014-05-28 16:56:32
243,2014-05-17 13:00:11,"The task that makes sure that newebe is running can't deal with the fact that it's running:

Here's the output:

<S_CODE_TOKEN>

I'm using Ansible 1.6.1 on Ubuntu 14.04 LTS.
",neuhaus,2014-05-28 17:12:55
243,2014-05-17 13:07:43,"Weird, when I tried it again it worked...?!
",neuhaus,2014-05-28 17:12:55
243,2014-06-07 17:38:45,"Happening for me to on Ubuntu 14.04, so I think this isn't just you.

TASK: [newebe | Ensure that newebe is started] ********************************
failed: [MY_IP] => {""failed"": true}
msg: newebe: ERROR (already started)

(MY_IP redacted)
",abl,2014-05-28 17:12:55
243,2014-06-07 20:44:13,"Did you try it twice? Worked for me on second try.

> Am 07.06.2014 um 19:38 schrieb abl notifications@github.com:
> 
> Happening for me to on Ubuntu 14.04, so I think this isn't just you.
> 
> TASK: [newebe | Ensure that newebe is started] ********************************
> failed: [MY_IP] => {""failed"": true}
> msg: newebe: ERROR (already started)
> 
> (MY_IP redacted)
> 
> ‚Äî
> Reply to this email directly or view it on GitHub.
",neuhaus,2014-05-28 17:12:55
243,2014-06-07 23:32:35,"It did work on the second try, but having a task designed to fail (and forcing a rerun of the playbook) seems like a bug to me? :)
",abl,2014-05-28 17:12:55
242,2014-05-17 09:44:16,"On Ubuntu 14.04 LTS, a2ensite (part of package ""apache2-2.4.7-1ubuntu4"") automatically appends "".conf"" to the filename it looks for in /etc/apache2/sites-available/
Therefore, the file ""/etc/apache2/sites-available/roundcube"" must be renamed to
""/etc/apache2/sites-available/roundcube.conf"". The same goes for the other virtualhost files in ""/etc/apache2/sites-available/"".

Security issue:
These files must be owned by root, otherwise it is a huge security issue (User www-data could modify the file once there is a tiny security hole in any of the webpages and get root at next restart of apache).
",neuhaus,2014-06-05 18:03:35
242,2014-05-17 14:16:45,"I have added some more Ubuntu Trusty fixes to this pull request.
If you want I can create separate patches for the issues, but I'd rather not :-)
",neuhaus,2014-06-05 18:03:35
242,2014-05-17 16:38:14,"> On Ubuntu 14.04 LTS, a2ensite (part of package ""apache2-2.4.7-1ubuntu4"") automatically appends "".conf"" to the filename it looks for in /etc/apache2/sites-available/

Will this change continue to work on Debian 7?
",lukecyca,2014-06-05 18:03:35
242,2014-05-18 07:36:31,"I believe so. The idea is that a2ensite does not append "".conf"" when it's already present.  Someone with a Debian 7 vm should test it though.

Also, existing installations will end up with the old file (without .conf) and the new one.

> Am 17.05.2014 um 18:38 schrieb Luke Cyca notifications@github.com:
> 
> On Ubuntu 14.04 LTS, a2ensite (part of package ""apache2-2.4.7-1ubuntu4"") automatically appends "".conf"" to the filename it looks for in /etc/apache2/sites-available/
> 
> Will this change continue to work on Debian 7?
> 
> ‚Äî
> Reply to this email directly or view it on GitHub.
",neuhaus,2014-06-05 18:03:35
242,2014-05-18 16:15:16,"Thanks for the clarifications. I looked into this too and it appears there is no problem changing all of the names to end in `.conf`. In fact it probably would have been more idiomatic to do it this way all along, even on Debian.

There is a problem, now, for all existing installations. When running this new playbook, they are going to receive another copy of each file. To make this upgrade go smoothly, we'll need to also delete the non-`.conf` version of each file in `sites-available` and the symlinks in `sites-enabled`.
",lukecyca,2014-06-05 18:03:35
242,2014-05-19 10:14:20,"I added some rules to deal with the old files and symlinks. Please test it on a Debian system.
Thanks!
",neuhaus,2014-06-05 18:03:35
241,2014-05-17 09:00:51,,neuhaus,2014-05-17 16:33:57
240,2014-05-10 21:18:34,"Probably doing something wrong but get the following consistently when installing on Debian 7.0 64bit on a digital ocean droplet. 

<S_CODE_TOKEN>
",johnnye,2014-05-10 22:23:35
240,2014-05-10 21:24:40,"What version of Ansible are you on? Take a look at the bottom of this thread: https://github.com/al3x/sovereign/issues/167
",DomenicF,2014-05-10 22:23:35
240,2014-05-10 21:31:09,"1.6.1 at the moment, yeah I was that and bumped the version but still same issues. 
",johnnye,2014-05-10 22:23:35
240,2014-05-10 22:18:50,"The problem is likely that your kernel does not support fuse. Are you on a VPS provider that offers a limited choice of kernels (e.g. Digital Ocean)?

See https://github.com/al3x/sovereign/issues/147#issuecomment-42434828
",lukecyca,2014-05-10 22:23:35
240,2014-05-10 22:23:35,"closing as a dupe of https://github.com/al3x/sovereign/issues/147#issuecomment-42434828
",johnnye,2014-05-10 22:23:35
239,2014-05-09 22:20:16,"Hi @al3x,

  Here is my submission for Newebe (more infos here: #228).
It sets up three daemons:
- Newebe: a Python program that runs the Newebe instance.
- CouchDB: The database used by Newebe.
- Supervisor: a process manager in Python that manages the Newebe daemon.

It adds a configuration to Apache2: 
- a reverse proxy between newebe.{{soevereign_domain}}:443 and localhost:8282.

I hope everything is ok. Tell me if I must change something.

Regards,

Frank
",gelnior,2014-05-13 16:27:22
239,2014-05-11 16:14:22,"Ok I made the fix. 

I added `newebe_domain` in `vars/defaults.yml` too. 

I removed and put back enc.fs in the common tasks. It was a mistake, there is no good reason about that (sorry for the dirty commits).

Do you want that I change something else?
",gelnior,2014-05-13 16:27:22
238,2014-05-08 01:52:04,"This should address #148
",jplock,2014-05-13 16:21:38
238,2014-05-08 07:20:09,"I'd like `ufw` to first start with denying all ports, and then as the script runs enabling them per role. This way my current firewall, which has lots of ports open, is properly configured.
",tilsammans,2014-05-13 16:21:38
238,2014-05-16 07:36:04,":thumbsup: 
",tilsammans,2014-05-13 16:21:38
238,2014-07-18 00:02:42,"I'm not sure if ""deny everything by default"" is a good idea. One might want to run sovereign on a machine that is not fresh, and that initial step of closing all ports would mess up the existent configuration.

At the least, attention should be called to this, to alert users to change the default if this isn't a fresh machine that they are installing on to.
",the-solipsist,2014-05-13 16:21:38
237,2014-05-07 21:28:44,"http://ahbl.org/content/changes-ahbl

Fixes #232
",thomwiggers,2014-05-07 21:54:06
236,2014-05-06 01:15:40,"You can confirm here: https://www.dnsleaktest.com/

I tried changing `/etc/openvpn/server.conf` to use various combinations `bypass-dhcp` and `push ""dhcp-option DNS 208.67.222.222""` options, but I was not able to get it working. I also tried setting up a `bind` DNS forwarder, but I'm not sure if `dnsmasq` is already responsible for that.
",reedlaw,2014-08-01 20:36:56
236,2014-08-01 20:36:56,"This seems to be a VPN client issue. Our OpenVPN server configuration does what I'm 99% sure is the right thing:

<S_CODE_TOKEN>

Note too that the privacy-focused related project Streisand is using [exactly the same OpenVPN and DNSmasq configuration](https://github.com/jlund/streisand/tree/706189dd5656d61a69eb4336c3d97b2f7627a11f/playbooks/roles/openvpn).

The VPN client software I use on Mac OS X, Viscosity, doesn't seem to receive that push, despite following [their DNS instructions](http://www.sparklabs.com/support/configuring_dns_and_wins_setti/) closely. However, I can manually set my VPN connection to use 10.8.0.1, and then DNS leak test confirms that I'm using Linode's resolver, as is appropriate for my Sovereign setup.

My suggestion is to check out your OpenVPN client settings and then reopen if you still think this is an issue.
",al3x,2014-08-01 20:36:56
236,2014-08-01 20:41:55,"[This discussion](http://security.stackexchange.com/questions/46997/open-vpn-has-dns-leak) might also be useful.
",al3x,2014-08-01 20:36:56
235,2014-05-05 16:53:33,"After regenerating the openssl certificates and running the playbook again, at least dovecot is not working anymore.

<S_CODE_TOKEN>

edit: Nevermind. Seems to be a duplicate from #190 
",simontretter,2014-05-05 17:37:03
234,2014-04-30 01:31:27,"Dovecot 2.x is issuing a warning that the autocreate plugin is deprecated, and to use mailbox { auto } setting instead.

http://wiki2.dovecot.org/MailboxSettings
",poops,2014-05-28 16:56:10
234,2014-05-07 21:14:48,"+1
",jplock,2014-05-28 16:56:10
233,2014-04-29 20:09:38,"It would be great to support etherpad-lite for collaborative editing http://etherpad.org/
",glogiotatidis,
233,2014-04-29 22:02:22,"would be cool. Just found a existing playbook for etherpad-lite. When I have time I'll come up with a pull request. 

https://github.com/p2pu/marvin/tree/master/etherpad-lite-install 
",nstanke,
233,2014-08-17 19:21:19,":+1: This would be excellent.
",ariddell,
233,2014-11-17 00:42:50,"Any update on this? :+1:
",tehmainframe,
233,2014-12-15 15:32:08,"I implemented this and will try to segregate it into a separate branch for a PR soon.
",jcamins,
233,2015-08-22 11:40:52,"Another option woud be Hackpad: https://github.com/dropbox/hackpad
",candeira,
233,2016-09-29 17:00:14,"@jcamins any update on your PR?
",neuhaus,
233,2016-10-24 01:40:29,"@neuhaus I never got around to segregating the Etherpad build into a separate branch. The commit with the bulk of the changes is https://github.com/jcamins/sovereign/commit/f377adacdccee244e22108b46ed1248e120177f9 though.
",jcamins,
232,2014-04-29 14:54:56,"http://ahbl.org/content/changes-ahbl

> I'm winding down the public DNSbl services of the AHBL.
> 
> This means the dnsbl.ahbl.org, ircbl.ahbl.org, rhsbl.ahbl.org lists are all going away, as is the public lookup/removal tool.

These are currently in the `/etc/postfix/main.cf` file.
",thomwiggers,2014-05-07 21:54:06
232,2014-05-07 21:15:09,"Can you submit a PR to fix this?
",jplock,2014-05-07 21:54:06
231,2014-04-29 11:29:59,"> With Postfix versions before 2.10, the rules for relay permission and spam blocking were combined under `smtpd_recipient_restrictions`, resulting in error-prone configuration. As of Postfix 2.10, relay permission rules are preferably implemented with `smtpd_relay_restrictions`, so that a permissive spam blocking policy under `smtpd_recipient_restrictions` will no longer result in a permissive mail relay policy.
> 
> For backwards compatibility, sites that migrate from Postfix versions before 2.10 can set smtpd_relay_restrictions to the empty value, and use smtpd_recipient_restrictions exactly as before. 

See http://www.postfix.org/postconf.5.html#smtpd_relay_restrictions
",thomwiggers,2014-06-26 23:51:23
231,2014-05-07 21:14:30,"Can you submit a PR to fix this?
",jplock,2014-06-26 23:51:23
231,2014-05-07 21:32:30,"I'm afraid not, I don't know enough about mailservers to tackle this. I've just applied the workaround myself, but that doesn't seem a future-proof implementation.

[Debian stable also doesn't seem to ship 2.10 yet](https://packages.debian.org/wheezy/postfix) and I don't know if that matters.
",thomwiggers,2014-06-26 23:51:23
230,2014-04-27 18:06:45,"Missing library in some debian 7 library for cgit compilation
",AlbanSeurat,2014-05-05 00:25:06
229,2014-04-26 16:44:46,"It hangs on 

<S_CODE_TOKEN>

My roles are as follows:

<S_CODE_TOKEN>

Debian 7.4, amd64. No errors. Thoughts?
",jrgifford,2014-04-26 18:44:53
229,2014-04-26 17:04:15,"latest ansible version? 
",nstanke,2014-04-26 18:44:53
229,2014-04-26 18:15:20,"I'm using head. Going to see if I can replicate with what is in the Ubuntu
PPA.
On Apr 26, 2014 1:04 PM, ""Norman S."" notifications@github.com wrote:

> latest ansible version?
> 
> ‚Äî
> Reply to this email directly or view it on GitHubhttps://github.com/al3x/sovereign/issues/229#issuecomment-41474228
> .
",jrgifford,2014-04-26 18:44:53
229,2014-04-26 18:44:53,"Oh, I missed the `mail_db_password` entry in user.yml. That would do it, sorry for bothering!
",jrgifford,2014-04-26 18:44:53
228,2014-04-23 18:32:02,"Hello there,

First thank you for Sovereign that is an amazing project. I would like to propose a software I work on to Sovereign. It's a distributed social network where each user hosts his own account. Its name is Newebe and the stack is based on Python/Tornado/CouchDB. It's web-based so I think it could interest your users. 
So, here is my question: what are the requirements to be included to the Sovereign project?

Website: http://newebe.org
Ansible Playbook: https://github.com/gelnior/newebe/tree/master/deploy/ansible

Regards,

Frank
",gelnior,2014-06-27 00:31:46
228,2014-04-29 15:11:25,"See https://github.com/al3x/sovereign#contributing
",thomwiggers,2014-06-27 00:31:46
228,2014-04-29 20:18:41,"Sorry I didn't see it. Thx.
",gelnior,2014-06-27 00:31:46
228,2014-06-27 00:31:46,"Newebe has since been rolled in.
",al3x,2014-06-27 00:31:46
227,2014-04-23 02:28:15,"Added read it later support using Wallabag.  The site is available at ""read.sovereign.local"".  Fixes #58.
",jplock,2014-05-16 16:47:06
227,2014-05-15 01:12:35,"Thoughts on merging this?
",jplock,2014-05-16 16:47:06
227,2014-05-15 16:46:32,"I'm up for it! Looks like it won't auto-merge though?
",al3x,2014-05-16 16:47:06
227,2014-05-16 13:44:51,"I merged in master
",jplock,2014-05-16 16:47:06
226,2014-04-21 00:14:43,"Have just provisioned a new Debian 7 x64 server, and am trying to set up CardDAV integration on RoundCube. I've input all the correct details into Personal Settings > CardDAV, but when I then navigate to the section in Address Book, I get a red bar at the top of the screen with ""Server Error! (Internal Server Error)"".

Looking at the logs (/var/log/roundcube/errors), I get this line:

> PHP Fatal error:  Allowed memory size of 67108864 bytes exhausted (tried to allocate 51130945 bytes) in /usr/share/roundcube/plugins/carddav/carddav_common.php on line 194

Has anyone else seen this?
",MisterWS,2014-06-27 00:32:05
226,2014-04-21 23:36:37,"I haven't seen this before.  Can you confirm which version of roundcube is being installed?
",jplock,2014-06-27 00:32:05
226,2014-04-25 08:09:42,"dpkg shows it as '0.7.2-9+deb7u1'.
",MisterWS,2014-06-27 00:32:05
226,2014-06-27 00:32:05,"Please reopen if you're still seeing this.
",al3x,2014-06-27 00:32:05
225,2014-04-19 17:14:12,"What's the process for adding new emails after the Ansible scripts have already been added? Is there a specific task for adding a new email account?
",zachlatta,2014-06-27 01:11:57
225,2014-04-19 17:32:10,"You can add the new emails to the script and run the entire playbook again. 

> Op 19 apr. 2014 om 19:14 heeft Zach Latta notifications@github.com het volgende geschreven:
> 
> What's the process for adding new emails after the Ansible scripts have already been added? Is there a specific task for adding a new email account?
> 
> ‚Äî
> Reply to this email directly or view it on GitHub.
",tilsammans,2014-06-27 01:11:57
225,2014-04-29 09:52:27,"Hmm, the scripts fail on second run - that's fun. Will probably end up
looking into https://github.com/JoshData/mailinabox.

Excerpts from Joost Baaij's message of 2014-04-19 10:32:16 -0700:

> You can add the new emails to the script and run the entire playbook again. 
> 
> > Op 19 apr. 2014 om 19:14 heeft Zach Latta notifications@github.com het volgende geschreven:
> > 
> > What's the process for adding new emails after the Ansible scripts have already been added? Is there a specific task for adding a new email account?
> > 
> > ‚Äî
> > Reply to this email directly or view it on GitHub.
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/al3x/sovereign/issues/225#issuecomment-40875406
",zachlatta,2014-06-27 01:11:57
224,2014-04-18 13:52:48,"fixes #156 by adding the -L flag, as suggested by @ventolin
",nstanke,2014-04-18 14:14:48
223,2014-04-17 16:53:27,"Checks if the exact version of Tarsnap is already installed and, if so,
skips the download and build steps.
",alexdunae,2014-04-18 13:45:33
223,2014-04-17 22:10:12,"+1 - Would appreciate this for z-push and roundcube aswell. 
",nstanke,2014-04-18 13:45:33
222,2014-04-16 16:07:31,"Change instructions for creating the tarsnap key to generate it at ""decrypted_tarsnap.key"" to catch up with PR #176.
",yourcelf,2014-04-18 13:44:40
221,2014-04-16 13:47:21,"SSLH¬π would be a great way to access our box inside a corporate firewall, which almost never block port 443. I'm going to try this in the upcoming days. Would someone be interested in this? 

[1]https://github.com/yrutschle/sslh
",nstanke,2014-06-27 00:29:14
221,2014-05-17 10:39:07,"This is cool but should be an optional feature.
",neuhaus,2014-06-27 00:29:14
221,2014-06-27 00:29:14,"If your corporate firewall allows outgoing OpenVPN connections, that might be a less tricky way of reaching your Sovereign VPS.
",al3x,2014-06-27 00:29:14
221,2014-09-17 07:37:13,"I noticed that SSLH currently only offers a forking server and one that uses select(). The ""proper"" way (for the best performance) would be to have one that is libevent based.
",neuhaus,2014-06-27 00:29:14
221,2014-09-17 12:51:22,"If someone is still interested in this, I added a SSLH playbook to Streisand a while ago. (SSH, SSL & OpenVPN on :443)

[1] https://github.com/jlund/streisand/
[2] https://github.com/jlund/streisand/commit/990cf81a7c1a282cd7709aa81859ddebe3fb2b2e
",nstanke,2014-06-27 00:29:14
220,2014-04-14 19:17:23,"I'm getting this error:

<S_CODE_TOKEN>

The `ca-certificates` package is up-to-date and I've tried `update-ca-certificates` but I still get this error.
",reedlaw,2014-04-21 23:11:21
220,2014-04-14 19:27:40,"More info:

Curl works fine.

<S_CODE_TOKEN>
",reedlaw,2014-04-21 23:11:21
220,2014-04-14 20:51:53,"I've been seeing the same thing, not just with Google Auth, though I can't remember which others at the moment. 

As a work-around I've been adding validate_certs:no wherever there's a problematic get_url command. Better to identify the cause though I imagine. 

> On Apr 14, 2014, at 3:27 PM, ""Reed G. Law"" notifications@github.com wrote:
> 
> More info:
> 
> Curl works fine.
> 
> deploy@sovereign:~$ curl -v https://google-authenticator.googlecode.com/files/libpam-google-authenticator-1.0-source.tar.bz2 -o libpam-google-authenticator-1.0-source.tar.bz2
> - About to connect() to google-authenticator.googlecode.com port 443 (#0)
> -   Trying 74.125.22.82...
>   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
>                                  Dload  Upload   Total   Spent    Left  Speed
>   0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\* connected
> - Connected to google-authenticator.googlecode.com (74.125.22.82) port 443 (#0)
> - successfully set certificate verify locations:
> -   CAfile: none
>   CApath: /etc/ssl/certs
> - SSLv3, TLS handshake, Client hello (1):
>   } [data not shown]
> - SSLv3, TLS handshake, Server hello (2):
>   { [data not shown]
> - SSLv3, TLS handshake, CERT (11):
>   { [data not shown]
> - SSLv3, TLS handshake, Server key exchange (12):
>   { [data not shown]
> - SSLv3, TLS handshake, Server finished (14):
>   { [data not shown]
> - SSLv3, TLS handshake, Client key exchange (16):
>   } [data not shown]
> - SSLv3, TLS change cipher, Client hello (1):
>   } [data not shown]
> - SSLv3, TLS handshake, Finished (20):
>   } [data not shown]
> - SSLv3, TLS change cipher, Client hello (1):
>   { [data not shown]
> - SSLv3, TLS handshake, Finished (20):
>   { [data not shown]
> - SSL connection using ECDHE-RSA-AES128-GCM-SHA256
> - Server certificate:
> -    subject: C=US; ST=California; L=Mountain View; O=Google Inc; CN=*.googlecode.com
> -    start date: 2014-04-02 15:25:07 GMT
> -    expire date: 2014-07-01 00:00:00 GMT
> -    subjectAltName: google-authenticator.googlecode.com matched
> -    issuer: C=US; O=Google Inc; CN=Google Internet Authority G2
> -    SSL certificate verify ok.
>   > GET /files/libpam-google-authenticator-1.0-source.tar.bz2 HTTP/1.1
>   > User-Agent: curl/7.26.0
>   > Host: google-authenticator.googlecode.com
>   > Accept: _/_
>   > 
> - additional stuff not fine transfer.c:1037: 0 0
> - HTTP 1.1 or later with persistent connection, pipelining supported
>   < HTTP/1.1 200 OK
>   < Content-Length: 32708
>   < Content-Type: application/x-bzip2; charset=binary
>   < Content-Disposition: attachment; filename=""libpam-google-authenticator-1.0-source.tar.bz2""
>   < Accept-Ranges: bytes
>   < Date: Mon, 14 Apr 2014 19:22:16 GMT
>   < Last-Modified: Tue, 15 May 2012 01:45:25 GMT
>   < Expires: Mon, 21 Apr 2014 19:22:16 GMT
>   < Server: DFE/largefile
>   < Cache-Control: public, max-age=604800
>   < Age: 138
>   < Alternate-Protocol: 443:quic
>   < 
>   { [data not shown]
>   100 32708  100 32708    0     0   205k      0 --:--:-- --:--:-- --:--:--  329k
> - Connection #0 to host google-authenticator.googlecode.com left intact
> - Closing connection #0
> - SSLv3, TLS alert, Client hello (1):
>   } [data not shown]
>   ‚Äî
>   Reply to this email directly or view it on GitHub.
",robfeldmann,2014-04-21 23:11:21
220,2014-04-14 20:58:31,"I'm getting it for all `get_url` commands as well as the `apt_key` from `prosody.yml`. As a workaround I'm manually fetching the files with curl.
",reedlaw,2014-04-21 23:11:21
220,2014-04-21 23:11:21,"Upgrading to ansible 1.5.4 fixed these problems.
",reedlaw,2014-04-21 23:11:21
220,2015-02-11 22:31:55,"This is happening to me on a remote Ubuntu 14.04 with Ansible 1.5.4 so seems to still be an issue :/ I had to manually wget the files that were failing although it only happened with two instances.
",shaneonabike,2014-04-21 23:11:21
219,2014-04-10 22:46:48,"While I love the idea of a personal cloud, I don't relish the thought of downtime or emergency fixes. Has anyone put any thought into automated failover? Maybe a simple solution is to run two instances and set up [DNS round-robin](https://en.wikipedia.org/wiki/Round-robin_DNS). There would need to be a way to automatically mirror the data. I'm not sure how many different types of data there are here, but probably it would need some combination of [db replication](http://wiki.postgresql.org/wiki/Streaming_Replication) and rsync or [unison](http://www.cis.upenn.edu/~bcpierce/unison/).
",reedlaw,2014-06-26 23:45:27
219,2014-04-11 17:11:24,"Failover mechanism would be really great. I think it would be enough to sync /decrypted/?
",nstanke,2014-06-26 23:45:27
219,2014-06-26 23:45:27,"Sovereign comes with backups to Tarsnap out of the box. If you'd like to see an additional redundancy measure added, please submit a pull request.
",al3x,2014-06-26 23:45:27
218,2014-04-10 20:50:32,"I originally created my server when Sovereign was using MySQL. Earlier today I needed to update my SSL cert (due to Heartbleed), so I grabbed the latest Sovereign and went to town. Now Roundcube is reporting ""DATABASE ERROR: CONNECTION FAILED!"".

What steps can I take to resolve this? I'd love not to loose all of my past emails is possible, though it wouldn't be the end of the world.
",jgillman,2014-04-22 19:00:40
218,2014-04-10 21:08:32,"any helpful output in the roundcube logs (`/var/log/roundcube/`)? I've never used sovereign before the PostgreSQL change, I'm sorry.
",nstanke,2014-04-22 19:00:40
218,2014-04-10 23:02:32,"This is the same issue I‚Äôm having! I‚Äôd like to get you some log data but, in the testing environment (Vagrant), I can‚Äôt seem to get access to the /var/log/roundcube/ directory (permission denied). I still haven‚Äôt upgraded on production so I can‚Äôt do it there.

I‚Äôve tried elevating to root (‚Äòsu root‚Äô) but I don‚Äôt know the password. I‚Äôve tried ‚Äúvagrant‚Äù, ‚ÄútestPassword‚Äù, and ‚Äúfoo‚Äù to no avail.

Does anyone know what the root password is for the virtual testing machine?

On Apr 10, 2014, at 5:08 PM, Norman S. notifications@github.com wrote:

> any helpful output in the roundcube logs (/var/log/roundcube/)? I've never used sovereign before the PostgreSQL, I'm sorry.
> 
> ‚Äî
> Reply to this email directly or view it on GitHub.
",robfeldmann,2014-04-22 19:00:40
218,2014-04-11 00:10:41,"@PajamaSoft If your main account (named ""deploy"" by default) has sudo privileges you should be able to do `sudo su` and get in. Other than that I'm not sure.

@nstanke The error in the roundcube logs doesn't seem too helpful ‚Äì just the following repeated several time:

<S_CODE_TOKEN>
",jgillman,2014-04-22 19:00:40
218,2014-04-11 16:50:34,"@jgillman You could try to reconfigure Roundcube. Run `dpkg-reconfigure roundcube-core` and and go through all the prompts. 
",nstanke,2014-04-22 19:00:40
218,2014-04-22 19:00:40,"After a month of my server being down Linode came out with new servers tiers with SSDs so I'm giving up and starting over. Sad, but now everything is all up to date.
",jgillman,2014-04-22 19:00:40
218,2016-11-17 20:09:39,"If anyone else ends up with this error https://github.com/sovereign/sovereign/issues/218#issuecomment-40158945, in my case it was an issue with the password. In my `vars/user.yml` file, I mistakenly put the password _hash_, and not the password, in the `webmail_db_password` line (oops).

Conceivably, this could also happen if for some other reason the password you're entering in the `webmail_db_password` line doesn't match up exactly with that already in the postgresql database for the roundcube user.
",dr-nate,2014-04-22 19:00:40
217,2014-04-10 00:48:05,"While playing around with #216, I had set up the jessie repo and accidentally tried to run the playbooks.  This breaks all sorts of stuff since the packages are so much newer in jessie.  To prevent the playbooks from breaking for other people, I was thinking of locking in the specific apt versions of all of the packages (especially for things like roundcube).  Then we can upgrade them later on without fear that a rouge repo will break things.

Thoughts?  /cc @lukecyca @al3x 
",jplock,2014-06-27 00:25:38
217,2014-04-10 00:51:16,"Locking them into the latest version that is available in wheezy.
",jplock,2014-06-27 00:25:38
217,2014-06-27 00:25:38,"I'm confused as to how things would break unless someone had intentionally added a different repository. I haven't tinkered with the repositories on my Ansible VPS and it's been running smoothly through many `sudo apt-get dist-upgrade`s.
",al3x,2014-06-27 00:25:38
216,2014-04-08 20:14:11,"I'm currently running sovereign on Debian wheezy which only has Apache 2.2.  If we add the jessie debian apt repos, we could install 2.4 per https://gist.github.com/azet/6143635

Would that be something people are interested in?
",jplock,2014-04-10 01:22:32
216,2014-04-08 21:31:06,"+1 had the same idea a few minutes ago. 
",nstanke,2014-04-10 01:22:32
216,2014-04-08 21:45:07,"I think using nginx would be a better priority with the trusted and heavily used dotdeb repo version for php5-fpm and the latest nginx
",stephenjamieson,2014-04-10 01:22:32
216,2014-04-09 14:34:01,"@stephenjamieson that would be even better but in the meantime Apache 2.4 would do it. 
",nstanke,2014-04-10 01:22:32
216,2014-04-09 15:57:34,"The one issue I see with doing this though is if we add the jessie repo, its going to want to install a lot of packages from there instead of preferring the wheezy versions.

@lukecyca or @al3x, any opinions?
",jplock,2014-04-10 01:22:32
216,2014-04-09 17:24:27,"Maybe it's time to roll forward a release of Debian? Sovereign is coming up on a year old in several months.

## 

Alex Payne

> On Apr 9, 2014, at 8:57, Justin Plock notifications@github.com wrote:
> 
> The one issue I see with doing this though is if we add the jessie repo, its going to want to install a lot of packages from there instead of preferring the wheezy versions.
> 
> @lukecyca or @al3x, any opinions?
> 
> ‚Äî
> Reply to this email directly or view it on GitHub.
",al3x,2014-04-10 01:22:32
216,2014-04-09 17:28:05,"but Jessie is still in 'testing' for a long time (freeze in november?) and the aim of this project is/was to provide a long-term self running stable mail/cloud environment?

Edit: I would still +1 the change even an upgrade. 
",nstanke,2014-04-10 01:22:32
216,2014-04-09 18:43:19,"I agree with @nstanke on this one.  I'd prefer a stable system over apache 2.4 honestly.  Let me hunt around to see if we have any other options.
",jplock,2014-04-10 01:22:32
216,2014-04-10 01:22:32,"I don't see this happening https://www.mail-archive.com/debian-apache@lists.debian.org/msg14792.html  I'm going to close it out for now.
",jplock,2014-04-10 01:22:32
215,2014-04-07 15:12:34,"cgit wouldn't work for me until I enabled the CGI module in Apache.
",squarepegsys,2014-04-18 13:43:34
214,2014-04-05 19:32:18,"Unfortunately I have been super busy and haven't updated my production environment since December, 2013. A lot has changed since then and so far my tests (in vagrant) going from 12/2013 to the latest sovereign version haven't worked so well and I don't want to have a lot of downtime or issues I can't solve right away.

So I'm wondering what is the best way to backup all my email (the only thing I care about) so that I can just start over from scratch and re-run the ansible script? As far as I can tell, [larch](https://github.com/rgrove/larch) only copies to another imap server which I don't/won't have. I am also thinking that using [Dovecot's DSync](http://wiki2.dovecot.org/Tools/Dsync) might be an option, but I'm not 100% sure.

If anyone has any thoughts, or experience doing this themselves, I would really appreciate some advice.
",robfeldmann,2014-06-26 23:45:40
214,2014-04-07 03:04:27,"> so far my tests (in vagrant) going from 12/2013 to the latest sovereign version haven't worked so well

Can you elaborate on how it failed? I don‚Äôt think the mail system has changed too much since December, so I would expect that it should mostly be upgradable in-place. I recently did a similarly big update to my own server (2-3 months worth of changesets) and it went pretty smoothly.

Even if you do a complete reinstall, I think you will be able to simply restore dovecot‚Äôs data directories and have everything work (as long as you create exactly the same email accounts, etc.). That seems more straightforward than restoring via IMAP.
",lukecyca,2014-06-26 23:45:40
214,2014-04-08 15:27:38,"What specific folders should we backup? That does seem pretty simple.
",DomenicF,2014-06-26 23:45:40
214,2014-04-08 16:45:00,"I use the included `tarsnap` configuration for backups, so whatever is included in that. The email server‚Äôs stuff is all in `/decrypted`, I believe.
",lukecyca,2014-06-26 23:45:40
214,2014-04-09 22:56:54,"Okay, it seems that in testing I can run the latest hotness on my several month old sovereign installation without breaking mail as far as I can tell, so that's good.

However, the switch to Postgres is messing up Roundcube. The Ansible script stops at ""set round cube password"" with the error ""database 'roundcube' does not exist"". Now whenever I visit roundcube I get the ""Database Error! Connection failed"" message. Unfortunately, I know next-to-nothing about Postgres so I can't really diagnose the issue easily. Also, any further re-runs of the ansible script do not produce the error (it's as if it _thinks_ everything is configured correctly the second time).

So far my researching and trying things out has not solved the issue but I do feel more confident that at least my mail setup won't entire be broken; I can still access it via IMAP.
",robfeldmann,2014-06-26 23:45:40
214,2014-04-10 00:45:28,"Are you still running on stock wheezy?  If you've accidentally added any of the jessie repos, it will install a later version of roundcube which is not currently compatible with the version that wheezy is installing.
",jplock,2014-06-26 23:45:40
214,2014-04-10 00:56:32,"I‚Äôm pretty sure it‚Äôs just stock Wheezy. I didn‚Äôt see anything related to jessie when checking ‚Äò/etc/apt/sources.list‚Äô.

On Apr 9, 2014, at 8:45 PM, Justin Plock notifications@github.com wrote:

> Are you still running on stock wheezy? If you've accidentally added any of the jessie repos, it will install a later version of roundcube which is not currently compatible with the version that wheezy is installing.
> 
> ‚Äî
> Reply to this email directly or view it on GitHub.
",robfeldmann,2014-06-26 23:45:40
214,2014-04-11 15:54:50,"@lukecyca Can you elaborate on your process? Assuming tarsnap, what exactly do you extract? Do you replace any files, etc? A detailed process would be VERY much appreciated :)
",DomenicF,2014-06-26 23:45:40
214,2014-04-14 17:33:21,"The tarsnap script backs up the following:
- `/home` 
- `/root` 
- `/decrypted` 
- `/var/www` 
- `/var/lib/postgresql/9.1/main`
  Of those, I believe the only one required for email state is `/decrypted/example.com`. 

The restore process should be roughly:
1. Create a new blank vps server
2. Run your playbooks against it (to install the software and create the encfs)
3. Immediately stop most services manually (so they don‚Äôt attempt to do anything during the restore)
4. Restore the directories from backup
5. Restart the server (just to ensure all services are restarted)
6. Re-run the playbooks (to remount the encfs and ensure the services are started)

I‚Äôve done similar maneuvers on my server, but never a full restore. YMMV. Please take notes and consider starting a wiki page.
",lukecyca,2014-06-26 23:45:40
213,2014-04-05 15:51:38,"To bring this certificate in line with how those in ssl.yml are managed.
",thomwiggers,2014-04-07 03:05:30
213,2014-04-07 03:05:34,"Thank you!
",lukecyca,2014-04-07 03:05:30
212,2014-04-05 14:08:34,"Provisioning fails with this error:

<S_CODE_TOKEN>
",thomwiggers,2014-06-27 00:34:11
212,2014-04-07 03:09:44,"What vagrant image are you using?
",lukecyca,2014-06-27 00:34:11
212,2014-04-07 21:52:37,"The vagrantfile provided
",thomwiggers,2014-06-27 00:34:11
212,2014-04-08 02:13:35,"The vagrant file references two different images: one for VirtualBox and one for VMWare Fusion. The former is working for me, using Vagrant 1.5.2 and VirtualBox 4.3.8 and Ansible 1.5.4. I haven‚Äôt used the latter image.

In any case, the problem is that `python-apt` is required by the ansible apt module, creating a chicken-and-egg problem. You should be able to do something like:
1. `vagrant up`
2. `vagrant ssh` and then `apt-get install python-apt`
3. `vagrant provision`
",lukecyca,2014-06-27 00:34:11
212,2014-04-08 08:20:42,"I tracked it down - it appeared I already had a `wheezy64` box which did not have `python-apt` installed.

Perhaps the `vm.box` setting shouild be changed to a more unique id.
",thomwiggers,2014-06-27 00:34:11
211,2014-04-03 22:41:45,"It appears that ZNC release 1.0 (as specified in `roles/ircbouncer/vars/main.yml`) is no longer available at the same URL. You can see the following error when installing ZNC.

<S_CODE_TOKEN>

I'm happy to update to the latest stable of 1.2, but I'm not familiar enough with ZNC to understand the implications of this change.

If we don't wish to move to 1.2, there's an archived version of 1.0 at `http://znc.in/releases/archive/znc-1.0.tar.gz`.

I'm happy to submit the PR for this change, but I need guidance as to the direction to take.

 -- Rob
",qnm,2014-04-05 03:53:23
211,2014-04-05 01:32:00,"I updated ZNC to 1.2 in #177.  Are you sure you are using the latest code?
",jplock,2014-04-05 03:53:23
211,2014-04-05 03:53:23,"@jplock Ah - my mistake. I must've forked sovereign prior to your commit. A merge from upstream master brought in your changes. I'll test them soon, but I suspect they'll sort my problem. Thanks.
",qnm,2014-04-05 03:53:23
210,2014-04-02 08:33:42,"- The role now generates .ovpn profiles with embedded CA, certificate, key, and HMAC firewall key information. These .ovpn profiles are compatible with OpenVPN for iOS and Android, and only a single file needs to be transferred to your mobile device.
- Added explicit route information to the .ovpn profile
",jlund,2014-04-02 15:11:36
210,2014-04-02 15:11:34,"Looks great. Thanks!
",lukecyca,2014-04-02 15:11:36
209,2014-04-01 00:40:34,"fix broken link to getting ansible
",chid,2014-04-01 01:04:34
209,2014-04-01 01:04:31,"Thanks!
",lukecyca,2014-04-01 01:04:34
208,2014-03-31 19:50:23,"Hi sovereign-users

I have 2 major problems with z-push. Attachments over 1MB don't arrive & my search isn't working. Both work's great over imap. 

Anyone with the same problem? 
",nstanke,2014-06-27 01:11:48
207,2014-03-30 14:25:11,"libpam-dev didn't exist for some people so switching to libpam0g-dev instead.  This should fix the issue @nstanke was having on #199
",jplock,2014-04-01 01:08:13
206,2014-03-30 13:29:14,"Optional 2FA support for OpenVPN (requires uncommenting on the server and pushing new client configs)

Fixes #200
",jplock,2014-04-01 01:07:52
205,2014-03-29 17:24:08,"Vagrant can't sudo to the sovereign test user so this won't work.
",jplock,2014-03-30 19:42:51
204,2014-03-29 17:04:43,,jplock,2014-03-30 19:42:27
203,2014-03-29 14:28:23,"The .google_authenticator file has to be generated by the user that is going to attempt to use it.  Also, -W doesn't seem to work (results an in INVALID_WINDOW error in /var/log/auth.log), so use -w 1 to allow for a single concurrent token.

Fixes #202 
",jplock,2014-03-29 14:46:26
202,2014-03-29 12:46:06,"I feel like an idiot, but is Google Authentication actually working for anyone?  google-authenticator doesn't seem to work if you attempt to generate it for another user.  I'm trying to update the play books to use:

<S_CODE_TOKEN>

which generates the file properly but logins still won't work.  Is it even possible to generate a hash for another user?
",jplock,2014-03-29 14:28:52
202,2014-03-29 13:13:12,"If you run ""google-authenticator"" yourself after logging in for the first time, it works fine.
",jplock,2014-03-29 14:28:52
201,2014-03-28 18:17:07,"https://github.com/alexandregz/twofactor_gauthenticator or https://github.com/rcdevs/openotp_authentication_roundcube (requires php-soap eww)
",jplock,2014-03-30 19:42:27
200,2014-03-28 15:02:39,"http://zcentric.com/2012/10/09/google-authenticator-with-openvpn-for-2-factor-auth/
https://securityskittles.wordpress.com/2012/03/14/two-factor-authentication-for-openvpn-on-centos-using-google-authenticator/
",jplock,2014-04-01 01:07:52
200,2014-03-28 20:31:48,"Forgive me if this is a naive question. Does one have to install an app from the Google Play store to use this on android?
",ariddell,2014-04-01 01:07:52
200,2014-03-29 02:32:21,"i use the otp by fedora, FreeOTP its on f-droid, google closed sourced theirs.
",stephenjamieson,2014-04-01 01:07:52
200,2014-03-29 14:36:38,"@al3x or @lukecyca, is this something we want to do, or just continue using the certificates as we are today?
",jplock,2014-04-01 01:07:52
200,2014-03-29 14:53:40,"Either way is fine by me. 

The client cert method that we use now is very convenient, and fairly secure against broad attack vectors, but it's vulnerable if someone can get access to one of the certs (via your unlocked screen, or an unencrypted hard drive, or whatever).

I also use a (non-sovereign) OpenVPN AS install which uses regular user logins in combination with Google Authenticator, so you simply append the 6 digits OTP to your password when logging in. It works well, but is extra work to enter the OTP each time you connect.
",lukecyca,2014-04-01 01:07:52
200,2014-03-29 17:38:49,"I'd like to make this optional, but off by default.
",al3x,2014-04-01 01:07:52
199,2014-03-28 01:21:08,"Google Authenticator for 2FA logins (fixes #6)
",jplock,2014-03-28 03:30:17
199,2014-03-28 01:27:22,"Well that was fast... :)

What should we do regarding settings up a key for the user? It would be nice if the playbook generated one and then placed it on the local machine (like the openvpn role does). IIRC it can generate a QR code too, which would be pretty slick.
",lukecyca,2014-03-28 03:30:17
199,2014-03-28 01:29:25,"I figured the user can log in initially and run ""google-authenticator"" so they can can scan the QR code and write down the other passwords.  That's what I had intended to do anyway.  Unless we want the playbook to run that command and pause like the openvpn one does.  Is that what you'd like it to do?
",jplock,2014-03-28 03:30:17
199,2014-03-28 01:57:52,"I'm making it do that now, should be finished in a few minutes.
",jplock,2014-03-28 03:30:17
199,2014-03-28 03:30:20,"Very nice. Thanks for this!
",lukecyca,2014-03-28 03:30:17
198,2014-03-28 00:57:08,"In preparation for using any 2FA solution, it will most likely need to modify sshd_config, so let's change the file in place instead of overwriting it completely.  Relates to #6 and #195
",jplock,2014-03-28 01:15:55
197,2014-03-26 00:34:43,"Hi,

you want to add and enable carbons and smack (stream managment) on prosody. This allows a better expirience on mobile devices. Have a look at mine prosody ansible role (CentOS based): https://github.com/xsrc/Prosody . I use the patched version the mod carbon which fixes an otr/private/carbons issue. 
",kalkin,2014-06-27 01:15:03
197,2014-06-27 01:15:03,"I'm open to a pull request but I'd prefer not to integrate third-party patches to the software that ships with Ansible.
",al3x,2014-06-27 01:15:03
196,2014-03-25 12:30:34,"My spam is through the roof. Shouldn't DSPAM be trained?

http://forum.directadmin.com/showthread.php?t=16015
",tilsammans,2014-06-26 21:09:17
196,2014-03-25 15:27:10,"My DSPAM has always been pretty useless too. Luckily, I find that the greylisting works wonders and gets rid of most of my spam.

I‚Äôm pretty sure DSPAM is correctly noticing when you move a message into the SPAM folder, and that should cause it to update its database accordingly. Despite that, it still scores almost everything as ham.
",lukecyca,2014-06-26 21:09:17
196,2014-03-25 15:43:08,"The corpus training still seems like something we could automate in Ansible, to make it a little better?
",tilsammans,2014-06-26 21:09:17
196,2014-04-01 20:19:57,"Odd. Maybe it's just that I gave it a huge initial corpus from my Gmail import, but my dspam install seems to catch spam pretty well.
",al3x,2014-06-26 21:09:17
196,2014-04-03 07:56:38,"Okay, if it works well for you it must be a problem for me. I've diligently updated my Junk folder but it's not very effective at all. I will try to train it manually.
",tilsammans,2014-06-26 21:09:17
196,2014-06-26 20:01:54,"dspam has never worked for me, and I recently realized that we have a few misconfigurations...

In `/decrypted/dspam/data/example.com/username/username.stats`, I get something like `0,9999,0,0,0,0`, indicating that 9999 messages were allowed through as ham, and 0 were detected as spam.

I also have a set of data directories located in `/decrypted/dspam/data/unix:/run/dspam/dspam.sock/username/`. These ones are referenced from `dspam_filter_access`.

I also have `/decrypted/dspam/data/dspam/username/username.stats` because the user argument to `dspam` is `${user}@${nexthop}`, but the value of nexthop is `dspam`.

Essentially, different components of the dspam system are looking in different data directories, preventing any training from ever happening. I have a patch for this and have done a fair amount of research, but I'm hoping someone else can corroborate these findings first...
- What does your `/decrypted/dspam/data/` directory look like?
- What are the contents of your primary `username.stats` file?
",lukecyca,2014-06-26 21:09:17
196,2014-06-26 20:36:40,"Thanks for looking into this!!!

> What does your /decrypted/dspam/data/ directory look like?

Omitting several other domains on the machine:

<S_CODE_TOKEN>

> What are the contents of your primary username.stats file?

I don't have that file under my domain directory:

<S_CODE_TOKEN>

But it is present in the `unix:` directory:

<S_CODE_TOKEN>
",tilsammans,2014-06-26 21:09:17
196,2014-06-26 20:48:18,"Thanks! Those are exactly the same symptoms. I'll push my fix.
",lukecyca,2014-06-26 21:09:17
196,2014-06-26 21:12:19,"After applying this change, dspam should start working. If you want to clean up the previous mess, you can simply `rm -rf /decrypted/dspam/*` and it will be regenerated for you. Since you have zero training data, you won't be losing anything.

You can keep an eye on that `username.stats` file to see how dspam is performing. See `man dspam_stats` for a description of each number.
",lukecyca,2014-06-26 21:09:17
196,2014-06-27 06:53:41,"It works! Hurray!
",tilsammans,2014-06-26 21:09:17
195,2014-03-24 02:43:51,"Installs Duo Security using both login_duo and pam_duo.  Users in the sudo or deploy groups are ignored, so that should allow both vagrant testing to work locally and the deploy user to authenticate when running the playbooks.
",jplock,2014-03-28 01:22:57
195,2014-03-27 18:06:44,"Any preferences on getting this merged in?
",jplock,2014-03-28 01:22:57
195,2014-03-27 22:58:41,"Looks like good work, and 2FA is something we really need. I‚Äôm not crazy about relying on a third-party cloud-based service to do it though. Seems antithetical to sovereign.

I‚Äôd much prefer to do this using the google auth pam module, which is compatible with a variety of smart-phone tokens (including Google Authenticator) as well as hardware tokens (such as from [Feitian](http://www.ftsafe.com/product/otp)). I‚Äôve been using this setup for years (not with sovereign, though).

I‚Äôll let @al3x make the call on this.
",lukecyca,2014-03-28 01:22:57
195,2014-03-27 23:19:38,"Oh that's cool.  I didn't know about that.  Let me look into the google auth pam module.
",jplock,2014-03-28 01:22:57
195,2014-03-28 01:21:40,"I submitted PR #199 for Google Authenticator instead
",jplock,2014-03-28 01:22:57
194,2014-03-23 21:17:33,"This one worked for me

<S_CODE_TOKEN>
",banglashi,2014-06-25 02:21:15
194,2014-06-25 02:21:15,"Dupe of #149 
",lukecyca,2014-06-25 02:21:15
193,2014-03-23 18:53:07,"52 versions are bit to much - 5 fit much better.  
",nstanke,2014-03-24 15:18:46
193,2014-03-24 12:38:12,"+1
",jplock,2014-03-24 15:18:46
192,2014-03-23 06:11:54,"As a potential solution for #43 this adds [cgit](http://git.zx2c4.com/cgit/about/) for a web interface and [gitolite](https://github.com/sitaramc/gitolite) for hosting and access control.

Was unsure how to set them up for a common use case, so pretty much stuck with defaults. They both offer a wide range of settings though. Maybe someone with more experience hosting them could chime in with settings to use.

You'll have to run `cp ~/.ssh/id_rsa.pub roles/git/files/gitolite.pub` or similar to get working. Also need to add some documentation in general.

cgit exists at https://git.sovereign.local, and the gitolite settings are in the `git@sovereign.local:gitolite-admin` repo.
",larryfox,2014-04-01 01:39:55
192,2014-03-24 12:38:22,"+1
",jplock,2014-04-01 01:39:55
192,2014-03-24 13:14:15,"Works nicely for me. Thanks - this is great!
",skottler,2014-04-01 01:39:55
192,2014-03-25 20:55:09,"+1 would be a cool addition to sovereign.
",nstanke,2014-04-01 01:39:55
192,2014-03-28 01:20:41,"This looks pretty awesome! Can you also add a line to the README?
",lukecyca,2014-04-01 01:39:55
192,2014-04-01 01:05:21,"Ping. Add a quick line to the README and I‚Äôll merge this in.
",lukecyca,2014-04-01 01:39:55
192,2014-04-01 01:39:00,"Added a short line about needing to copy your public key. Should I add something about configuring gitolite to the README or the wiki?
",larryfox,2014-04-01 01:39:55
191,2014-03-21 00:34:31,,jplock,2014-03-21 00:41:05
190,2014-03-19 23:25:34,"I just updated my SSL cert as the first time I made it I wasn't as knowledgable and improperly created it. After installing them, I restarted my server (Debian on Linode), and everything seemed to come back up fine, but now when I navigate to Roundcube it reports ""connection to imap server failed""

Apache is correctly using the new SSL cert. I'm not really sure where to start trouble shooting this.
",jgillman,2014-04-10 19:50:56
190,2014-03-19 23:26:44,"I should note that I know my way around the command line pretty well, and have decent troubleshooting skills. But this is my first time running my own mail server (and owncloud, and so on), so I'm not always sure where to start looking.
",jgillman,2014-04-10 19:50:56
190,2014-03-20 19:31:06,"`/etc/ssl/certs/wildcard_combined.pem` contains also your new certificate? 
",nstanke,2014-04-10 19:50:56
190,2014-03-20 21:33:25,"@nstanke `/etc/ssl/certs/wildcard_combined.pem` should be a copy of `/etc/ssl/certs/wildcard_ca.pem`, correct?
",jgillman,2014-04-10 19:50:56
190,2014-03-21 00:44:05,"@jgillman Where is your cert from? Is it self-signed or from a real certificate authority?
",lukecyca,2014-04-10 19:50:56
190,2014-03-21 02:30:03,"@lukecyca Self signed using the instructions in the `README.textile`.

The first time I didn't understand what ""Common Name"" was and just put in my own name. Oddly, this worked, though I would get browser errors saying that the domain didn't match what was on the cert. That's what I was trying to fix when I recreated it, this time using a wildcard for my domain: `*.gil.mn`

(FYI, gil.mn is not using SSL. I only have it on for RoundCube and other services)
",jgillman,2014-04-10 19:50:56
190,2014-04-08 21:55:30,"I just updated my SSL certificates due to heartbleed (https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0160) and had a similar problem. The `/etc/ssl/certs/wildcard_combined.pem` was not properly updated. I got this in my first run after changing the certificate files locally.

<S_CODE_TOKEN>

Presumably, the task gets skipped because `/etc/ssl/certs/wildcard_combined.pem` already exists, but I'm not certain of that. Please note, I'm not running the latest version of the playbooks. It is possible this has been resolved already.
",bryanjswift,2014-04-10 19:50:56
190,2014-04-08 22:00:05,"Just looked at that task again:

<S_CODE_TOKEN>

`creates=/etc/ssl/certs/wildcard_combined.pem` is there so it gets skipped when files are updated as the file already exists.
",bryanjswift,2014-04-10 19:50:56
190,2014-04-10 18:45:49,"Yeah, thanks to Heartbleed I'm also updating my certs _again_ with a patched OpenSSL.

Is the solution here to delete the certs on the server, then run the playbook again? Looks like it would also install Selfoss, which would be welcomed.
",jgillman,2014-04-10 19:50:56
190,2014-04-10 18:54:20,"@jgillman Yes this fixed the problem for me. To be safe I would backup `wildcard_combined.pem` first, the run the playbook again.
",nstanke,2014-04-10 19:50:56
190,2014-04-10 19:50:53,"@nstanke @bryanjswift Awesome! This fixed the SSL issue for me as well, though in upgrading I now have a disconnected database as I was using the old sovereign which used MySQL. I will open a new issue for that as I have no idea how to upgrade/migrate.
",jgillman,2014-04-10 19:50:56
189,2014-03-18 23:11:58,"my z-push log was crazy huge.
",nstanke,2014-03-18 23:16:29
188,2014-03-16 19:04:21,"I would change the log level default to ERROR. My z-push log was over 17MB filled with [INFO] lines.
",nstanke,2014-03-16 19:17:26
187,2014-03-15 21:57:49,"<S_CODE_TOKEN>

Any idea what would cause this? I have `steveklabnik.com` in my `vars/user.yml`.
",steveklabnik,2014-03-15 22:59:19
187,2014-03-15 22:21:05,"So. because DNS was _after_ running the playbooks, I didn't set up any records. Pointing an `A` at `steveklabnik.com` made it work.
",steveklabnik,2014-03-15 22:59:19
187,2014-03-15 22:31:47,"Ehh, while ansible ran,  if I log into the server and try to `apachectl start`, it doesnt work with the same error.
",steveklabnik,2014-03-15 22:59:19
187,2014-03-15 22:33:08,"`/var/log/apache2/error.log` says:

<S_CODE_TOKEN>

Soooo something must be wrong with my CA stuff. `git diff` shows that i've changed
- b/roles/common/files/wildcard_ca.pem
- b/roles/common/files/wildcard_private.key

So i guess I'm missing `wildcard_public_cert`?
",steveklabnik,2014-03-15 22:59:19
187,2014-03-15 22:56:36,"Whew. I triple checked the cert stuff, and now it does start. It still complains:

<S_CODE_TOKEN>

How strange.
",steveklabnik,2014-03-15 22:59:19
187,2014-03-19 23:43:55,"I had this issue too and found an answer here: http://askubuntu.com/questions/256013/could-not-reliably-determine-the-servers-fully-qualified-domain-name

I created the file `/etc/apache2/conf.d/fqdn` with the contents `ServerName localhost`

Solved the issue for me.
",jgillman,2014-03-15 22:59:19
186,2014-03-10 01:04:51,"Fixes #184
",jplock,2014-03-15 17:00:28
186,2014-03-15 13:33:19,"Can someone please merge this in?
",jplock,2014-03-15 17:00:28
185,2014-03-10 00:09:59,,jplock,2014-03-15 16:59:22
185,2014-03-15 13:33:25,"Can someone please merge this in?
",jplock,2014-03-15 16:59:22
185,2014-03-15 13:46:58,"What are the errors that are raised during the import and have you filed a bug upstream?
",skottler,2014-03-15 16:59:22
185,2014-03-15 13:58:07,"The SQL file doesn't have ""CREATE TABLE IF NOT EXISTS"" in it, just ""CREATE TABLE"".  So if you attempt to re-run the play books with the ON_ERROR_STOP there, they won't execute properly.  I did ask the upstream author to add ""IF NOT EXISTS"" to the postgres file to work around it there as well.  The file also creates sequences which don't support ""IF NOT EXISTS"", so I'm thinking we still need to remove the ON_ERROR_STOP as this PR does.
",jplock,2014-03-15 16:59:22
184,2014-03-09 20:46:39,"Roundcube doesn't work and shows:

> DATABASE ERROR: CONNECTION FAILED!
> Unable to connect to the database!
> Please contact your server-administrator.

Logs show:

<S_CODE_TOKEN>
",yuvadm,2014-03-15 17:00:28
184,2014-03-09 21:11:36,"I got hit by this one too, but I'd had a previous working installation of RoundCube. I did notice there was an update to OwnCloud which may have messed up the CardDav plugin?

I'm not getting these errors anymore but here was a different error in the log file when I first experienced issues with RoundCube that was complaining about the plugin not having a table in the RoundCube db. Unfortunately as part of my debugging process (I assumed it was a problem I'd created) I purged the RoundCube install manually, so I don't have that log anymore...
",iboxifoo,2014-03-15 17:00:28
184,2014-03-09 21:57:23,"I'm having the same problem. Roundcube isn't creating the postgres user.

The following is in the roundcube error log:

<S_CODE_TOKEN>

And this is in the postgresql log:

<S_CODE_TOKEN>

Looking into why this user no longer exists.
",ssoriche,2014-03-15 17:00:28
184,2014-03-09 22:55:57,"I'm seeing this now too.  I'll admit, I have no idea how this roundcube, db-config stuff on debian is suppose to work.  It seems to be the most confusing thing possible as there are round cube files in /etc/roundcube, /var/lib/roundcube and /usr/share/roundcube.  I'll see if I can figure it out.
",jplock,2014-03-15 17:00:28
184,2014-03-09 23:07:13,"I'll just mention that plain IMAP login isn't working for me either, but that might be a separate issue, since this is the first time I'm trying and I might be trying wrong credentials (user field with/out `@example.com` etc.)

Also, @jplock's recent commit 1bd900bfae touched some of the roundcube user/pass stuff, might it be related?
",yuvadm,2014-03-15 17:00:28
184,2014-03-09 23:16:25,"IMAP seems to be working fine for me @yuvadm, so your issues there are maybe related to something else.
",iboxifoo,2014-03-15 17:00:28
184,2014-03-09 23:18:01,"I've still got the roundcube user and all of its database tables, but I'm getting a ""Database Error: Connection Failed"" when I try to launch roundcube.

I'm also seeing the

<S_CODE_TOKEN>

In my roundcube logs. 
",jplock,2014-03-15 17:00:28
184,2014-03-10 00:51:18,"I think I found the issue.  When I did my carddav changes, I had added this handler:

<S_CODE_TOKEN>

Which was generating a /etc/roundcube/debian-db.php file that looked like:

<S_CODE_TOKEN>

instead of being a valid PHP file like:

<S_CODE_TOKEN>

I'm going to submit a PR that just properly creates debian-db.php as roundcube is expecting and put that file in the proper place and not rely on dbconfig to do it's thing.  However, if you do run:

<S_CODE_TOKEN>

and go through all the prompts, you do end up with a valid PHP file.  Which is annoying as to why /usr/sbin/dbconfig-generate-include doesn't seem to work.
",jplock,2014-03-15 17:00:28
184,2014-03-16 01:47:24,"I am still seeing this problem on master :/

ehhhhhhhh actually I may not have set the password. Ugh.
",steveklabnik,2014-03-15 17:00:28
184,2014-03-16 09:28:17,"@steveklabnik The original problem was fixed, but I'm also having password errors. I might not be using `doveadm pw` properly.
",yuvadm,2014-03-15 17:00:28
184,2014-04-15 00:34:52,"I'm getting the `roundcube` db set up with owner `postgres` instead of `roundcube`.
",reedlaw,2014-03-15 17:00:28
184,2014-12-20 06:27:52,"I solved this for myself as all the things it says here  didnt work, first i edited roundcube.conf in /etc/dbconfig-common/roundcube.conf then ran dpkg-reconfigure roundcube-core and reinstalled the db using the mysql root user for the admin 
",wgailey,2014-03-15 17:00:28
184,2015-09-12 19:09:15,"Thanks very much @wgailey ! That really helped it's now working! I personally don't think this should be closed because in the plain install it still isn't really functioning. It wasn't until I shifted it to mysql that it started working
",shaneonabike,2014-03-15 17:00:28
183,2014-03-05 21:43:33,"This would allow us to setup our Mail, Calendar aswell as Contacts over Exchange on mobile-devices easier.

https://github.com/arved/PHP-Push-2-owncloud

Any suggestions or opinions on this?
",nstanke,2014-06-27 01:18:12
183,2014-03-25 18:14:28,"I use this on my almost-new sovereign install! It's great!

Biggest config change is change all the urls to remove /owncloud/ at the beginning, assuming you use a separate subdomain for it. After that it pretty much just works.
",T3hUb3rK1tten,2014-06-27 01:18:12
183,2014-03-25 20:49:54,"@T3hUb3rK1tten if you got a working Ansible solution for this it would be cool if you could send a pull request, else I would give it a try. - Norman
",nstanke,2014-06-27 01:18:12
183,2014-03-25 22:17:23,"@nstanke Sadly I do not and I have no experience with Ansible. I configured it manually. I started with PHP-Push-2, realized that didn't work with Owncloud, and then moved to this. I can help you with configuring it though, spent many hours being quite frustrated with it.

One big thing, you authenticate with ""user@domain.com"" to IMAP but you use ""user"" for Owncloud over CalDAV/CardDAV. PHP-Push-2 only can receive one set of credentials. To fix this I recommend opening up the source files for caldav.php and carddav_0c5.php under backend and putting in a regex to get just the local part of the email, something like ([^@]+) and use that as the username. This also means that your Owncloud and Dovecot passwords must be in sync.
",T3hUb3rK1tten,2014-06-27 01:18:12
183,2014-06-27 01:18:12,"I'd like to see a pull request for this. However, it doesn't look like PHP-Push-2 has seen much development lately, and there's 30 open issues on the project. I'd like to avoid including software that requires custom patches to function with Sovereign.
",al3x,2014-06-27 01:18:12
182,2014-03-05 05:08:47,"I ran into an error on first install, made a fix and attempted to run the playbook again but it stalled on the step, ""Gathering Facts"", specifically, ""'/bin/sh -c \'sudo -k && sudo -H -S -p""...not sure what is going on but any help would be greatly appreciated. 
",JulianGindi,2014-06-27 00:34:58
182,2014-03-05 15:32:30,"If the playbook failed part-way through, it‚Äôs possible that it left your firewall or sshd in an inconsistent state. I‚Äôm afraid you might have to blow away the VM and spin up a new one.

Are you using digital ocean by any chance? For some reason the kernels they provide have caused problems for both ufw (our firewall) and also for encfs. #167 has some discussion about this.
",lukecyca,2014-06-27 00:34:58
182,2014-03-05 15:53:10,"Lovely, haha. I'm currently using EC2. Ill try doing this again from scratch.
",JulianGindi,2014-06-27 00:34:58
182,2014-03-18 01:44:07,"I ran into this today with some other vagrant work.  Check the permissions on the deploy user to ensure they are in a group that can sudo without requiring a password.  For vagrant, that is the ""admin"" group.
",jplock,2014-06-27 00:34:58
181,2014-03-04 04:50:27,,jplock,2014-03-04 04:51:14
180,2014-03-04 04:46:23,"After much trial and error, this should properly set the ""roundcube"" database password to ""testPassword"" when running these playbooks within vagrant.   Previously, what I think was happening, was when dbconfig-common gets installed, it generates a random password for roundcube and sets it within postgres.  So when the handler to add the carddav database tables was attempted to be executed, it would fail.

This now properly sets the roundcube database password to {{ webmail_db_password }}
",jplock,2014-03-04 04:51:06
179,2014-03-03 22:43:26,"I'm unable to run this against the vagrant VM as the webmail_db_password seems to be automatically generated.
",jplock,2014-03-04 04:06:25
179,2014-03-03 22:43:45,"Fixes #178 
",jplock,2014-03-04 04:06:25
179,2014-03-04 03:23:00,"Don't merge this just yet.  I'm trying to resolve an issue with this running during the tests.
",jplock,2014-03-04 04:06:25
179,2014-03-04 03:37:55,"This should be good to merge now.  The tests execute properly now.
",jplock,2014-03-04 04:06:25
178,2014-03-03 19:39:52,"Hi
anyone with the same issue? Ansible fails at ""Store ownCloud data securely"", also Roundcube is unable to establish a Database-Connection since #174 

`TASK: [file src=/decrypted/owncloud-data dest=/var/www/owncloud/data owner=www-data group=www-data state=link] ***
failed: [myhost] => {""failed"": true, ""gid"": 33, ""group"": ""www-data"", ""item"": """", ""mode"": ""0770"", ""owner"": ""www-data"", ""path"": ""/var/www/owncloud/data"", ""size"": 4096, ""state"": ""directory"", ""uid"": 33}
msg: refusing to convert between directory and link for /decrypted/owncloud-data`

-Norman
",nstanke,2014-03-04 21:50:11
178,2014-03-04 20:54:20,"So Roundcube might be fixed now, thanks to #179, but unfortunately I'm still not able to run alle playbooks. I'm really the only one with this issue? I have absolutely no clue why this error appears.
",nstanke,2014-03-04 21:50:11
178,2014-03-04 21:17:00,"Hi @nstanke it's a known issue: #116. If you remove the directory, re-run the playbook it should be back in working order.
",tilsammans,2014-03-04 21:50:11
178,2014-03-04 21:50:11,"Fixed. Thanks for your help @tilsammans.
",nstanke,2014-03-04 21:50:11
177,2014-03-02 16:44:04,,jplock,2014-03-03 14:50:07
176,2014-03-02 16:16:44,"Move tarsnap.key from /root to /decrypted and don't overwrite it if one already exists (fixes #15)
",jplock,2014-03-03 14:49:44
175,2014-03-02 15:53:51,"Sorry, I just caught this while trying to re-run my playbooks.  This relates to #174 
",jplock,2014-03-02 15:54:42
174,2014-03-02 04:34:10,,jplock,2014-03-02 15:43:23
174,2014-03-03 21:32:33,"Like mentioned in #178 Roundcube is unable to establish a database-connection (Ansible didn't failed at this point). Maybe I should setup a new clean  box..

<S_CODE_TOKEN>
",nstanke,2014-03-02 15:43:23
174,2014-03-03 21:34:20,"Sorry about that, I forgot a task for loading the database schema.  Let me see if I can fix that.
",jplock,2014-03-02 15:43:23
174,2014-03-03 21:39:26,"Seems so :) https://github.com/blind-coder/rcmcarddav/blob/master/dbinit/postgres.sql
",nstanke,2014-03-02 15:43:23
174,2014-03-03 22:26:16,"I'm still trying to make this work in the playbooks, but you can run something like:

<S_CODE_TOKEN>

to fix it
",jplock,2014-03-02 15:43:23
174,2014-03-03 22:38:23,"Thanks for you help! :) 
",nstanke,2014-03-02 15:43:23
173,2014-03-02 02:10:59,"Resolves #154 
",jplock,2014-03-02 04:30:03
173,2014-03-02 03:52:51,"Nice. Will this break existing installations?
",DomenicF,2014-03-02 04:30:03
173,2014-03-02 04:30:03,"Let me close this out and clean up the PR.  That tcsh -> zsh change shouldn't have been merged in
",jplock,2014-03-02 04:30:03
173,2014-03-02 04:44:21,"I submitted PR #174 instead
",jplock,2014-03-02 04:30:03
172,2014-02-24 08:42:17,"This enables and appropriately configures roundcube's password plugin. In order to make this work I had to change permissions on dovecot configuration files, which makes me a little uneasy but I couldn't find how to make only the directories executable by recursing in the ansible documentation. I was able to test this in a local environment and it is working there. I'm no longer able to successfully execute `nosetests -v` (even on branches I know the tests were executing successfully on before) locally so I don't know that they pass though I don't think anything in them would be affected by these changes.
",bryanjswift,2014-06-05 18:04:54
172,2014-02-24 18:48:47,"I just, JUST, realized this will get overwritten every time I run the ansible playbook.
",bryanjswift,2014-06-05 18:04:54
172,2014-02-27 06:11:30,"I have a solution that 'works' for my particular setup with these changes included. I wrote a script to pull down the password data and write it out to a separate vars file. I run the script (included below and at https://gist.github.com/bryanjswift/9245254) as part of a pipeline that looks like: `ssh {{ main_user_name }}@{{ domain }} 'PGPASSWORD={{ mail_db_password }} psql -U {{ mail_db_username }} -h 127.0.0.1 --command=""SELECT email, password FROM virtual_users;"" {{ mail_db_database }}' | grep '\$6\$' | ./mail_virtual_users.rb > vars/mail_accounts.yml`. I am not sure I know how to automate this process sufficiently to make this a reasonable feature addition though.

<S_CODE_TOKEN>
",bryanjswift,2014-06-05 18:04:54
172,2014-02-27 06:14:57,"It is probably possible to create an Ansible module that publishes the `mail_virtual_users` information as facts but then there would be the problem of merging facts from server and the virtual users in the playbook and how do conflicts get resolved. Ultimately I think this might be the wrong solution to the problem of user account management with sovereign but am open to suggestions.
",bryanjswift,2014-06-05 18:04:54
171,2014-02-24 01:31:36,"When trying to run the playbook to provision a Vagrant box locally I got an error when trying to unzip the downloaded z-push files. After some investigation it seems I was getting an HTML 302 response pointing to the new URL so this changes to the new URL scheme.
",bryanjswift,2014-02-24 22:52:18
171,2014-02-24 22:06:06,"Ditto, :+1: 
",nicknovitski,2014-02-24 22:52:18
171,2014-02-25 17:07:04,"since this merge ansible fails at decompressing z-push, though manually `tar xzf` works fine on my box.

<S_CODE_TOKEN>

any ideas?
",nstanke,2014-02-24 22:52:18
171,2014-02-25 17:49:03,"@nstanke that's the error I was getting _before_ I submitted this change. Did you run the playbook before merging this change with an error? The playbook does not detect/cleanup the previous 302 HTML response. Will you look at the contents of /root/z-push-2.1.1-1788.tar.gz and see if it is an HTML file?
",bryanjswift,2014-02-24 22:52:18
171,2014-02-25 18:00:56,"@bryanjswift okay, just fixed it by deleting /root/z-push-2.1.1-1788.tar.gz and running the playbook again. Thank's for your help and fast response.
",nstanke,2014-02-24 22:52:18
171,2014-02-25 18:21:27,"@nstanke my pleasure, glad we were able to resolve quickly.
",bryanjswift,2014-02-24 22:52:18
170,2014-02-22 21:07:14,"I made a few tweaks to the ansible scripts based on issues I encountered. The commit messages have more details.
",jsravn,2014-02-28 19:17:12
170,2014-02-26 15:39:40,"+1
",jplock,2014-02-28 19:17:12
170,2014-02-27 03:27:45,"Looks awesome, but I have two small concerns:
1. Rather than stopping postgres to take a backup, I think we should use `pg_dump` to a file and back that up instead.
2. Previously we were ‚Äúnormalizing‚Äù the blog hostname from `www.example.com` to `example.com`. This changeset reverses that. I personally prefer the existing behaviour and I think it‚Äôs more widespread.
",lukecyca,2014-02-28 19:17:12
170,2014-02-27 11:08:48,"Agreed, pg_dump would probably be superior. On the other hand, the existing backup mechanism is broken and will lead to unusable backups. I'm happy with just stopping it for a bit since this is for personal use.

Using a naked domain for a website is generally bad practice. You can do it, but it shouldn't be default behavior in my opinion.
",jsravn,2014-02-28 19:17:12
170,2014-02-27 11:11:58,"> Using a naked domain for a website is generally bad practice. You can do it, but it shouldn't be default behavior in my opinion.

Agreed.
",tilsammans,2014-02-28 19:17:12
170,2014-02-27 11:16:16,"I strongly disagree! I think unnecessarily slapping ""www"" in front of every domain is bad practice.
http://no-www.org
",florianbeer,2014-02-28 19:17:12
170,2014-02-27 20:04:31,"I prefer no-www :)
",stephenjamieson,2014-02-28 19:17:12
170,2014-02-27 22:30:03,"I also prefer no www. I mostly liked the dovecot changes in this PR
",jplock,2014-02-28 19:17:12
170,2014-02-28 08:26:49,"Ok I reverted the naked domain redirect.
",jsravn,2014-02-28 19:17:12
170,2014-02-28 08:34:52,"I think I accidentally deleted my comment pro-www. The main reason I did it is so I could get free SSL certs from startssl.com. I also prefer it aesthetically. But no big deal. Let me know if I should break up commits into multi pull requests..
",jsravn,2014-02-28 19:17:12
170,2014-02-28 19:21:25,"Thanks very much for all of this.

http://no-www.org and http://yes-www.org were very interesting reads and I can appreciate both arguments. We could revisit this change in a separate issue if you really want, but it looks like there are quite a few people that have yet to be convinced. ;)
",lukecyca,2014-02-28 19:17:12
169,2014-02-22 12:13:27,"The tarsnap cronjob backs up the postgresql data directory directly. However it doesn't stop postgresql, which could lead to a useless backup/data corruption if any activity occurs during the backup. See http://www.postgresql.org/docs/current/static/backup-file.html for more details.

As a local workaround, I stop the postgresql service during the backup run, and I've rescheduled the cronjob to 3am so the downtime isn't an issue.

Probably the ideal would be to use pgdump so we can do a live database backup (it would also result in a smaller backup size).
",jsravn,2014-07-15 19:07:11
169,2014-03-02 16:25:29,"I believe this is resolved now that #170 has been merged in.
",jplock,2014-07-15 19:07:11
169,2014-04-01 14:29:09,"This is resolved in the same way that @jsravn mentions. However, there's a problem with this method: if tarsnap fails, postgres won't be started again until it is manually started. Also, if the backup takes a long time, postgres will be down for quite some time.

Postgres being down isn't just a ""I can't access services"" issue, it's actually needed for email receipt (spam checks hit the database). So postgres being down is kind of a big deal.

I think pgdump would be a much better solution.
",jimrollenhagen,2014-07-15 19:07:11
169,2014-04-01 17:11:03,"Agreed. Simpler to dump it to a file and back that up instead.
",lukecyca,2014-07-15 19:07:11
169,2014-04-01 18:09:15,"I've also run into a few problems where postgres has been down for many hours because tarsnap failed.
",brucespang,2014-07-15 19:07:11
169,2014-04-01 20:18:11,"+1 to doing a pgdump before the Tarsnap backup job runs. The current strategy is dumb; I implemented it in a rush.
",al3x,2014-07-15 19:07:11
169,2014-07-15 13:17:38,"This was fixed in #257 
",jplock,2014-07-15 19:07:11
168,2014-02-05 20:54:58,"To the extent that it's a good thing for folks to run (or consider running) their own e-mail, the wildcard SSL default seems undesirable because of the cost (~$100 a year).

What are the downsides of having roundcube served from `https://site/mail` and owncloud from `https://site/cloud/`? I would be willing to work on this if there was interest.
",ariddell,2014-03-11 00:55:30
168,2014-02-05 21:23:36,"If it can be done, I think that would be great.
",tilsammans,2014-03-11 00:55:30
168,2014-02-05 22:16:35,"Definitely a +1. 
",DomenicF,2014-03-11 00:55:30
168,2014-02-06 21:43:07,"Can we do this in a way that doesn't break the existing setup?  Maybe just user-defined hostnames in the vars.yml file or something?
",jplock,2014-03-11 00:55:30
168,2014-02-06 23:23:56,"I've been slowly working on using a separate certificate per host. It's just not in a tested or working state yet.
",ssoriche,2014-03-11 00:55:30
168,2014-02-07 08:28:24,"@ssoriche that would work for me as well. I only have a few hosts to protect; it's a lot cheaper to buy 5-year RapidSSLs for those.
",tilsammans,2014-03-11 00:55:30
168,2014-03-06 00:15:13,"@ssoriche any progress that you could share on configuring separate certificats per host?
",reedlaw,2014-03-11 00:55:30
168,2014-03-06 18:04:13,"The preliminary setup is done, and mail is now using its own certificate. I need to go through and find the remaining places that certificates are used and populate with the proper variable values.
",ssoriche,2014-03-11 00:55:30
168,2014-03-11 00:55:30,"I've tried to get owncloud running underneath /owncloud but it seems really difficult to do elegantly in Apache.

I'll close this. I think @ssoriche's method probably belongs in its own issue since it's a different approach. Good luck!
",ariddell,2014-03-11 00:55:30
167,2014-02-05 15:37:27,"Hey guys,

I started off with Sovereign on Linode. Everything seemed fine, except when I needed to reboot the server. After doing that, things just stopped working. IMAP, SMTP, etc. I issued reload's on dovecot and postfix and that didn't help. Looking at the logs, I can see one error that encfs directories are not mounted. So I mount it with sudo and I get a permission denied error when it tries and chdir. 

It's not just SMTP/IMAP though, it's Owncloud as well. I'm getting this error after a reboot:  [14] SQLSTATE[HY000] [14] unable to open database file

It's worth noting that I ran sovereign multiple times to get past errors involving ufw and znc. I am willing to do a fresh install and go from the top again to get to the bottom of this, especially if it can help someone in the future. I'm currently on DigitalOcean, but I'll be keeping a Linode instance for a couple days longer.
",DomenicF,2014-06-26 23:29:41
167,2014-02-05 16:04:05,"If the server restarts, you must run the sovereign playbook again to mount encfs.

There is potential for getting into a difficult state if the services start running without `/decrypted` being available. Some services may initialize new data files, and then be confused when there old ones reappear.

Personally, I had an unexpected restart in the middle of the night a couple weeks ago. I re-ran the sovereign playbooks a few hours later and everything came up clean. However, I was not running the very latest sovereign (I was still using MySQL instead of Postgres).

Any work you can do to clarify this procedure and make it more reliable would be greatly appreciated.
",lukecyca,2014-06-26 23:29:41
167,2014-02-05 17:54:02,"I'm going to do a fresh install to get the most reliable procedure.

Debian 7 64 Bit, DigitalOcean, 512 MB RAM. site.yml is unedited.
- I prep the server and sovereign config files as suggested. I also upgrade all packages. I issue an init 6 command because the kernel has been replaced. 
- Exit ssh. On my desktop. `ansible-playbook -i ./hosts site.yml`

<S_CODE_TOKEN>
- `ansible-playbook -i ./hosts site.yml`

<S_CODE_TOKEN>
- `ansible-playbook -i ./hosts site.yml`

<S_CODE_TOKEN>
- Go to cloud.MY_DOMAIN and finish OwnCloud setup by typing in user/pass. I get the error:

<S_CODE_TOKEN>

After some research I conclude that this is because I'm using a self signed certificate and I'll need to edit some files in order to use WebDAV. Okay.
- Go to mail.MY_DOMAIN. I can log in to Roundcube, but sending messages fail with the error:

<S_CODE_TOKEN>

For now I will keep the server up and running and see if we can at least fix the problem while it's booted, then after we do that I will restart it and we can run the playbooks again.

Thanks a lot for the help :+1: 
",DomenicF,2014-06-26 23:29:41
167,2014-02-05 19:40:29,"I grew impatient so I started playing around a bit and searched a little more. It turns out the SMTP server error could have been caused due to a reverse DNS issue. DigitalOcean set's their PTR/reverse DNS by whatever you name your server instance (or what they call a ""droplet""), so I changed my instance name to mail.MY_DOMAIN and edited /etc/hostname, issued `hostname -F /etc/hostname`, rebooted, reran the playbooks and I can now send mail.

BUT, I cannot receive mail. Going to keep looking around, but this is a step in the right direction. 
",DomenicF,2014-06-26 23:29:41
167,2014-02-05 19:58:12,"Looks like I spoke too soon, I can now receive mail. Some of my messages that I sent from another domain still haven't come through though, but I can ignore that for now. Sorry this has turned into a log of me figuring stuff out. I'm going to keep the issue open for now in case anything else strange happens. Also gonna write a wiki post on setting this up with DigitalOcean. 

If anyone is available to chat on IRC or answer questions as I go along writing it, please let me know as I want to make the guide as detailed as possible. :)
",DomenicF,2014-06-26 23:29:41
167,2014-02-05 20:41:13,"I encountered the same problems setting up on DO last week. It would be nice if the errors didn't appear -- but it is comforting that they seem to go away after running the script a few times.
",ariddell,2014-06-26 23:29:41
167,2014-02-05 20:45:03,"I should add I haven't been able to get DKIM working on DO.
",ariddell,2014-06-26 23:29:41
167,2014-02-05 21:08:14,"@ariddell did you set up your TXT records to match what's inside of the default txt file in /etc/opendkim/keys/DOMAIN ? I'm writing a wiki guide, should have basic stuff done by later tonight but I'm hoping some devs can help with it as well: https://github.com/al3x/sovereign/wiki/Setting-up-on-DigitalOcean-with-Debian-7-%28IMCOMPLETE%29
",DomenicF,2014-06-26 23:29:41
167,2014-02-06 21:44:59,"I had to eventually skip the znc compilation on a 1GB of RAM digitalocean machine because it kept consuming all of the resources and would timeout.  I eventually used docker on another machine to build it then copy it over.  It would hang on the python modules part.
",jplock,2014-06-26 23:29:41
167,2014-02-07 00:05:08,"This has probably been asked, but is there a reason for not using the packages from Debian?
",DomenicF,2014-06-26 23:29:41
167,2014-02-07 00:19:31,"> This has probably been asked, but is there a reason for not using the packages from Debian?

I believe they are either quite old, or don‚Äôt contain the plugins we have enabled. It would be very nice if we could switch to a pre-packaged install of znc, so it‚Äôs worth investigating again.
",lukecyca,2014-06-26 23:29:41
167,2014-02-07 00:35:58,"Would it be possible for one of us to create a deb and host it in a
repository and have sovereign install it? Since we already have the
playbook for building from source, we could leave that as an option as well
in a variable. We would just have to maintain the binaries for x32 / x64,
not sure if this goes beyond the scope of the project.
On Feb 6, 2014 7:19 PM, ""Luke Cyca"" notifications@github.com wrote:

> This has probably been asked, but is there a reason for not using the
> packages from Debian?
> 
> I believe they are either quite old, or don't contain the plugins we have
> enabled. It would be very nice if we could switch to a pre-packaged install
> of znc, so it's worth investigating again.
> 
> ## 
> 
> Reply to this email directly or view it on GitHubhttps://github.com/al3x/sovereign/issues/167#issuecomment-34391660
> .
",DomenicF,2014-06-26 23:29:41
167,2014-02-11 04:46:12,"@DomenicF: I guess I'd prefer to go through the Debian community process for updating their znc package. That way, everyone gets the benefit of that work and maintenance.
",al3x,2014-06-26 23:29:41
167,2014-02-11 14:33:39,"Alright, when you get it started please post a link here. 
",DomenicF,2014-06-26 23:29:41
167,2014-04-03 17:22:49,"Fresh install of Debian 7 64bit Digital Ocean, getting hung up on encfs:

<S_CODE_TOKEN>

Any ideas?
",DomenicF,2014-06-26 23:29:41
167,2014-04-05 11:50:02,"What version of ansible?  I've been using 1.5.4
",jplock,2014-06-26 23:29:41
167,2014-04-08 15:27:10,"I am on 1.5.4 as well.
",DomenicF,2014-06-26 23:29:41
167,2014-04-10 15:50:04,"Look's like it was my install of Ansible. I booted into a VM and ran the playbooks and all was fine. Got caught up on #149 but you guys already had that covered.
",DomenicF,2014-06-26 23:29:41
166,2014-02-04 18:37:08,"Not sure if this would be something that should go in the README or in the Wiki, but A records need to point to any virtual host that sovereign is creating (e.g. news.EXAMPLE.com, cloud.EXAMPLE.com).
",DomenicF,2014-05-28 17:19:24
166,2014-05-19 18:02:19,"pull request #245 solves this issue.
",neuhaus,2014-05-28 17:19:24
166,2014-05-28 17:01:35,"Pull request #245 has been merged, this issue can be closed.
",neuhaus,2014-05-28 17:19:24
165,2014-02-03 22:17:14,,Korni22,2014-02-04 01:32:21
164,2014-02-03 20:45:42,"This serves more as a reminder that I am going to work on this as time permits.

In some of the deployment tools one can store private data encrypted with key that is not shared. If I check in my encrypted data into a public repo, everybody already has my data, just encrypted. If my key some time gets out in the wild, all private data is exposed.
Instead I'd rather have a specifc config file that is in gitignore and maybe a python script to to fill this config file initially. The configuration does not need to contain domains or ports, only passwords, and if configurable, usernames. People would be responsible on their own to back up this file.
",do3cc,2016-09-16 10:36:39
164,2014-05-19 18:03:44,"+1
",neuhaus,2016-09-16 10:36:39
164,2014-07-14 15:48:36,"I'd suggest an approach that goes a lot further, that of splitting out personal configuration from sovereign altogether. It's an approach I've taken in the ansible role library I'm developing called [lowar](https://github.com/adrinux/Lowar) ‚Äì (similar approach to sovereign, different end result ‚Äì its only for hosting web sites). Looking at the lowar 'skeleton' folder should give you some idea of how this works.

The approach depends on the ansible configuration variable ['roles_path'](http://docs.ansible.com/intro_configuration.html#roles-path) introduced in ansible 1.4, which allows you to point ansible to a folder of roles. You'd still want to supply an example set of configuration files with sovereign, but those would be copied out of the repo and modified to the users needs. At which point the user can do whatever they're comfortable with ‚Äì no version control, private repo etc.

This has an additional benefit of not having to be careful to exclude personal config when submitting pull requests etc to Sovereign and a lot less jumping about between git branches.

I'm still at the point of setting up sovereign the first time, but I'm trying to set it up using this approach and will be submitting pull requests where required to make this possible.
",adrinux,2016-09-16 10:36:39
164,2014-09-07 13:14:07,":+1: 
",mariocesar,2016-09-16 10:36:39
164,2014-09-07 13:23:29,"The edx ansible configuration project describes two approaches to this problem. Either one would be an improvement over the current setup.
1. You must define a group for your server in the inventory file hosts, then you use group variables to define your variables (just copy user.yml). One would add group_vars to gitignore here.
2. You manually specify the configuration on the command line via `ansible-playbook -e@myvars.yml`

See https://github.com/edx/configuration
",ariddell,2016-09-16 10:36:39
164,2014-09-18 13:58:19,"What about having this private info in environment variables on the local (""client""?) machine? That way we would never risk have that written anywhere in the project. Maybe `-e@myvars.yml` could get vars from the environment?

Would that work in ansible? Does that even make sense? :)
",malvim,2016-09-16 10:36:39
164,2014-09-18 14:16:03,"I don't know whether that would work with ansible, but there's no need to go that far to keep personal config out of sovereign, read my comment from July 1th malvim.

But there is a further problem I think, currently there are several parts where getting granular control of configuration in Sovereign requires editing the roles. It's not really even compatible with fully separating config.
",adrinux,2016-09-16 10:36:39
164,2014-09-18 14:25:53,"Shouldn't the aspiration be to require as little editing as possible?

The main reason for this would be that one could trivially rebase or `pull --rebase` so as to keep up with bugfixes and the like.
",ariddell,2016-09-16 10:36:39
164,2016-09-16 10:36:39,"I believe this issue has been addressed.  Secrets are moved to a separate folder, and the folder is in `.gitignore`.  Ansible will populate these secrets with randomly-generated passwords if they don't exist.  Users are responsible for backing up their secrets.
",mikeashley,2016-09-16 10:36:39
163,2014-02-03 03:32:40,"In the README it says to add a TXT record with the field name of `default._domainkey.EXAMPLE.COM.` with the value equal to the contents of `/etc/opendkim/keys/EXAMPLE.COM/default.txt`. After running all the playbooks except tarsnap and blog, /etc/opendkim does not exist.
",DomenicF,2014-02-03 04:12:38
163,2014-02-03 03:52:43,"That‚Äôs weird. The tasks that makes that directory and its contents are in `roles/mailserver/tasks/opendkim.yml`. Are you sure they ran without error?
",lukecyca,2014-02-03 04:12:38
163,2014-02-03 03:58:12,"There were no errors relating to opendkim. Here is the part of the log containing anything related to it:

<S_CODE_TOKEN>

And the only errors I got were these, which I may make a new issue for tomorrow individually:

<S_CODE_TOKEN>

The final response:

<S_CODE_TOKEN>

I find it strange that it says `failed=0` when items obviously failed. 
",DomenicF,2014-02-03 04:12:38
163,2014-02-03 04:06:15,"The 2nd, 3rd, and 4th tasks in that list seem like they executed fine, so I don‚Äôt see any reason those files wouldn‚Äôt have been created. The directory is mode 700, so you will need to be root to see into it. 

> And the only errors I got were these, which I may make a new issue for tomorrow individually:

Those two are explicitly ignored. They‚Äôre being used to test for existence of certain paths in order to maintain idempotency of the playbooks. (Perhaps we‚Äôre abusing an ansible feature here).
",lukecyca,2014-02-03 04:12:38
163,2014-02-03 04:12:38,"That was the problem, didn't realize it was mode 700! As I go along I'll try and take note of these things that aren't documented but may be slightly obvious to most and hopefully contribute it to the wiki after. Thanks for the help, lukecyca.
",DomenicF,2014-02-03 04:12:38
163,2014-02-03 04:13:59,"> As I go along I'll try and take note of these things that aren't documented but may be slightly obvious to most and hopefully contribute it to the wiki after.

That would be most appreciated. Cheers.
",lukecyca,2014-02-03 04:12:38
162,2014-02-02 23:42:42,"Updated README to follow the change to PostgreSQL.
",nstanke,2014-02-02 23:44:41
161,2014-02-02 13:03:27,"Continuation of previous commit (missed one).
",ariddell,2014-02-02 16:51:21
160,2014-02-02 00:11:41,"String-valued variables containing spaces can be substituted into an ansible
tasks file but they will not be interpreted correctly.
",ariddell,2014-02-02 01:10:57
159,2014-02-01 20:19:25,"To take advantage of the OpenDKIM installation it's important to set up a DNS `txt` record. This documentation addition explains how to do that.
",keybits,2014-02-01 20:21:01
159,2014-02-01 20:21:10,"Thanks Tom!
",lukecyca,2014-02-01 20:21:01
159,2014-02-01 20:29:15,"Yes, good one!
",tilsammans,2014-02-01 20:21:01
158,2014-02-01 19:20:54,"...  in case it contains shell metacharacters.

I dunno how stupid I'm being here, but my password generator happily generates passwords containing `$` and `>` and othersuch.  My sovereign install was dying on `[mailserver | import sql postfix]` and this fixed it.  Thought it might help anybody else who got stuck the same way.
",snowyote,2014-02-01 20:06:37
157,2014-02-01 15:13:09,"Clean install of Sovereign on Debian x64 with self-signed wildcard cert as per the readme.

Email is working fine - I can send from roundcube and receive messages. Testing with:

<S_CODE_TOKEN>

and

<S_CODE_TOKEN>

both work fine too.

When I try to connect Thunderbird to the mail server I just get

> Thunderbird failed to find the settings for your email account.

I've triple checked all settings and tried Evolution with no luck.

Wondering if it's related to #34? Any suggestions gratefully received.
",keybits,2014-02-01 19:18:18
157,2014-02-01 19:18:18,"Problem solved. If you fill in all the required fields in Thunderbird and **don't** request that it 'test connection'. Click 'Done' and you then get the choice to confirm the security exception for the certificate.
",keybits,2014-02-01 19:18:18
156,2014-01-31 13:39:34,"each night I receive the following tarsnap error after cron is exectued. 

<S_CODE_TOKEN>

any ideas how to fix this? Which file/directory is required there by tarnsap?
",nstanke,2014-04-18 14:14:48
156,2014-01-31 16:00:41,"What OS and filesystems are you using? What VPS host? Anything non-standard about your sovereign setup?

The only mention of this error related to tarsnap that I could find is [here](http://mail.tarsnap.com/tarsnap-users/msg00353.html) and Colin indicated that it wasn‚Äôt an error message from tarsnap per se. He suggests that it could be due to a file being deleted while tarsnap is running.

It could be [this line in libarchive](https://github.com/LuaDist/libarchive/blob/master/libarchive/archive_read_disk_entry_from_file.c#L480) but it‚Äôs slightly different (attributes is not plural).
",lukecyca,2014-04-18 14:14:48
156,2014-01-31 16:10:40,"This error started appearing for me as well since I reran Sovereign a few days ago. I never got it before, so something must have triggered it between now and 2 weeks ago.
",tilsammans,2014-04-18 14:14:48
156,2014-02-01 14:45:02,"Running Debian Wheezy 64bit at Digitalocean using ext4 as filesystem. Runned sovereign from the latest git pull, customized of course the necessary files.
",nstanke,2014-04-18 14:14:48
156,2014-02-02 15:36:31,"I'm running the exact same setup as @nstanke and I also see the same message
",jplock,2014-04-18 14:14:48
156,2014-02-04 23:23:09,"I've been getting this on Linode, running from a fork off fdce2b0.
",snowyote,2014-04-18 14:14:48
156,2014-03-18 22:41:04,"any update on this? Still receive this error daily. 
",nstanke,2014-04-18 14:14:48
156,2014-03-19 18:03:19,"I'm still getting it too - I've switched over to using tarsnap -v, I'll see if I can find out anything.
",snowyote,2014-04-18 14:14:48
156,2014-04-13 11:57:25,"Tarsnap' been running fine for me the past few weeks
",jplock,2014-04-18 14:14:48
156,2014-04-16 16:22:21,"I just set up sovereign a couple days ago and have been seeing this message as well. I'm still learning about all of these tools so I'll just describe what I think I've figured out:

The message was coming from `/decrypted/hostname/username/.dovecot.sieve`
I could reproduce it by running:

<S_CODE_TOKEN>

It turns out that this is a symlink, and (for me at least) happens to be the only symlink on the encfs mount. If I add the `-L` flag to the above command, I no longer get the error message. I modified the tarsnap.sh script to add that flag only when `decrypted` is being backed up, and it seems to be working.
",ventolin,2014-04-18 14:14:48
156,2014-04-16 17:28:09,"Nice catch!  I stopped getting the error message, but it's probably because I accidentally overwrote that symlink with an actual file by using the filtering options in roundcube, apparently. That sort of explains things.
",snowyote,2014-04-18 14:14:48
156,2014-04-17 22:06:32,"Thanks to @ventolin, finally fixed this error by adding the -L¬π flag, pull request would be welcome.

[1] `-L  (c mode only) All symbolic links will be followed.  Normally,
             symbolic links are archived as such. With this option, the tar-
             get of the link will be archived instead.`
",nstanke,2014-04-18 14:14:48
156,2014-04-18 15:29:40,"Sorry, I've been busy and I was going to try to get to doing a pull request today, but thanks for taking care of it. :)
",ventolin,2014-04-18 14:14:48
155,2014-01-29 15:43:16,"Maybe this isn't a code issue but . . . I restarted my fresh-built server and my encrypted data didn't come up. I can remount them, but how do I know what volume is what?
",squarepegsys,2014-01-29 16:07:26
155,2014-01-29 16:07:26,"Never mind -- ""sudo encfs /encrypted /decrypted"" .
",squarepegsys,2014-01-29 16:07:26
155,2014-01-29 17:18:21,"When your server reboots, you can simply run your playbook against it again. It should remount encfs, start all services, etc.

Unfortunately it is not desirable to have the encfs auto mount on boot. See #139.
",lukecyca,2014-01-29 16:07:26
155,2014-01-29 17:34:40,"I didn't think about just running the playbook again. That would have been smart. And, no, I don't want my encrypted data mounted on boot -- it was just something I didn't think about when I booted it up.
",squarepegsys,2014-01-29 16:07:26
154,2014-01-29 02:21:47,"I'm creating an issue for this so I remember, and if I have time, I'll try and work on this, but if we're installing both Roundcube and Owncloud, this would be useful to provide out of the box.

https://petermolnar.eu/linux-tech-coding/use-owncloud-carddav-contacts-in-roundcube-and-import-vcf-to-owncloud/

https://github.com/blind-coder/rcmcarddav
",jplock,2014-03-02 15:43:24
153,2014-01-28 16:22:44,"This allows you to configure all virtual web hosts using Ansible.
When no config/docroot present, Sovereign will provide starter
files. These files can be edited at will and will not be
overwritten by later runs.

Note: if you like this, I plan to incorporate the ""blog"" role into this.
",tilsammans,2014-06-27 01:16:26
153,2014-01-28 16:31:10,"This is a great idea, but it obviates the need for the blog role. I think we should merge the blog role into this one. That would require:
- A per-vhost flag for enabling SSL
- Remove blog role
- Reword README regarding blog hosting to be more general

If you want to tackle that, great! I am also happy to help.
",lukecyca,2014-06-27 01:16:26
153,2014-01-28 18:15:52,"That is exactly what I had in mind!

I will continue down this road and push a few new commits in the next few days.

> Op 28 jan. 2014 om 17:31 heeft Luke Cyca notifications@github.com het volgende geschreven:
> 
> This is a great idea, but it obviates the need for the blog role. I think we should merge the blog role into this one. That would require:
> 
> A per-vhost flag for enabling SSL
> Remove blog role
> Reword README regarding blog hosting to be more general
> If you want to tackle that, great! I am also happy to help.
> 
> ‚Äî
> Reply to this email directly or view it on GitHub.
",tilsammans,2014-06-27 01:16:26
153,2014-01-31 21:51:14,"I added the ability to include arbitrary Apache configuration per virtual host.
I found that I needed very specific stuff for some vhosts, and it became too messy to put it all in Sovereign. This arbitrary `config` value solves everything.
Still need to code the SSL option, a boolean seems like a good idea there.
",tilsammans,2014-06-27 01:16:26
153,2014-02-27 03:30:00,"Any progress on finishing up the SSL bit? If you don‚Äôt have time, let us know and maybe someone else will finish it off.
",lukecyca,2014-06-27 01:16:26
153,2014-03-03 15:08:34,"Feel free to pick this up. I won't be able to continue for a few weeks, but mid-March should be fine again.
",tilsammans,2014-06-27 01:16:26
152,2014-01-27 19:32:36,"I had a `#` in my mail_db_password and spent the last 2 hours trying to figure out why I couldn't connect by IMAP. A `#` is only allowed if the connect string is wrapped in quotes. This will probably save a few people a lot of frustration by wrapping it in quotes to begin with.
",ConceitedCode,2014-01-28 01:37:06
152,2014-01-28 01:37:04,"Good catch. Thanks!
",lukecyca,2014-01-28 01:37:06
151,2014-01-27 13:59:51,"Not everyone wants to use `zsh`.  

The way it's done is very (maybe too?) straightforward. Please give feedback on how to do it better, if this is not in line how something like this should be done.
",benjmin-r,2014-01-28 23:15:45
151,2014-01-27 14:09:10,"+1
",jplock,2014-01-28 23:15:45
151,2014-01-27 16:40:53,"Please move `main_user_shell: ""/usr/bin/zsh‚Äù` to defaults.yml and set it to bash by default.

Most people will not need to see this option at all. Those who want zsh can simply add an extra line to their user.yml to override it.
",lukecyca,2014-01-28 23:15:45
151,2014-01-28 22:34:37,"Thanks for the feedback, Luke. I've amended the commit accordingly.
",benjmin-r,2014-01-28 23:15:45
151,2014-01-28 23:15:51,"Thanks!
",lukecyca,2014-01-28 23:15:45
150,2014-01-27 13:40:09,"Allow monit built-in webserver through ufw.
",nstanke,2014-01-27 16:39:07
150,2014-01-27 14:28:30,"You did not add a comment for the port number, the next reader might not know what the portnumber is for.
The default configuration for monit at least looks like as if monit would only listen to localhost anyway. Did you modify it locally?
If it listens to the internet, the password must be configurable. right now the password is hard coded and this is not good.
Even if the password is hardcoded, exposing the monit service to the outside world should only be an option, imho deactivated by default.
Do you know that you could also access the monit web service by creating a port forward via ssh?
Here is how:

ssh  deploy@YOURSERVER  -L 2812:localhost:2812

After this, the port 2812 on your computer transmits all traffic to localhost on YOURSERVER on port 2812, so your monit would be available via http://localhost:2812. If you are running windows, you can also create such a port forwarding.
",do3cc,2014-01-27 16:39:07
150,2014-01-27 16:39:07,"Agreed that this should not be exposed to the Internet. It should be available only to localhost (and hence via an ssh tunnel as @do3cc suggested) or perhaps via the VPN.
",lukecyca,2014-01-27 16:39:07
150,2014-01-27 17:10:27,"Can't connect (even over VPN) until 2812 is allowed.
",nstanke,2014-01-27 16:39:07
150,2014-01-27 18:24:43,"So ufw sets up a firewall for localhost? That sounds wrong!

""Norman S."" notifications@github.com schrieb:

> Can't connect (even over VPN) until 2812 is allowed.
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/al3x/sovereign/pull/150#issuecomment-33397108

## 

Diese Nachricht wurde von meinem Mobiltelefon mit Kaiten Mail gesendet.
",do3cc,2014-01-27 16:39:07
150,2014-01-27 18:32:38,"yep. Maybe I should test it again but thanks for your thoughts. Awesome project and some day I will contribute (hopfully) something useful.

On Mon, Jan 27, 2014 at 7:27 PM, Patrick Gerken notifications@github.com
wrote:

> So ufw sets up a firewall for localhost? That sounds wrong!
> ""Norman S."" notifications@github.com schrieb:
> 
> > Can't connect (even over VPN) until 2812 is allowed.
> > 
> > ---
> > 
> > Reply to this email directly or view it on GitHub:
> > 
> > ## https://github.com/al3x/sovereign/pull/150#issuecomment-33397108
> > 
> > ## Diese Nachricht wurde von meinem Mobiltelefon mit Kaiten Mail gesendet.
> > 
> > Reply to this email directly or view it on GitHub:
> > https://github.com/al3x/sovereign/pull/150#issuecomment-33404328
",nstanke,2014-01-27 16:39:07
149,2014-01-26 14:49:02,"Up-to-date Debian (last update 26.01.14) and up-to-date playbook (cloned on 26.01.14), getting the following error:

<S_CODE_TOKEN>

Seems to be my fault though, I am trying to fix this by setting my locale - despite that, it might be good to know for the devs...
",Korni22,2014-08-01 20:06:21
149,2014-01-27 14:32:19,"I've had the same problem. Manually deinstalling the postgresql server via apt-get and rerunning the soverein scripts did not restart the postgresql server. Trying sovereign on a fresh machine did not expose this behavior, postgresql worked like a charm.
Th perl warnings about the locales are just annoying warning and are not related to the problem.
This sounds like a debian problem. But I can't reproduce it now.
Can you try to purge the postgres packages and rerun sovereign to see if it works afterwards? I only did a remove, not a purge.
",do3cc,2014-08-01 20:06:21
149,2014-01-27 14:36:04,"This might be related: http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=599063
",do3cc,2014-08-01 20:06:21
149,2014-01-27 15:29:47,"Purge of postgresql:

<S_CODE_TOKEN>

Trying the playbook again, right after that:

<S_CODE_TOKEN>

Error persists after reboot.
",Korni22,2014-08-01 20:06:21
149,2014-01-27 16:16:52,"Sorry, I should have been clearer on that, please remove all postgresql packages, afaik the configuration is from the postgresql-common package.
",do3cc,2014-08-01 20:06:21
149,2014-01-27 16:37:08,"Nope, purged everything that contained postgresql, rebootet, reran the playbook, error persits.
",Korni22,2014-08-01 20:06:21
149,2014-01-27 19:49:02,"Maybe somebody with more postgresql know how can chime in so that we can create a debian bug report.
The sovereign config is pretty much straight forward.
",do3cc,2014-08-01 20:06:21
149,2014-01-27 21:09:39,"I tried with a fresh (Digital Ocean) machine today, still the same error.
",Korni22,2014-08-01 20:06:21
149,2014-01-27 21:45:18,"I just tried the playbook on a fresh, plain Debian VM it worked fine (got another error with owncloud, just because the server for the repo-key download seems to be offline).

So the problem is sadly Digital Ocean :(
",Korni22,2014-08-01 20:06:21
149,2014-01-27 23:54:11,"@Korni22 I just destroyed my digitalocean instance and tried to reproduce the error but failed. There is one critical difference between my config and this one here, for debugging reasons I added a statement to ensure that the postgresql server got restarted. If you reboot your instance and rerun the script, does it still fail at the same step?
",do3cc,2014-08-01 20:06:21
149,2014-01-28 04:59:41,"Okay, I did the following thing:
New droplet --> 512 MB RAM --> Debian 7.0 x64 --> `apt-get update && apt-get upgrade` --> reboot --> generate ssl certificate --> run playbook

It fails, I tried it two or three times on fresh machines...

I am creating a new droplet now or later today ;)
",Korni22,2014-08-01 20:06:21
149,2014-01-28 05:16:37,"I just created a new droplet using only the things mentioned above:

<S_CODE_TOKEN>
",Korni22,2014-08-01 20:06:21
149,2014-01-31 22:52:34,"This is an issue with locales. Run:

<S_CODE_TOKEN>

as root on the server and install the appropriate locale.

You can then do:

<S_CODE_TOKEN>

followed by:

<S_CODE_TOKEN>

All should now be well. I'll look into getting Ansible to perform the locale configuration.
",keybits,2014-08-01 20:06:21
149,2014-01-31 23:07:36,"That actually worked, thank you very much ! :+1: 
",Korni22,2014-08-01 20:06:21
149,2014-02-03 11:00:32,"@Korni22 can you update the README with the documentation of how to check for potential locales problems?
I think running perl -v would show if there is a locales problem and the reconfigure locales would fix it. This should be part of setting up the server before ansible is run, and I guess this is limited to servers with customized debians, like on strato.
",do3cc,2014-08-01 20:06:21
149,2014-02-03 11:41:04,"Later today :+1: 

Also I think a quick documentation on how to configure your clients after the setup would be nice :)
",Korni22,2014-08-01 20:06:21
149,2014-02-03 16:33:52,"Would it be okay for you, if we had a ""Troubleshooting"" page in the sovereign wiki? :)
",Korni22,2014-08-01 20:06:21
149,2014-02-03 19:40:40,"@Korni22 Great idea.
",al3x,2014-08-01 20:06:21
149,2014-02-03 22:14:48,"[Here we go!](https://github.com/al3x/sovereign/wiki/Troubleshooting) (quick and dirty, I know, but it's late...)

Pull Request for README coming right up...
",Korni22,2014-08-01 20:06:21
149,2014-05-07 21:16:44,"Can this be closed?
",jplock,2014-08-01 20:06:21
148,2014-01-25 22:31:10,"See #147 on why I am adding a different firewall.

This pull request is not finished yet, it serves only as a notification of work in progress.
The firewall gets configured with this setting but the rest of my sovereign scripts does not finish yet so I can't test it completely (yet)
",do3cc,2014-05-07 23:17:22
148,2014-01-27 22:20:32,"This looks very promising, @do3cc. However, I think it would be even more maintainable if you replaced lines 17 - 27 of `roles/common/templates/etc_shorewall_rules.j2` with a templated list, moving those lines into the Ansible role itself.
",al3x,2014-05-07 23:17:22
148,2014-02-03 21:55:20,"I switched to ferm and started to make the firewall rules configurable, see at the mailserver how this is supposed to work. This is still unfinished and won't run yet due to typos are small omissions
",do3cc,2014-05-07 23:17:22
148,2014-02-27 03:28:52,"Any progress on this? I used your half-finished changeset as an example for a ferm configuration on another project. :)
Would love to get this finished and integrated.
",lukecyca,2014-05-07 23:17:22
148,2014-02-28 09:18:03,"Hi @lukecyca unfortunately no. I don't know if I will come to this, my focus shifted to using ansible with a lot more and more modular roles. It is more probable that I extract some parts of here into a role usable in the galaxy.
",do3cc,2014-05-07 23:17:22
148,2014-02-28 09:19:11,"But I think the worst part has been done, the config for openvpn is the hardest and it is already there, albeit untested.
",do3cc,2014-05-07 23:17:22
148,2014-04-06 19:03:21,"Just noticed that ansible is going to support `ufw` directly in 1.6. See: https://github.com/ansible/ansible/blob/devel/CHANGELOG.md
",ariddell,2014-05-07 23:17:22
148,2014-05-07 21:13:05,"Ansible 1.6 is out which supports `ufw`...can we just use that for now?
",jplock,2014-05-07 23:17:22
148,2014-05-07 23:05:04,"I'm +1 to @jplock. Fewer services to administer on the Sovereign side means less complexity overall.
",al3x,2014-05-07 23:17:22
148,2014-05-07 23:17:22,"Agreed
",lukecyca,2014-05-07 23:17:22
148,2014-05-07 23:22:06,"I'll work on a PR for moving around the `ufw` stuff
",jplock,2014-05-07 23:17:22
147,2014-01-24 10:00:20,"Hi,

I have had this issue on different virtual servers already. This time on the stratoserver where I intend to install sovereign.
The ufw enable action sometimes throws an error on ufw-init.
Whenever the firewall is enabled, dns lookups fail, even though port 53 is open for both udp and tcp. It seems to be a problem with conntrack and the disability to load the module. Related bug report:
https://bugs.launchpad.net/ufw/+bug/713788
",do3cc,2014-05-07 14:36:50
147,2014-01-27 16:56:33,"+1. ufw has been quite troublesome (#73, #82)

Please consider how to make it easy for servers to migrate to this once we merge. It‚Äôs probably as simple as adding a task that _uninstalls_ ufw (and its associated configuration).

Also consider a modular configuration approach. It would be nice if each sovereign role was somehow responsible for enabling the ports it requires. That way, someone who comments out the XMPP role wouldn‚Äôt also have to plug the hole in the firewall.

FWIW, we originally used ferm, but accepted a patch to switch to ufw because it seemed simpler, more popular with people coming from Ubuntu, and would allow modular configuration. Did you consider switching back to ferm instead of introducing a third option? I don‚Äôt have an opinion either way ‚Äî¬†just curious.
",lukecyca,2014-05-07 14:36:50
147,2014-01-27 17:15:20,"Going to shorewall or back to ferm would reintroduce the problem that ufw was introduced to solve: adding and removing firewall rules depending on the apps used. This seems like an admirable goal especially given new developments like ansible galaxy. The bug linked to doesn't look that serious (more a problem with logging and VPS configuration than with ufw technically). Perhaps there's a third way?
",ariddell,2014-05-07 14:36:50
147,2014-01-27 18:16:29,"The problem is with some vservers and the kernels used there. With ufw ansible cant be used with a firewall with these vservers.

This sounds serious but maybe it isnt all that much, because vservers can make trouble in other ways. Right now encfs does not work on digitalocean, and while the setup of vpn did not give errors on my stratoserver, I remember from some time ago that there were problems with tun or tap devices on these servers.

So maybe using a real server might be the right solution, I dont know.

Regarding the configurable firewall, I think that shorewall can work with config directories, then each service could register itself a rule file.

Allen Riddell notifications@github.com schrieb:

> Going to shorewall or back to ferm would reintroduce the problem that
> ufw was introduced to solve: adding and removing firewall rules
> depending on the apps used. This seems like an admirable goal
> especially given new developments like ansible galaxy. The bug linked
> to doesn't look that serious (more a problem with logging and VPS
> configuration than with ufw technically). Perhaps there's a third way?
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/al3x/sovereign/issues/147#issuecomment-33397571

## 

Diese Nachricht wurde von meinem Mobiltelefon mit Kaiten Mail gesendet.
",do3cc,2014-05-07 14:36:50
147,2014-01-27 18:25:02,"I did not know that ferm was used before. I did not use shorewall before, just chose it because with pure iptables i would have been responsible for an init script.

Luke Cyca notifications@github.com schrieb:

> +1. ufw has been quite troublesome (#73, #82)
> 
> Please consider how to make it easy for servers to migrate to this once
> we merge. It‚Äôs probably as simple as adding a task that _uninstalls_
> ufw (and its associated configuration).
> 
> Also consider a modular configuration approach. It would be nice if
> each sovereign role was somehow responsible for enabling the ports it
> requires. That way, someone who comments out the XMPP role wouldn‚Äôt
> also have to plug the hole in the firewall.
> 
> FWIW, we originally used ferm, but accepted a patch to switch to ufw
> because it seemed simpler, more popular with people coming from Ubuntu,
> and would allow modular configuration. Did you consider switching back
> to ferm instead of introducing a third option? I don‚Äôt have an opinion
> either way ‚Äî¬†just curious.
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/al3x/sovereign/issues/147#issuecomment-33395679

## 

Diese Nachricht wurde von meinem Mobiltelefon mit Kaiten Mail gesendet.
",do3cc,2014-05-07 14:36:50
147,2014-01-27 20:17:30,"I've had a second look at ferm, it would also support to include files from a directory. Thus each part could install its own rules.
",do3cc,2014-05-07 14:36:50
147,2014-01-27 20:33:44,"regarding your point about eucfs not working on digitalocean, i've been running my VM on there with eucfs without issue.

Linux mymachine 3.2.0-4-amd64 #1 SMP Debian 3.2.41-2+deb7u2 x86_64 GNU/Linux
",jplock,2014-05-07 14:36:50
147,2014-01-27 21:16:56,"TASK: [common | Mount encfs] *************************************************\* 
failed: [x.x.x.x] => {""changed"": true, ""cmd"": ""printf \""yourpasshere\"" | encfs /encrypted /decrypted --public --stdinpass "", ""delta"": ""0:00:02.977420"", ""end"": ""2014-01-27 21:11:37.016943"", ""item"": """", ""rc"": 1, ""start"": ""2014-01-27 21:11:34.039523""}
stderr: fuse: mountpoint is not empty
fuse: if you are sure this is safe, use the 'nonempty' mount option
fuse failed.  Common problems:
- fuse kernel module not installed (modprobe fuse)
- invalid options -- see usage message

Same uname string
",do3cc,2014-05-07 14:36:50
147,2014-05-07 14:36:50,"I ran into the digitalocean fuse/encfs problem and found a solution...

Digitalocean provides you with their own kernel, regardless of what you have installed in the VM. That means that if you upgrade your kernel (with `apt-get upgrade`, for example) then your package manager will think you have the new kernel, but you won't actually be able to run it.

My solution is to downgrade the kernel package to the version that they're actually providing, and pinning it. That ensures that all other packages that get installed will be compatible.

First, downgrade:

<S_CODE_TOKEN>

Then, pin it:

<S_CODE_TOKEN>

I was not able to reproduce the ufw issue.
",lukecyca,2014-05-07 14:36:50
147,2014-05-18 19:50:50,"Sorry, not sure if I should make another issue for this, so writing here for now.

I am getting the fuse/encfs module issue above (and I am using Debian 7 x64 on a VPS with DigitalOcean) and I can't find the version that you suggest downgrading the kernel to in the repositories. Here is what I have in my repositories:

<S_CODE_TOKEN>

When running the above apt-get install command I get:
`E: Version '3.2.46-1+deb7u1' for 'linux-image-3.2.0-4-amd64' was not found`

Any ideas? Been trying to get this to work for ages, and I have used encfs on Ubuntu (with Digital Ocean) before, so might try and do that. Thanks.
",timinator,2014-05-07 14:36:50
147,2014-05-18 21:35:54,"Try running `apt-get update` before `apt-get install`.
",skottler,2014-05-07 14:36:50
147,2014-05-19 06:38:17,"Yeah I tried that, but seems like the repositories dont have that version. Would this problem go away if I used Ubuntu 14.04?
",timinator,2014-05-07 14:36:50
147,2014-05-21 16:21:46,"I'm having the same error as that of  #240 and @timinator, but in my case inside the VirtualBox VM. I don't know enough about package management, but I ran... 

<S_CODE_TOKEN>

I have no idea if there's a way to get previous versions, but I haven't been able to. For testing I can bypass encfs, but since it has repeatedly been an issue in one way or another any ideas are welcome. If I have time I will look into a replacement.
",dr-nate,2014-05-07 14:36:50
147,2014-05-22 05:21:50,"I resolved this problem on DigitalOcean by changing the kernel version according to [these instructions](https://www.digitalocean.com/community/articles/how-to-update-a-digitalocean-server-s-kernel-using-the-control-panel). The control panel doesn't show the minor release numbers but I chose the 2nd from the last in the drop down menu (out of 3 options that all read `* Debian 7.0 x64 vmlinuz-3.2.0-4-amd64`).

Before changing the kernel, `uname -a` reported version `3.2.54-2`. Now it reports `3.2.57-3` and `modprobe fuse` works again.
",reedlaw,2014-05-07 14:36:50
147,2014-05-22 07:39:53,"@reedlaw Thanks so much, this has resolved my problem :)
",timinator,2014-05-07 14:36:50
146,2014-01-23 21:32:18,"With little to no support for windows from Ansible, I would suggest moving to more of a vagrant passthrough option for the sovereign setup. 

Vagrant is already used for the testing environment, and it could easily be modified to run ansible playbooks locally from inside of it, and it could then also be used to deploy remotely from a windows machine.

I don't know of any reason this would affect other OSes negatively, but it would definitely benefit Windows users if it could be done.
",EHLOVader,2014-06-27 00:16:05
146,2014-05-28 17:20:39,"Another option for windows users with a Linux VPS would be to just run ansible on the VPS itself.
",neuhaus,2014-06-27 00:16:05
146,2014-05-29 19:22:18,"I have actually been doing this since I wrote this ticket. I was working on another box solution to try and combine the efforts here with the efforts over at http://getprotobox.com/ which is geared towards dev virtualboxes, but does handle that exact case. It installs ansible on the remote machine and makes configuring the playbook as simple as a single yaml file.

I had hoped that the virtual machine could also be used for local testing of the configurations and then deployment to the remote machines in the case of sovereign or my other project that was meant to marry the two.

This may still be a concern for others so I will keep it open, but hopefully some of the above may help in determining a solution appropriate for this use case.
",EHLOVader,2014-06-27 00:16:05
146,2014-06-27 00:16:05,"I'm open to patches that would make Sovereign more Windows-friendly but given the multitude of options for accessing virtual Debian servers it's not a priority.
",al3x,2014-06-27 00:16:05
145,2014-01-22 23:51:33,"Following the instructions of using a Debian 7 image, PostgreSQL 9.1 is installed in /var/lib/postgresql not /opt/postgresql
",jplock,2014-01-23 20:35:27
144,2014-01-21 01:58:59,,jplock,2014-01-21 02:19:54
143,2014-01-19 18:08:09,"I've tried to use ownCloud but it's so slow as to be completely useless. I don't even store much, but it just would not go through. From what I hear I have every reason to worry, ownCloud is a neat idea but the code is in bad shape.

After trying a few commercial offerings I am now running [BitTorrent Sync](http://www.bittorrent.com/sync) and it works great. I'm assuming y'all know this. I love that nobody has to register anywhere; just use the secret key and the files start syncing. So it works, it's encrypted, fast and free.

I am running this on my Ubuntu machine as follows:

Read [this blog post](http://forum.bittorrent.com/topic/18974-debian-and-ubuntu-server-packages-for-bittorrent-sync-121-1/) and added the PPA:

<S_CODE_TOKEN>

The setup was interactive, but I'm pretty sure it can be scripted. Accepted all the defaults, which means a btsync process running on some port (I chose 21992 based on some comment). It also wants to run a configuration web server, ran that at 8888 (the default).

After opening those two in ufw, and adding a folder in the web gui, things started syncing just fine. I chose `/decrypted/btsync` as my base folder and added folders to-be-synced below that.

Does this sound like something we'd want?

If yes are the PPAs okay or do we run btsync directly. The latter seems simpler to me, it's just a download, unpack and running a daemon.

Not sure about the web gui, it seems like a risk to me. I couldn't find anything about scripting folders to-be-synced though. It seems you'd need the gui just for that.
",tilsammans,2014-01-19 20:17:09
143,2014-01-19 18:26:40,"Just replying to myself so I know where to find it. The [entire config can be scripted](http://blog.bittorrent.com/2013/09/17/sync-hacks-how-to-set-up-bittorrent-sync-on-ubuntu-server-13-04/) which is good news for us.
",tilsammans,2014-01-19 20:17:09
143,2014-01-19 18:45:40,"Until bitorrent sync is open source, it should not be in sovereign.
",stephenjamieson,2014-01-19 20:17:09
143,2014-01-19 20:17:09,"I'm with @stephenjamieson: I would prefer not to include non-FOSS software in Sovereign. However, I would be happy to link to your BitTorrent Sync from the official Sovereign repo/wiki/docs.

Sorry that you've had issues with ownCloud. It hasn't been perfect for me, but it definitely gets files from my laptop to my server and back.
",al3x,2014-01-19 20:17:09
143,2014-02-21 22:09:49,"@stephenjamieson @al3x well, that didn't take long. https://github.com/jewel/clearskies
",tilsammans,2014-01-19 20:17:09
143,2014-02-21 22:27:43,"That's great, I think I would wait until it matures a bit though.  I'd rather have the c based version as well, not the ruby.  Nothing's wrong with ruby, but we're limited with a VPS on memory/cpu, so lighter is better.
",stephenjamieson,2014-01-19 20:17:09
143,2014-02-22 08:02:16,"Agreed!

> Op 21 feb. 2014 om 23:27 heeft stephenjamieson notifications@github.com het volgende geschreven:
> 
> That's great, I think I would wait until it matures a bit though. I'd rather have the c based version as well, not the ruby. Nothing's wrong with ruby, but we're limited with a VPS on memory/cpu, so lighter is better.
> 
> ‚Äî
> Reply to this email directly or view it on GitHub.
",tilsammans,2014-01-19 20:17:09
142,2014-01-19 05:10:33,"If we want to use SSL, I wasn‚Äôt able to connect to port 6667 so I had to change this to 6697 which is the SSL only port
",jplock,2014-01-19 08:30:58
141,2014-01-17 14:30:42,"Fixes issue #8. Adds new variable mail_header_privacy, on by default.
Installs postfix-pcre unconditionally, and then copies the pcre file
over and adds the header check to main.cf based on the variable value.
‚Äúthis header replacement works great, but it logs that the replacement
has been done, which means that you are storing this information,
unless you are anonymizing your logs‚Äù
",cji,2014-01-17 16:27:46
141,2014-01-17 16:27:53,"Thanks!
",lukecyca,2014-01-17 16:27:46
140,2014-01-17 02:34:21,,jplock,2014-01-28 01:06:46
140,2014-01-27 16:42:33,"Is 9.2 the version that gets installed with Debian 7.x?
",lukecyca,2014-01-28 01:06:46
140,2014-01-27 16:51:24,"Mine installed 9.1 when I ran the playbooks
",jplock,2014-01-28 01:06:46
140,2014-01-27 19:50:19,"The playbook explicitly installs postgresql 9.1 so the reference to the 9.2 pid is very probably an oversight that is (probably) fixed with this.
",do3cc,2014-01-28 01:06:46
140,2014-01-28 01:15:06,"ok, also confirmed in a current test VM:

<S_CODE_TOKEN>

Thanks for the fix!
",lukecyca,2014-01-28 01:06:46
139,2014-01-17 01:32:12,"When rebooting the server, is there anyway to securely automount /decrypted so the various programs that are using it don't get messed up?
",jplock,2014-01-17 01:54:53
139,2014-01-17 01:42:20,"Unfortunately there isn‚Äôt. Doing so requires the key to be stored persistently (most likely on disk) which defeats the purpose of encfs entirely. If your server restarts, you must re-run the playbooks on it, and that should mount the encfs volume.

It is debatable how much security encfs provides when running on a VPS anyway. It is probably quite easy for the VM host to memory-scrape the key. At best, it prevents the casual snooper from trivially mounting the disk image (or snapshot) of our VM.

If you would like to disable encfs altogether, have a look at #120.
",lukecyca,2014-01-17 01:54:53
139,2014-01-17 01:54:53,"Yea it is remounting it, but then I'm running into #116 and now I need to ensure I'm not losing all my owncloud files on all my devices if its data folder gets messed up.  Thanks for the help.
",jplock,2014-01-17 01:54:53
139,2014-05-15 20:36:26,"Using an encrypted root partition (with cryptsetup) will solve this. You'll have to enter your passphrase after every reboot (at the console or remotely using the dropbear ssh server in initrd) to mount the root partition and boot up your server properly.
",neuhaus,2014-01-17 01:54:53
138,2014-01-16 11:00:14,"Start out with the random worldwide pool by default, but override that in user.yml. This won't change the behavior of Sovereign out of the box, but makes the pool configurable. Accurate system clock ftw.
",tilsammans,2014-01-16 20:57:57
138,2014-01-16 11:08:27,"Just now reading that `pool.ntp.org` DNS response is aware of location:

> Looking up pool.ntp.org (or 0.pool.ntp.org, 1.pool.ntp.org, etc) will usually return IP addresses for servers in or close to your country. For most users this will give the best results.

Might actually be best to stick with that and comment the servers in `user.yml` by default? This way the results are better for most people. Changes the way Sovereign works though. We'd need to bump the major version. :grin: 
",tilsammans,2014-01-16 20:57:57
138,2014-01-16 16:04:22,"You could put this variable in defaults.yml and omit it from user.yml (and testing.yml).

user.yml is intended for variables that pretty much everyone will have to set. defaults.yml has more variables exposed that can be overridden in user.yml if someone has more specific needs.

However, if nobody is needing specific NTP servers, I think we could simply switch the hard-coded servers from north-america to the geo-looked-up ones as you suggest, and not expose it as a variable at all. 
Less code, YAGNI, etc.
",lukecyca,2014-01-16 20:57:57
138,2014-01-16 16:08:27,"I'd be cool with YAGNI and relying on the geo lookup, but that means that the north-america servers will be replaced with the generic ones. If that's cool I can modify this pull request.
",tilsammans,2014-01-16 20:57:57
138,2014-01-16 16:11:39,"> but that means that the north-america servers will be replaced with the generic ones.

I think that‚Äôs an improvement!
",lukecyca,2014-01-16 20:57:57
138,2014-01-16 20:35:44,"There you go.
",tilsammans,2014-01-16 20:57:57
138,2014-01-16 20:58:03,"Thanks!
",lukecyca,2014-01-16 20:57:57
137,2014-01-16 08:00:58,"See the docs http://docs.ansible.com/playbooks_prompts.html

I believe that Passlib also provides SHA-256 Crypt and we can replace the hashes currently in the script with a private `vars_prompt`. SHA-256 Crypt is pretty good but it's still best practice to not store the hash I think.

When using `vars_prompt` we will have to leave the existing email accounts alone.
",tilsammans,2015-06-04 05:59:19
137,2014-01-16 08:01:59,"This hash I mean: https://github.com/al3x/sovereign/blob/master/vars/user.yml#L33
",tilsammans,2015-06-04 05:59:19
137,2014-01-16 16:07:37,"Fantastic idea. Setting those hashes is a pain for a first-time user, since the instructions use the software that hasn‚Äôt been installed yet.
",lukecyca,2015-06-04 05:59:19
137,2014-01-16 16:11:35,"Okay great. How do we handle rebuilding of a clean server from the existing setup? No hashes in Ansible means it's difficult to rebuild a server with existing users from scratch.
",tilsammans,2015-06-04 05:59:19
137,2014-01-16 16:21:45,"I think the model is that everything required is either stored in your local clone of the repo, or backed up to tarsnap. A theoretical restore (which I have been meaning to test for real) would be:
1. Get new machine
2. Run your playbooks
3. Restore backups onto the machine
4. Maybe run the playbooks again for good measure

So I guess your plan is fine as long as the tasks are idempotent and can detect if the hashes are already set on the server.

A less elegant option that might be easier to implement would be to have a separate stand-alone script that lets new users create the hashes on their local machine and copy them into user.yml. This would still be a big improvement over the current instructions.
",lukecyca,2015-06-04 05:59:19
137,2014-01-19 11:49:18,"I'll see if I can come up with something that works nicely. I kind of like that all the config is now in Sovereign.

Op 16 jan. 2014, om 17:22 heeft Luke Cyca notifications@github.com het volgende geschreven:

> I think the model is that everything required is either stored in your local clone of the repo, or backed up to tarsnap. A theoretical restore (which I have been meaning to test for real) would be:
> 
> Get new machine
> Run your playbooks
> Restore backups onto the machine
> Maybe run the playbooks again for good measure
> So I guess your plan is fine as long as the tasks are idempotent and can detect if the hashes are already set on the server.
> 
> A less elegant option that might be easier to implement would be to have a separate stand-alone script that lets new users create the hashes on their local machine and copy them into user.yml. This would still be a big improvement over the current instructions.
> 
> ‚Äî
> Reply to this email directly or view it on GitHub.

Joost Baaij
Space Babies B.V.
Van Ostadestraat 89
1072 SR Amsterdam
KVK 34180528
",tilsammans,2015-06-04 05:59:19
137,2014-01-31 23:39:34,"On Debian / Ubuntu you can get round the problem of not having Dovecot etc installed first by using:

<S_CODE_TOKEN>

This will generate the hashes you need. If it's not already installed you can get it with:

<S_CODE_TOKEN>
",keybits,2015-06-04 05:59:19
137,2014-05-28 17:19:55,"That's cool but the problem is that the machine with the ansible playbook may be something else, like a Mac.
",neuhaus,2015-06-04 05:59:19
137,2014-05-29 13:13:41,"@knitatoms  that's really helpful. It's a pain for ZNC as well. I'd welcome adding the mkpasswd trick to the docs.
",ariddell,2015-06-04 05:59:19
137,2015-06-04 05:59:19,"People seem to have accepted generating and storing hashes in their config files. Closing.
",al3x,2015-06-04 05:59:19
137,2015-06-04 08:32:30,"Using http://docs.ansible.com/playbooks_vault.html or git-crypt, maybe add this projects to the README?
",spk,2015-06-04 05:59:19
136,2014-01-16 07:55:01,"Webmail php libraries have a pretty spotty track record as far as security is concerned. Also, they contain a lot of sensitive data that must not be breached. ownCloud is the same in this regard. I'm pretty hesitant to commit private stuff to it.

How does adding another security layer sound for these two sites? I'm thinking of http basic/digest with username and password for everyone. Just another gate you have to know the secret of, in order to continue.
",tilsammans,2014-04-14 02:10:59
136,2014-04-13 11:54:24,"Do we need this now that roundcube supports 2FA?
",jplock,2014-04-14 02:10:59
136,2014-04-13 12:00:50,"No! Good call. 

> Op 13 apr. 2014 om 13:54 heeft Justin Plock notifications@github.com het volgende geschreven:
> 
> Do we need this now that roundcube supports 2FA?
> 
> ‚Äî
> Reply to this email directly or view it on GitHub.
",tilsammans,2014-04-14 02:10:59
135,2014-01-15 20:46:33,"Otherwise only pop and imap (un-secured) are blocked.
Which we don't use.
",tilsammans,2014-01-15 21:38:03
134,2014-01-14 16:13:49,"This works on Debian/Ubuntu only.

There are similar packages for other distributions, but they still
need manual configuration. It seemed better to go for the common
denominator. unattended-upgrades is usually installed by default
anyway, so we are just reinforcing best practices.

Fixes #92
",tilsammans,2014-01-14 16:18:36
133,2014-01-14 15:40:50,"added dovecot-pop3d
allowed in the firewall
monitored with monit
added relevant tests
",tilsammans,2014-01-14 16:20:46
133,2014-01-14 16:21:18,"A very well-crafted pull request. Thanks for the contributions!
",lukecyca,2014-01-14 16:20:46
133,2014-01-14 22:44:45,"I aim to please.
",tilsammans,2014-01-14 16:20:46
132,2014-01-14 01:44:28,"Updated the default port to reflect MySQL to Postgres change (port 3306 to 5432)
",jplock,2014-01-14 01:49:07
131,2014-01-14 00:48:17,"- Made the OpenVPN port and protocol (tcp/udp) configurable
- Added 'cipher' and 'auth' lines to the generated client configs
",jlund,2014-01-14 00:56:25
130,2014-01-13 23:58:30,"It would be really cool to have a single user database that all services could use for authentication. That is, the same username and password should work across all applications.
",cweagans,2016-10-08 22:07:08
130,2014-03-24 16:47:36,"I investigated this a little and all the services currently installed seem to support this one way or another (even ZNC).
",catern,2016-10-08 22:07:08
130,2014-09-16 15:15:08,"+1 for this. yunohost seems to support this, though I'm not sure how they install it or use it in other apps
",malvim,2016-10-08 22:07:08
130,2014-10-07 19:36:54,"If there is interest I could create a role for the musterroll ldap server we use for cloudfleet. It is a very lightweight subset of an ldap server with the only target to support user authentication over ldap and brings its own user management web interface.
",DoubleMalt,2016-10-08 22:07:08
130,2014-10-13 20:49:47,"That sounds very nice, though we'd still have to adapt all the other software to authenticate via ldap. Not sure what would need to be done, but I'm willing to help if needed.
",malvim,2016-10-08 22:07:08
130,2014-10-13 21:36:02,"I'd be interested in seeing this as well!
",ariddell,2016-10-08 22:07:08
130,2014-10-20 11:38:03,"@DoubleMalt I'm trying to setup ldap for Ubuntu 14.04 -- is your role or part of it public?
",ariddell,2016-10-08 22:07:08
130,2014-10-20 11:40:43,"No. Not yet.

On Mon, Oct 20, 2014 at 1:38 PM, Allen Riddell notifications@github.com
wrote:

> @DoubleMalt https://github.com/DoubleMalt I'm trying to setup ldap for
> Ubuntu 14.04 -- is your role or part of it public?
> 
> ‚Äî
> Reply to this email directly or view it on GitHub
> https://github.com/al3x/sovereign/issues/130#issuecomment-59734252.
",DoubleMalt,2016-10-08 22:07:08
130,2014-12-29 04:23:55,"+1
",flasheater,2016-10-08 22:07:08
130,2015-05-22 00:46:23,"Any news on this? Or any news in sovereign in general? 

I've been looking at various self-hosting platforms, and sovereign actually seems like the best one; even though it is barely customizable, it does support most essential features
",stevenroose,2016-10-08 22:07:08
130,2015-05-22 19:01:00,"Sovereign is continuously updated by myself and the community. There are no particular releases or milestones. It's meant to be stable at all times.

I haven't worked on LDAP myself. I don't manage many accounts on my Sovereign instance and so haven't needed it.
",al3x,2016-10-08 22:07:08
130,2015-05-22 19:25:54,"Maybe an initial fork for a proof of concept would be a good idea. I'd be willing to test it. In theory, I can see the appeal of having a single (LDAP) login for mail, shell, OwnCloud, etc...
",ariddell,2016-10-08 22:07:08
130,2015-08-08 14:23:21,"I think what you actually want is FreeIPA not an old antiquated LDAP ;)
",DtpEJsaYXDU4GDH8dE4MyI9VrieF0UZpPZ0K76K,2016-10-08 22:07:08
130,2015-08-08 15:41:28,"I think the simplicity of LDAP (with TLS) might be a better match for the present set of users.
",ariddell,2016-10-08 22:07:08
130,2015-08-08 17:46:37,"+10^much, much ! That would really add value to sovereign
",perfaram,2016-10-08 22:07:08
130,2015-08-08 17:52:23,"LDAP is much more common than FreeIPA, and significantly more bulletproof. It might be antiquated, but it's still rock solid.
",cweagans,2016-10-08 22:07:08
130,2016-09-29 16:59:17,"I'd welcome a PR for this... until then, shall we close this bug?
",neuhaus,2016-10-08 22:07:08
130,2016-09-29 17:07:47,"I'd leave it open and tag is as ""enhancement"" or ""feature request""

On Sep 29, 2016 18:59, ""Sven Neuhaus"" notifications@github.com wrote:

> I'd welcome a PR for this... until then, shall we close this bug?
> 
> ‚Äî
> You are receiving this because you commented.
> Reply to this email directly, view it on GitHub
> https://github.com/sovereign/sovereign/issues/130#issuecomment-250527411,
> or mute the thread
> https://github.com/notifications/unsubscribe-auth/AA0F3A-tWtyUNFDerzaH0yNpzu49awpjks5qu-5sgaJpZM4BZeHf
> .
",stevenroose,2016-10-08 22:07:08
130,2016-10-08 22:07:08,"This thread seems to have run its course.  I am going to close it but like @neuhaus would welcome a PR from someone interested in seeing it added.
",mikeashley,2016-10-08 22:07:08
129,2014-01-10 19:11:56,"Remove all configuration for MySQL and configure PostgreSQL as the main
database.

All __mysql__ options have been changed to __db__ options.

Postgres requires the database user to have a password in order to
connect via localhost. The db_admin_password option is used to set the
password of the admin user (usually postgres).
",ssoriche,2014-01-12 23:03:19
129,2014-01-11 23:04:31,"For Postgres I think it's even more important to replace all `varchar(n)` with `text`. This is more or less standard practice. The performance is exactly the same, inserts are slightly faster because the length of the string isn't checked. And email addresses can definitely be larger than 100 characters, so having a varchar(100) in there is not a good idea I think.
",tilsammans,2014-01-12 23:03:19
129,2015-02-10 22:27:52,"Is there a way to grab the source code before this was merged? Unfortunately, postgres doesnt work that well with Drupal (more importantly with Aegir unfortunately).
",shaneonabike,2014-01-12 23:03:19
129,2015-02-10 22:36:59,"<S_CODE_TOKEN>

e.g.

<S_CODE_TOKEN>
",qmr,2014-01-12 23:03:19
129,2015-02-10 22:54:57,"Thanks but I was trying to figure out the commit code before this checkout which I'm struggling to find
",shaneonabike,2014-01-12 23:03:19
129,2015-02-10 23:00:29,"70f2a4445f139b788a642a88add95880e9d13c9e
",qmr,2014-01-12 23:03:19
129,2015-02-10 23:06:59,"Wow amazing that is correct.. sorry I didn't realize you were ACTUALLY giving me the proper one.. thank you! How did you figure out which was the proper one because I tried others using git show and none of them worked :/
",shaneonabike,2014-01-12 23:03:19
129,2015-02-10 23:26:57,"<S_CODE_TOKEN>

Then forward slash to search for 'mysql'.
",qmr,2014-01-12 23:03:19
128,2014-01-06 15:20:44,"I am no server security expert, but had looked into ways of security the VPS I hosted my IRC bouncer on. I found artillery and can't say if it has really helped, but it looks like a good proactive solution that may stop outside attempts to get in and even DDOS attacks.

In addition to the honeypot blocking of portscanners, it also monitors system files for changes.

https://github.com/trustedsec/artillery/
",EHLOVader,2014-06-27 00:22:53
128,2014-06-27 00:22:53,"I would consider a pull request for adding this tool, but I'm skeptical of a tool that combines a ""honeypot, monitoring tool, and alerting system"", which seem like three distinct and hard-to-implement-correctly systems.
",al3x,2014-06-27 00:22:53
127,2014-01-05 20:59:44,"When you're hosting a couple of hundred aliases, you will benefit.
It seems safer to create the index and deal with the slight overhead
for just a couple of records, as opposed to not having these
indexes and deal with serious performance issues if you have
lots of aliases on the machine.
",tilsammans,2014-01-07 02:31:07
127,2014-01-07 02:31:16,"Thanks!
",lukecyca,2014-01-07 02:31:07
126,2014-01-05 14:08:57,"I added a README section about generating self-signed SSL certs.

I'd appreciate any comments as to which services might not work when using such a cert.
",yuvadm,2014-01-12 23:06:46
126,2014-01-07 00:57:40,"Note that Sovereign doesn't (or at least, as of the playbooks five months ago, doesn't) require a wildcard cert. #14 discussed this a bit; I think a section (not that I'm volunteering to write it :) on how to set up SNI and multiple free StartSSL certs is probably the best resolution.

With that said, I think self-signed certificates shouldn't be encouraged. Browser handling of self-signed certificates ranges from ""poor"" to ""silently terrible"" - not to mention that iOS's native HTTP methods tend to choke on self-signed in ways the user can't resolve. Especially given that one of the goals of Sovereign is to improve personal security - adding self-signed certs, and encouraging users to ignore the (many) self-signed warnings, feels counterproductive to me.
",abl,2014-01-12 23:06:46
126,2014-01-07 03:01:25,"AFAICS, the instructions aren‚Äôt sufficient to work without additional modifications to the playbooks. Here are the commands I use to generate self-signed certs for testing Sovereign:

<S_CODE_TOKEN>

Also, if you‚Äôre using self-signed certs, you may want to consider #111. If your cert supports `Subject Alternative Name` for both example.com and *.example.com, you can then easily add your cert as a trusted CA on clients, and it will work for all subdomains.

Perhaps a wiki page called ‚ÄúAlternatives to Wildcard Certificates‚Äù would be a better place for this. It can document self-signed certs as well as various free cert configurations.
",lukecyca,2014-01-12 23:06:46
126,2014-01-07 09:08:07,"In my [Rails playbook](https://github.com/tilsammans/playbook/blob/master/roles/rails/tasks/main.yml#L45) I go a step further and generate the key and CSR directly on the server. I prefer that to generating the key on the client and committing it to Git. In my opinion a key belongs only on the server, with strict permissions, and must never be checked into source control.

Doing it on the server has the bonus that everything can be completely automated.

I think that self-signing a certificate is fine for the scope of Sovereign, as long as we mention in the README that for a production system you should buy one from a CA.
",tilsammans,2014-01-12 23:06:46
126,2014-01-07 16:35:14,"Security considerations aside for one moment, is there anything deployed by sovereign that _requires_ a fully-signed SSL cert - i.e. applications like XMPP or IMAP that might fail due to _other_ servers looking at the cert and going ""nope""?
",yuvadm,2014-01-12 23:06:46
126,2014-01-07 16:58:55,"XMPP might do soon, there is a movement amongst the xmpp community to do server to server secutiry properly. Imap won't - it's client only.

SMTP might, but will probably remain a mess.

What might be useful is to use DNSSEC and publish TLSA records, support for verifying them has been recently added to postfix.
",JasperWallace,2014-01-12 23:06:46
126,2014-01-09 15:13:10,"I updated the method used (and squashed the commit) to reflect @lukecyca's suggestion.

There's more discussion to be had on this topic, and I concur that a wiki page describing the various tradeoffs might be in place, and in that case I'd like to see a reference from the README to that page.
",yuvadm,2014-01-12 23:06:46
126,2014-01-12 23:07:20,"Thank you for the contribution, @yuvadm.
",al3x,2014-01-12 23:06:46
125,2014-01-05 13:36:19,"Sovereign requires a wildcard SSL cert, which is a significant financial obstacle for self hosting services (at ~$150$/yr).

How would using a self-signed wildcard SSL affect the sovereign installation base? What implication does it have, and which services are bound to fail in such a case?
",yuvadm,2014-01-05 14:10:58
125,2014-01-05 14:10:58,"Closing this issue, please discuss on PR #126 
",yuvadm,2014-01-05 14:10:58
124,2014-01-04 22:33:07,"As configured, every ban against the main fail2ban jails (sshd, apache, postfix) is individually mailed to the `admin_email` address. Each jail is also enumerated in ten ‚Äústopped‚Äù/‚Äústarted‚Äù emails whenever fail2ban is restarted. By using the `action_` shortcut instead of `action_mwl`, the `mail-whois-lines` action is not invoked and no individual email is sent.

As the bans are still logged, the results are rolled up into the Logwatch email instead, and sent once together with all the other Logwatch notices.

This is the change I made to address issue #98, but I'm no expert so there might be a better method.
",markpasc,2014-01-06 03:34:36
124,2014-01-06 03:34:39,"Thanks!
",lukecyca,2014-01-06 03:34:36
123,2014-01-04 13:20:57,"Any interest in [AppArmor](http://wiki.apparmor.net/index.php/GettingStarted)? If you like the idea, I can whip up a pull request.
",tilsammans,2014-01-17 20:09:47
123,2014-01-09 21:45:10,"Sounds great!
",jgeerds,2014-01-17 20:09:47
123,2014-01-12 23:06:08,"+1, this would be great.
",al3x,2014-01-17 20:09:47
123,2014-01-14 13:38:08,"Distributions that include AppArmor:
- Annvix
- Arch Linux
- Debian
- Gentoo
- Mandriva
- openSUSE (integrated in default install)
- Pardus Linux
- PLD
- Ubuntu (integrated in default install)

In other words, not for CentOS and if you are Ubuntu already (as I suspect many will) it's turned on and running already.

Maybe we don't need this in Sovereign?
",tilsammans,2014-01-17 20:09:47
123,2014-01-16 16:32:07,"Our official supported distro is Debian 7. According to [this page](https://wiki.debian.org/AppArmor/HowTo), it is enabled in the Debian 7 kernels, but the userspace tools are not installed and no profiles are enabled. We could certainly do the latter in sovereign.
",lukecyca,2014-01-17 20:09:47
123,2014-01-17 18:55:42,"Apparently AppArmor is only easy on Ubuntu. http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=670170

Other distros require changing files and a reboot before it's enabled. Which kind of interferes with the one-click approach of Sovereign. As cool as AppArmor sounds I feel like closing this ticket. Ubuntu servers will use it anyway; for others it seems like too much trouble at this time.
",tilsammans,2014-01-17 20:09:47
123,2014-01-17 19:57:37,"Great, close it.

> On Jan 17, 2014, at 10:55, Joost Baaij notifications@github.com wrote:
> 
> Apparently AppArmor is only easy on Ubuntu. http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=670170
> 
> Other distros require changing files and a reboot before it's enabled. Which kind of interferes with the one-click approach of Sovereign. As cool as AppArmor sounds I feel like closing this ticket. Ubuntu servers will use it anyway; for others it seems like too much trouble at this time.
> 
> ‚Äî
> Reply to this email directly or view it on GitHub.
",al3x,2014-01-17 20:09:47
122,2014-01-02 02:24:53,"Fixes issue al3x/sovereign#121 by changing `${recipient}` to `${user}@${nexthop}` in a couple places inside roles/mailserver/files/etc_postfix_master.cf
",bryanjswift,2014-01-02 02:36:21
122,2014-01-02 02:36:24,"Fantastic. Thank you.
",lukecyca,2014-01-02 02:36:21
121,2014-01-02 01:00:03,"When I send an email to, for example, 'sovereign+foo@sovereign.local', the mail gets bounced rather than delivered.

As best I can tell this is because `etc_postfix_master.cf` uses `${recipient}` everywhere instead of `${user}@${nexthop}` or `${user}@${domain}` but I'm not familiar enough with the programs being piped into to know which should be changed. I'm doing some poking around to try and get this sorted out and will hopefully have a pull request soon.
",bryanjswift,2014-01-02 02:36:35
121,2014-01-02 01:41:52,"Thanks for looking into this.
",lukecyca,2014-01-02 02:36:35
121,2014-01-02 02:26:04,"I am not sure how to convert this issue to the pull request so I created a new one, #122. Hopefully this isn't too much of a maintenance headache for you folks.
",bryanjswift,2014-01-02 02:36:35
121,2014-01-02 02:38:30,"To convert existing issues to pull requests, I use [hub](https://github.com/github/hub) as in this [stack overflow question](http://stackoverflow.com/questions/4528869/how-do-you-attach-a-new-pull-request-to-an-existing-issue-on-github).
",lukecyca,2014-01-02 02:36:35
121,2014-01-02 02:42:38,"Good to know. Thanks.
",bryanjswift,2014-01-02 02:36:35
120,2014-01-01 14:43:20,"How hard would it be to make encfs optional ? 

I run this on my own host on my own network, and I want it mounted at boot time. Doing this means storing the password somewhere on the host. If my host is siezed, they will be able to recover the password anyway, so I don't see the value to encfs in this operating model. 

Looking at the playbooks and the resulting installation, many of the applications expect their content to be available at /decrypted. Would it be possible to include the data directory as a variable in the user.yml vars file? 

Removing encfs would also make these playbooks work with Ubuntu 13.10. This currently fails as there is no fuse-utils package in the default repos. 
",Anonymouslemming,2014-01-07 02:38:40
120,2014-01-07 02:38:40,"You can do this by:
1.  Commenting out encfs in `roles/common/tasks/main.yml`
2.  Creating a `/decrypted` directory manually

Unless there is quite a bit of demand for this, I suggest we keep it out of Sovereign. Our goal is a configuration that is ideal for most people and doesn‚Äôt require many decisions to configure.
",lukecyca,2014-01-07 02:38:40
120,2014-04-27 15:39:29,"I've have Issue making work Fuse on an OpenVZ VE host as described here.

 EncFS Password: 
fuse: device not found, try 'modprobe fuse' first
fuse failed.  Common problems:
- fuse kernel module not installed (modprobe fuse)
- invalid options -- see usage message

It requires OpenVZ Host to have fuse installed and my provider (OVH in france) doesn't provide this 
",AlbanSeurat,2014-01-07 02:38:40
120,2014-05-15 20:34:26,"I have a dedicated root server with an encrypted root partition (using the cryptsetup package which is available on Debian and Ubuntu). It'd be handy if encfs were optional without jumping through too many hoops (i.e. finding this issue on github). For now, I'll do it manually by following lukecyca's advice. Thanks.
",neuhaus,2014-01-07 02:38:40
120,2014-10-30 14:08:44,"The need to re-run the playbook after every reboot is a major drawback of sovereign in my opinion. I think this should be stated very prominently in the README, so people don't have to google it once they run into the problem of having a dysfunctional mailserver.
",felixfischer,2014-01-07 02:38:40
120,2015-02-11 02:58:05,"As well you will need to remove the fuse group from the user at roles/common/tasks/users.yml since this will fail the install also!
",shaneonabike,2014-01-07 02:38:40
120,2015-02-18 08:07:31,"Btw, there is also the possibility to run ansible with the option `--skip-tags ""encfs""`
",neuhaus,2014-01-07 02:38:40
120,2015-02-18 08:16:17,"Thanks @shaneonabike for your observation, in my pull request I removed the group ""fuse"" from users.yml and moved it to encfs.yml instead, making it optional.
",neuhaus,2014-01-07 02:38:40
119,2014-01-01 10:56:20,"My very first environment setup with vagrant failed when installing owncloud, this should fix it.
",soulrebel,2014-01-01 19:10:48
118,2013-12-29 19:35:46,"Curl outputs a progress bar to stderr, so just redirecting the stdout to /dev/null doesn't stop the email. This adds `--silent --show-error` to curl as per https://github.com/al3x/sovereign/pull/117#issuecomment-31323349, which stops the emails.
",brucespang,2013-12-29 21:50:09
117,2013-12-29 19:25:08,"Currently, the selfoss cron job overrides the ownCloud cronjob and creates cron email noise. This commit fixes it.
",brucespang,2013-12-29 19:26:31
117,2013-12-29 19:27:21,"There's still a problem with this: curl outputs a progress bar to stderr, so cron still sends an email about it.
",brucespang,2013-12-29 19:26:31
117,2013-12-29 19:29:09,"D‚Äôoh! How about `curl --silent --show-error`?
",lukecyca,2013-12-29 19:26:31
117,2013-12-29 19:30:35,"Sounds good. Let me try it on my sovereign install and make sure it works.
",brucespang,2013-12-29 19:26:31
116,2013-12-26 16:57:27,"When owncloud is updated, the pkg places a new directory at `/var/www/owncloud/data`, replacing our symlink. This then causes our symlink task to fail:

<S_CODE_TOKEN>
",lukecyca,2014-06-27 01:19:02
116,2014-01-16 07:56:26,"Would a hard link fix it?
",tilsammans,2014-06-27 01:19:02
116,2014-01-17 01:57:27,"@jplock apparently ran into this issue simply from a reboot. Perhaps we need to look into preventing services from starting at boot, and rather wait until the playbook mounts the encfs again.
",lukecyca,2014-06-27 01:19:02
116,2014-01-17 02:18:38,"Yea I think that would be good.  It would work for me anyway.  I don't intend to reboot my VM often, but I had to one time to take a snapshot of it and ran into this.  Thanks for your help in this.
",jplock,2014-06-27 01:19:02
115,2013-12-26 14:34:48,"I'm seeing a regular segfault in solr. It looks like it might be related to some configuration issue, although I can't tell which file would be the problem from the log.

It looks like there's an ubuntu bug report of [a similar issue](https://bugs.launchpad.net/ubuntu/+source/dovecot/+bug/1242365), although I cannot reproduce the segfault by running `sudo doveadm index -u bruce@brucespang.com Inbox`.

Have any of you run into this or found a fix for it?

Backtrace:

<S_CODE_TOKEN>
",brucespang,2014-01-12 23:23:55
115,2013-12-26 19:22:41,"I have not seen this before. I grepped through my own server and didn‚Äôt find it either.

Memory issue?
",lukecyca,2014-01-12 23:23:55
115,2014-01-12 23:13:45,"@brucespang Anything further on this? I don't see this behavior on my VPS.
",al3x,2014-01-12 23:23:55
115,2014-01-12 23:23:55,"I'm still seeing the issue, but it doesn't seem to be impacting anything.
",brucespang,2014-01-12 23:23:55
115,2014-01-30 14:27:35,"I've had this issue since the beginning, and consequently can't use IMAP search. Still trying to pinpoint the problem, but it is definitely having an impact.
",tilsammans,2014-01-12 23:23:55
115,2014-02-03 20:40:28,"Signal 6 means that an process called abort() This means an error was anticipated and the program killed itself. Probably not a memory problem. You said that this happens regulary. Does it happen at specific intervals?
",do3cc,2014-01-12 23:23:55
115,2014-09-09 17:21:31,"/var/log/tomcat6/catalina.out usually has clues.  The segfault happens in conjunction with a 500 from Solr.  I've had two different problems here.
",bigfleet,2014-01-12 23:23:55
115,2014-09-09 17:49:25,"For me, the solution is to comment out [this line](https://github.com/al3x/sovereign/blob/master/roles/mailserver/files/etc_solr_conf_solrconfig.xml#L1576).
",bigfleet,2014-01-12 23:23:55
114,2013-12-26 14:16:34,"Mozilla developed an email server settings autoconfig standard, it's supported well be thunderbird and a few other mail clients:

https://developer.mozilla.org/en-US/docs/Mozilla/Thunderbird/Autoconfiguration

This might help if it can be used to generate a static config (It may be too complicated for sovereign's purposes):

http://automx.org/en/
",JasperWallace,2014-08-08 16:33:44
114,2014-01-28 19:55:53,"Can you provide an example config file?
",do3cc,2014-08-08 16:33:44
114,2014-05-05 01:41:07,"https://developer.mozilla.org/en-US/docs/Mozilla/Thunderbird/Autoconfiguration/FileFormat/HowTo
https://wiki.mozilla.org/Thunderbird:Autoconfiguration:ConfigFileFormat
and
https://autoconfig.thunderbird.net/v1.1/freenet.de
",the-solipsist,2014-08-08 16:33:44
113,2013-12-25 04:31:23,"Adds an RSS reader role. This addresses issue #5.

I decided to use selfoss for this role because it works and because it doesn't add any dependencies (e.g. Feedbin requires Postgres). I'd be happy to hear arguments for other services.

There are no tests yet, but I am happy to add any you recommend. Please let me know if there are any style issues.
",brucespang,2013-12-26 20:48:38
113,2013-12-26 19:20:05,"Very nice work. Style is excellent. :)

A simple test would be good, just to ensure the app is responding to http requests. You can copy `test_owncloud_http` and adjust it slightly. Push that and then I‚Äôll merge.

Thanks!
",lukecyca,2013-12-26 20:48:38
113,2013-12-26 20:40:37,"Cool, I've added a test and updated the wiki with how to make it run.
",brucespang,2013-12-26 20:48:38
113,2013-12-26 20:53:16,"Thanks!
",brucespang,2013-12-26 20:48:38
112,2013-12-23 18:38:44,"The default owncloud web ui is unpleasantly slow. These commits make it somewhat faster:
- We add an expires header to static content of 2 weeks, which allows the browser to cache static content.
- We override PHP's expires header so that it's not [set to 1981](http://stackoverflow.com/questions/8194481/why-is-expires-1981), which helps with caching.
- We compress responses with gzip.

This update also fixes some problems with the owncloud tasks:
- it doesn't update the cache when installing the owncloud package, since updating takes forever and should be done by another role.
- It adds a previously-missing restart notification for when the owncloud apache configuration changes.
",brucespang,2013-12-23 19:05:24
111,2013-12-22 23:34:59,"Maybe this is expected, but I am unable to access the ""blog"" URL on the vagrant test machine. Browsing to `sovereign.local` or `www.sovereign.local` results in the following message (in Safari):

<S_CODE_TOKEN>

This is what's in my `/var/log/apache2/error.log` file (after restarting apache):

<S_CODE_TOKEN>

None of the other apache logs show any information. I'm sure I have my hosts file configured correctly and mail.sovereign.local loads up Roundcube perfectly. 

I would like to be able to test the blog URL to make sure it's loading which will help me work on an Apache virtual host issue I'm trying to solve. Thanks!
",robfeldmann,2015-06-09 00:36:27
111,2013-12-26 18:02:03,"I think this is a problem with how I created the included self-signed cert. It has a Common Name of `*.sovereign.local`, but that‚Äôs not enough to make it work with `sovereign.local`. It also needs to have the Subject Alternative Name extension to work with both forms.

If you‚Äôre able to look into adding this to our testing cert, that would be most helpful.
",lukecyca,2015-06-09 00:36:27
111,2014-01-13 00:46:49,"This isn‚Äôt fixed yet, but I have the beginnings of a fix in my local repo.
",lukecyca,2015-06-09 00:36:27
111,2015-06-09 00:36:27,"Not going to get to this, unfortunately. This is such a minor issue that I am just going to close it.
",lukecyca,2015-06-09 00:36:27
111,2015-06-13 07:45:17,"I hope we can get rid of those expensive wildcard certificates soon and replace them with a bunch of free ""lets-encrypt""-certs.
",neuhaus,2015-06-09 00:36:27
110,2013-12-21 21:29:28,"Perhaps a lot to ask, but these are awesome.

We recently launched galaxy.ansibleworks.com.

Would you be interested in splitting the parts into different repos and uploading to galaxy?   The main project could then just slurp in the roles using the CLI like in a setup.sh:

ansible-galaxy install app1 app2 app3

Not sure if this interesting or not but I know you have some great content so I thought I would ask.  (Free free to close this ticket, it was just an easy way of suggesting).

Thanks!
",mpdehaan,2014-08-01 20:59:54
110,2013-12-29 00:27:39,"I‚Äôm keen to integrate with Galaxy.

Sovereign is gaining new functionality at a good rate, and we really need a better way for users to pick and choose the functionality they want. Right now this is accomplished by commenting out roles, but Galaxy is a prettier solution.

We also have talked about dockerizing our various components. @knitatoms, how would Galaxy affect this effort?
",lukecyca,2014-08-01 20:59:54
110,2014-02-02 21:29:35,"@mpdehaan Thanks for the heads-up re: Galaxy. I've tried out a few of the roles there and I can see it being a very useful resource. (Great work with the Ansible re-branding BTW).

As @lukecyca says I've been investigating how to 'Dockerise' Sovereign. This is currently a work in progress (see #99). The plan is to host Docker images for components of Sovereign on a Docker registry. These will be updated when application updates are available and can then be pulled by each Sovereign server. Ansible will still be an important part of this process but the roles will  be much simpler as most of the configuration will then be in Docker containers.

It would be possible to put the relevant roles on Galaxy but I'm not sure if these would be that useful to other Galaxy users?

With regard to making it easy for Sovereign users to choose which applications to install, I'm currently of the opinion that commenting out roles is a reasonable approach given the target demographic of Sovereign. I can't see how Galaxy would make this any easier or more elegant. (But I might be missing something!)

Any thoughts / suggestions gratefully received.
",keybits,2014-08-01 20:59:54
110,2014-02-02 22:25:21,"The roles could be much more modular. I'm not even sure that commenting out works in all cases --- at minimum you have to keep `common` in there.

I'm not sure how docker would interact with the encfs directory (which matters for dovecot and owncloud, I think). Getting things more modular / Galaxy compliant might be a useful preliminary step before dockerizing.
",ariddell,2014-08-01 20:59:54
110,2014-02-02 22:35:10,"Good points. I agree about improving modularity and have been making some progress on what needs to be done for that. My experience with trying to install a 'personalised' version of Sovereign was definitely painful due to lack of modularity.

Re: encfs: You're right that Docker doesn't support encfs. I'm about to experiment with storing user data via Docker volumes on `/decrypted`.  As this is outside of the container I'm hoping it will work. 
",keybits,2014-08-01 20:59:54
110,2014-02-02 23:48:07,"""It would be possible to put the relevant roles on Galaxy but I'm not sure
if these would be that useful to other Galaxy users?""

Basically users would be writing their own playbooks, and could mix and
match what they wanted to install.

""With regard to making it easy for Sovereign users to choose which
applications to install, I'm currently of the opinion that commenting out
roles is a reasonable approach given the target demographic of Sovereign. I
can't see how Galaxy would make this any easier or more elegant.""

Basically it expands reach so the content can be used without having to
know about your github repo.

On Sun, Feb 2, 2014 at 5:35 PM, Tom Atkins notifications@github.com wrote:

> Good points. I agree about improving modularity and have been making some
> progress on what needs to be done for that. My experience with trying to
> install a 'personalised' version of Sovereign was definitely painful due to
> lack of modularity.
> 
> Re: encfs: You're right that Docker doesn't support encfs. I'm about to
> experiment with storing user data via Docker volumes on /decrypted. As
> this is outside of the container I'm hoping it will work.
> 
> ## 
> 
> Reply to this email directly or view it on GitHubhttps://github.com/al3x/sovereign/issues/110#issuecomment-33915492
> .
",mpdehaan,2014-08-01 20:59:54
110,2014-02-03 20:50:28,"I see one issue with the galaxy functionality as it works right now. I cannot define which version of a role I want. As such if sovereign would use galaxy roles without checking them into this repo, it would be impossible to help people who are having problems with these roles.
",do3cc,2014-08-01 20:59:54
110,2014-02-20 16:03:50,"I have to correct myself. One can define a version by ansible-galaxy install <username>.<role>,v<version>
Does not look too nice but for sure works.
",do3cc,2014-08-01 20:59:54
110,2014-02-20 16:06:09,"You can also have a file with ""-r"" to ansible-galaxy that lists

username.rolename,version
username.rolename2,version

And it basically works like a requirements file

On Thu, Feb 20, 2014 at 11:03 AM, Patrick Gerken
notifications@github.comwrote:

> I have to correct myself. One can define a version by ansible-galaxy
> install .,v
> Does not look too nice but for sure works.
> 
> ## 
> 
> Reply to this email directly or view it on GitHubhttps://github.com/al3x/sovereign/issues/110#issuecomment-35636861
> .
",mpdehaan,2014-08-01 20:59:54
110,2014-02-20 16:06:19,"forgot about this earlier

On Thu, Feb 20, 2014 at 11:06 AM, Michael DeHaan
michael.dehaan@gmail.comwrote:

> You can also have a file with ""-r"" to ansible-galaxy that lists
> 
> username.rolename,version
> username.rolename2,version
> 
> And it basically works like a requirements file
> 
> On Thu, Feb 20, 2014 at 11:03 AM, Patrick Gerken <notifications@github.com
> 
> > wrote:
> > 
> > I have to correct myself. One can define a version by ansible-galaxy
> > install .,v
> > Does not look too nice but for sure works.
> > 
> > ## 
> > 
> > Reply to this email directly or view it on GitHubhttps://github.com/al3x/sovereign/issues/110#issuecomment-35636861
> > .
",mpdehaan,2014-08-01 20:59:54
110,2014-03-26 00:37:52,"If you do create galaxy roles, please keep them packet manager agnostic (this is pretty simple) so they could be reused by others. 
",kalkin,2014-08-01 20:59:54
110,2014-07-14 16:07:33,"I still cant really see what the benefit of Galaxy is to role collections like sovereign. For starters the roles tend to be interdependent, putting them on Galaxy would likely require increasing role complexity to deal with that, suddenly they have to work inside _and_ outside of a Sovereign server.

@mpdehaan ""Basically users would be writing their own playbooks""
The whole point of projects like Sovereign is that you _don't_ have to do that, it's a library of roles _and_ associated plays. A bit of setup, tweak a few variables, run the play. Done. Skip the hunting down suitable roles in Galaxy entirely.

I also think commenting or uncommenting roles in plays is a perfectly suitable way to go ‚Äì most config files on unix based systems already work like that ;)
",adrinux,2014-08-01 20:59:54
110,2014-07-14 16:10:04,"FWIW, ansible-galaxy CLI already takes a requirements file that will
download all deps from github.

No hunting required.

On Mon, Jul 14, 2014 at 12:07 PM, Adrian Simmons notifications@github.com
wrote:

> I still cant really see what the benefit of Galaxy is to role collections
> like sovereign. For starters the roles tend to be interdependent, putting
> them on Galaxy would likely require increasing role complexity to deal with
> that, suddenly they have to work inside _and_ outside of a Sovereign
> server.
> 
> @mpdehaan https://github.com/mpdehaan ""Basically users would be writing
> their own playbooks""
> The whole point of projects like Sovereign is that you _don't_ have to do
> that, it's a library of roles _and_ associated plays. A bit of setup,
> tweak a few variables, run the play. Done. Skip the hunting down suitable
> roles in Galaxy entirely.
> 
> I also think commenting or uncommenting roles in plays is a perfectly
> suitable way to go ‚Äì most config files on unix based systems already work
> like that ;)
> 
> ‚Äî
> Reply to this email directly or view it on GitHub
> https://github.com/al3x/sovereign/issues/110#issuecomment-48919743.
",mpdehaan,2014-08-01 20:59:54
110,2014-07-15 10:33:17,"I see. But still every role ends up in its own git repo? It seems harder to manage as a project that way, with little, if any, gain for the project. Galaxy has its purpose, but I don't think it fits projects like this.
",adrinux,2014-08-01 20:59:54
110,2014-08-01 20:59:54,"This issue has been open a long time. I'd like to resolve it.

I'm inclined to agree with @adrinux. For better or worse, the components of Sovereign are fairly coupled. I'm not sure that breaking them into Galaxy roles would make life better for Sovereign users or developers, and I'm not sure those roles would have much use to anyone trying to use them outside of Sovereign's context.

Also, Galaxy is still in beta. I've already spent many hours on Sovereign and I'd prefer not to spend my time refactoring its roles against an API that may yet change.
",al3x,2014-08-01 20:59:54
110,2014-08-02 19:06:59,"Fair enough, this was originally opened to just be a suggestion.

(The beta is mostly just a label - nothing is really changing in any
greatly significant ways soon, we just have to remove the sticker)

On Fri, Aug 1, 2014 at 5:00 PM, Alex Payne notifications@github.com wrote:

> This issue has been open a long time. I'd like to resolve it.
> 
> I'm inclined to agree with @adrinux https://github.com/adrinux. For
> better or worse, the components of Sovereign are fairly coupled. I'm not
> sure that breaking them into Galaxy roles would make life better for
> Sovereign users or developers, and I'm not sure those roles would have much
> use to anyone trying to use them outside of Sovereign's context.
> 
> Also, Galaxy is still in beta. I've already spent many hours on Sovereign
> and I'd prefer not to spend my time refactoring its roles against an API
> that may yet change.
> 
> ‚Äî
> Reply to this email directly or view it on GitHub
> https://github.com/al3x/sovereign/issues/110#issuecomment-50934173.
",mpdehaan,2014-08-01 20:59:54
109,2013-12-21 18:48:03,"Use the changed `mail_virtual_users` structure to ensure directories and sieve rules are created for each defined account.
",bryanjswift,2013-12-21 20:01:38
109,2013-12-21 19:06:04,"I just saw the Travis CI build doesn't run the tests. For what its worth here's the output of running them locally with a newly provisioned machine setup by Vagrant with the VirtualBox provider.

<S_CODE_TOKEN>
",bryanjswift,2013-12-21 20:01:38
109,2013-12-21 19:59:59,"I thought I had honestly, clearly I only removed it from `testing.yml`
",bryanjswift,2013-12-21 20:01:38
109,2013-12-21 20:01:41,"Looks good to me. Thanks for the contribution!
",lukecyca,2013-12-21 20:01:38
109,2013-12-21 20:03:18,"My pleasure. Thanks for your work maintaining this!
",bryanjswift,2013-12-21 20:01:38
108,2013-12-19 02:26:34,"This pull request adds Z-Push to allow for mobile push notifications via ActiveSync/Exchange (something I really wanted). Before this I was using d-push successfully for about 20 days or so. However, the Debian 7 d-push is a bit behind Z-Push and doesn't allow syncing HTML email (thus, all mobile emails were in plain text). So instead I switch to z-push and not only is it faster, but now pushed emails are in HTML.

The only major limitation of z-push (and d-push) is that you cannot have multiple accounts syncing on the same device to a single server. It looks like this is/was in the plans to be able to support but has not, yet, been implemented. Of course, you can still have unlimited accounts configured the normal IMAP way on a single device.

This is using the latest release of z-push (version 2.1.1-1788) which was released on November 30th.

I've also included a bit in the README explaining z-push and how to configure it.
",robfeldmann,2013-12-29 00:15:29
108,2013-12-29 00:15:29,"Merged on the command line.

Thanks for the contribution!
",lukecyca,2013-12-29 00:15:29
107,2013-12-17 20:17:20,"Web interface listens on localhost only.
The web interface is needed for polling the monit status from the console via

<S_CODE_TOKEN>
",do3cc,2013-12-17 20:19:49
106,2013-12-17 19:33:16,"The tests failed for me so I tried to understand why and stumbled over duraconf, from which I quickly added some configurations.
I still don't understand though, why postfix now uses Elliptic Curve keys and where this gets configured.
",do3cc,2013-12-30 00:13:34
106,2013-12-17 20:18:09,"This looks great. Thanks!

I‚Äôm not sure why the tests would have failed for you. What version of OpenSSL and Python do you have on your machine (the machine running the tests).

I wasn‚Äôt aware of [duraconf](https://github.com/ioerror/duraconf) ‚Äî¬†good find. I want to be very sure of these new settings before merging. I think we want to continue to accept mail from all servers, regardless of what ciphers they support or even whether they support TLS at all. I think it would be acceptable to require high-security ciphers, as long as we gracefully fall back to unencrypted for servers that fail to negotiate one.

Are you using this on your own mail server already? What kinds of ciphers have you seen negotiated with other mail servers?
",lukecyca,2013-12-30 00:13:34
106,2013-12-17 20:36:44,"Hi,

I am using the debian from the provided fabfile. Here are my versions:

<S_CODE_TOKEN>

I am not using sovereign yet on a real server, I was just getting an idea of how it works so far.
",do3cc,2013-12-30 00:13:34
106,2013-12-17 20:39:37,"Can you also post the versions of python/openssl on your host machine (your laptop, for example)? I‚Äôm interested to know about the environment from which you run `nosetests`.
",lukecyca,2013-12-30 00:13:34
106,2013-12-17 23:43:26,"Here we go, I am using a virtualenv with a self compiled python.
I tried to look if I can import ssl in an interactive python interpreter and introspect his protocol preferences, but without success.

<S_CODE_TOKEN>
",do3cc,2013-12-30 00:13:34
106,2013-12-30 00:13:34,"That‚Äôs our problem. You are using OpenSSL 1.0.1e and I am using 0.9.8y which is what comes standard with OS X Mavericks. The HMAC ECC ciphersuites from [RFC5289](http://tools.ietf.org/search/rfc5289) were [added in version 1.0.1](http://www.openssl.org/news/changelog.html). So nothing changed in Sovereign, just in the client from which the tests are run.

Let‚Äôs change the assert to look for `DHE-RSA-AES256-SHA (256/256 bits)` and then they‚Äôll both match. In retrospect this assertion is quite brittle because it depends on what is negotiated by the client, but I think this solution will be effective for now.

With regards to the duraconf changes in postfix, I‚Äôm not comfortable merging those without more research and some testing in the wild. My concern is breaking interoperability with other MTAs. If you are keen to look into it in more detail and submit a new PR, that would be awesome and I would be happy to pitch in.
",lukecyca,2013-12-30 00:13:34
106,2014-01-01 17:42:55,"@lukecyca I understand, thanks and I will try it.
",do3cc,2013-12-30 00:13:34
105,2013-12-12 22:46:18,"I just ran sovereign on an empty DigitalOcean VPS, and it completed successfully.
Most everything was fine, but the mailserver SQL database was empty. It seems that the generated import.sql placed in /etc/postfix either wasn't imported, or there was a silent failure during its import. I ran ansible again, and it completed successfully, but the database was still empty.

As a workaround, I added
    use mailserver;
to the beginning of /etc/postfix/import.sql, and ran
    mysql -u mailuser -p < import.sql 
to manually import it. 

Things appear to work fine beside this issue.
",catern,2014-01-12 23:08:45
105,2013-12-17 20:37:09,"Thanks for reporting this, @catern.

Did you run it all at once? Or did you by chance do it in batches (interrupting and restarting it)?

I ask because the [task that copies the import.sql into place](https://github.com/al3x/sovereign/blob/master/roles/mailserver/tasks/postfix.yml#L20) notifies a handler to run the import. If you interrupt the playbook before that handler runs, it won‚Äôt import. Worse, the task won‚Äôt notify the handler on subsequent runs of the playbook because the import.sql file already be there.

You could test this by deleting `/etc/postfix/import.sql` on your server, and re-running the playbook. You should see it copy the file over again _and_ import it a little later in the playbook.

Assuming that‚Äôs the case, we could improve this by forcing the handler to run right after the copy.
",lukecyca,2014-01-12 23:08:45
105,2013-12-17 20:42:08,"I can confirm this issue.

I've ran all the tasks at once. /etc/postfix/import.sql was generated, but not imported. I worked around the problem by importing it manually.
",brucespang,2014-01-12 23:08:45
105,2013-12-17 21:09:23,"I didn't interrupt the playbook myself (although the vpn and tarsnap roles were commented out, and thus their tasks did not run, so I couldn't say I ran all the tasks). However, the playbook did fail and halt at starting ufw. I restarted it immediately after and it ran normally from that point. (I think this was not an issue with sovereign but my VPS). I suppose this wouldn't have an effect since the mailserver tasks would run after the common tasks.

If the import is done by a handler which can be prevented from being run by a failure in other parts of sovereign, that's not very fault tolerant. Perhaps on every run a task could check if the relevant tables are present, and trigger the handler to perform the import if they are not.
",catern,2014-01-12 23:08:45
105,2013-12-18 01:03:54,"We‚Äôve had a lot of trouble with ufw, particularly on DigitalOcean for some reason. I guess that‚Äôs a separate issue. Any insight into that would be much appreciated! If you have any, please open a new issue.

> If the import is done by a handler which can be prevented from being run by a failure in other parts of sovereign, that's not very fault tolerant.

I believe that‚Äôs just how Ansible works. The best we can do is [flush the handlers](http://www.ansibleworks.com/docs/playbooks.html#id12) immediately after this task so that it runs right away. The reason it‚Äôs a handler and not a task is so that it only runs if the `import.sql` file has actually changed.

A far simpler solution may be to use postfix flat files instead of a MySQL database.
",lukecyca,2014-01-12 23:08:45
105,2014-01-02 02:55:53,"I've had problems with this as well though I knew the import failed as I got the following error when the import was attempted. I was able to execute import.sql manually (after checking for syntax errors) without any alterations so I'm not clear why this failed. I was able to re-run the playbook and have it complete successfully after the failure because the import handler didn't run again.

<S_CODE_TOKEN>
",bryanjswift,2014-01-12 23:08:45
105,2014-01-12 23:08:45,"@bryanjswift: we just merged a pull request that moves Sovereign from MySQL to PostgreSQL. Could you please see if you have the same issue on Postgres and, if so, reopen with any diagnostic output? Thanks!
",al3x,2014-01-12 23:08:45
104,2013-12-12 22:40:08,"mail_virtual_xx list were not use correctly in tasks.

We got error 'unicode object' has no attribute 'name' because:
with_items:
- ""{{ mail_virtual_xx }}
  is understood has a list of strings containing information extracted from {{ mail_virtual_xx }} variable
  
  Now we use:
   with_items: virtual_domain_xx}}""
",bcachet,2013-12-12 22:45:27
104,2013-12-12 22:46:12,"Thanks!

I got this error today too, but it went away when I upgraded to Ansible 1.4.1. Either way, the syntax in your fix is much nicer.
",lukecyca,2013-12-12 22:45:27
104,2013-12-13 07:00:12,"Glad to help

On 12.12.2013 23:46, Luke Cyca wrote:

> Thanks!
> 
> I got this error today too, but it went away when I upgraded to
> Ansible 1.4.1. Either way, the syntax in your fix is much nicer.
> 
> ‚Äî
> Reply to this email directly or view it on GitHub
> https://github.com/al3x/sovereign/pull/104#issuecomment-30469963.
",bcachet,2013-12-12 22:45:27
103,2013-12-08 10:40:28,"I installed on 32-bit debian, dspam can't find

<S_CODE_TOKEN>

because it is in

<S_CODE_TOKEN>

which leads to postfix rejecting incoming mail.

Either the README should state 64-bit as a prerequisite or ansible could configure this path depending on the platform (if it _can_ do it, I don't know it very well).
",mye,2013-12-09 23:12:53
102,2013-12-08 03:22:00,"Based on a playbook from https://github.com/phred/5minbootstrap, this is part of the ""first 5 minutes on a server"" blog post suggestion. A daily summary of server events from logs are e-mailed to the main_user_name variable. 
",cji,2013-12-09 19:51:37
101,2013-11-30 04:34:44,"Addresses #95

These are the changes necessary to enable Roundcube's manage sieve plugin to mange server-side sieve filters. I carefully followed the Dovecot + Roundcube instructions here: ISPmail tutorial for Debian Wheezy (https://workaround.org/ispmail/wheezy/) and made only the relevant changes that differed to get this working.

Also, I enabled Dovecot's autocomplete plugin to auto create and subscribe basic mail folders for each account so they appear right away in mail clients (only tested using Apple's Mail.app on Mac/iOS). These are: Drafts, Sent, Junk, Trash and Archive.
",robfeldmann,2013-12-01 16:43:29
101,2013-12-01 16:43:33,"Very nice. Thank you.
",lukecyca,2013-12-01 16:43:29
100,2013-11-26 22:31:00,"Of course we should connect via ssl/tls to freenode.
",ariddell,2013-11-27 00:35:59
99,2013-11-26 02:54:45,"Rather than installing each service directly on the machine, we should dockerize some or all of them. This would allow the services to better coexist with other customizations people make on their server.

This may require switching to Ubuntu as the supported distro.
",lukecyca,2015-02-25 18:50:58
99,2013-12-30 18:03:35,"+1
",anildigital,2015-02-25 18:50:58
99,2013-12-31 23:22:22,"FYI, the Docker folks still aren't recommending it for production. Some of the changes they have planned are significant...
",ariddell,2015-02-25 18:50:58
99,2014-02-02 21:12:14,"I've finally had some time to seriously investigate how this approach would work with Sovereign. I have most of the pieces in place.

The main stumbling block at the moment is waiting for Ansible to support container naming and linked containers. There's a [PR for this](https://github.com/ansible/ansible/pull/5639) which will hopefully get included in the next Ansible release.

As mentioned above Docker still isn't production ready and in my testing I get quite a lot of unpredictable behaviour. I'll update here with how things progress when new versions of Docker are released.
",keybits,2015-02-25 18:50:58
99,2014-05-17 10:45:42,"How would this affect memory and disk space requirements?
",neuhaus,2015-02-25 18:50:58
99,2014-06-27 00:30:22,"@knitatoms The Ansible PR you linked to back in February has now been closed. Any chance we'll see your Docker work?
",al3x,2015-02-25 18:50:58
99,2014-07-02 21:23:22,"@al3x Apologies for the lack of updates on this. With current commitments I don't see me being able to take this forward.

It's incredible to see how far Docker has come, and the tooling and stability definitely makes this much more feasible than six months ago. Hopefully someone else may take up the challenge.
",keybits,2015-02-25 18:50:58
99,2014-07-03 12:29:35,"For what it's worth Docker is production ready now. 
",denibertovic,2015-02-25 18:50:58
99,2014-07-03 12:29:40,"@neuhaus No disk/memory overhead worth mentioning imho.
",denibertovic,2015-02-25 18:50:58
99,2015-02-25 18:50:58,"""Dockerizing"" Sovereign has been discussed a number of times, but there doesn't seem to be much active interest in it. Docker and related container technologies are still a moving target, with competing standards and tools still emerging. It currently doesn't seem like a stable base for a ""set it and forget it"" personal cloud.
",al3x,2015-02-25 18:50:58
99,2015-03-04 08:30:08,"@denibertovic I started using Docker at work and ran into several severe bugs, I'm glad it's postponed for now. I wouldn't call it anywhere near production ready.
",neuhaus,2015-02-25 18:50:58
99,2015-03-05 06:33:04,"I would really love to see this, or something else to isolate / containerize everything.  If a particular service is compromised the exposure would be lessened.

Maybe chroots for some things instead?  
",qmr,2015-02-25 18:50:58
99,2015-03-05 10:05:50,"@neuhaus I'm using it everywhere...and haven't had issues. 
",denibertovic,2015-02-25 18:50:58
99,2015-12-10 10:51:02,"+1
Dockerising (deploying from personal docker registry) should make it easier to manage incremental changes to separate components, and forward migration easier...
",timoc,2015-02-25 18:50:58
99,2015-12-10 13:16:42,"Docker would help in certain aspects, however, it would also complicate things. Currently, you can just log into your box running all these services and keep packages up-to-date regarding security fixes with a single ""apt-get update; apt-get upgrade"". Docker will make this more complicated.
",neuhaus,2015-02-25 18:50:58
98,2013-11-26 02:51:42,"I'm getting about a dozen emails per day telling me that a particular IP has been banned. I don't see much use in these, so I think we should stop sending them.
",lukecyca,2014-01-06 03:35:37
98,2013-11-28 04:03:57,"Huh, interesting. I've never received one, but I imagine it might be an annoyance. We can disable them by default as long as the IP is being logged, I think.
",al3x,2014-01-06 03:35:37
98,2013-12-17 20:38:37,"An alternative might be to switch the standard ssh port to something else. This should also reduce logging attempts. On stratoservers I used to see failed loggings every few days.
",do3cc,2014-01-06 03:35:37
98,2014-01-06 03:35:37,"Fixed by @markpasc in #124.
",lukecyca,2014-01-06 03:35:37
97,2013-11-22 23:28:59,"I asked the author about pulling some of this post:

http://lattejed.com/first-five-and-a-half-minutes-on-a-server-with-ansible

into a role for this project.  I expect to replicate whats in Step 3. Getting Started in the readme for Sovereign and these steps from the blog post:
- Update & upgrade the system via apt-get
- Install fail2ban to block ssh brute-force attempts
- Create a new user so we don't have to use root
- Copy over our pub key
- Lock down sudo
- Lock down ssh to prevent root & password login
- Configure unattended security upgrades

It would ease new user setup and address #92 

I've got time to work on it this weekend and can send a pull request if that's the kind of thing you're in to for this project.  Lemme know. 
",pdebruic,2014-01-12 23:16:44
97,2013-11-22 23:30:09,"I recommend something like ossec over fail2ban, since it encompasses many things. 
",stephenjamieson,2014-01-12 23:16:44
97,2013-11-23 01:13:54,"@pdebruic that would be awesome. Let me know if I can lend a hand.
",lukecyca,2014-01-12 23:16:44
97,2013-11-28 15:54:07,"If it helps, I thought about adding something like this to sovereign. I figured it'd be out of scope for this project and created my own Ansible project: https://github.com/PajamaSoft/5-min-bootstrap

You are welcome to check it out and either contribute or work what I've started into this project.
",robfeldmann,2014-01-12 23:16:44
97,2013-11-29 03:26:50,"@PajamaSoft Your playbook seems great, but it seems like we've got 90% of it in Sovereign already. Was there anything in particular that you did in your playbook that was missing from what we've got here?
",al3x,2014-01-12 23:16:44
97,2013-11-29 15:30:54,"@al3x That's a good question. It seems I did the following in my playbook that are not currently present in sovereign:
- Explicitly setting the server's timezone
- Installing and configuring unattended-upgrades for security updates (would address issue #92)
- Deploy/main_user_name user configured for passwordless sudo
  - Following sovereign's ""prep the server"" instructions, my playbook creates that user, sets up the ssh keys, and configures passwordless sudo. 
  - For this to work, `sshpass` is needed so ansible can run as root using the `--user root --ask-pass` parameters. I have instructions on how to install this via homebrew in my readme.
- Configure logwatch to email daily server logs

I'm happy to add these to sovereign somewhere in the custom role (??) and submit pull requests if you'd like.
",robfeldmann,2014-01-12 23:16:44
97,2013-12-17 20:51:14,"- We got logwatch in #102.
- Unattended Upgrades has an open issue already: #92 (contribution welcome)

@PajamaSoft: I like your suggestion of providing a means to bootstrap the deploy user, and also to set the timezone. If it can slim down the manual steps in the README, that would be great. Please submit a PR if you‚Äôre so inclined. The common role is indeed where those would belong.

@stephenjamieson: `ossec` would be awesome. If you‚Äôre interested in working on that, open a new issue for discussion, or just submit a PR.

@pdebruic: I believe everything else is already in Sovereign. Have I missed anything?
",lukecyca,2014-01-12 23:16:44
96,2013-11-19 06:32:57,"Some VPS providers do not use eth0 by default, which prevents the MASQUERADE iptables rule from being set properly. This can also be an issue on a dedicated server that has multiple network interfaces.
",jlund,2013-11-19 15:40:52
95,2013-11-18 12:19:26,"I've been trying to enable the managesieve plugin of Roundcube which provides a decent GUI for managing server-side filters or rules. So far I've been unsuccessful as I get an ""Unable to connect to server"" error message in Roundcube no matter what I try. This post sums up the issue pretty nicely: http://www.sunfinedata.com/tutorial/enable-the-managesieve-of-dovecot-and-use-it-in-roundcubemail/, though it did not solve the problem.

This should probably be tagged as an 'enhancement' request. If anyone can get this working or help me figure this out I'd be grateful!
",robfeldmann,2013-12-01 16:51:37
94,2013-11-18 00:05:59,"Turns out it should be in the tarsnap role, not common. :)
",jimrollenhagen,2013-11-18 00:11:49
94,2013-11-18 00:11:54,"My bad ‚Äî¬†thanks!
",lukecyca,2013-11-18 00:11:49
93,2013-11-17 21:10:59,"Add a comment to each variable in vars/defaults.yml and vars/user.yml to explain what it does and how to use it.
",lukecyca,2014-06-30 21:21:38
93,2014-06-30 21:21:38,"Six months later, I think the current level of commenting is sufficient. :)
",lukecyca,2014-06-30 21:21:38
92,2013-11-17 21:02:26,"Automatically installs security patches:
https://help.ubuntu.com/community/AutomaticSecurityUpdates
",lukecyca,2014-01-14 16:18:36
91,2013-11-16 21:28:11,"Without the owner being set to vmail and dovecot, when a virtual user
tries to access their mail account, dovecot throws an error that it does
not have permission to create the mail folder for the user.

With the owner and permissions being set the user's mail directory is
created and they can successfully sign in.
",ssoriche,2013-11-17 17:43:37
91,2013-11-16 23:36:57,"Thanks for this fix. Could you split this into a separate task from the one above it? A task with two modules like this causes Ansible to ignore the first, I believe.
",lukecyca,2013-11-17 17:43:37
91,2013-11-17 00:04:48,"It worked correctly in my local environment, but I separated the task as requested.

I also moved it before the creation of the primary id directories. Logically it makes sense to me that the higher level directory task comes before a subdirectory task.
",ssoriche,2013-11-17 17:43:37
91,2013-11-17 17:43:47,"Excellent. Thanks very much.
",lukecyca,2013-11-17 17:43:37
90,2013-11-14 02:47:51,"I seem to be having an issue with the following line in site.yml:

<S_CODE_TOKEN>

I will occasionally get an 'undefined variables' error when I am NOT running in any sort of testing mode. The following is but one example but I've seen a similar one while running the enfs tasks as well:

<S_CODE_TOKEN>

I am able to solve these errors if I comment out the aforementioned offending line (and add - vars/user.yml) such that site.yml looks like this:

<S_CODE_TOKEN>

Does anyone have any ideas on why this is happening?
",robfeldmann,2013-11-14 22:40:14
90,2013-11-14 06:35:20,"Try pulling the latest changes. That line should read:

<S_CODE_TOKEN>

If you continue to have troubles, let me know. You could also just replace it with `vars/user.yml` for the time being.
",lukecyca,2013-11-14 22:40:14
90,2013-11-14 16:41:59,"@PajamaSoft did pulling the latest changes fix this for you?
",lukecyca,2013-11-14 22:40:14
90,2013-11-14 16:47:24,"I will have to try this evening, as I'm only on iPad during the day while at work. But I am hopeful it will work and I'll let you know. Thanks!

‚ÄîRob

On Thu, Nov 14, 2013 at 11:42 AM, Luke Cyca notifications@github.com
wrote:

> ## @PajamaSoft did pulling the latest changes fix this for you?
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/al3x/sovereign/issues/90#issuecomment-28499660
",robfeldmann,2013-11-14 22:40:14
90,2013-11-14 22:40:14,"That appears to have fixed the issue. Thanks so much!
",robfeldmann,2013-11-14 22:40:14
89,2013-11-14 02:27:02,"When testing/using the development environment (VM), what is the email password for the ""sovereign@sovereign.local"" user? I see from the testing.yml file, the password line reads:

<S_CODE_TOKEN>

I'm not sure what the comment #foo refers to? It's not the password I don't think.

Am I supposed to change this myself?

Thanks!
",robfeldmann,2013-11-14 16:41:13
89,2013-11-14 06:43:43,"If you are testing/developing, you can use this account and the password should be ""foo"".

If you are deploying this for yourself, you should replace it with a new password hash according to the instructions in step 4 of the README.

I've recently added the testing vars to facilitate automated testing. If this is unintuitive or unclear, I appreciate the feedback on how to improve it.
",lukecyca,2013-11-14 16:41:13
89,2013-11-14 15:28:05,"The password ""foo"" does not work for me when attempting to log into Roundcube (mail.sovereign.local). That's why I suspected it wasn't the password. I didn't try any other way of logging in yet.

Otherwise, the testing vars and the ""foo"" comment are intuitive enough I think. Not sure why it isn't working though. These are very nice updates lately and way more intuitive than when I first started looking at this project. 
",robfeldmann,2013-11-14 16:41:13
89,2013-11-14 16:41:13,"I had the same problem, so I regenerated the hash. Perhaps I mis-copy-pasted it before.

Now I can log into Roundcube using ""sovereign@sovereign.local"" and ""foo"".
",lukecyca,2013-11-14 16:41:13
88,2013-11-10 20:11:43,"The number of days that a certificate will be considered valid is now a user-controlled variable and is set to five years by default. (Fixes Issue #87)
",jlund,2013-11-10 20:30:29
88,2013-11-10 20:37:13,"Nice, thanks @jlund.
",al3x,2013-11-10 20:30:29
87,2013-11-10 19:51:30,"The Server certificate remains valid for an extended period of time, but the rest of the certificates expire only 30 days after they were first generated. Flags need to be added to the certificate generation commands to prevent this from happening, and the number of days that a certificate will remain valid should be a user-configurable setting.
",jlund,2013-11-10 20:30:44
87,2013-11-10 20:23:47,"Once this gets merged, existing users who run into this issue can simply delete the files in /etc/openvpn on their Sovereign server and run the playbook again. This will generate brand new certificates with a five-year expiration date. After the OpenVPN service is restarted, and the new certificates are installed on your clients, you'll be back in business!

I apologize for not catching this during the rewrite. I had no idea that the default expiration date was so short until my phone stopped connecting yesterday :)
",jlund,2013-11-10 20:30:44
87,2013-11-10 20:30:43,"Looks great. Thanks!
",lukecyca,2013-11-10 20:30:44
86,2013-11-07 09:41:10,"- Add an openvpn_server variable
- Move `${openvpn_client}.{key,csr,crt}` to
  `${openvpn_client}/client.{key,csr,crt}`
- Generate `${openvpn_client}/${openvpn_server}.ovpn` config file
- Copy over a self contained directory of file per client that can be
  imported by networkmanager in ubuntu or run directly with `sudo
  openvpn ${openvpn_server}.ovpn`
",boothead,2013-11-11 20:25:19
86,2013-11-07 19:40:59,"Please fix the super minor formatting details and I'll happily merge. Thanks!
",al3x,2013-11-11 20:25:19
86,2013-11-11 20:26:52,"@boothead this is fantastic. Thanks!

Unfortunately I had made some other commits which were conflicting with this, but I've merged it manually. I also addressed @al3x's comments.
",lukecyca,2013-11-11 20:25:19
86,2013-11-11 20:33:35,"Yeah, sorry for my tardyness. I'm working up another couple of bits I need (pushing routes and dns servers to the client) and didn't quite get round to the tweaks. I'll issue another pull request for those (if you're interested) in the next day or so.
",boothead,2013-11-11 20:25:19
86,2013-11-15 01:28:47,"Awesome improvements, @boothead! It makes me incredibly happy that people are using this and now you've made it even easier. Nicely done. I love open source.
",jlund,2013-11-11 20:25:19
85,2013-11-06 15:49:36,"Server: http://trac.calendarserver.org
Client: http://agendav.org

Or there are many others to choose from:
- https://code.google.com/p/sabredav/
- http://baikal-server.com
- http://radicale.org
- http://en.wikipedia.org/wiki/Comparison_of_CalDAV_and_CardDAV_implementations
",lukecyca,2013-12-09 22:04:42
85,2013-11-18 15:18:29,"In my experience, OwnCloud is more standards-compliant than these other servers; better to stick with OwnCloud.
",catern,2013-12-09 22:04:42
85,2013-11-30 01:47:46,"-1
",jeffbr13,2013-12-09 22:04:42
85,2013-12-09 22:04:42,"Closing this for now. ownCloud still seems like the best bet.
",al3x,2013-12-09 22:04:42
84,2013-11-05 21:34:52,"I'm struggling slightly with what to do next with the files that end up in /tmp
",boothead,2013-11-05 22:21:22
84,2013-11-05 22:21:22,"Once again: https://gist.github.com/al3x/7327347. Please reopen if you need anything else. If an example configuration would help improve the documentation, please let us know. Thanks!
",al3x,2013-11-05 22:21:22
83,2013-11-03 16:33:48,"I've been working on an automated build scheme for ansible using [Vagrant](http://www.vagrantup.com).

Following [this post](http://keyholesoftware.com/2012/12/05/building_vagrant_boxes_with_veewee_on_travis/), I've tried to get it working on [Travis CI](https://travis-ci.org), but I've had no luck. It seems that this method [no longer works](https://groups.google.com/forum/#!topic/travis-ci/x7WGHb89DlE).

You can see my work thus far at https://github.com/lukecyca/sovereign/.

At this point I'm looking for input or other ideas. If I can't get it working on Travis or a similar service, I'll likely stand up a private [Jenkins](http://jenkins-ci.org) instance and run it there.
",lukecyca,2013-11-10 19:31:31
83,2013-11-05 01:51:06,"For a client, I've set up a very basic Ansible CI setup using [CircleCI](https://circleci.com/). Circle uses YAML files that define the steps necessary to set up a CI environment and run tests. My `circle.yml` file looks like:

<S_CODE_TOKEN>

The corresponding Rake namespace and task looks like:

<S_CODE_TOKEN>

There is also a `requirements.txt` file in the root of the repo that specifies the appropriate version of Ansible and any dependencies. CircleCI discovers this file and installs the necessary packages into a virtualenv.

Of course, all this does is guarantee that the playbooks are syntactically valid according to Ansible, but it's better than nothing.
",al3x,2013-11-10 19:31:31
83,2013-11-09 16:38:32,"@al3x: Here's a simple syntax check script. Go to Travis CI and enable this repo, then merge this PR.

I am familiar with Travis and it's free, but if you prefer Circle CI, I have no objections.

I would still like to do full testing on the playbook, but it will take more work to figure out so this will have to do for now.
",lukecyca,2013-11-10 19:31:31
82,2013-11-03 14:14:16,"Ran into a failure on Debian 7. Disabling logging (as originally suggested) on Debian 7 solves the problem.
",ariddell,2013-11-03 15:38:08
82,2013-11-03 15:38:08,"Thanks. Rather than merging directly, I combined with #80 and pushed a brand new changeset. Have a look and see that it fixes the issue you ran into. It works well for me on Debian 7.
",lukecyca,2013-11-03 15:38:08
81,2013-11-03 12:44:52,"I'm trying to write up how one generates a key and self-signs it. What should take the place of wildcard_ca.pem? Should it be just another copy of the .crt (again, in the event that one is self-signing). Or does one have to create a CA with its own private key?
",ariddell,2013-11-03 16:09:15
81,2013-11-03 15:34:19,"This has been working for me for testing...

<S_CODE_TOKEN>
",lukecyca,2013-11-03 16:09:15
81,2013-11-03 16:09:15,"That worked for me too.
",ariddell,2013-11-03 16:09:15
80,2013-11-03 09:37:56,"Please review it since I am ansible-illitterate. I attempted to write a fix based on the information I found here: http://www.ansibleworks.com/docs/playbooks_error_handling.html#id5

This should close issue #79.
",lbsnrs,2013-11-03 15:38:57
80,2013-11-03 15:38:57,"Thanks for reporting this. Rather than merge directly, I combined with #82 and pushed a new change set.

It should now work using the latest stable ansible release.
",lukecyca,2013-11-03 15:38:57
79,2013-11-03 09:07:12,"Commit f64ad6995076ddb484e83dc837627c371c2ae953 introducted the ""failed_when""  module variable which in turn has been added in ansible 1.4.

This causes an issue when running the playbooks with installations prior to 1.4 (for example, at the time I'm writing this, Homebrew is still sitting on ansible 1.3.3).
",lbsnrs,2013-11-03 15:39:54
79,2013-11-03 09:30:55,"Update: after some search it looks like ansible 1.4 is still in development and that the latest release at the time I write this is 1.3.4. The fix seems trivial, I'll try to fix it and open a pull request.
",lbsnrs,2013-11-03 15:39:54
79,2013-11-03 15:39:54,"See #80 
",lukecyca,2013-11-03 15:39:54
78,2013-10-30 17:50:19,"I think the recommended way to use vars these days is the {{var}} idiom rather than the ${var} idiom, so I used that.  And I used some extra carriage returns to make it easier to read.  Of course ""recommended"" and ""easier"" are subjective so feel free to reformat as you see fit.

this should address issue #77 
",pdebruic,2013-10-30 18:13:25
77,2013-10-30 15:24:11,"Would you like a PR that checks the SHA256 of the tarsnap download?
",pdebruic,2013-10-30 18:13:44
77,2013-10-30 15:37:54,"Yes, please!
",lukecyca,2013-10-30 18:13:44
77,2013-10-30 17:52:05,"not sure how to combine this issue and the PR I just sent which is issue #78 
",pdebruic,2013-10-30 18:13:44
77,2013-10-30 18:13:44,"Closed by #78.
",al3x,2013-10-30 18:13:44
76,2013-10-29 12:12:42,"In order to check the version of the linux distribution we need to
set `gather_facts` to True.

Closes #73.
",ariddell,2013-10-29 19:02:27
76,2013-10-29 15:16:47,"This gets rid of the error, but still doesn't set up ufw to start at boot. I would prefer conditionally calling `ufw logging off` on Debian 7. And then running `ufw --force enable` unconditionally. That way we would avoid the error altogether.

Since I'm the only one actually affected by this, I don't mind making the change, if everyone agrees on that solution.

@ariddell thanks for your help troubleshooting this by installing a whole new distro!
",lukecyca,2013-10-29 19:02:27
76,2013-10-29 18:13:16,"`ufw logging off` doesn't solve the problem for me.

<S_CODE_TOKEN>

But you're right -- my patch doesn't solve the problem because ufw will not be enable upon reboot.
",ariddell,2013-10-29 19:02:27
76,2013-10-29 18:14:01,"perhaps we should keep discussion on #73
",ariddell,2013-10-29 19:02:27
75,2013-10-28 00:44:07,,lukecyca,2013-10-28 00:51:20
74,2013-10-28 00:39:04,,lukecyca,2013-10-28 00:55:36
73,2013-10-27 22:14:43,"Following @ariddell's contribution, I switched my server to use `ufw` instead of `ferm`, and ran into this problem:

<S_CODE_TOKEN>

I logged in and ran it manually, and got a different error:

<S_CODE_TOKEN>

The firewall _is_ running and operating properly, but the `enable` command fails to mark itself as enabled in `/etc/ufw/ufw.conf`, so it fails to start at boot (which I think is a problem).

Upon further investigation, it seems there is a [bug](https://bugs.launchpad.net/ufw/+bug/1065297) whereby ufw logging is incompatible with our version of iptables. A fix has been committed, but it's not fixed in the version we're using (0.31.1-2). 

If we turn logging off, this bug goes away and the `enable` command works fully, but I'm not sure that's a good solution.
",lukecyca,2013-10-29 19:02:27
73,2013-10-27 22:45:50,"I admit I've been testing on Ubuntu 13.04. (Not out of any desire not to use Debian -- I just depend on python 3.3)

What about adding an `ignore_errors` that's pinned to the relevant version of ufw / iptables? I'm still of the opinion that `ufw` is worth switching to.
",ariddell,2013-10-29 19:02:27
73,2013-10-28 00:51:08,"Interesting. I switched my server over to it and didn't run into that issue.

+1 to @ariddell's suggestion of `ignore_errors` as a temporary solution.
",al3x,2013-10-29 19:02:27
73,2013-10-28 03:36:00,"@al3x: ansible may be skipping the task for you because the previous task checks if `ufw status` reports that it's running (which it is, depending on the timing). However, if you log in and try `/etc/init.d/ufw start` you may find that it skips it, which means it will also skip it on boot. If you run `ufw disable` and `ufw --force enable`, you should see the error. (If you don't, then I'm seriously mistaken in my assessment!)

Another workaround for us is to disable ufw logging by issuing a task to run `ufw logging off`. Logging is broken either way, but at least then it would start cleanly.
",lukecyca,2013-10-29 19:02:27
73,2013-10-28 19:54:58,"I'm not seeing the issue, for whatever reason:

<S_CODE_TOKEN>
",al3x,2013-10-29 19:02:27
73,2013-10-29 12:13:21,"I get the error on a clean install of Debian 7.2. I've implemented the proposed fix.
",ariddell,2013-10-29 19:02:27
73,2013-10-29 18:15:28,"Is this really what's supposed to happen? I have to run ufw --force enable _twice_?

<S_CODE_TOKEN>

But this does indeed solve the problem. What an ugly hack though.
",ariddell,2013-10-29 19:02:27
73,2013-10-29 18:28:42,"Fixed. I updated the PR #76 
",ariddell,2013-10-29 19:02:27
73,2014-05-11 17:04:57,"FYI, this irritated me so I figured it out for y'all.

It turns out that the default ufw before{,6}.rules for the version of ufw available for debian wheezy reference a logging target chain that has not been created yet (ipv6 given as example here);

<S_CODE_TOKEN>

This target chain is actually created in the auto-generated preamble to user{,6}.rules by ufw. There's an easy fix: forcibly create the chain in before{,6}.rules with a lineinfile directive.
",fluffle,2013-10-29 19:02:27
72,2013-10-27 17:08:13,,lukecyca,2013-10-27 21:01:14
71,2013-10-17 04:32:02,"Hello,

I'm not sure I understand the point of encfs, or perhaps how it is implemented:

If the machine is considered trusted, then what's the point of encryption (not considering possible loss here like a laptop because it is always remote anyway)?

If the machine is not trusted, it cannot be allowed access to the decryption key, and thus cannot decrypt email, etc.

Is everything here done in-browser/mail client on the fly? I guess not, since I don't know whether such technology exists today, and even so, it probably wouldn't be compatible with search...

Can you please explain either how encfs is used (if I misunderstood something) or its utility (if understood correctly)?

Thanks in advance!
",sprig,2013-10-17 05:25:26
71,2013-10-17 05:17:49,"The primary attack vector being protected here is against data at rest. Many of us run sovereign on VPS (virtual private servers) where the block devices are virtualized as files on a host system, or on some type of SAN. Someone with control of the host system could trivially make a copy of the block device and mount it. With EncFS, they would only see our encrypted files. Instead, they would need to attack our running system, which is certainly possible but much more difficult.

Note that the password for encfs is not stored on our system's disk, so it cannot mount during boot without manual intervention. Of course, you can simply run the sovereign playbook and it will mount it.
",lukecyca,2013-10-17 05:25:26
71,2013-10-17 05:25:26,"I see - so the encryption key is loaded into memory after boot by the user...

It would protect from the casual snooper I guess, but probably not from a determined attacker. Nevertheless...

Thanks!
",sprig,2013-10-17 05:25:26
71,2013-10-17 05:30:08,"Exactly. Security comes in layers. :)

That said, we would certainly welcome some more eyes on this system. Please do propose improvements.
",lukecyca,2013-10-17 05:25:26
71,2013-10-17 05:33:06,"I'm far from a security expert - or even a serious critic...

I will think about it however :)
",sprig,2013-10-17 05:25:26
71,2015-02-18 08:20:44,"Note that if you run sovereign on a VPS, the data on disk will be encrypted, however the ISP can run arbitrary commands inside your VPS, accessing it without you having any chance of detecting that or stopping him from doing so.
If you can't trust your ISP 100%, I strongly suggest you use a dedicated server instead of a VPS.
Remember, the ISP may be forced to retrieve data from your VPS against his will.
",neuhaus,2013-10-17 05:25:26
70,2013-10-13 16:56:08,"This pull request is an attempt to resolve https://github.com/al3x/sovereign/issues/65.

/cc @lukecyca
",hectcastro,2013-10-21 01:51:35
69,2013-10-12 17:20:13,"Closes #53
",ariddell,2013-10-21 01:58:59
69,2013-10-21 01:59:00,"Very nice, thank you!
",al3x,2013-10-21 01:58:59
68,2013-10-10 20:35:01,"Scripts used to rotate tarsnap backups exit when a command fails
Cron will catch that return code is not zero and will send message to root

No more silent failure
",bcachet,2013-10-21 01:52:49
68,2013-10-10 20:42:21,"Fantastic ‚Äî¬†thanks!
",lukecyca,2013-10-21 01:52:49
67,2013-10-10 19:53:02,"Add server_ip_address to vars/user.yml
",bcachet,2013-10-21 01:53:13
66,2013-10-09 01:50:44,"- OpenVPN setup is now fully automated. No configuration changes are necessary (though the defaults can easily be modified) and all manual command line steps have been eliminated.
- Removed the dependency on easy-rsa in favor of pure OpenSSL and OpenVPN commands that are executed by Ansible
- Improved the security of the OpenVPN configuration
  - Increased the default key size to 2048
  - RSA keys are only readable by root
  - The cipher and authentication digest are now configurable. If your client supports it, you can use AES-256-CBC and SHA256 instead of BF-CBC (Blowfish) and SHA1 which are the defaults. Or you can be a really cool, paranoid, crypto hipster and use CAMELLIA-256-CBC and SHA512 with an RSA key size of 4096.
  - Enabled ""HMAC firewall"" functionality using the tls-auth option and automated the generation of the 'ta' key that it depends on
  - The OpenVPN daemon becomes an unprivileged user after it starts
- Automated the retrieval of the files that clients will need in order to connect to OpenVPN
- A pause prompt outputs basic configuration information after the role has finished running
- Variables are referenced using the new Ansible variable format (e.g. {{ var }} instead of $var)
- Added a flush_handlers command to the role that ensures OpenVPN will restart prior to dnsmasq (fixes issue #63)
- Fixed two bugs that were preventing packet forwarding for IPv4 from being enabled correctly
",jlund,2013-10-09 04:11:37
66,2013-10-09 04:12:01,":crown::poop: 
",al3x,2013-10-09 04:11:37
66,2013-11-05 22:06:58,"I just raised an issue for this, so sorry for the noise. Would it be possible to share a working client config file? I can't seem to get mine to work. Here's what I have:

<S_CODE_TOKEN>

I've copied these into `~/.openvpn` and I'm just running it with `openvpn client.conf`

no sure what the relevant problem in the client output might be but I get this in the server log:

<S_CODE_TOKEN>

 Any ideas?
",boothead,2013-10-09 04:11:37
66,2013-11-05 22:19:43,"@boothead Here's an example: https://gist.github.com/al3x/7327347
",al3x,2013-10-09 04:11:37
66,2013-11-05 22:43:16,"I'm not really sure what's going on. I don't seem to be getting a tun device created on the client. And I'm getting TLS handshake failed too.

Thanks for the config, I'll have another look in the morning. Be happy to send you a pull request with a working config file for ubuntu 13.10.

Cheers!
",boothead,2013-10-09 04:11:37
66,2013-11-05 22:44:27,"Scratch my last - I uncommented the `tls-auth ta.key 1` again and it seems to work again!
",boothead,2013-10-09 04:11:37
66,2013-11-05 22:50:44,"Edit: Glad to hear that it's working!
",jlund,2013-10-09 04:11:37
65,2013-10-08 21:39:06,"In the SSL task under common roles, the following lines generate a combined certificate that is referenced in the template znc configuration file:

<S_CODE_TOKEN>

The [znc documentation for setting up SSL](http://wiki.znc.in/Signed_SSL_certificate) suggests that `SSLCertFile` needs to reference a file that leads with a private key, followed by your certificate and the certificate bundle.

I had to execute the following to get znc to play nice with my Comodo wildcard certificate:

<S_CODE_TOKEN>

From here I altered `SSLCertFile` to point to `/var/lib/znc/znc.pem` instead of `/etc/ssl/certs/wildcard_combined.pem`.

Anyone else hit anything similar? Is this worth a pull request against the znc tasks?
",hectcastro,2013-10-21 01:59:24
65,2013-10-10 14:44:00,"I refactored the SSL keys a while back after we had some confusion about what the `wildcard_compbined.pem` file should contain for Postfix. I did not test `znc` (I don't have it set up) so I could very well have broken it.

Your solution looks good. I would combine the first two commands into a single shell task, and then use the `file` module to set the owner/group/mode.
",lukecyca,2013-10-21 01:59:24
64,2013-10-08 19:52:31,"Instead of sending email to {{ admin_email }} we send them to root user.
These emails will be redirected to the appropriate user via
mail_virtual_aliases variables
",bcachet,2013-10-08 22:02:40
63,2013-10-07 22:52:43,"OpenVPN should restart before dnsmasq so the 10.8.0.0 interface that dnsmasq tries to bind to is available. Currently dnsmasq attempts to restart first, which causes the task to fail.
",jlund,2013-10-09 20:36:16
63,2013-10-07 23:29:05,"I'll submit a pull request once this is tested on a few more machines.
",jlund,2013-10-09 20:36:16
62,2013-10-07 18:51:03,".gitignore contained complete path to /vars/user.yml but we want to ignore the locale version inside local vars directory
",bcachet,2013-10-07 19:34:13
61,2013-10-07 18:25:15,"ignoreip field inside /etc/fail2ban/jail.local is populated with
server_ip_address variable
",bcachet,2013-10-07 18:26:52
60,2013-10-07 18:19:27,"Add tasks to install script/tarsnap configuration file and a cronjob to run
the backup job
Number of hourly/daily/weekly/monthly backups kept can be configure from the
tarsnap.sh script

Thanks to this script, we don't use all the backups which save space on
tarsnap server and thus reduce the price to pay
",bcachet,2013-10-07 20:32:59
60,2013-10-07 18:38:30,"Hello,

After pushing this feature, I wonder if it's not better to add variables to define number of hourly/daily/weekly/monthly backups to keep.

Just tell me if you want this modification

Sincerely

Bertrand C.
",bcachet,2013-10-07 20:32:59
60,2013-10-07 18:39:17,"A sensible default is fine by me.
",al3x,2013-10-07 20:32:59
60,2013-10-10 14:51:53,"This is really great!

I'm concerned that this script will eat tarsnap errors though. If the main tarsnap backup command fails for some reason (no credits left, server down, etc.) then this script will continue.

To improve this, you could explicitly test the return codes of the important tarsnap commands, or just set the `-e` switch on bash (in the shabang line). Either way, try to simulate a bad tarsnap command to make sure cron sends an appropriate email to `root`.

Silently failing backups == scary. :)
",lukecyca,2013-10-07 20:32:59
60,2013-10-10 20:37:00,"For sure, not be informed about failing backups, is an error

Fix with last pull request

Thanks to notice this error
",bcachet,2013-10-07 20:32:59
59,2013-10-07 18:18:20,"Apticron is configured to send email to {{ admin_email }}
",bcachet,2013-10-07 18:27:32
58,2013-10-07 18:16:33,"[Poche](http://inthepoche.com/) just went 1.0.0.
",al3x,2014-05-16 16:47:06
58,2014-02-02 21:38:48,"Poche is now [wallabag](http://www.wallabag.org/). I've tried it out and it's developing nicely. I'll look into getting this added via Docker (see #99).
",keybits,2014-05-16 16:47:06
58,2014-04-13 11:58:39,"I'd be interested in this. I'll work on this if no one else currently is. 
",jplock,2014-05-16 16:47:06
58,2016-09-29 19:43:24,"@jplock Hi guy, i'm planning to develop a product based on your source code. Do you still working on this?
",huytiki,2014-05-16 16:47:06
58,2016-09-29 20:52:26,"@huytiki working on what, specifically?  I added read-it-later support in #227 
",jplock,2014-05-16 16:47:06
57,2013-10-07 18:15:46,"See Mozilla's [guide to running your own sync server](http://docs.services.mozilla.com/howtos/run-sync.html).
",al3x,2015-02-25 18:51:38
57,2014-01-27 18:50:46,"I added the app to ownCloud and it works great in the mean time.

http://apps.owncloud.com/content/show.php?content=161793
",ConceitedCode,2015-02-25 18:51:38
57,2014-09-07 13:14:31,":+1: 
",mariocesar,2015-02-25 18:51:38
57,2015-02-25 18:51:38,"The ownCloud app seems like it's been an acceptable solution for Firefox Sync users for over a year now.
",al3x,2015-02-25 18:51:38
56,2013-10-06 01:29:30,"Sovereign does not currently use jabber/xmpp or insecure smtp.
",ariddell,2013-10-06 01:44:09
56,2013-10-06 01:48:57,"I believe we need port 25 (smtp). That is how other mail servers (MTAs) send us mail. From [wikipedia](https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol#Protocol_overview):

> An SMTP server acting as client initiates a TCP connection to the server on the ""well-known port"" designated for SMTP: port 25. MUAs should use port 587 to connect to an MSA. The main difference between an MTA and an MSA is that SMTP Authentication is mandatory for the latter only.
",lukecyca,2013-10-06 01:44:09
56,2013-10-06 01:50:22,"Yes you need 25 for incoming mail.
",stephenjamieson,2013-10-06 01:44:09
56,2013-10-06 02:30:44,"Merged too hastily. Thanks.
",al3x,2013-10-06 01:44:09
55,2013-10-05 18:44:28,,Benny-,2013-10-05 19:14:56
54,2013-10-04 14:52:01,"I'm at commit #7240e65644  When running inside vagrant, I get the following error:

<S_CODE_TOKEN>
",explorigin,2013-10-21 14:32:30
54,2013-10-05 00:56:07,"Without being able to see any modifications you've made to the YAML files it's hard to say where this error might be coming from. I can't replicate it locally. 

I suggest doing a `git diff` and looking for unclosed strings.
",al3x,2013-10-21 14:32:30
54,2013-10-05 04:19:03,"git diff gives (don't worry about the private key I'm not actually going to use it):

<S_CODE_TOKEN>
",explorigin,2013-10-21 14:32:30
54,2013-10-21 02:01:57,"@explorigin Is this still an issue for you?
",al3x,2013-10-21 14:32:30
54,2013-10-21 14:32:30,"I tried it again, and did not have an issue with it.  I'm not sure what made the difference, but I'll close it for now.
",explorigin,2013-10-21 14:32:30
53,2013-10-01 15:47:13,"It would be nice to have a more modular firewall, i.e., if you're not using XMPP you shouldn't have to have that port open in the ferm.conf (in roles/common)

This can be done with ferm and its include directive but `ufw` seems (to me at least) very easy to use and well-maintained.

Would there be any openness to a pull request?
",ariddell,2013-10-21 01:58:59
53,2013-10-01 15:50:02,"Absolutely, agreed that would be much better.
",al3x,2013-10-21 01:58:59
53,2013-10-01 15:52:16,"As a bonus ufw has good defaults for ddos mitigations and ssh protection
",stephenjamieson,2013-10-21 01:58:59
53,2013-10-09 13:51:55,"I've been poking away at this. One issue is that `ufw` will always respond if you try to add a rule that already exists with lines like this:

<S_CODE_TOKEN>

So it doesn't play well with the idempotency convention of ansible. I'm not sure how to deal with this.

Apparently there's a `changed_when` option that I need to look into. (http://lattejed.com/first-five-and-a-half-minutes-on-a-server-with-ansible)
",ariddell,2013-10-21 01:58:59
53,2014-01-24 21:55:29,"This issue is closed, but it doesn't seem to have been fixed.
",Kudu,2013-10-21 01:58:59
53,2014-01-25 13:01:32,"Originally I did think that it would be good to add the firewall rules only when the relevant app/role was used. Some of this could be done. Is this what you mean?
",ariddell,2013-10-21 01:58:59
53,2014-01-25 20:57:45,"Yes, I think that would be a useful feature.
",Kudu,2013-10-21 01:58:59
52,2013-10-01 08:31:07,"I'm not familiar with setting up openvpn, but I've stumbled upon this while working on #39: https://github.com/al3x/sovereign/blob/1e9a560ff6351fadbb4196d3a8ca06a130e04b95/roles/vpn/templates/etc_openvpn_easy-rsa_2.0_vars.j2#L71-L72

<S_CODE_TOKEN>

I think those should be extracted as variables, especially now that we can have ""mandatory"" attributes, it's too easy to miss and it probably has an impact on security.
",gregkare,2013-12-09 23:14:26
52,2013-10-02 03:03:41,"PKCS11_MODULE_PATH can be set to ""/"". PKCS11_PIN should be extracted to a variable, and the user should be instructed to choose a random 4-digit PIN.
",al3x,2013-12-09 23:14:26
52,2013-10-02 12:52:58,"Thanks, I'll send you a PR for that.
",gregkare,2013-12-09 23:14:26
51,2013-09-30 16:19:21,,gregkare,2013-09-30 16:30:06
51,2013-09-30 16:33:20,"The comment about applying the diff to Vagrant 1.2 should just be deleted, what do you think?
",gregkare,2013-09-30 16:30:06
50,2013-09-29 16:40:13,"<S_CODE_TOKEN>

After #33, I'm getting an email from cron every day to let me know the above warning.

I'm going to fix the `tarsnap` command so that it doesn't produce this warning.
",lukecyca,2013-09-30 13:30:14
49,2013-09-29 16:33:35,"I get this warning when apache is started:

<S_CODE_TOKEN>

Reading http://wiki.apache.org/httpd/CommonMisconfigurations, I believe this is because we have `NameVirtualHost *:80` in both `/etc/apache2/ports.conf` as well as our blog vhost.
",lukecyca,2013-09-30 15:30:05
48,2013-09-27 15:13:48,"Since I'm now running my own mail server, I want to know if my server's IP ends up on any prominent RBLs so I can, you know, [post an angrygram](http://pigeonsnest.co.uk/stuff/crapstuff/sorbs.html).

There are some free services online to do this:
- http://mxtoolbox.com
- http://www.rblmon.com

But since this is a relatively simple check, perhaps we should include a cron job that checks once a day. Here's a nice-looking script:
- https://github.com/DjinnS/check-rbl
",lukecyca,2013-10-07 21:00:06
48,2013-09-27 17:20:26,"+1
",al3x,2013-10-07 21:00:06
47,2013-09-27 10:27:45,"That way we can override all the config from a central location. The
`user.yml` file overrides `defaults.yml`. `user.yml` was added to
`.gitignore` in order to allow a user to change it without having to worry
about merges. It's easy to do a diff to see what changed between the defaults
and your own settings.

Needs documentation, this is just a proposal.

Refs #39
",gregkare,2013-09-30 15:47:21
47,2013-09-27 18:30:59,"Love it, although we should probably do away with the vars files inside the respective roles so there aren't three different places that a variable could be set.

Also, any variable that has a TODO in it should probably not live in `defaults.yml`, lest it accidentally be applied to a template at runtime. If a variable requires user modification, it should live in `user.yml`.

Fantastic work, thanks so much @gkarekinian!
",al3x,2013-09-30 15:47:21
47,2013-09-28 23:24:36,"Looks great. I would also add that we should be consistent with namespacing the variables since they're now all swimming in the same file. Almost all start with the name of the role in which they are used, but a few don't: `key_*` should be come `openvpn_key_*`, for example.
",lukecyca,2013-09-30 15:47:21
46,2013-09-27 05:48:30,"I have a bunch of these errors littering `/var/log/mail.err`:

<S_CODE_TOKEN>
",lukecyca,2014-01-13 00:43:35
46,2013-09-27 17:24:49,"Yeah, I see the same. I'll look into it.
",al3x,2014-01-13 00:43:35
46,2014-01-12 23:16:16,"I'm no longer seeing this behavior. How about you, @lukecyca?
",al3x,2014-01-13 00:43:35
46,2014-01-13 00:43:35,"Yeah, I still get the error every day or so, but I have not experienced any other symptoms so it‚Äôs likely benign. I can live with it.
",lukecyca,2014-01-13 00:43:35
46,2015-11-19 18:03:30,"A small bump, but I'm running into exactly the same issue. I think I might have found a discussion which touches the issue we all seem to have: https://www.mail-archive.com/search?l=dovecot@dovecot.org&q=subject:%22Re%3A+Permissions+problem+with+mdbox+maildir%22&o=newest&f=1

Apparently, it would seem that (at least in their & my case), due to the ""paranoid"" setup of the encfs container, hard links are not allowed, and as such causing the error in dovecot. 

I'm currently trying out this solution (as suggested in that thread):

<S_CODE_TOKEN>

I hope this helps you guys too (took away too much time to leave this issue just as is)
",canihavesomecoffee,2014-01-13 00:43:35
45,2013-09-27 05:45:21,"<S_CODE_TOKEN>

That's a legit gmail server. Out of all the spams blocked by RBLs, SORBS has rejected one for me, and it was this false positive!

<S_CODE_TOKEN>

For now I'm going to take it out of my configuration.

[An article](http://sourceforge.net/apps/mediawiki/dspam/index.php?title=RBL_Block_Lists) on the dspam wiki suggests using [policyd-weight](http://www.policyd-weight.org) so that no single RBL causes a rejection:

> I am not trusting one single RBL. Never ever would I do that!

From policyd-weight's homepage:

> Postfix' built-in checks can be too tough for poorly configured clients: one hit, and the mail gets rejected.

That sounds good to me. What does everyone else think?
",lukecyca,2013-11-26 06:15:15
45,2013-09-27 17:24:11,"policyd-weight sounds great. I've also been hit by Gmail ending up on blacklists.
",al3x,2013-11-26 06:15:15
45,2013-11-22 18:29:04,"Since applying these changes I'm seeing spam (mail with `X-DSPAM-Result: Spam` headers) show up in my inbox. @lukecyca, how about you?
",al3x,2013-11-26 06:15:15
45,2013-11-23 01:16:55,"@al3x I haven't had that problem. `X-DSPAM-Result: Spam` is going directly to the `Spam` subfolder for me.

Could you capture a relevant segment of `/var/log/mail.log` and post it or email it to me?
",lukecyca,2013-11-26 06:15:15
45,2013-11-26 06:15:15,"This ended up being due to a mail client swapping out my `Spam` folder for a `Junk` folder. Our `.dovecot.sieve` only moves spam into a folder named `Spam`, and will fail open to delivering mail to the Inbox if it can't find a folder with that name.
",al3x,2013-11-26 06:15:15
44,2013-09-26 14:11:56,"Also replace the global variable in Vagrantfile with a local one.
",gregkare,2013-09-26 17:04:40
43,2013-09-25 22:29:15,"Use https://github.com/sitaramc/gitolite or http://gitlab.org or something. Probably GitLab.
",al3x,2014-04-13 16:09:04
43,2013-09-26 02:45:49,"+1
",lukecyca,2014-04-13 16:09:04
43,2013-09-26 10:38:11,"Gitlab uses gravatar. This is a privacy issue, to me. Like gmail / google calandar / google drive / ... , gravatar is cool, gravatar is easy, gravatar tracks you.

The worst, is that even if I don't have a gravatar account, services stiil send my identity to gravatar. I have no way prevent gravatar to track me, except not using these services (including github :/ )
",lisael,2014-04-13 16:09:04
43,2013-09-26 10:43:07,"Gravatar is easily disabled
",stephenjamieson,2014-04-13 16:09:04
43,2013-09-26 13:24:28,"I didn't dig, sorry my fellow geometric avatar ;)
",lisael,2014-04-13 16:09:04
43,2013-11-18 03:43:16,"I've setup gitlab once myself, it was very complex to get going. I imagine upgrades are also quite a hassle. There are probably some better options out there, like Gitorious as a VM (http://getgitorious.com/virtual-appliance)
",chuyskywalker,2014-04-13 16:09:04
43,2013-11-18 11:07:59,"I agree, I've been put off by gitlab after the last few upgrades, not to mention major security vulnerabilities.
",stephenjamieson,2014-04-13 16:09:04
43,2013-11-22 17:39:51,"There's Rhodecode, which works with both Git and Mercurial. The newest version has some license restrictions, but you can still get version 1.7.2, which works great and is completely free.

[rhodecode.com](http://rhodecode.com) (newest enterprise variant)
[Python package for 1.7.2](https://pypi.python.org/pypi/RhodeCode) (last GPL variant)
",tucker-m,2014-04-13 16:09:04
43,2013-11-24 17:06:10,"[cgit](http://git.zx2c4.com/cgit/about/) is stable, very fast and lean on resources. Doesn't have all the bells and whistles of the others mentioned here, but for personal servers I like it.
",keybits,2014-04-13 16:09:04
43,2014-02-08 09:29:07,"https://github.com/takezoe/gitbucket :question: 
",tilsammans,2014-04-13 16:09:04
43,2014-02-11 04:44:02,"@knitatoms: I like cgit too.

@tilsammans: gitbucket looks nice but I'm concerned about adding another memory-hungry JVM process (in addition to Lucene, which we use for email search).
",al3x,2014-04-13 16:09:04
43,2014-02-11 08:46:54,"Agreed.
",tilsammans,2014-04-13 16:09:04
43,2014-03-15 19:43:06,"This is especially relevant to my interests today.

I was simply thinking about `git-instaweb` and mailing lists. Like in the Olden Times.
",steveklabnik,2014-04-13 16:09:04
43,2014-03-21 22:24:51,"I actually just started work on adding cgit to my fork https://github.com/larryfox/sovereign/tree/cgit. It ‚Äúworks‚Äù, in that you can access the empty repository browser.

Trying to find a sane way to do access management. Seems like some people use gitolite in addition for that, so might go that route.
",larryfox,2014-04-13 16:09:04
43,2014-03-22 01:19:54,"+1 for gitolite, it has good access control and works as expected.
",malvim,2014-04-13 16:09:04
43,2014-04-13 11:56:30,"This can be closed now
",jplock,2014-04-13 16:09:04
42,2013-09-25 22:05:22,"Several people have inquired about using Nginx, as it's lighter-weight than Apache. I'm open to the idea.

[This Nginx config](https://gist.github.com/konklone/6532544) has some nice features, particularly when it comes to SSL, and could be used as a base template.
",al3x,2015-02-25 18:54:07
42,2013-09-29 02:58:09,"Good baseline for [nginx security](http://tautt.com/best-nginx-configuration-for-security/)
",nanoxd,2015-02-25 18:54:07
42,2013-10-18 06:33:08,"Alex,

Have a look at my ansible repo (https://github.com/pjan/the-ansibles). It includes an extensive/configurable nginx role (add and delete modules, ...).

One thing to bear in mind, is that switching to nginx somehow will complicate the owncloud setup, but nothing that can't be done

BTW: Based on the many roles I already had, I took your sovereign for a twist (https://github.com/pjan/the-ansibles/blob/master/docs/cloudbox.md) and believe it's a bit more fool-proof / easier to start off with for the general crowd (owncloud is however not included). (No remarks here though, as it was mainly a personal exercise based on what I already had + feel free to get some inspiration)
",pjan,2015-02-25 18:54:07
42,2013-11-13 02:49:52,"+1 on nginx
@NanoXD nice ressource
",i-trofimtschuk,2015-02-25 18:54:07
42,2014-04-28 04:27:55,"+1. But be aware that SPDY requires special compilation flags, and so will generally be difficult.
Also, another set of standard settings for nginx from the Mozilla project:
https://wiki.mozilla.org/Security/Server_Side_TLS#Nginx
",the-solipsist,2015-02-25 18:54:07
42,2014-05-21 15:51:32,"+1 on nginx, because it does the whole reverse proxy thing too, which is useful when Docker-ising applications.
",jeffbr13,2015-02-25 18:54:07
42,2014-05-22 15:39:19,"+1
",timinator,2015-02-25 18:54:07
42,2014-05-22 16:38:31,"> +1 on nginx, because it does the whole reverse proxy thing too,

So do Apache, lighttpd, and many other web servers.
",qmr,2015-02-25 18:54:07
42,2014-11-01 23:34:34,"+1 to replace Apache with nginx.
",taoeffect,2015-02-25 18:54:07
42,2014-11-02 11:20:38,"I initially was in favor of switching -- but have since changed my mind. Memory prices in the cloud are coming down and apache has solid documentation.

If there are good reasons beyond memory usage to switch, I'd reconsider.
",ariddell,2015-02-25 18:54:07
42,2014-12-04 10:47:25,"+1
",stibiumz,2015-02-25 18:54:07
42,2014-12-14 15:29:24,"+1 for nginx support!
",azharp,2015-02-25 18:54:07
42,2015-02-25 18:54:07,"Not to sound like a broken record, but: I'm open to a pull request. Apache httpd has worked well for most Sovereign users. As @ariddell pointed out, higher-memory VPS instances have come down in price.
",al3x,2015-02-25 18:54:07
42,2016-03-11 23:49:58,"I'm curious to know what people think of switching from Apache to Nginx, more than a year later after the last comment on this issue.

It was mentioned in the LetsEncrypt discussion over at #451, and also with PR #526 aiming to modularize sovereign I thought it might be a good time to give this a second thought.

From what I've gathered, @ariddell is in favor of switching to Nginx, and @neuhaus doesn't mind it.

I'd like to see what everyone thinks of this.

P.S. I'm using Nginx on my server (along with owncloud) and can probably help with some of the virtual host files.
",aminb,2015-02-25 18:54:07
42,2016-03-12 00:01:40,"I'm in favor. I prefer nginx to Apache; this was one thing that made me debate using sovereign vs rolling my own solution. 
",carljm,2015-02-25 18:54:07
42,2016-03-12 00:16:55,"I'm in favor of switching to nginx.
",jplock,2015-02-25 18:54:07
42,2016-04-13 14:57:51,"Agreed, NGINX is technically superior in most parts and certainly less resource hungry. Even if VPS memory costs are coming down, there is still never enough since we always want to do more with them!
",TotallyInformation,2015-02-25 18:54:07
42,2016-04-13 15:58:29,"In January I've played around with porting the apace configs to nginx on a freshly installed server with the jessie-playbooks and have got a working set now, but I currently don't have time to put those configs into the playbook. Testing is a pain when jessie isn't fully supported yet. I'd wait until the jessie transition is finished and put them into the playbook afterwards.
",tynsh,2015-02-25 18:54:07
42,2017-03-11 16:26:24,@tynsh do you have any fork or something were we could support you somehow?,alexanderadam,2015-02-25 18:54:07
42,2017-03-11 16:48:18,"Unfortunately I've lost that config when I've wiped my server without having a backup :-(

Since I no longer use sovereign I doubt I will try again, sorry.",tynsh,2015-02-25 18:54:07
42,2017-03-12 16:30:01,@tynsh what a pity. If I may ask: do you use an alternative you could recommend?,alexanderadam,2015-02-25 18:54:07
42,2017-03-12 17:51:41,"@alexanderadam yes, I've started writing my own playbook which uses [a nginx role](https://github.com/HanXHX/ansible-nginx) which is pretty easy to use and works well. I can recommend that if you want to integrate nginx into your playbooks.",tynsh,2015-02-25 18:54:07
42,2017-03-12 18:06:52,"@tynsh does it integrate a full email config similar to the one in [sovereign](https://github.com/sovereign/sovereign#services-provided) as well? You don't [have it public on GitHub yet](https://github.com/tynsh?tab=repositories), right?",alexanderadam,2015-02-25 18:54:07
42,2017-03-12 18:32:51,"ah, well, the email config is not yet there. I wasn't thinking of uploading the playbook since it is written quite messy. I will see if I can clean it up and upload it but don't expect it to happen in the near future. Even if it will be uploaded I doubt you will be able to use it as a replacement for sovereign since it heavily relies on [zerotier](https://www.zerotier.com/) and spreads the configuration on multiple servers.",tynsh,2015-02-25 18:54:07
42,2017-03-12 20:35:00,"@al3x I totally understand that there are reasons for you not to solve this issue not by yourself.

However, if I interpreted your comment correctly, *closing* this issue was not what you really intended to do. Because you are actually *open* to get this issue solved. So as this issue *isn't rejected nor solved* it should be still open so nobody can misinterpret the state of this issue (as rejected or closed).

PS: independent from that I just wanted to mention that it's absolutely awesome what you've done",alexanderadam,2015-02-25 18:54:07
42,2017-03-13 20:34:34,"For others interested in an alternative to some of Sovereign's functionality (mail, calendar and contacts), I'd recommend taking a look at [Mailu](https://github.com/Mailu/Mailu), which I've been happily using for a few months now and haven't had any issues with it.",aminb,2015-02-25 18:54:07
42,2017-03-24 04:16:33,"Whats the status on this, is there a reason it was closed? It seems there is still a desire by users for nginx over apache. @aminb as for Mailu if that was a set of ansible scripts instead of a docker container I would  easily consider using it. ",Brando753,2015-02-25 18:54:07
41,2013-09-25 12:44:11,"I don't use tarsnap, so I must comment ""- tarsnap.yml"" out in roles/common/tasks/main.yml putting it in a dedicated role would give a more consistent behaviour, I'd just comment it in site.yml
",lisael,2013-09-25 17:43:43
41,2013-09-25 17:43:43,"Done, checked into master.
",al3x,2013-09-25 17:43:43
40,2013-09-25 12:20:37,"After the install, we could display a message telling what is installed, what still remains to do (setting owncloud and znc...), urls to new web services (roundcube, owncloud, blog), and even a DNS config summary.
",lisael,2014-06-27 00:23:47
40,2014-01-16 08:42:09,"Can this even be done in Ansible? I'm aware of the `debug` task, but that prints in-line with execution and it's wrapped in a dictionary. What we need would have to print at the very end of playbook execution.
",tilsammans,2014-06-27 00:23:47
40,2014-06-27 00:23:47,"Between the output of the run that Ansible produces and the documentation in the README and on the wiki, I don't believe this is necessary.
",al3x,2014-06-27 00:23:47
39,2013-09-24 15:09:35,"We could gather all vars in a single file, and even use string replacement to make config as simple as:

https://gist.github.com/lisael/f9af1d96b1323c56ec8c

this allow the user to keep all control over her config but also provides a sensible default config with minimal pain.
",lisael,2013-11-17 21:05:34
39,2013-09-24 16:45:29,"Another nice thing about having a single config file is that it would make merge conflicts less likely when updating sovereign.
",brucespang,2013-11-17 21:05:34
39,2013-09-24 17:15:14,"I like it. It does decrease the ""modularity"" of each of the roles, and it isn't in keeping with Ansible conventions, but hey rules are made to be broken ;) I'd love to see a pull request!
",al3x,2013-11-17 21:05:34
39,2013-09-26 14:58:04,"I agree, it would be really convenient to have one global file to override configuration from all the roles. That file could even be added to `.gitignore` with a sample showing all the variables you can use. I'm new to Ansible but I'm going to play with overrides and see what I can do.
",gregkare,2013-11-17 21:05:34
39,2013-09-27 10:50:22,"My pull request above is a proposal using `vars_files`. I wanted to use `group_vars` but the variables from the roles had precedence, so I ended up with this. What do you think?

Obviously it needs documentation, but I don't want to document this if it's a wrong way to do this :)
",gregkare,2013-11-17 21:05:34
38,2013-09-23 18:56:05,"My take at simplifying the initial setup when it comes to mail users passwords.
",lbsnrs,2013-09-24 02:15:21
38,2013-09-23 20:03:28,"Hello,

Your proposition is really interesting, but what happen if I play the playbook several times. It will generate new hash every time, so Ansible will not be able to import SQL template to existing database.

I think it's important to be able to launch playbook several time. In case we want to install new tools or fixes provided to the project.

But maybe I'm wrong with my interpretation of your solution

Bertrand
",bcachet,2013-09-24 02:15:21
38,2013-09-24 01:44:41,"Seconding the concern that this isn't idempotent as implemented. I'd love to remove any tricky manual steps but this will cause issues.

One possible solution to make it idempotent would be to first check to see if a user present with a non-NULL password column and only execute the INSERT if it is not.

Closing for now, please reopen if you have another take on it.
",al3x,2013-09-24 02:15:21
37,2013-09-23 18:47:34,"I think these are leftovers from @al3x local setup:

./roles/mailserver/files/etc_dovecot_conf.d_20-imap.conf:  postmaster_address = postmaster@syntax.cc
./roles/mailserver/templates/etc_dovecot_conf.d_15-lda.conf.j2:postmaster_address = postmaster@syntax.cc
",lbsnrs,2013-09-24 02:12:46
36,2013-09-22 07:55:49,"I fixed up the remaining certificate-related issues from #34 and #26. It now correctly verifies the cert when connecting with `openssl s_client -connect mail.lukecyca.com:993` (and also port 465), and also shows `Trusted TLS connection established` in `mail.log` when connecting out to other mail servers.

@bcachet, can you test these out and confirm that they work for you as well?

I wanted to write up some more explicit instructions on what exactly goes in each cert file, and ended up adding similar detail for the other manual setup steps. @al3x, feel free to copy edit. :)
",lukecyca,2013-09-23 23:21:40
36,2013-09-22 09:43:22,"Works like a charm for me.
Sorry for the error I introduced. I didn't RTFM correctly.

Thanks a lot for your fix and explanations.

Bertrand
",bcachet,2013-09-23 23:21:40
35,2013-09-21 20:35:04,"Hi, and fist, thanks for the effort :)

I added a webmail (roundcube) role. I Hope you'll like it (well roundcube isn't that sexy, but it helps fetching your mail anywhere).
",lisael,2013-09-24 02:13:27
34,2013-09-19 20:42:01,"Fix Postfix configuration file to link to correct SSL certificate locations
",bcachet,2013-09-19 20:46:20
33,2013-09-19 06:38:43,"I just realized my tarsnap cron job has been failing for the last few days because the cache directory had become out of sync (probably because I've been installing/uninstalling things like crazy lately). The [fix is easy enough](https://www.tarsnap.com/usage.html), but the silent failure is concerning.

I'll see if I can set up an email on failure.
",lukecyca,2013-09-25 17:45:49
33,2013-09-25 09:25:52,"I also discovered that the tarsnap cronjob was failing because the binary wasn't in $PATH.

I'm interested to know if anyone else had this problem. Might want to double-check your backups with:

<S_CODE_TOKEN>
",lukecyca,2013-09-25 17:45:49
32,2013-09-18 16:29:36,"It would also be great to have the option to use postgreSQL instead of MySQL
",brot,2014-01-14 16:03:51
32,2013-09-19 06:33:45,"Forget the ""option"", let's make postgres the default!
",lukecyca,2014-01-14 16:03:51
32,2013-09-19 10:05:06,"I completely agree here!
",stephenjamieson,2014-01-14 16:03:51
32,2013-09-19 11:28:55,"I'd like the option as well.
",ariddell,2014-01-14 16:03:51
32,2013-09-19 15:21:35,"I'm actually more of a Postgres guy myself, so I'm in agreement. I went with MySQL simply out of expediency with respect to setting up the virtual email domains, but it seems like that could be done just as easily using another database.

I'm adding this to my to do list of non-critical enhancements, but I'd happily accept a pull request :)
",al3x,2014-01-14 16:03:51
32,2014-01-03 22:42:15,"I have a branch in my account that implements PostgreSQL as an option (https://github.com/ssoriche/sovereign/tree/postgres) via a new configuration variable db_type. The default right now is for mysql, but setting the db_type to pgsql, db_admin_username to postgres and a password for db_admin_password, sets up the environment with a PostgreSQL backend (with all tests passing).

I made some changes to the configuration variables, removing the _mysql_ and replacing it with _db_ so that the same options can be used for either mysql or pgsql.

I'd appreciate some more testing of it, and if acceptable I can submit a pull request.
",ssoriche,2014-01-14 16:03:51
32,2014-01-03 22:53:08,"Looks good to me. I‚Äôll try test it in the next week or so.

I don‚Äôt think there‚Äôs any reason to maintain support for both databases. Let‚Äôs pick one (i.e.: postgres) and move to it.
",lukecyca,2014-01-14 16:03:51
32,2014-01-09 18:44:03,"I've created a new branch that is only PostgreSQL. 

I left the configuration parameters database agnostic (_db_ instead of _mysql_ or _pgsql_). All tests are passing.

https://github.com/ssoriche/sovereign/tree/postgres_only
",ssoriche,2014-01-14 16:03:51
32,2014-01-10 01:54:05,"@ssoriche I've reviewed your branch, and it looks fantastic. Great work. Would you mind sending over a pull request?
",al3x,2014-01-14 16:03:51
32,2014-01-10 03:43:18,"@al3x do you want the postgres only branch or the mix?
",ssoriche,2014-01-14 16:03:51
32,2014-01-10 19:10:44,"The Postgres-only branch, please.

## 

Alex Payne

> On Jan 9, 2014, at 19:43, Shawn Sorichetti notifications@github.com wrote:
> 
> @al3x do you want the postgres only branch or the mix?
> 
> ‚Äî
> Reply to this email directly or view it on GitHub.
",al3x,2014-01-14 16:03:51
32,2014-01-14 16:02:57,"This was merged with #129.
",tilsammans,2014-01-14 16:03:51
31,2013-09-18 15:04:40,"Hello,

I have performed a fresh install of the distribution on a debian 7 system.

I do not manage to connect to SMTP with the command

<S_CODE_TOKEN>

Log message is the following

<S_CODE_TOKEN>

The wildcard_private.key certificate seem validate

<S_CODE_TOKEN>

I wonder if problem is with permission for vmail/postfix users:

<S_CODE_TOKEN>

I have already install sovereign distrib on this server 2 weeks ago. Worked fine. I just want to update everything with last modifications. I fully reinstall debian (disk format) but now, I do not manage to get it work

Any hint

Sincerely

Bertrand
",bcachet,2013-09-19 20:46:39
31,2013-09-18 15:28:20,"I manage to access to IMAP with:

<S_CODE_TOKEN>

And I manage to list content of inbox

<S_CODE_TOKEN>

I really do not understand why SMTP + TLS is broken
",bcachet,2013-09-19 20:46:39
31,2013-09-18 16:13:48,"A little bit more information

When I check which user launch dovecot/postfix processes I got:

<S_CODE_TOKEN>

For dovecot, it seems that the process in charge of checking SSL is launched by **root** => able to access to certificate

But for postfix, all the process are launched by **postfix** user, who is not able to access the certificate.

I should change the _owner group_ of the certificate to allow **postfix** user to access it. 

Any idea on how to do this correctly ?

Sincerely

Bertrand
",bcachet,2013-09-19 20:46:39
31,2013-09-19 06:47:19,"Me again,

When performing the check of my private key as **postfix** user, I got error

<S_CODE_TOKEN>

I also try to check about the mismatch with cert. Running the following command

<S_CODE_TOKEN>

produces no output. Which seems good to me.
I think mismatch is because, private key is not read.

Bertrand
",bcachet,2013-09-19 20:46:39
31,2013-09-19 06:52:42,"[This page](http://www.postfix.org/TLS_README.html) specifically says the private key should be owned by root and not readable by anyone else. I think the process starts as root and then drops privileges once it's started.

Here's how mine looks:

<S_CODE_TOKEN>

<S_CODE_TOKEN>

Try setting the key to only be readable by root (mode 600). It could be that postfix is refusing to use the key because the permissions are set insecurely.

Also make sure the key is in PEM format and isn't encrypted (ie: isn't password-protected).
",lukecyca,2013-09-19 20:46:39
31,2013-09-19 11:30:40,"I change mode on the certificate to 600. I have now the same permissions as you. I restarted postfix service, but it doesn't work

Certificates are the same for dovecot and postfix and they work for dovecot (moreover I used them in my previous installation and it worked very well at this time). So I think that they are in the good format and accessible. But I want to check them.

How can I check that they are not password-protected (for me they are not but who knows). When I ask openssl to check the key it doesn't ask for password. Is it sufficient ?
",bcachet,2013-09-19 20:46:39
31,2013-09-19 13:33:22,"I have a private key from StartSSL which is password protected. 
I regenerate a private key with the following command

<S_CODE_TOKEN>

I enter my password and got a passwordless private key. This is the key I use (and used in previous server instance) for my _sovereign_ like server.

But once again, it doesn't work.

Any idea on how to get more debug information from postfix. I have set **smtp_tls_loglevel** to 4, but it doesn't much more information about why it doesn't manage to read my private key.
",bcachet,2013-09-19 20:46:39
31,2013-09-19 15:27:37,"@bcachet It might be worth checking around the Postfix mailing list.
",al3x,2013-09-19 20:46:39
31,2013-09-19 20:26:59,"I finally found the problem

In roles/mailserver/templates/etc_postfix_main.cf.j2

<S_CODE_TOKEN>

but should be

<S_CODE_TOKEN>
",bcachet,2013-09-19 20:46:39
31,2013-09-19 20:46:39,"Fixed in pull request #34.
",al3x,2013-09-19 20:46:39
31,2013-09-22 04:28:51,"The `*_CAfile` parameters are not quite right after this change. I've studied the postfix docs some more ([this page](http://www.postfix.org/TLS_README.html) is especially detailed) and here are the relevant parts:

### [smtp_tls_CAfile](http://www.postfix.org/postconf.5.html#smtp_tls_CAfile)

> A file containing CA certificates of root CAs trusted to sign either remote SMTP server certificates or intermediate CA certificates.

In other words, this is the set of all the CAs in the world from which our server will recognize certificates. When our server tries to send email to gmail.com, gmail's smtpd will present a cert signed by GeoTrust. Unless we have GeoTrust in our list of recognized CAs, we won't be able to validate gmail's cert.
This should be set to `smtp_tls_CAfile = /etc/ssl/certs/ca-certificates.crt`

### [smtpd_tls_CAfile](http://www.postfix.org/postconf.5.html#smtpd_tls_CAfile)

> A file containing (PEM format) CA certificates of root CAs trusted to sign either remote SMTP client certificates or intermediate CA certificates.

This is similar to above, but since it's for `smtpd`, it is used to validate client certs from clients connecting to our smtpd server.

> By default (see smtpd_tls_ask_ccert), client certificates are not requested, and smtpd_tls_CAfile should remain empty.

Since we are not using client certs in this configuration, we have no use for this line.

### [smtpd_tls_cert_file](http://www.postfix.org/postconf.5.html#smtpd_tls_CAfile)

This is correct after @bcachet's fix, however...

> To enable a remote SMTP client to verify the Postfix SMTP server certificate, the issuing CA certificates must be made available to the client. You should include the required certificates in the server certificate file, the server certificate first, then the issuing CA(s) (bottom-up order).

So this should actually be our cert, followed by the rest of the cert chain. Otherwise, you'll notice you get `Verify return code: 21 (unable to verify the first certificate)` when you test with `openssl s_client -connect mail.example.com:465`.

I have (erroneously) made my `/etc/ssl/certs/wildcard_ca.pem` be the whole chain (since there was multiple TODO placeholders in there), which is why this was working for me.

I'll submit another pull request to clear these things up, and try to make the docs more explicit to prevent people from making the same mistake I did.
",lukecyca,2013-09-19 20:46:39
31,2015-12-14 17:37:30,"I think that somewhere in the documentation we should add something about adding passwordless certificates... this one got me good :)
",shaneonabike,2013-09-19 20:46:39
30,2013-09-18 00:41:45,"I tidied up a lot of the tasks so that they [are named](http://www.ansibleworks.com/docs/bestpractices.html#always-name-tasks), notify handlers correctly, and are idempotent wherever possible.

It also now updates and upgrades `apt` packages.
",lukecyca,2013-09-18 03:40:28
29,2013-09-17 10:47:48,"Just by setting `encfs_password`, this set of tasks will:
- Create the filesystem if doesn't exist (using paranoid mode)
- Decrypted/mount it if exists but isn't mounted
- Do nothing if it's already mounted

I moved `/decrypted-mail` to exclude ""mail"" from its name because it's now being used for more than just mail, and I figure it was just a holdover from the ""inspirational post"". Better to clean this up sooner rather than later.
### Migrating an existing server
1. Reboot the server (or just stop the services and unmount the encfs)
2. `rm -rf /decrypted-mail`
3. `mv /encrypted-mail /encrypted`
4. Run the entire playbook to update the paths everywhere, and decrypt/mount it
",lukecyca,2013-09-17 19:48:22
28,2013-09-17 10:32:40,"As recommended by [My First 5 Minutes On A Server](http://plusbryan.com/my-first-5-minutes-on-a-server-or-essential-security-for-linux-servers)...
",lukecyca,2013-09-17 19:47:11
27,2013-09-17 10:25:54,"Inspired by [this article](http://hynek.me/articles/hardening-your-web-servers-ssl-ciphers/) by @hynek, this takes us from a ""C"" rating to an ""A"" rating on https://www.ssllabs.com/ssltest/.

I didn't tackle TLS compression, so there's still room for improvement there.

I disabled directory listings too.
",lukecyca,2013-09-17 19:42:52
26,2013-09-17 10:17:11,"I noticed that SSL on smptd wasn't providing a verifiable cert:

<S_CODE_TOKEN>

This can be fixed by providing the cert chain including the intermediate CA cert. Now it verifies:

<S_CODE_TOKEN>

I also noticed that Postfix was establishing ""untrusted"" connections to other mail servers when sending, like this:

<S_CODE_TOKEN>

which is fixed by telling postfix about the ca-certificates that are installed. Not they're trusted:

<S_CODE_TOKEN>

---

ps: Thanks for creating sovereign! I'm pumped to implement it for myself and contribute improvements back. I've got a bunch of commits queued up which I'll submit as individual pull requests so you can pick and choose.
",lukecyca,2013-09-17 17:34:58
25,2013-09-15 01:48:46,"According to [the docs](http://www.ansibleworks.com/docs/modules.html#service), `running` is not a valid value for the state parameter. Ansible silently accepts it and starts the service anyway, but was bouncing the service each time it runs.

I believe `started` is a more appropriate value.
",lukecyca,2013-09-16 21:37:12
24,2013-09-15 00:09:46,"<S_CODE_TOKEN>

Simply removing `${main_user_name}` from the list of groups seems to work. Debian creates a primary group with the same name as the user automatically.
",lukecyca,2013-09-15 21:21:27
23,2013-09-14 15:12:43,"Put in a conditional clause in the mailserver mysql template to add virtual aliases if mail_virtual_aliases is defined. I also added an example in vars/main.yml with a slight suggestion that folks consider having a postmaster@ alias (since it's generally a good idea to have that address at your domain).
",sjahl,2013-09-17 19:47:37
22,2013-09-14 06:20:45,"Removed your hardcoded server IP
",lukecyca,2013-09-15 00:03:46
21,2013-09-05 23:44:35,"The included /etc/dspam/dspam.conf file still had ""Home"" set to /var/spool/dspam. Since there's some sensitive info in the logs there, I figured it'd be best to change that directive to place stuff in /decrypted-mail/dspam (I figured this is where you originally intended, since you were creating the decrypted-mail/dspam folder already).

Second, there was a really strange bug with dspam, where it _always_ placed the DSPAM signature in the message body, even though the config file had signatureLocation set to 'headers'. Only way I was able to fix it was to remove the trailing comment from the signatureLocation line in /etc/dspam/default.prefs.

Let me know if there's anything to improve here :-)
",sjahl,2013-09-05 23:58:45
21,2013-09-05 23:59:38,"Thanks for the patch!
",al3x,2013-09-05 23:58:45
20,2013-09-04 21:57:11,"If one of your first steps in setting up a new server is to change the ssh port, the ferm configuration will not anticipate you and you'll eventually find yourself locked out of your server. 
- A workaround, if you can get root access to your server, is to edit /etc/ferm/ferm.conf and add your port to the proto tcp dport list. Then load your new rules: sudo ferm ferm.conf
- Or, don't change your SSH port!
- A more permanent fix might be to parameterize (or detect?) this and add when ferm is installed. I don't have this fix; still trying to get my first install going! :)
",hoosteeno,2013-09-04 22:45:07
20,2013-09-04 22:05:36,"My solution is not to change the SSH port. fail2ban will take care of password cracking attempts. Assuming you disable password-based logins as recommended in the README, there's not much to be gained by moving it to a high port.
",al3x,2013-09-04 22:45:07
20,2013-09-04 22:35:55,"Cool! Sounds like it's not an issue then. 
",hoosteeno,2013-09-04 22:45:07
19,2013-09-04 09:03:41,"sovereign / roles / monitoring / files / etc_monit_conf.d_tomcat
contains this block:

<S_CODE_TOKEN>

which should be:

<S_CODE_TOKEN>
",stetskevych,2013-09-04 21:42:41
18,2013-09-03 09:04:32,"I am setting up a server with the following config:

<S_CODE_TOKEN>

When I run ansible, the users are added to the mysql database(virtual_users) correctly, but only the ""primary"" user has a directory created under /decrypted-mail/example.com/

eg /decrypted-mail/example.com/bill

When I try and login using steve@example.com the following appears in /var/log/mail.log

<S_CODE_TOKEN>

Should that directory be created by ansible during setup? Or should it be created by dovecot when the user first logs in? If the latter, then do we need to modify the permissions so it can create the directory?

Cheers,

Jordan
",jordanbrock,2013-09-05 01:37:48
18,2013-09-03 10:54:37,"Sorry, neglected to mention that logging in as the first user (bill@example.com) works perfectly.
",jordanbrock,2013-09-05 01:37:48
18,2013-09-04 22:22:54,"Hello,

I got troubles with mail authentication too (SMTP).
I manage to connect to SMTP server with openssh

<S_CODE_TOKEN>

Then EHLO returns:

<S_CODE_TOKEN>

But when performing authentication

<S_CODE_TOKEN>

I got

<S_CODE_TOKEN>

I think the problem is with my password hash in roles/mailserver/vars/main.yml

<S_CODE_TOKEN>

Where $6$salt information$password encoded is the output of the command

<S_CODE_TOKEN>

What did I miss ?
",bcachet,2013-09-05 01:37:48
18,2013-09-05 00:54:50,"@bcachet Is your password hash similar to this:

<S_CODE_TOKEN>

I used the following command to generate the hash

<S_CODE_TOKEN>

You need to include the full hash, including the $6 at the beginning which signifies the hashing algorithm.
",jordanbrock,2013-09-05 01:37:48
18,2013-09-05 00:58:12,"Further to my issue above, I noticed that my mail directory has the following permissions

<S_CODE_TOKEN>

Then the (successful) primary user directory has the following

<S_CODE_TOKEN>

Should the /decrypted-mail/example.com directory be owned by vmail?
",jordanbrock,2013-09-05 01:37:48
18,2013-09-05 01:37:48,"OK, so I should probably have just done that. chown /decrypted-mail/example.com to vmail and chgrp to dovecot has fixed the problem.
",jordanbrock,2013-09-05 01:37:48
18,2013-09-05 05:59:00,"I will try using **mkpasswd**, but yeah, my password is of the form **$6$5SsudmJZ6QCIGzX5$MQxsjj8TF.gWFl.1ffkRbrWu8PDmT5u2n1LRJW4MjTd73zTeaQgibnAVBqo1SuTQ8LouuSsYFFIlmKp2Wi9tk/**
",bcachet,2013-09-05 01:37:48
18,2013-09-05 10:22:09,"Just work perfectly with mkpasswd command.
Don't understand why doveadm-pw doesn't provide a good hash

Thanks for the information
",bcachet,2013-09-05 01:37:48
17,2013-09-01 20:56:54,"The old action would generate a crontab job for `* 3 * * *`, which means every minute at 3am, so 60 times per day.
",henrikhodne,2013-09-01 21:40:55
16,2013-08-28 12:53:31,"I'm having trouble making sense of this.

What should I be doing in `roles/mailserver/templates/etc_opendkim_TrustedHosts.j2`?

Contents of the file:

<S_CODE_TOKEN>

Could you provide an example of what this might look like with the info added?
",zachlatta,2013-08-29 04:55:31
15,2013-08-27 15:13:10,"The default configuration stores tarsnap's key in /root/tarsnap.key and backs up /decrypted_mail to tarsnap.

Unless I misunderstand, this seems to mean that an attacker who gains physical access to the drive gains access to the unencrypted tarsnap key and can then gain access to tarsnap backups containing unencrypted mail.

The solution then seems to be one of two options:
1) back up encrypted-mail, not decrypted-mail

Pros:
- Defends against any theoretical weakness in tarsnap

Cons:
- Encrypted data doesn't deduplicate as well.
- Attacker still gains access to all backups, possibly useful for an attack.

2) move key to /decrypted-mail
Pros:
- Key is never unencrypted-at-rest on the drive
- Attacker can't gain access to backups

Cons:
- Trusts tarsnap

3) move key to /decrypted-mail and back up /encrypted-mail
Pros:
- Most secure option

Cons:
- Encrypted data doesn't deduplicate well

---

I'm personally going with 2 for now. Happy to submit a pull request for this one; thanks for all the great work on Sovereign!
",abl,2014-03-03 14:49:44
15,2013-08-28 00:38:39,"@aleksandyr I agree that 2 is a better solution. Please do submit a pull request for it. Thanks!
",al3x,2014-03-03 14:49:44
15,2013-08-31 17:29:59,"And even better solution, though maybe not as easy to implement using ansible, would be to generate a write only key for tarsnap and move the full key to another server. Leaving the Sovereign server only able to write backups. 
",sloped,2014-03-03 14:49:44
15,2013-11-03 16:48:05,"@abl & @sloped: Have either of you had any luck with this? If you've got it working, please submit a PR.
",lukecyca,2014-03-03 14:49:44
15,2013-11-05 17:44:32,"Oh. Yes, it was a pretty trivial fix (although I didn't fix the playbooks, and my server is on an ancient-ish revision of Sovereign and needs to be taken down and rebuilt.)

I'll have to get employer permission to submit a PR; may be awhile before I fire it up.
",abl,2014-03-03 14:49:44
15,2014-01-12 23:10:42,"@abl: can we expect a PR, or should we work on this ourselves? Thanks.
",al3x,2014-03-03 14:49:44
15,2014-01-21 21:30:41,"@al3x - still waiting on employer approval :( I promise it was a really quick fix, however, so I'd say to just go ahead with it.
",abl,2014-03-03 14:49:44
14,2013-08-24 16:44:36,"It looks like wildcard certs are quite expensive (hundreds of dollars per year). Is it absolutely required for installing Sovereign? If so, can you explain a little more about how you self-signed or point to a tutorial? A quick Google search brought up [this tutorial](http://blog.justin.kelly.org.au/how-to-create-self-signed-wildcard-ssl-certificates-for-apache/) but it seems a little too easy for something that's so expensive from a provider.
",patik,2013-08-28 00:45:43
14,2013-08-25 10:42:53,"Self-signed is trivially easy; the problem is everything you connect with will squawk (unless you import your self-signed cert everywhere.)

StartSSL offers non-wildcard certs for free.

I just (mostly; haven't finished mail yet) set up Sovereign tonight and all I had to generate was a www.DOMAIN.COM and a cloud.DOMAIN.COM cert; if you start with the www.DOMAIN.COM cert from startssl (which is also good for DOMAIN.COM) as your wildcard cert, you just need to patch /etc/sites-enabled/owncloud to point to a cloud.DOMAIN.COM cert.

YMMV; haven't gone down the full list yet.
",abl,2013-08-28 00:45:43
14,2013-08-28 00:45:43,"@cpatik Yes, wildcard SSL certificates are not cheap, unfortunately. I got mine from https://www.positivessl.com, as they offered the lowest price I could find. It was quick and fairly painless.

A _via media_ between self-signing and a pricey wildcard cert would be purchasing a standard (non-wildcard) cert and avoiding the use of subdomains. This is entirely doable, as there's no technical reason why things like email and ownCloud need to reside at subdomains, though certainly it makes DNS management a bit cleaner.
",al3x,2013-08-28 00:45:43
14,2013-08-28 00:50:08,"Just to be clear, I generated some six non-wildcard certs with StartSSL and spliced them in as appropriate. Works great, cost nothing.
",abl,2013-08-28 00:45:43
14,2013-08-28 01:55:54,"> I generated some six non-wildcard certs with StartSSL and spliced them in as appropriate.

Thanks. That's what I was looking for‚Äîwhether a wildcard was truly necessary or if there is some manageable number of subdomains to configure.
",patik,2013-08-28 00:45:43
14,2014-01-06 19:18:39,"@abl When you say splice what did you mean? I started this thinking the Wildcard SSL was going to be required for the subdomains, otherwise I would need multiple IPs. I bought an AlphaSSL wildcard rather cheap through ssl2buy.com but if I could get multiple StartSSL certificates to work I might try to back out of the purchase.

What (and Why) were the requirements for the X.509 certificate and server configuration to have successful and secure SSL/TLS sessions?

Class 1 certificates needed 1 IP per 1 host name ( the full one subdomain.domain.com) right? 

Class 2 could have multiple domains or subdomains, but only explicitly, did they have IP requirements?

then the wildcard, which would work for the domain and all subdomains (only one deep, no sub.sub.domain.com) and they can all be on a single IP right?
",EHLOVader,2013-08-28 00:45:43
14,2014-01-07 00:50:56,"NOTE: I like wildcard certs. I wish I had one. I'm just too cheap. :)

The answer to your question, kind of, is http://en.wikipedia.org/wiki/Server_Name_Indication - TL;DR extension to TLS, supported since 2007, allows for virtual domains to have independent SSL certificates.

Combine this with multiple free StartSSL Class 1 certificates (actually they might be class 2 - they all include ""X.domain.com"" and ""domain.com"", so that's two SSL domains) and you can avoid using a wildcard cert.

For each VirtualHost directive, add a set of SSL directives that point to the specific key, cert, and chain for the individual certificates.

http://www.digicert.com/ssl-support/apache-multiple-ssl-certificates-using-sni.htm has a bit more detail.
",abl,2013-08-28 00:45:43
14,2014-01-07 05:09:35,"Thanks abl. I was under the assumption all TLS happened before hosts, but this patch they added fixes that. Definitely solves that problem. 

I wondered about self-signed certs, I currently use one for my ircbouncer, but i could see that being an issue for webmail, owncloud, etc in the browser.

I am cheap too, I found this certificate for $30/yr, at ssl2buy (had to buy 5 years to get that deal) which I later found out startssl may have had the same deal for their verified certificates that are wildcard capable, for only 2 year minimum. I am also planning on installing all of this (and maybe more if it can take it) on a LowEndBox deal from the holiday season. 
",EHLOVader,2013-08-28 00:45:43
14,2014-05-17 09:32:51,"It'd be great if sovereign (optionally) used just one hostname for all services.
Web services could run at different paths on the same server.
Other services have their own ports anyway so they don't require special care.

Note that SNI currently has a small drawback, the hostname gets transmitted in the clear.
",neuhaus,2013-08-28 00:45:43
13,2013-08-24 09:43:02,"I wrote one a few years ago: https://github.com/naggie/vosbox 

It has a search engine and can crawl a server for all music, allowing streaming and playlist management/sharing.

Cheers
Naggie
",naggie,2013-08-28 00:51:57
13,2013-08-28 00:51:57,"This seems like it might be better suited to a home server than one that runs on a remote VPS? I'll accept a pull request but it's beyond the scope of what I need.
",al3x,2013-08-28 00:51:57
12,2013-08-24 01:24:38,"It doesn't seem to like the `--enable-python` option:

<S_CODE_TOKEN>
",larryhynes,2013-08-28 00:55:17
12,2013-08-24 06:19:57,"Since running ./configure with --enable-python from the command line works fine, I'm guessing it's something with the environment.  I had the same issue and got around that step by compiling znc manually.
",mnutt,2013-08-28 00:55:17
12,2013-08-24 09:33:04,"Yeah, that's my next move, thought I'd mention it here though. For reference it's on a fresh and updated Debian 7 64 install.
",larryhynes,2013-08-28 00:55:17
11,2013-08-22 05:51:54,,tjheeta,2013-08-28 00:59:03
11,2013-08-22 06:22:19,"Need to set the user to vagrant in site.yml + patch needed for vagrant itself for ansible for this to come up cleanly. 
",tjheeta,2013-08-28 00:59:03
10,2013-08-22 05:32:25,,tjheeta,2013-08-22 05:35:27
9,2013-08-22 05:14:53,,tjheeta,2013-08-28 00:47:17
9,2013-08-25 06:38:27,"Fixed it myself with exactly same solution. Minor change that is still necessary though, at the bottom due to the variables...

{% for virtual_domain in mail_virtual_domains %}
    INSERT INTO `{{mail_mysql_database}}`.`virtual_domains` (`id`, `name`)
    VALUES
        ('{{ virtual_domain.pk_id }}', '{{ virtual_domain.name }}');
{% endfor %}

{% for virtual_user in mail_virtual_users %}
    INSERT INTO `{{mail_mysql_database}}`.`virtual_users`  (`domain_id`, `password` , `email`)
    VALUES
    ('{{ virtual_user.domain_pk_id }}', '{{ virtual_user.password_hash }}', '{{ virtual_user.address }}');
{% endfor %}
",pjan,2013-08-28 00:47:17
8,2013-08-21 21:16:40,"Thoughts on including the header replacement for postfix to strip out the client's sending IP?
https://we.riseup.net/debian/mail#getting-your-postfix-anonymized

# apt-get install postfix-pcre
# grep smtp_header_checks /etc/postfix/main.cf
smtp_header_checks = pcre:/etc/postfix/maps/smtp_header_checks.pcre
# cat /etc/postfix/maps/smtp_header_checks.pcre
/^\s_(Received: from)[^\n]_(._)/ REPLACE $1 [127.0.0.1](localhost [127.0.0.1])$2
/^\s_User-Agent/        IGNORE
/^\s_X-Enigmail/        IGNORE
/^\s_X-Mailer/          IGNORE
/^\s*X-Originating-IP/  IGNORE
",cji,2014-01-17 16:28:05
8,2013-08-21 21:28:39,"I'm totally down with this. I'd like to include that conditionally, but on by default, I think.
",al3x,2014-01-17 16:28:05
8,2013-08-22 01:06:22,"Cool - wasn't sure how you wanted to handle the conditional execution for this otherwise I'd try and help and submit a pull request. :) Really great project! 
",cji,2014-01-17 16:28:05
8,2013-09-03 15:24:51,"If you only want them to be cleared from the outgoing mail, you should put this in the master.cf

Something like:

<S_CODE_TOKEN>

where /etc/postfix/smtp_header_checks can be like this (the first line is important, if you don't want to clear all the (previous) received headers from the other correspondents in the thread).

<S_CODE_TOKEN>
",pjan,2014-01-17 16:28:05
8,2014-01-16 08:06:19,"@cji any chance you could submit that pull request?

@al3x hop you don't mind me going through the issues too. :smile_cat: 
",tilsammans,2014-01-17 16:28:05
7,2013-08-21 14:22:42,"Supply/configure RoundCube Webmail would be nice.  I, and others I know, tend to use webmail more than native apps.  RoundCube, IMO, functions a lot like Gmail.

http://roundcube.net
",kjake,2013-09-24 15:50:16
7,2013-08-21 20:32:30,"RoundCube itself is not a pleasant thing to setup...so some other client would be fine too...  Something that is fairly modern/HTML5 is really all people need.
",kjake,2013-09-24 15:50:16
7,2013-08-21 20:35:25,"Well, not to be That OSS Guy, but I'd encourage you or someone else to submit a pull request with your webmail client of choice. I prefer native clients and I'm not comfortable with the additional attack surface that webmail would expose. Were I to integrate it, I'd probably only make it available inside the VPN.
",al3x,2013-09-24 15:50:16
7,2013-08-21 22:07:55,"That's totally cool, I understand.  Webapps, and servers for that matter, are often the target of exploits...though something like mod_security loaded into Apache could help with that.  Thanks for all the work that you've put into this.
",kjake,2013-09-24 15:50:16
7,2013-09-21 20:41:01,"Well. I submitted this pull request #35  just before reading the issue list... So, it's not into the VPN but it may help, @kjake
",lisael,2013-09-24 15:50:16
7,2013-09-24 14:44:08,"With #35, I believe this can be closed now.
",lukecyca,2013-09-24 15:50:16
6,2013-08-21 14:20:06,"Automated setup of a nice (free) two-factor auth platform like Duo Security would be cool.

https://www.duosecurity.com/vpn
https://www.duosecurity.com/unix
",kjake,2014-03-28 03:30:17
6,2013-08-21 19:12:39,"Yeah, agreed. That's probably my next addition.
",al3x,2014-03-28 03:30:17
6,2013-08-21 22:58:54,"OATH is a standard that is implemented in Authy and Google Authenticator. Duo, while a great product, is not based on OATH, therefore I would have to install another app. Please use OATH via google-authenticator, https://code.google.com/p/google-authenticator/
",robbiet480,2014-03-28 03:30:17
6,2013-08-22 04:22:50,"FWIW, the Duo app supports integration with Google Authenticator, so it
would actually replace that App.

There have been vulnerabilities disclosed with OAUTH systems (Google,
Twitter) that have allowed login, so I'm not sure it is the best solution.

https://blog.duosecurity.com/2013/02/bypassing-googles-two-factor-authentication/
  (now patched)

https://blog.duosecurity.com/2013/08/beyond-google-application-specific-password-exploiting-google-chromes-stored-oauth2-tokens/

FYI, Google's VC arm has invested in Duo...and no, I don't work for either
of them...just happen to believe that it is a great system that has, so
far, shown itself to be better than even RSA.
",kjake,2014-03-28 03:30:17
6,2013-08-23 18:37:29,"Perhaps an even better two-factor auth would [follow Twitter's model](http://www.wired.com/threatlevel/2013/08/twitter-new-two-facto/). (Using a S/KEY exchange with a client on your phone.) However, that isn't portable nor is it ready to go in a simple fashion. There would be a lot of work involved in doing it this way, so it probably isn't worth it for this.
",evaryont,2014-03-28 03:30:17
6,2013-08-25 18:10:36,"> Google Authenticator was recently made closed source

Google Authenticator, the apps, were recently made closed source. [google-authenticator](https://code.google.com/p/google-authenticator/source/browse/#git%2Flibpam), the PAM module, is still open source
",robbiet480,2014-03-28 03:30:17
6,2013-08-28 00:40:13,"I'm happy to accept a pull request for Google Authenticator support, but my personal preference is for Duo. I'll implement that when I have some free time.
",al3x,2014-03-28 03:30:17
6,2013-08-28 01:04:58,"My reading about Duo suggests you have to pay for it. Am I missing
something?

> I'm happy to accept a pull request for Google Authenticator support,
> but my personal preference is for Duo. I'll implement that when I have
> some free time.
> 
> ‚Äî
> Reply to this email directly or view it on GitHub
> https://github.com/al3x/sovereign/issues/6#issuecomment-23382347.
",vertis,2014-03-28 03:30:17
6,2013-08-28 01:14:53,"@vertis Please see https://www.duosecurity.com/editions and note the free Personal edition.
",al3x,2014-03-28 03:30:17
6,2013-08-28 01:24:07,"@al3x Ah, that makes more sense. The products page just has ""free trial""
everywhere.

On 28/08/13 11:14 AM, Alex Payne wrote:

> @vertis https://github.com/vertis Please see
> https://www.duosecurity.com/editions and note the free Personal edition.
> 
> ‚Äî
> Reply to this email directly or view it on GitHub
> https://github.com/al3x/sovereign/issues/6#issuecomment-23383529.
",vertis,2014-03-28 03:30:17
6,2013-08-28 19:37:01,"What about http://www.dynalogin.org/ ? Seems to be fully open source, whereas duo isn't. (I have not used either product, but generally veer towards open source security code)
",mpettitt,2014-03-28 03:30:17
6,2013-08-28 21:39:48,"@mpettitt Sure, seems good. Unified auth across the whole setup is probably a prerequisite for integrating any of these multi-factor auth solutions, though.
",al3x,2014-03-28 03:30:17
6,2013-11-25 00:29:29,"OATH and OAUTH are different things. Google authenticatior is an implementation of the HOTP and TOTP standards, see links etc from here:

https://en.wikipedia.org/wiki/Initiative_For_Open_Authentication
",JasperWallace,2014-03-28 03:30:17
6,2014-03-24 01:21:06,"I've got a working Duo Security implementation I'm willing to submit a PR for, but how integrated do we want to make it?  I put it in the common role under a separate ""duo"" tag, but to fully integrate it, I need to modify /etc/ssh/sshd_config with these settings:

<S_CODE_TOKEN>

Which may break the unit tests as I'm not sure we can script this.  Unless someone knows how to check for the presence of an ansible tag from within a template file.  Then I could just only include those if we are running with the ""duo"" tag.
",jplock,2014-03-28 03:30:17
6,2014-03-24 01:23:57,"Actually, I'll just append those using lineinfile in the duo role then I don't need to modify the sshd_config if we aren't using duo.
",jplock,2014-03-28 03:30:17
6,2014-03-24 01:36:51,"Do we want Duo integrated with just ssh or with PAM?  I'm not sure of the implementations on email and whatnot if we go the full PAM route.
",jplock,2014-03-28 03:30:17
6,2014-03-24 16:40:38,"The more stuff we can integrate with a MFA solution, the better. Whatever route gets us more coverage.

--¬†
Alex Payne
@al3x

From:¬†Justin Plock notifications@github.com
Reply:¬†al3x/sovereign reply@reply.github.com
Date:¬†March 23, 2014 at 21:37:11
To:¬†al3x/sovereign sovereign@noreply.github.com
Cc:¬†Alex Payne al3x@al3x.net
Subject:¬† Re: [sovereign] Two-factor Auth (#6)  

Do we want Duo integrated with just ssh or with PAM? I'm not sure of the implementations on email and whatnot if we go the full PAM route.

‚Äî
Reply to this email directly or view it on GitHub.
",al3x,2014-03-28 03:30:17
5,2013-08-20 21:24:24,"This is sweet.

Would it be valuable to include Tiny Tiny RSS or another server-side RSS aggregator?

http://tt-rss.org/redmine/projects/tt-rss/wiki
",hoosteeno,2013-12-29 00:19:57
5,2013-08-20 23:44:48,"@hoosteeno It probably would be valuable to someone :) You're welcome to submit a playbook for that if you have time.
",al3x,2013-12-29 00:19:57
5,2013-08-21 01:13:16,"[selfoss](http://selfoss.aditu.de/) is also an option. I might add it when I start using ansible for my VPS but won't find the time this week.
",phaer,2013-12-29 00:19:57
5,2013-08-21 23:17:13,"There's an ownCloud plugin for RSS aggregation, available in the repository from the admin settings menu.
",logomancer,2013-12-29 00:19:57
5,2013-10-17 23:54:41,"I also vote for this feature, I recommend Feedbin (https://github.com/feedbin). It seems promising. 
",code-guru,2013-12-29 00:19:57
5,2013-11-13 02:43:58,"+1
i would suggest [newsblur](https://github.com/samuelclay/NewsBlur)
it seems to be not that easy to setup though
",i-trofimtschuk,2013-12-29 00:19:57
5,2013-11-22 23:33:38,"I personally use selfoss which uses mysql and php so it's light compared to some of the other suggestions here.
",stephenjamieson,2013-12-29 00:19:57
5,2013-11-24 17:07:48,"+1 for Feedbin - an excellent app.
",keybits,2013-12-29 00:19:57
4,2013-08-20 20:21:21,"http://docs.services.mozilla.com/howtos/run-sync.html
",vsviridov,2013-08-20 23:45:21
4,2013-08-20 20:57:16,"There's an OwnCloud app for this, and set up is explained in [this blog post](http://techchillings.nl/index.php/2013/04/nederlands-firefox-sync-server-met-owncloud/).
",jeffbr13,2013-08-20 23:45:21
3,2013-08-20 20:18:43,"http://baikal-server.com/ comes to mind.
",vsviridov,2013-09-24 17:16:48
3,2013-08-20 21:01:31,"@vsviridov Can you describe why you'd like an alternative? I originally used [Radicale](http://radicale.org) but found it somewhat buggy compared to ownCloud's implementation of those standards. Plus, ownCloud gives you Dropbox-style sync and other nice features ""for free"".
",al3x,2013-09-24 17:16:48
3,2013-08-20 21:13:41,"I guess it's just more lightweight, and for people who do not want the whole cloud stack, just bits and pieces...
",vsviridov,2013-09-24 17:16:48
3,2013-09-24 17:16:48,"I haven't heard any further requests for this, and I'm still a believer in benefits of ownCloud. Closing.
",al3x,2013-09-24 17:16:48
2,2013-08-20 20:18:06,"eJabberd server with postgres auth would fit in nicely
",vsviridov,2013-12-09 22:03:38
2,2013-08-20 20:59:57,"I thought about including this but I don't have a personal need for Jabber/XMPP thanks to IRC and hosted services like HipChat. Plus I'm a little scarred from previous experiences with XMPP.

OpenFire is a little easier to administer, and would be my suggestion to someone who wants to implement XMPP support.
",al3x,2013-12-09 22:03:38
2,2013-09-24 17:18:53,"Another feature that I haven't since heard any requests for. The value of XMPP has, sadly, decreased dramatically since Google stopped allowing Talk users to communicate with the rest of the Internet. Anecdotally, anyone I know who has a non-Talk XMPP account is probably also on IRC.

Would still entertain a pull request for this, but closing for now.
",al3x,2013-12-09 22:03:38
2,2013-10-07 22:19:25,"Had a change of heart. Currently experimenting with [http://prosody.im/](Prosody).
",al3x,2013-12-09 22:03:38
2,2013-10-07 22:22:58,"(How do you judge how many requests there are for a feature? I could file a dupe but that doesn't seem to help. And GitHub doesn't allow users to vote on bugs, or to see how many users are watching a thread.)
",rgov,2013-12-09 22:03:38
2,2013-10-07 22:24:25,"Count +1's in comments? :)
",vsviridov,2013-12-09 22:03:38
2,2013-10-07 23:08:23,"Yeah, +1s in comments are just fine. So far so good with Prosody, let me test for another couple days and then I'll merge it in.
",al3x,2013-12-09 22:03:38
2,2013-10-29 15:16:16,"Any update on timeline for this?
",pdebruic,2013-12-09 22:03:38
2,2013-10-29 15:28:08,"+1 !
",nowfred,2013-12-09 22:03:38
2,2013-10-31 01:14:53,"+1
",arcwhite,2013-12-09 22:03:38
2,2013-11-13 02:40:56,"+1
",i-trofimtschuk,2013-12-09 22:03:38
2,2013-11-30 01:47:29,"+1
",jeffbr13,2013-12-09 22:03:38
2,2015-01-02 08:11:34,"Hi. Personally I like ejabberd more, simply because I already know how to administer it. So suppose I fork sovereign and replace prosody. Could that be merged back here? Is there a way to express alternative roles ? 
",flasheater,2013-12-09 22:03:38
2,2015-01-02 14:28:52,"@flasheater You're encouraged to fork and/or modify your particular Sovereign installation. However, we've chosen Prosody because of its easy administration and low memory footprint, so we're unlikely to replace it with Ejabberd.

You may find https://github.com/birkand/ansible-role-lider-ejabberd useful.
",al3x,2013-12-09 22:03:38
2,2015-01-02 14:52:05,"Maybe I was not clear enough, but the idea is not to replace prosody, but
offer both.

For example, the xmpp role could have an ejabberd.yml additionally and the
main.yml would either include prosody.yml or ejabberd.yml based on some
variable.

I am asking because I am about to fork sovereign and add ejabberd for my
own purposes and maybe having alternate implementations of roles is
something you are interested in pulling from.

-- Oliver Krylow
",flasheater,2013-12-09 22:03:38
2,2015-01-02 15:13:59,"We've tried to stick to a single option for each service that Sovereign provides. ""Curating"" the selection of software for running a personal cloud is a large part of the value of Sovereign. Introducing additional choices into the setup process decreases that value, from my perspective. But we'd be happy to link to your alternate implementation from the README or wiki.
",al3x,2013-12-09 22:03:38
2,2015-01-02 15:30:41,"-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

I can definitely see the value in that. It's more simple and easier to maintain.

However, don't you 'lose out' on many potential contributions as every fork that replaces something gets hard to pull from?

On January 2, 2015 4:14:07 PM CET, Alex Payne notifications@github.com wrote:

> We've tried to stick to a single option for each service that Sovereign
> provides. ""Curating"" the selection of software for running a personal
> cloud is a large part of the value of Sovereign. Introducing additional
> choices into the setup process decreases that value, from my
> perspective. But we'd be happy to link to your alternate implementation
> from the README or wiki.
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/al3x/sovereign/issues/2#issuecomment-68533068
> -----BEGIN PGP SIGNATURE-----

iQI/BAEBCAApIhxPbGl2ZXIgS3J5bG93IDxva3J5bG93QGdtYWlsLmNvbT4FAlSm
uZcACgkQovQI0wu3odaP2BAAkFhd444zy4P6muMWwvgrhzsq6da4h+WMxS0+WJKR
WVSfwvyDaUma4oO1mVn5REBg5CqESf2pEWkcvWiGriwwkHSNflfYDTr8vaSC0R0+
ERgrfKkIbPcXsiLyJm0Pd5QB23Xm0wahGtChqOb+llD4q1BR8Rv+aqrjf2duH3Z/
luaEG3aCbwZtJ9+I/VbU+BNoYoj8uY2nwdsUITnczYNjmn5N0JCQMtMe/d3y0WrJ
nq+hFem/Eqkcn0siHd/0Lfu8pf5zpOreMkAjxgVnMSBDwYA5j5J53ZxKs8JnoBvf
gcgpwlnA8oAJWpzIItSHCDaGglj+2VbCvjFIzaoZ0N9IHThgb5nG6iQNV9j7q7wA
Fv2yZC4s/IF+rwdm1yH5wbIvtWH9NF1MYBJ6kwdIbJo60H8ix0y7CM0wRQXlrIoq
0TTWQskQhZmjrGBsvXwSZau2VF6InjoahZU9V5RWHK/vN2UVi2p7vDOHMItwmmj+
R6B0LgdnBDhrzo0oCdCw0I0PNj1DUCuk9LQyHu1eN1hIdsXMzAIdvnbKAuYasZBD
tYvPd1h9W0Ipr8/Qf6TFtxXdGhlvXGsneCCHNr/P9ANy3a6bHf2nr6QzOl6h6PoR
ZWp3/D8OKrRte+twcwsz+JDT4A1AKuymiudgGDYsQzM2gYPAIMeqoC+VIoma/ViE
DR0=
=LR8F
-----END PGP SIGNATURE-----
",flasheater,2013-12-09 22:03:38
1,2013-08-19 22:49:56,"Can you please add a webmail client that uses NODE.js and email server backed by MongoDB? This way when my email needs scaling I can just add servers.

TIA
",sorenmacbeth,2013-08-20 23:20:08
