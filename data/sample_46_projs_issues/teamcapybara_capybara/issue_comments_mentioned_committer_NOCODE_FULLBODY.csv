issue_num,datetime,body,login,mention_login
1845,2017-03-11 23:02:15,"@twalpole Thanks a lot for your quick feedback. I have corrected affected drivers. You are right, originally I tested on phantomjs driver (selenium-webdriver gem). You also are right regarding edge case when a title is missing in a frame. I proposed a raw code.

If the bug is fully connected with selenium-webdriver gem, I suggest to post the corresponding issue there and close this one. At least other users will have an ability to find this conversation about the problem.",romikoops,twalpole
1845,2017-03-13 22:29:16,"@mhoran Yeah -- I'm wavering between whether Capybara should add `frame_url` and `frame_title` driver methods (and then maybe allow a parameter for assert_current_path, assert_title to choose that the user wants frame level) or make seleniums `title` and `current_url` return the frames info when in the frame context.   The first would more align with the webdriver spec (and I prefer to go towards that), but I'm having a hard time coming up with a case where it makes sense to want to check the pages URL from inside a frame context.",twalpole,mhoran
1845,2017-03-14 03:40:49,"Yeah, I agree. I think the top frame makes sense.

On Mon, Mar 13, 2017 at 03:29:21PM -0700, Thomas Walpole wrote:
> @mhoran Yeah -- I'm wavering between whether Capybara should add `frame_url` and `frame_title` driver methods (and then maybe allow a parameter for assert_current_path, assert_title to choose that the user wants frame level) or make seleniums `title` and `current_url` return the frames info when in the frame context.   The first would more align with the webdriver spec, but I'm having a hard time coming up with a case where it makes sense to want to check the wholes pages URL from inside a frame context.
> 
> -- 
> You are receiving this because you were mentioned.
> Reply to this email directly or view it on GitHub:
> https://github.com/teamcapybara/capybara/issues/1845#issuecomment-286263845

-- 
Matt Horan matt@matthoran.com http://matthoran.com/
",mhoran,mhoran
1845,2017-03-14 17:01:24,"@route - yes there is.  

Ok, so I think the consensus is that current_url and title when called on the session should return the top level context url and title (that which would be shown in the browser) which is how selenium currently works. For Capybara 2.14, not the 2.13 release going out today/tomorrow, I'll add tests for that (will require changes in poltergeist and capybara-webkit) and look at possibly adding some frame specific title and url methods.  Sound good?",twalpole,route
1845,2017-03-14 18:09:15,@twalpole yep perfect,route,twalpole
1845,2017-03-14 18:39:44,@twalpole Amazing! Let me know if I can help you with something.,romikoops,twalpole
1843,2017-03-07 16:49:12,@twalpole thanks for the feedback - I brought back a `Test::Unit` specific section to the README and left the Rails/Minitest after it.,lucasmazza,twalpole
1839,2017-02-28 21:12:31,I've been doing more testing with this and I agree with @twalpole conclusion. I'll check into his suggestion about elementScrollBehavior with FF and see if it helps my test. Thanks.,rugill,twalpole
1839,2017-03-01 11:50:37,"@twalpole thanks for the feedback. While the page I linked has animations, I have been able to reproduce this issue on a page that has no animated menu as well, but since it's not a public application, I cannot share that link unfortunately.

The reason this is confusing to me is that even if the animation is running slower, I would expect it to *not find* the link. On the other hand, if the link is actually found and clicked, why is the click not being triggered?

In our local example, we were able to reproduce this in Xvfb and a ratpoison window manager which automatically full-screens the Firefox. Then we would:
1. Open Firefox A, navigate to a page
2. Open Firefox B, this hides Firefox A completely
3. In Firefox A session, navigate to another page, then click a link.

The result will be: The click brings Firefox A into the foreground (!) and there is a hover effect over the link/button. But it was not clicked.",rbu,twalpole
1839,2017-03-06 12:05:30,"@twalpole, Thank you for the feedback. As I mentioned, I was not able to reduce the core Firefox/Selenium issue further so it could become a good bug report. I'll close this for now, as you point out it is not a Capybara issue.

As a sidenote, do you know if Selenium accepts bugs written using the Capybara API?",rbu,twalpole
1830,2017-01-27 21:52:57,@abotalov No - it supports returning AN element -- It's not going to run through objects to figure out whether or not they have elements in them at the current time.  If you want to implement that and submit a PR - feel free,twalpole,abotalov
1830,2017-01-28 22:36:46,@abotalov Actually - I've implemented full unwrapping for selenium - Just need to check it can work with Poltergeist and CapybaraWebkit too,twalpole,abotalov
1827,2017-01-13 22:44:09,"@twalpole Yeah I hadn't either until we experimented moving our suite to BrowserStack. I've noticed a lot of latency in general. Regardless, I figured it wouldn't hurt to prevent this issue from raising an exception in Capybara.

Thanks for the suggestion! I've updated the mock, squashed commits, and updated.

@abotalov I'll take a look into this.",dylanlive,abotalov
1827,2017-01-13 22:44:09,"@twalpole Yeah I hadn't either until we experimented moving our suite to BrowserStack. I've noticed a lot of latency in general. Regardless, I figured it wouldn't hurt to prevent this issue from raising an exception in Capybara.

Thanks for the suggestion! I've updated the mock, squashed commits, and updated.

@abotalov I'll take a look into this.",dylanlive,twalpole
1826,2017-01-10 19:02:31,@abotalov  Yeah - I think I'm just going to mark 2.4.0 as allowed failures on travis and ignore it for now - 2.4.0 is basically unusable if anything included into a project uses delegators from forwardable.,twalpole,abotalov
1824,2017-01-03 22:02:21,"Thanks @twalpole - I'm not entirely sure of the expected behavior yet (I just inherited this codebase and I don't have anyone that I can ping questions to). I'll continue to explore it and if it turns out to be unexpected, then I'll be back. Thanks for the follow up- that makes sense to me!",davidwparker,twalpole
1823,2017-01-05 07:57:49,@abotalov Which version of selenium?  That would violate the definition of interactibility from the webdriver spec https://www.w3.org/TR/webdriver/#element-interactability,twalpole,abotalov
1823,2017-01-05 22:48:57,"@abotalov Ok -- that example does fail when testing Selenium with Firefox without marionette (<= 2.47) - with a Selenium::WebDriver::Error::ElementNotVisibleError eror, but it looks like geckodriver and chromedriver support attaching a file to non visible file inputs",twalpole,abotalov
1821,2017-01-07 16:11:46,@twalpole Do we have both in poltergeist?,route,twalpole
1821,2017-01-07 16:29:51,"@route - Yes, I implemented both in Poltergeist (not released yet though), it should be passing all the capybara master branch tests.  ",twalpole,route
1820,2017-01-03 09:29:47,"@abotalov `page.assert_all_of_selectors(:css, '#my_div', 'a.not_clicked') ` is slightly less typing and reads fine - see the rails PR linked above ",twalpole,abotalov
1818,2017-01-03 09:25:00,"@abotalov Yeah - I originally had it as :style_change but didn't like that -- I'm not sure I like `preset_style`, maybe `set_style` -  I'll think about it",twalpole,abotalov
1818,2017-01-03 09:30:46,@strika - no there isn't due to the many ways an element can be hidden,twalpole,strika
1818,2017-01-03 19:00:27,"With a night of sleep on this, I like the idea put forward by @strika, with a minor extension.  We could have a `make_visible: true` option that defaults to setting something like `opacity: 1, display: block`  - and if that doesn't work for a specific users site they can set it to a hash of settings to change.",twalpole,strika
1816,2016-12-30 09:33:08,"Thank you for the kind words @twalpole, its the least I could do as a longtime user of Capybara, - and thank you even more for the fix.

I've realized my reproduction case above is incomplete, it doesn't cover ancestor fieldsets that aren't direct parents. I'm unsure if the changes at https://github.com/teamcapybara/capybara/pull/1817/files#diff-7064352df631f346ca44fb93af7af952R96 will cover this scenario:


",eliotsykes,twalpole
1815,2016-12-29 23:53:45,"@strika Rather than saying ""If the application that you are testing is a Rails app"" say something like ""If you have required capybara/rails Capybara.save_path will default to ...""",twalpole,strika
1815,2016-12-30 20:39:37,@strika save_and_open_page_path is deprecated so it doesn't matter,twalpole,strika
1814,2017-01-05 21:40:03,"@abotalov The issue this is proposed to solve is really the `within` issue when RSpecs matchers override Capybaras version of the method.  In all the other cases of `all` and `within` the user ends up with some sort of error which allows them to, eventually, work out that it's calling the wrong method.  With RSpecs `within` overriding Capybaras though it just ends up with the test silently ignoring a block of code

    within(element) do
      expect(page).to have_content('Some test')  # ends up not being run if RSpecs `within` has shadowed Capybara's 
    end

which leads to false passing of tests (the worst possible outcome)

Since RSpecs `within` matcher doesn't take a block, but Capybaras version always does, I proposed having RSpec flag that as an error which would at least have warned users - but that was not acceptable.  I don't have time to continue proposing other changes to RSpec that may or may not be acceptable, and the maintainers of RSpec don't seem to really consider it to be an issue that needs flagging,  so I'm looking to do anything I can purely in Capybara to at least give users notice that things may not be as expected.  Adding `within_element` is definitely a possibility but, as you said, doesn't solve usage in existing tests.

Either way they are both available to be used in the same test, either via  RSpec.all/RSpec.within, or page.all/page.within but without any indication that the wrong one is being used (silent ignoring) the user isn't notified in any way",twalpole,abotalov
1812,2016-12-23 16:11:30,"@abotalov Yes it was, because it was reported to not be possible (or very difficult) in other drivers.  What has changed is that I went ahead and implemented it for Poltergeist - https://github.com/teampoltergeist/poltergeist/pull/838 - so it's not a Selenium specific feature anymore",twalpole,abotalov
1810,2017-01-03 22:06:03,"@abotalov Definitely seems that it's not removed.  This PR doesn't really do anything that will break things so it should be safe to merge, just waiting for a response from the OP of Issue #1809 to make sure if fixed the issue for them.  There's also the question of whether or not there's much use in trying to use Capybara with Chrome when javascript is disabled -- Haven't really tried anything to find out.",twalpole,abotalov
1804,2016-12-14 18:16:51,"Thank you @twalpole  for your fast reply.


> [...] changing the page isn't really something I consider desirable

This is the reason why in my last comment I suggested to add an option to enable/disable it.

> We do provide the asset_host setting which can be set so you can load up the saved page and load the assets from a different base url ...

This option require to have a running server, where my feature doesn't, which ease the life of developers.

> [...] if you really want to see what the page looked like in the browser there is save_screenshot.

As far as I know, this requires to have a JavaScript driver which is slow. (Correct me if I'm wrong).
Also this prevent developers to inspect the page and see the CSS rules for example.

The added code is really small, and with an option to enable it (disabled by default) would give us the best of both worlds.",zedtux,twalpole
1798,2016-11-23 09:08:37,"@twalpole I haven't debugged how it happens. `quit` is being called by Capybara and it raises an exception. I noticed that the same exception, with a different message is being handled already in Capybara code, so I updated the code to preserve the same behaviour against the latest versions of Firefox/geckodriver. All I can add is that Firefox is shut down without any processes hanging around after the test suite finishes, same goes for the geckodriver process.",psyho,twalpole
1796,2016-11-20 22:11:05,"Thanks for this @twalpole .

For those who may visit this issue in the future having a similar problem, be sure to:
- Set default_driver as selenium
- If you want to replicate the functionality of save_and_open_page with `save_screenshot`, I found `save_and_open_image` from the [capybara-screenshot](https://github.com/mattheworiordan/capybara-screenshot) gem helpful. 
",Schwad,twalpole
1788,2016-11-09 20:19:32,"Appreciate the insight @twalpole .  I wasn't familiar with the `Capybara.string` behavior.

Note to anyone else reading this issue: `has_content?` throws a `NoMethodError` on a string, but `have_content` converts it to an element.
",ronwsmith,twalpole
1787,2016-11-09 19:18:35,"Thanks for the quick review @twalpole 

> in the current form it will attempt to call set on a non-visible element if allow_label_click is false (default) which is not acceptable.

Where `allow_label_click` is false the implemention in this PR will raise at [line 156](https://github.com/mrloop/capybara/blob/d8d57df8bef11ddf674e3a6f9f5a89b6fd576acb/lib/capybara/node/actions.rb#L156)
`cbox = find(:checkbox, locator, options.merge({visible: (allow_label_click ? :all : true)}))`

This scenario is tested for [here](https://github.com/mrloop/capybara/blob/d8d57df8bef11ddf674e3a6f9f5a89b6fd576acb/lib/capybara/spec/session/check_spec.rb#L160) , maybe the ternary operator doesn't help readability, also not sure if it's in keeping with the project style. Let me know if it's acceptable in it's current form or if it needs changed.
",mrloop,twalpole
1787,2016-11-09 20:08:14,"@twalpole great I'll try out #1789 with test suite tomorrow. (UTC+00:00)
",mrloop,twalpole
1787,2016-11-10 08:36:02,"@twalpole #1789 working as expected. I'll close this PR in favour of yours. Thanks for coming up with better solution and I now know capybara internals a little bit better :) 
",mrloop,twalpole
1776,2016-10-26 22:08:40,"@twalpole will do .. thanks
",pkmiec,twalpole
1776,2016-10-30 20:46:38,"@twalpole i tested it on my giant monitor and it works.
",pkmiec,twalpole
1775,2016-10-13 18:46:34,"@twalpole Tested and verified this will catch the case of a user closing the browser on Grid.

Unfortunately I don't believe it will catch other Grid connection issues, such as an SO_TIMEOUT. SO_TIMEOUT's also fall under `Selenium::WebDriver::Error::UnknownError`, but have a different exception message.

The easy solution would be to add another expected message to catch, but I fear the maintenance of string matching... what are your thoughts?

Exception:



For brevity of this comment, I made a gist containing the backtrace:
https://gist.github.com/dylanlive/df4645d54cdaa21c170c9fec1e62cc3a
",dylanlive,twalpole
1775,2016-10-13 19:08:59,"@dylanlive  Ugh -- and this is the problem with UnknownError - I'm not interested in maintaining the strings and really don't want to just ignore all the errors - how often are you getting these errors?  There's an argument to be made that SO_TIMEOUT is an error some people would actually want to know about since the timeouts could potentially be adjusted.
",twalpole,dylanlive
1775,2016-10-13 19:46:16,"@twalpole I concur :P

Reasonable argument that people would want to know about it; however, the exception will likely still be raised during test execution (which can be caught in an rspec around block).

If the session was already terminated, does it make sense for quit to raise an exception? Likely the same argument could be used for `Errno::ECONNREFUSED`.

As for my experience with the SO_TIMEOUT's, they're occurring around some of our bandwidth throttling scenarios. Need to spend time researching prevention, but in the interim, was looking at recovery. The at_exit logic to quit is killing recovery efforts.
",dylanlive,twalpole
1774,2016-10-13 16:50:23,"@dylanlive  Please try the selenium_quit_error branch/PR #1775 and see if that solves the issue you're having  -  Closing this in favor of the more limited error ignoring (assuming it works)
",twalpole,dylanlive
1766,2016-09-30 15:43:55,"@twalpole also I found this but not sure if it's a bug or not supported (hidden field):


",vizcay,twalpole
1766,2016-09-30 17:10:46,"@twalpole yes but usually I'm checking the value of a field:

`expect(page).to have_css('input[type=""hidden""][value=""xxx""].retencion_ganancias_destroy', visible: false)`

that looks like too much.. so I will explore the custom selector route.. this will be ideal:

`page.has_selector?(:hidden_field, class: 'retencion_ganancias_destroy', with: 'xxx')`

Thanks
",vizcay,twalpole
1765,2016-09-30 04:42:56,"@elliterate you need to use different text for your added button so it doesn't cause ambiguous issues with the other tests. Other than that this looks good.
",twalpole,elliterate
1763,2016-09-29 16:26:41,"@abotalov It was an intermediate step while I thought about whether it made sense to have on all the specialized matchers/finders or only on the general versions
",twalpole,abotalov
1761,2016-09-15 14:06:07,"Hi @twalpole 
I'm using Selenium as the driver. The failing test code looks like this:



and passes when I add `page.execute_script(""$('#scheduled_report_hour_of_day_to_send').blur()"")` before the assertion. Really nothing noteworthy about the HTML this tests...

There should be no conflicting listeners on the select. If this is not the standard/expected behavior from capybara (leaving the dropdown open), then I'll just live with this fix for now. I created this issue under the assumption that it was.
",phillipspc,twalpole
1761,2016-09-19 16:56:11,"@twalpole using firefox with selenium
",phillipspc,twalpole
1761,2016-09-19 19:29:01,"@twalpole thats fine. thanks for taking a look. We're also on an older version, so that may be a factor.
",phillipspc,twalpole
1755,2016-09-13 14:31:21,"@twalpole:

Great, I think that 

`expect(page).to have_field(class: 'subtotal', with: '125.00')`

is by far the best syntax.. that will be on 2.8.2 ?
",vizcay,twalpole
1746,2016-08-26 10:57:23,"@twalpole 
Thank for reply!, 
Sorry for incomplete information.
Problem already solved, I just give up on using placeholder, Just use the ID of the <input> element



This work for me

one of my html



Thanks again
have a nice day :D
",1c7,twalpole
1744,2016-09-01 21:58:35,"@twalpole - 3.0.0.beta3 is now released with the latest updates
Simon suggested he'd follow up on this tomorrow as far as what the w3c spec should do for the send keys.

Speaking of Capybara tests. How do I run a single selenium test, I couldn't find documentation on it? I miss the ability to right click in Rubymine and run a single spec. :)
",titusfortner,twalpole
1744,2016-09-02 00:29:32,"@twalpole, Thanks! Yeah the Watir project currently uses a submodule for running watirspecs with different projects. Submodules are kind of a pain, though, so we are considering the option of something similar to what Capybara does. It seems to be substituting one type of pain for another, though. :)
",titusfortner,twalpole
1744,2016-09-04 19:49:18,"@twalpole - fwiw, getAttribute is down to 7KB in beta3.1 :)
",titusfortner,twalpole
1728,2016-07-30 09:03:02,"@twalpole  Hi!  I updated the doc for the find_field, has_field?, and has_no_field? methods and changed the tests to use some Regexp features.
",donv,twalpole
1728,2016-08-01 20:31:19,"@twalpole Thanks for the tip.  I changed the type identifier separator to comma with a trailing space.
",donv,twalpole
1724,2016-07-22 18:46:01,"@twalpole sorry, that was a typo, fixed, everything is in `spec/`

And YES! I had `config.shared_context_metadata_behavior = :apply_to_host_groups` because the comment above said:



Changing it back fixed it!

I'm closing this issue, but can you please explain what happened? And if this will be a problem with Rspec 4 comes out?
",amingilani,twalpole
1724,2016-07-22 19:29:35,"@twalpole: Makes sense! Thank you for the explanation!
",amingilani,twalpole
1721,2016-07-29 01:03:03,"@mhoran Would you prefer I push a release until the beginning of next week?
",twalpole,mhoran
1721,2016-07-29 18:47:28,"@mhoran  Okay - I'll delay until the beginning of next week - let me know if there are any issues.
",twalpole,mhoran
1721,2016-07-29 20:06:53,"@mhoran I understand Chromium is being investigated for the next development of capybara-webkit but any chance of capybara-webkit doing a release that requires Qt 5.5+ , gets rid of the font override hack, etc -- People using older versions of Qt really seem to be the major source of issues with capybara-webkit.
",twalpole,mhoran
1721,2016-07-30 13:25:06,"@twalpole we had intended to release 2.0 at some point and drop support for Qt 4.8, but had no intentions of requiring a certain Qt 5 version. Unfortunately, I think a number of users are still on Qt 5.2 (Ubuntu trusty). Debian jessie provides 5.3, and to get 5.4, Ubuntu wily is required. 5.5 is only available in Ubuntu xenial, and Debian unstable includes 5.6 (which no longer includes the QtWebKit module).

Then there are the official binary releases from the Qt Project, which we've always recommended to our users. Unfortunately, most folks don't bother using these packages.

Based on the above, I have the feeling a version lock to 5.5 would be more trouble than it's worth.
",mhoran,twalpole
1721,2016-08-01 16:23:33,"@headius I don't think it's a JRuby issue, but rather a Travis-CI issue with JRuby configuration.  @mhoran Yeah I gave up on trying to get the JRuby travis config to work.
",twalpole,mhoran
1718,2016-07-03 20:16:43,"@twalpole - Fair enough. Thanks for detailed answer.
I'll state anyhow that the rack version that support Ruby 1.9.3 and should be forced in the Gemfile is ""**1.6.4**"" -(in-case someone will stumble upon this thread in the future with the same problem).

Thanks.
",amitz,twalpole
1716,2016-06-30 14:56:53,"@jonleighton Great that someone else is looking at this, since we've had some people who think it's causing issues (Issue #1715) but I don't see how it could be (maybe they have order issues with the database_cleaner fater block too).  An important thing to notice is that wait_for_pending_requests is only called after the session has set the page back to about:blank so there really shouldn't be any more requests started after that.
",twalpole,jonleighton
1716,2016-06-30 17:26:04,"@jonleighton Just to point out -- using `append_after` is the recommended standard config - https://github.com/DatabaseCleaner/database_cleaner#rspec-with-capybara-example
",twalpole,jonleighton
1715,2016-06-29 00:20:19,"@twalpole thanks for all that attention, much appreciated. I think the auto-increment isn't reset on the test dbs, thus causing the growing id numbers as you pointed out. Will go through your other points as well one-by-one. Thanks.

It certainly feels like something is funky with the db cleaner setup. as well, I will try to see if I can re-do those mocks and just do proper log-ins. 
",jasonfb,twalpole
1715,2016-06-30 21:00:36,"We solved this ---- it was _really_ hard. @twalpole You were right, the problem was in our setup.

Specifically, and importantly (documenting here), capybara-webkit will hold onto a cache of endpoints that are set to cache (makes sense, sort of). That means that even if you `Rails.cache.clear` on the server (which we tried), the headless driver has already cached our endpoint from a previous spec.

On the 2nd (subsequent) spec, the same endpoint is not fetched again by the headless driver, because it believes it already has it in the (headless driver's) web cache. Unfortunately for us, that important endpoint (which is just a giant JSON dump) is actually specific to our data, which was changing from spec to spec. 

So that's why on subsequent run my front-end was sending variant_id(s) to my backend that weren't in the database, because those old veriant IDs had already been deleted by database cleaner. 

So basically if you have endpoints that have cache-control headers on them (like, non-zero cache-control headers) you have to remember that the headless driver (webkit or poltergeist) will cache those responses inside of itself, even if you clear your Rails cache. This is why they pass individually but failed when run as a group. 

For now, we're going to `if Rails.env.test?` the cache control header, so that in test it will respond with 0 minutes (normally it responds with a 3 minute cache). However, is there any way to tell the driver (webkit or poltergeist-- we switch between them) not to hang onto the cache of endpoints it hits from spec-to-spec? That way, I could avoid the ugly `if Rails.env.test?`  in my app.
",jasonfb,twalpole
1710,2016-06-23 18:40:08,"@twalpole Thanks! 👍 
",gmcnaughton,twalpole
1710,2016-07-13 14:45:12,"@twalpole unfortunately it doesn't do much for me. It boots up the browser and doesn't get past the login page. Do we have any sense at what point there will be a stable alternative?
",mockdeep,twalpole
1710,2016-07-13 18:36:21,"@twalpole selenium-webdriver 2.54.3 doesn't work for me with FF 47. I get an unable to connect error:


",mockdeep,twalpole
1710,2016-11-16 00:58:41,"I figure since the question of porting the old FireFox profile config to Marionette was brought up in this thread it couldn't hurt to follow up on what happened. 

@gmcnaughton did you ever get the profile options working? I am having trouble determining if I am passing through the profile options correctly. The old way of configuring the browser using Capybara was the following:



now with marrionette set as true (as you know) the above code no longer works. So I am trying the following code:



I use a javascript in the page to see if the user agent has changed:

`alert(navigator.userAgent.toLowerCase())`

How did you encode the prefs to work like before with profile?
",dunban1,gmcnaughton
1710,2016-11-17 18:28:44,"@dunban1 Good question! I haven't had a chance to try again.  Personally we're still blocked by https://github.com/mozilla/geckodriver/issues/93 (support for self-signed certificates), so we're still running our test suite under FF 45.

@twalpole Thanks for the sample code (and all your work on this)!
",gmcnaughton,twalpole
1710,2016-11-22 01:21:49,"Thank you for your responses @twalpole and @gmcnaughton 

I get the following error with the code snippet:

when I add this line `Capybara.default_driver = :selenium` at the top. I get the following error instead:

The registration of the driver seems to be failing and it tries to use the fall back default which fails as well without proper configuration?

Perhaps there is another way that I should be looking at instead? For example, I have explored getting this to work is by referencing a pre-made FireFox profile. Is there a way to do this in Capybara with Marrionette?

I have been able to configure FireFox directly using selenium by linking the correct FireFox profile in the following code:



But I have no idea how to register the driver once I configured it directly. I imagine Capybara is designed to instantiate the driver only inside the register_driver. If not is there a way to get this working should passing the firefox_options object ultimately not work? 
",dunban1,gmcnaughton
1710,2016-11-22 01:21:49,"Thank you for your responses @twalpole and @gmcnaughton 

I get the following error with the code snippet:

when I add this line `Capybara.default_driver = :selenium` at the top. I get the following error instead:

The registration of the driver seems to be failing and it tries to use the fall back default which fails as well without proper configuration?

Perhaps there is another way that I should be looking at instead? For example, I have explored getting this to work is by referencing a pre-made FireFox profile. Is there a way to do this in Capybara with Marrionette?

I have been able to configure FireFox directly using selenium by linking the correct FireFox profile in the following code:



But I have no idea how to register the driver once I configured it directly. I imagine Capybara is designed to instantiate the driver only inside the register_driver. If not is there a way to get this working should passing the firefox_options object ultimately not work? 
",dunban1,twalpole
1710,2016-11-22 22:33:50,"For anyone that finds this thread and was looking for an answer to how to use firefox_options to configure the FireFox profile. The conversation shall be continued here: https://groups.google.com/forum/#!topic/ruby-capybara/AyAcBX9-lIE

@gmcnaughton FYI if you're eventually going to stop using FF47 once Marrionette stabilizes I would imagine you will need this answer as well.",dunban1,gmcnaughton
1709,2016-06-23 04:36:10,"@twalpole I am using ubuntu 14.04 LTS and I tried Synaptic package manager but it shows only 28.0 version.
",rafiqdeen,twalpole
1701,2016-05-17 09:21:59,"@twalpole : 
No, no `within` in this case. I actually tried to use `#app-navigation` as selector for a `within` initially and then realized the error pops up even for a plain `find(:xpath,'//html')`.
I'm not sure how to proceed with minimal reproducible debug. Between submitting the sign-in form and the attempt to access the dashboard page there is a lot of proprietary code at work.
",akseiya,twalpole
1698,2016-05-10 17:36:12,"@jnicklas - Updating the defaults seemed like the easiest way to make sure it was set all the time (unless overridden by the users options) - there really doesn't seem to be another place in the selenium API to do it nicely.
",twalpole,jnicklas
1697,2016-05-09 19:05:34,"I think the root cause of this is that selenium (with firefox at least) is dismissing the unhandled alert itself and no longer raising the error it used to (99% sure it used to).  Dismissing the alert rather than accepting it appears to prevent the location change so everything fails.  @jnicklas  - could you try setting the desired capability ""unexpectedAlertBehaviour"" (note English spelling of behaviour with a u) to ""ignore"" and see if your issue goes away, it fixes things in my tests and may be a preferable default since we are managing the alerts ourselves
",twalpole,jnicklas
1697,2016-05-09 22:22:24,"@jnicklas  Please look at PR #1698 and give your thoughts on that as opposed to this one.
",twalpole,jnicklas
1692,2016-04-28 17:54:56,"@jnicklas I think this may need more analysis -  The way it works currently - Session#reset! calls driver.reset!  which should be synchronous and not return until the browser has moved from the current page to about:blank (or equivalent).  There should be no way for the browser to initiate another request after this (if it is happening then I would think thats a driver bug).   Then wait_for_pending_requests is called to wait for any orphaned requests still being processed by the app to finish.  Once they are done then reset! finishes.   If the new request is coming from a second session that should also be fine because all sessions get reset before the test ends and DatabaseCleaner starts up.  
If this is happening because someone is manually managing sessions and calling DatabaseCleaner after resetting only one session but keeping another session running there is nothing we can do about that, it's user error.
",twalpole,jnicklas
1692,2016-04-28 19:02:43,"@jnicklas Do you happen to be opening multiple windows in the session (and not closing them) where this is happening (as opposed to multiple sessions) ?  I think only the currently active window gets navigated to about: blank on driver#reset! (in selenium) which means you could potentially be getting a request initiated from another window.
",twalpole,jnicklas
1692,2016-04-29 17:46:11,"@jnicklas Found it - each session creates it's own instance of Server, but doesn't actually start it up when it's sharing between sessions, this means it actually ends up looking at the wrong request counter when trying to close the second session.  I thought I had made sure this case was taken care of, but I guess not.  A potential solution would be to just reset sessions in the reverse order they were created but they're currently stored in a hash so we don't have that info.  A short term fix for your use case would be to specify `Capybara.reuse_server = false`  which would fix the issue, but use a bit more memory.
",twalpole,jnicklas
1692,2016-04-29 18:25:27,"@jnicklas Please try PR #1693 and see if it fixes the issue on your real app (without Capybara.reuse_server = false).  If so it'll be a good enough fix for 2.7 and for 2.8 I think I'll look at making it so there is an instance of Counter per app instance and the sessions access the correct one.
",twalpole,jnicklas
1688,2016-04-26 19:37:48,"@twalpole thanks for the response.  To save me trawling through the changes in 2.7, any chance you can suggest what needs to change to be compatible then?
",mattheworiordan,twalpole
1678,2016-04-07 02:12:25,"Ah, good catch @twalpole! Thanks!
",chadoh,twalpole
1674,2016-04-05 09:17:54,"@twalpole thanks for heads up, agree on middleware wanna see it in action.
",route,twalpole
1672,2016-04-04 22:39:01,"@jnicklas you're welcome -- I tried it with capybara-webkit and poltergeist and the removal of the assert_no_selector in Session#reset! didn't appear to affect them, so hopefully it doesn't --- I'm sure we'll hear if it does :)
",twalpole,jnicklas
1670,2016-03-30 21:56:59,"@jnicklas Does the change in the selenium_driver_reset_synchronous branch fix your issue?
",twalpole,jnicklas
1670,2016-03-31 16:18:54,"@twalpole I believe that poltergeist works properly on this
",route,twalpole
1670,2016-12-23 22:13:24,"@mhoran Thanks for mentioning capybara-webkit is moving to use CEF. Just to report that we did run into the async session reset issue with capybara-webkit (sometimes session wasn't reset in time and leaked into the following spec). Adding back the single `assert_no_selector` line in capybara seems to solved it.

I am not sure if it's worth digging into the root cause at this point, but wonder if you have any insights. Thanks!",starsirius,mhoran
1670,2016-12-23 23:30:33,"@twalpole No. My app doesn't have a database so we don't use database_cleaner.

By the way, the temporary fix in my own [fork](https://github.com/starsirius/capybara/commit/c056ddb7979804d5ef4fdf31eca2621a9889886d) (capybara 2.7.1, because of capybara-webkit, + that single `assert_no_selector` line) seems to fix the issue. :(",starsirius,twalpole
1667,2016-03-19 19:28:21,"@sodabrew  As @jnicklas pointed out, this would be a breaking change - so I'm not going to merge it.  I did however cherry pick the second commit which makes find_available_port check for a port on the correct interface.  For your team to maintain the same behavior it should just be a matter of you setting `Capybara.server_host = 'localhost'` now
",twalpole,jnicklas
1667,2016-03-19 19:28:21,"@sodabrew  As @jnicklas pointed out, this would be a breaking change - so I'm not going to merge it.  I did however cherry pick the second commit which makes find_available_port check for a port on the correct interface.  For your team to maintain the same behavior it should just be a matter of you setting `Capybara.server_host = 'localhost'` now
",twalpole,sodabrew
1660,2016-02-27 22:34:08,"@twalpole, thanks for the feedback (and the tip about `[ci skip]`). I've updated the PR based on your feedback.

One thing I wasn't entirely sure about was what the default value for `multiple` is. From what I understand about [how the Selector is loaded](https://github.com/jnicklas/capybara/blob/master/lib/capybara/selector.rb#L283), it appears to be `true`, but let me know if I've got this wrong.
",alextaylor000,twalpole
1660,2016-02-28 18:11:22,"@alextaylor000 From https://github.com/jnicklas/capybara/blob/master/lib/capybara/selector.rb#L287 you can see the `multiple` option doesn't have a default, so it's ignored unless passed in.  A `default` option would be passed in if there was a default value (like the `disabled` filter above) --  `boolean: true` is just a syntactic sugar instead of passing `valid_values: [true,false]` to the filter 
",twalpole,alextaylor000
1659,2016-02-26 01:36:57,"Great, thanks @twalpole! PR is cookin'.
",alextaylor000,twalpole
1652,2016-02-08 22:27:30,"Yeah -- it's unfortunate naming since Capybara.app_host (as shown in the readme) really is more of a base_url than a hostname -- change it to what @abotalov has specified and the issue should go away - If not we can reopen this
",twalpole,abotalov
1644,2016-01-27 23:32:15,":speech_balloon: @rezadehganpour 

> I just had a same issue, I resolved it by requiring addressable/uri in /lib/capybara/queries/current_path_query.rb:1
> 
> this is because the addressable is not a file

It _is_ a file in addressable 2.4.0. The issue is that Capybara 2.6.1 created a dependency on addressable 2.4.0 but its gemspec allows any version of addressable (including 2.3.8, which I had, which brought me to this issue :) ).

Changing the `require`  statement in current_path_query.rb, like you did, seems a better solution than constraining the version of addressable in the Capybara gemspec.

Thanks for reporting this @hb9358, and for starting to work on a fix, @twalpole!
",mjgiarlo,twalpole
1644,2016-01-27 23:51:20,":clap: @twalpole 
",mjgiarlo,twalpole
1644,2016-01-28 04:39:48,"2.6.2 fixed the issue for me, thanks @twalpole and @hb9358 for reporting.
",chrismitchell,twalpole
1641,2016-01-22 19:46:33,"@abotalov In that case I think one should just call visit('#/line/1')  then so it's clear in the test you're setting the target - otherwise calling visit('line/1') is going to be pretty confusing to most people
",twalpole,abotalov
1637,2016-08-02 23:12:30,"@twalpole I am not sure if I understand what `Capybara.reuse_server` is doing. I'm using RSpec and configured Capybara to use Unicorn as a server (what I use in prod). I would expect that with `reuse_server = false` and `Capybara.reset_sessions!` after each spec, a new Unicorn server would be started for each spec. Am I misunderstanding how this is supposed to work?
",jgonera,twalpole
1637,2016-08-03 15:41:43,"@twalpole Thank you for a fast reply. What do you mean by ""app server?"" I thought that Unicorn was the app server in my case.

Anyway, I do realize that it would make everything slower but I have a legitimate reason for that. If I stub out calls that my app does to third-party services, the stubs will not be ""unstubbed"" after each example if I'm running Unicorn. The reason for that, I think, is that Unicorn forks a separate process when it's started and after that RSpec/Capybara have no access to that process.

I configure Capybara to use Unicorn like this:



Let's say I have a spec file like this (just to illustrate, not a real spec):



Assuming that I run those examples in the order they are written, the second one will fail. What I think is happening is this:
- The first example is run and `SomeServiceObject.some_api_call` is stubbed.
- We use `visit` for the first time so Capybara spins up a server. Unicorn forks a worker process.
- Example finishes, RSpec removes the stub but only in the process itself and Unicorn master are running in. Unicorn worker process is untouched.
- The second example is run, but the Unicorn worker still has `SomeServiceObject.some_api_call` stubbed out so it fails.

Restarting the server is one solution that comes to my mind, but if there is anything else I can do to ""unstub"" in Unicorn worker, then I'll happily try that out.
",jgonera,twalpole
1634,2016-01-17 23:52:31,"@jferris @mhoran @jonleighton @route - 2.6.0 is released
",twalpole,route
1634,2016-01-17 23:52:31,"@jferris @mhoran @jonleighton @route - 2.6.0 is released
",twalpole,mhoran
1629,2015-12-23 08:25:20,"@twalpole I have those two in my gemfile



Here (https://github.com/plataformatec/devise/issues/3870) was the cause of this problem
",bbnnt,twalpole
1627,2015-12-21 07:22:56,"@twalpole I didn't set any specific driver so I guess I'm using `:rack_test`.
",andersennl,twalpole
1624,2015-12-17 09:55:38,"@twalpole I have merged these tasks and refactored focus tag specs
",Bartuz,twalpole
1624,2015-12-20 20:39:19,"@twalpole thanks you assistance and patience! :)
",Bartuz,twalpole
1606,2015-11-18 07:10:17,"@twalpole Thank you for your answer - you can download Windows10 virtual machine from https://dev.windows.com/en-us/microsoft-edge/tools/vms/mac/ :)
",haonoy,twalpole
1605,2015-11-20 14:35:45,"Hi @twalpole, I'm using the Poltergeist driver actually. I'm still confused about how to get this working, since the redirect does not get performed even if I add a line after `sign_out`:



I've posted this on the mailing list [here](https://groups.google.com/forum/#!topic/ruby-capybara/y_Eay2zTvfc).
",githorse,twalpole
1604,2015-11-13 21:11:09,"That could explain it ; I'll see wether the string was part of the error.

Though, and I don't mean to criticize just for the sake of it, I'd be less surprising if Capybara was to fail the scenario automatically when it receives a 500 error (with of course some way to disable that behaviour on the off-chance someone actually needs to check that a 500 error is raised through a scenario?). As a project maintainer, I'd be interested in tests failing when the app crashes through a scenario ^^

P.S. thanks for your help @twalpole ^^
",Bastes,twalpole
1604,2015-11-13 21:16:28,"@twalpole Diagnosis confirmed ^^d I'll patch my own spec to check wether a 500 error happened, but in case you have an idea on how to implement a safeguard to raise an error automatically in a scenario when a 500 error is raised, I'd be glad to contribute and try to implement it.
",Bastes,twalpole
1604,2015-11-13 21:27:55,"@twalpole Ah, there's the culprit then. Thanks a lot for your help, better_errors was indeed loaded in dev and test mode, and disabling it raises the errors in the scenario as it should.

Cheers, and sorry for the noise ^^°
",Bastes,twalpole
1594,2015-10-30 16:26:10,"Updated, appears to be working now. Thanks @twalpole ! I'll be sure to give you a twitter shout out :)
",illegalnumbers,twalpole
1583,2015-10-24 14:25:15,"Just got a response from rails issue about this and looks to be a straightforward addition to allow this cleanup to be added if it's worth it: https://github.com/rails/rails/issues/22050#issuecomment-150812209

Any more thoughts @twalpole or is it still not worth adding?
",amnesia7,twalpole
1578,2015-10-13 08:20:19,":+1: Thank you @tjgrathwell this bug has been here for months.

I decided to search and found your PR because I wanted to put my [WIP Rails Authenticator](https://travis-ci.org/hello-gem/hello) back testing with rails:master Now my specs work again :heart:  https://travis-ci.org/hello-gem/hello/builds/85068627

I had also tried your first approach, @twalpole I can validate that it does not work because it brings instances of internal classes, maybe a cleaner solution will show up in the recent future, but right now placing direct code in there seems like the easiest choice. :cry: 

@tjgrathwell thanks again! :+1: 
",thejamespinto,tjgrathwell
1578,2015-10-13 08:20:19,":+1: Thank you @tjgrathwell this bug has been here for months.

I decided to search and found your PR because I wanted to put my [WIP Rails Authenticator](https://travis-ci.org/hello-gem/hello) back testing with rails:master Now my specs work again :heart:  https://travis-ci.org/hello-gem/hello/builds/85068627

I had also tried your first approach, @twalpole I can validate that it does not work because it brings instances of internal classes, maybe a cleaner solution will show up in the recent future, but right now placing direct code in there seems like the easiest choice. :cry: 

@tjgrathwell thanks again! :+1: 
",thejamespinto,twalpole
1566,2015-08-25 23:06:01,"@mhoran I'm pretty much ready to do a 2.5 release, would it be of any benefit to do an rc1 release first?
",twalpole,mhoran
1566,2015-08-26 21:04:02,"Thank you @twalpole for information, I'll try to run tests and release new version soon!
",route,twalpole
1562,2015-08-14 14:01:00,"thanks @twalpole -- I didn't realize Array() would do that. That works.
",githorse,twalpole
1548,2015-07-16 20:54:54,"@twalpole yes, the elements are customized, so there is a big chance that they are hidden. I need to take a look later. 

Thank you for the idea. So is there a workaround? Click on the visible label still should change the value of a checkbox, why don't we support it?
",killthekitten,twalpole
1548,2015-07-16 21:10:12,"@twalpole labels are visible.
",killthekitten,twalpole
1548,2015-07-16 21:13:50,"@twalpole but who cares does he can interact or not? I mean it's a default way of interaction with these elements, via labels.
",killthekitten,twalpole
1548,2015-07-16 21:15:58,"@twalpole and the fact this behavior is not documented or mentioned in the exception message (stop me if I'm wrong) makes debugging very complicated. 
",killthekitten,twalpole
1545,2015-09-10 18:43:39,"@twalpole thanks for the update. Is there anything I could do to help move this forward?
",jhawthorn,twalpole
1545,2015-09-11 16:53:13,"@jhawthorn ok -- I've added a few comments to the current code, but there is a larger concern.  I believe this suffers from the same problem as Issue #1540 .  Namely that the methods on session don't really do what one would think when multiple sessions using the same app are created.  This may or may not be of concern (I haven't really decided if it's actually a real problem or just an issue that occurs in artificial conditions).  I think it would actually be more of an issue for this situation than the #1540 though.  I don't think we want to be duplicating the app object for each session, but a quick thought at a fix would be to have each session create a new server thread with it's own middleware instance on it's own port but share the app object, which would allow tracking requests on a per session basis.  That could lead to threading problems though and probably requires more thought
",twalpole,jhawthorn
1545,2016-01-12 03:42:17,"@twalpole sorry for the delay.

I've addressed your feedback and rebased against the latest master.

As far as I can tell this works fine with the changes in the `per_session_server` branch (different servers would count their requests separately). The code is very similar to that which handles errors, so I would expect them to behave largely the same.
",jhawthorn,twalpole
1523,2015-05-26 11:27:41,"@twalpole :+1:  ..
",sithara,twalpole
1518,2015-05-21 01:44:26,"@twalpole either of your suggestions is ok. If the file's not present then the test should surely fail anyway, my personal preference would be to eliminate the existence check. Do you need another PR?
Thank you for taking the time to respond, and thanks for your work on Capybara.
",lazylester,twalpole
1518,2015-05-23 18:26:05,"@twalpole thanks for your response...

""if that does actually work"" you say. I'd be happy to verify it if you can point me to the selenium-webdriver docs that describe it. After reading your suggestion, I reviewed the docs and haven't seen anything like that described. Nor do I see any API that suggests that this is possible.

All we really have is the Capybara attach_file interface. The same test should be executable whether interacting with a browser on the local machine or a remote machine. It seems pretty weird to have some kind of conditional inside the test that invokes some driver API calls if the target is remote. Isn't that what your'e suggesting?
",lazylester,twalpole
1513,2015-04-27 21:55:32,"@YSavir Other than the few line comments I made, its looking good -- please also update the has_link and click_link documentation to show they can take a regex for :href
",twalpole,YSavir
1509,2015-04-23 20:57:15,"@abotalov - Correct, if they are included the other way then Capybaras #all isn't hidden. Are you saying we shouldn't do it because of that? I don't think we want to deprecate #all currently, and I see no issue with having #all and #find_all accessible.
",twalpole,abotalov
1507,2015-04-23 17:52:46,"@twalpole before #1506 that example was unsafe, as it wouldn't wait (it still is unsafe by default), right?

Would it be doable to recommend using `page.has_no_selector` for this scenario?
",RSO,twalpole
1504,2015-04-16 21:53:33,"@abotalov -  as you can see from the PR - I've implemented something for actions too, but finders gets more complicated due to the variable args functions -- maybe a hack using caller is a cleaner solution.  I'm going to think about it for a bit
",twalpole,abotalov
1481,2015-03-17 19:20:51,"@philipfong  Also note that as I stated above regarding capybaras finders - ""For #all to wait one of the count options would need to be passed""  - so you could also do 



Obviously that doesn't read all that well, and the first example provided by @abotalov is probably the cleanest reading way to do what you are doing - with 'should' syntax it would be 


",twalpole,abotalov
1481,2015-03-17 19:34:59,"I just tried out the capybara finder with the count option and it works beautifully!  I did not know that option was supported.  Thank you, @twalpole @abotalov 
",philipfong,abotalov
1481,2015-03-17 19:34:59,"I just tried out the capybara finder with the count option and it works beautifully!  I did not know that option was supported.  Thank you, @twalpole @abotalov 
",philipfong,twalpole
1481,2015-04-10 21:05:03,"@mcmire You missed the fact that the ExpectationNotMet error is derived from ElementNotFound, so it will actually trigger a retry.   Using any of the count type options (count, minimum, maximum, between) will cause #all to wait up to the passed in wait time (or default_wait_time) for a set of elements that fulfill the requirements. If none of the count type options are used then any set of elements is an acceptable response (including none) so it will return immediately with the current set of elements (which may be empty) matching the query. 
",twalpole,mcmire
1481,2015-04-10 22:05:55,"@twalpole Ahh... nice, well, I stand corrected. That's very cool.

So yeah... the docs should definitely be updated in this case.
",mcmire,twalpole
1481,2015-08-25 20:48:29,"Well done @twalpole thank you!
",bbuchalter,twalpole
1472,2015-01-26 18:28:33,"@mhoran - The list of symbols is what selenium understands
:left_shift, :left_alt, :left_control are just aliases for :shift, :alt, :passport_control: 
:arrow_up, :arrow_down, :arrow_right, :arrow_left  are aliases for :up, :down, :right, :left.  
:command is an alias for :meta.  
:decimal is the numeric keypad .  
:add, :divide, :subtract, :multiply are the numeric keypad instances of +, /, -, *

:separator is the numeric keypad ""seperator"" key (different from the :decimal key) - the keycode is 108 and I'm guessing its a key returned by non-english keyboards although I can't find info that specifically states that.

:null - appears to be used in lower level key routines in selenium to trigger release of all modifier keys.  It is probably not needed for this so I'm removing it from the list 
",twalpole,mhoran
1464,2015-01-15 21:54:21,"Please disregard the issue written earlier. Thanks, @twalpole .
",scalixte-mdsol,twalpole
1463,2015-01-26 23:00:40,"@abotalov  for # 2 in my list of what I think you're looking for - please take a look at the filter_set branch I just pushed - I think something along those lines would provide the functionality you're looking for without requiring deprecation of a bunch of things, although its just a first stab at it and I may need to spend a bit more time thinking things through
",twalpole,abotalov
1463,2015-03-22 10:04:13,"I haven't responded previously as I got some concerns whether this feature has a value at all.

I don't see much value in using `:type` without any wrapper. It's just some additional code and I would like to use it via some sugar placed on top of it (the sugar might be not a part of Capybara, though).

Consider this example (with sugar):



The fact that `field` and `have_field` take inconsistent parameters doesn't look consistent, unfortunately.

@twalpole Do you have any thoughts about it?
",abotalov,twalpole
1463,2015-04-07 21:19:38,"@twalpole thank you, that helps. I thought the item was a field.
",onebree,twalpole
1460,2014-12-27 11:16:12,"@abotalov Sounds good, but I am using MiniTest.  Is it usable with MiniTest?
",donv,abotalov
1460,2014-12-27 12:06:42,"@donv No. Maybe you can write similar extension yourself.
",abotalov,donv
1454,2014-12-21 23:43:03,"@twalpole what is the correct way to loose focus?
",ioquatix,twalpole
1453,2014-12-09 23:39:45,"As @abotalov points out - the error message is incorrect, however the error is correct -- visible is not a valid option key for has_text ---   Whether or not to only look at visible text can be changed through the type parameter as shown in the docs -   http://www.rubydoc.info/github/jnicklas/capybara/Capybara/Node/Matchers#has_text%3F-instance_method
",twalpole,abotalov
1453,2014-12-11 18:07:11,"@abotalov, Based on the code you linked, I do not understand why it is not a valid key:
https://github.com/jnicklas/capybara/blob/2.4.1/lib/capybara/query.rb#L7

However, this error message needs to be fixed at the least. How hard would it be to accept the :visible keyword and convert that to the :visible type though? I do not see a reason why this API would behave different from all other find methods.
",rbu,abotalov
1443,2014-11-21 21:37:12,"Thank you @twalpole.  It seems I was down a path with an older minor version locked `database_cleaner`.  I omitted some of my configuration going to a simpler version and it worked just fine.  Specifically, I was using:



Going back to simpler truncation with :except worked just fine.
",rosskevin,twalpole
1439,2015-01-14 18:51:07,"Closing due to @jnicklas huge :-1: and my misgivings about the potential unexpected behavior
",twalpole,jnicklas
1435,2014-11-04 13:15:29,"Yes, @abotalov, this is my point. There is a capybara way that is better, but _there is no warning when you do it the wrong way_. Capybara will still work properly with `asset page.has_xxx?` but it will sleep for the full wait time.

All I want to do is add a warning when you reach the full timeout. This can only happen in two cases:
1. You are developing and you got the step wrong, so then you'll get an ElementNotFound anyways
2. You used a `has_xxx?` when you should have used a `has_no_xxx`

Right now there is no indication that the second one was done. I want a warning when someone does the second one.

Would it help if I submitted a PR and a pair of test cases?
",ngauthier,abotalov
1435,2014-11-05 13:22:51,"@twalpole So, I think there may be some miscommunication on this issue in general.

I've been using capybara for almost 5 years now, and I have met Jonas and talked to him about the framework. I am no stranger to capybara, and I know how to use it.

I think we all agree that the code I posted is not the optimal solution. _That is my point_.

The point of this issue is to help new (and experienced!) programmers when they accidentally use a capybara method that times out. I am happy to make this warning off by default, and something you can enable.

I would love to implement it as part of capybara, but I am also perfectly happy to do it as an external library.

The challenge here is that the `if` statement that checks for the timeout is so deep in `synchronize` that a monkey patch would not be ideal.

I like the idea of wrapping synchronize, but I am not sure how to do this, as all I would see is the exception being raised, but there is no indication that the exception raised was due to a timeout. The best I can come up with is wrapping synchronize with redundant timeout logic that is slightly less than the real timeout, and raising a different exception.

I just want to reiterate that I understand there is a better way to write the capybara code! My goal is to help people not make mistakes by issuing warnings when they have used a finder inappropriately.

Thanks for the feedback and discussion so far.
",ngauthier,twalpole
1435,2014-11-05 18:42:12,"@twalpole Could you give an example of a valid use of `has_x?` where timeout may be reached?
",abotalov,twalpole
1435,2014-11-05 19:12:14,"@abotalov  The very first post here is a valid use case if you want to test if a selector shows up on the page (within a set timeframe) in order to take a different action.  I grant that it should not be a common use case in well written tests, but I can see it sometimes being useful in libraries of test methods, etc.  If you're saying there is no valid use where timeout may be reached, then you're saying we should just remove the has_x? methods - and everyone can just always use the assert_x methods.   The has_x? methods specifically return true/false as opposed to the assert_x methods - they are methods with specifically different behavior, and the one whose behavior is wanted is the one that should be used.  As I said earlier, documentation updates may make the behaviors clearer to people, but adding warnings to a method that is doing exactly what it is written to do makes no sense to me.
",twalpole,abotalov
1435,2014-12-17 03:10:42,"I just came across this thread after we started using @ngauthier's gem. I didn't know @ngauthier tried to get this included upstream before publishing a gem. Kudos to you man for the effort.

I just wanted to add my voice to the chorus that my team finds this information very useful. @twalpole you have used the phrase ""ton of spam"" multiple times in this conversation, and I (a user of this library) totally disagree that this is qualified as ""spam"". I **want** to see this information.

I agree with @ngauthier and his statement ""I am strict and would not want the timeout hit in any scenario.""

The root cause is that these two statements:



look extremely similar to the developer writing the code but exhibit very different behavior. This is at odds with every rspec/minitest/testunit assertion I've ever used. I find it analogous to:



I fully appreciate that the wait is a user convenience so that we don't have manage asynchronous waits manually. However there is no way with the current capybara codebase for a user to even audit/evaluate their test suite in order to find these timing hotspots.

> ... they are methods with specifically different behavior, and the one whose behavior is wanted is the one that should be used. As I said earlier, documentation updates may make the behaviors clearer to people, but adding warnings to a method that is doing exactly what it is written to do makes no sense to me.
> Also your suggestion in the new gem that ... is incorrect and ... is correct, is highly misleading and potentially dangerous for new users. Those two statements test two very different things. 

I think the problem here is that these methods are stretching the definition of uniformity. These are two methods that behave quite differently but look very similar. Because of that, they are also traps for the principle of least astonishment when they are written as well as read without running the code or without expert-level context. I don't agree that updating documentation is the best solution here.

In my opinion these two options are more appropriate: 
- Change the method names so that it's abundantly clear that they behave differently when they are used
- Allow an optional way to audit incorrect uses of the method. It's a real bummer that this strategy has to be maintained as an external monkey patch.
",zmoazeni,twalpole
1434,2014-11-05 23:09:35,"@twalpole thanks for the comment, one of the use cases would be a user's found an element and then tries to find the previous or next element's text in relative to the current element.
",neilma,twalpole
1426,2014-10-17 08:47:44,"Hi @twalpole,

Thanks for your quick reply, good point about the processes. For now I'm going to do as you have suggested and quit the browser following each scenario. 

Do you think it would be of any benefit if Capybara could check whether there is at least one window available before performing any action, so that if there were none it could launch a new one and prevent this issue? Having to shutdown and relaunch the browser each time as you've said above is a little slow :( 
",jonathanchrisp,twalpole
1417,2014-10-13 19:24:53,"Thanks @twalpole any chance we could get this backported to 2.2.x as well? I can do a PR into that branch if it'd help.
",phillbaker,twalpole
1417,2014-10-14 01:22:41,"Thanks @twalpole! 

I'll give it a shot, I was hoping to get something quick out on 2.2 and then work on updating to 2.4. If it turns into a bunch of work, I'll open a PR against https://github.com/jnicklas/capybara/tree/2.2_stable and we can discuss.
",phillbaker,twalpole
1412,2014-09-30 09:01:33,"thanks @twalpole  for the feedback.  I see we can get the tests to fail if we add:



show_exceptions is true by default in sinatra, so this seems like a potentially very confusing issue.  cucumber capybara on the other hand doesn't behave like this.  The error thrown by sinatra is caught by cucumber rspec and is displayed in the console - I think it would make a lot more sense to developers if capybara-rspec followed capybara-cucumber in that regard.  Running a cucumber feature it looks like this:



I've added the cucumber example to the existing repo in case you want to run it yourself:

https://github.com/tansaku/rspec-capybara-bug

Thanks for clarifying that this is not a bug per se, but I would argue it is a serious usability issue - the cucumber behaviour seems much more developer friendly - is there some reason that capybara - rspec integration can't support the same?
",tansaku,twalpole
1412,2014-10-03 07:52:56,"Aha - thanks @twalpole - that clears everything up - really appreciate you taking the time to explain the details - we'll consider making an rspec-sinatra gem
",tansaku,twalpole
1406,2014-09-24 19:30:35,"@twalpole  sorry, ok.
",g-ilham,twalpole
1396,2014-09-11 19:25:45,"@abotalov I actually am having the reverse problem where I can't access Rspec's `all` method, not the other way around (for which your workaround would be fine). I think in the case of Rspec I need to do this:



But that kind of kills readability and isn't worth it. I just looped over the elements manually instead.
",mhodgson,abotalov
1396,2014-09-11 19:29:10,"@abotalov maybe `find_all` ?
",mhodgson,abotalov
1396,2014-09-28 20:06:23,"@myronmarston 

> I'm not sure what we could have or should have done differently

It looks to me that an issue of clashing method names is an issue not only of RSpec and Capybara but of Ruby ecosystem in general. It's bad when two gems expose methods with the same name. So it would be better if there would be a general enough solution for that problem.

It's easy to find those clashing methods if one would put some care into combining a list of modules/classes with with which methods exposed by a gem may interfere. Something like:



It may be even possible to create a general gem that will contain `gems_and_their_methods` array not only just for testing context but also for model, controller etc. though it may be a very large task, not sure.

It's possible to incorporate such task into a build that will check for those clashes and say if there are e.g. any new.
",abotalov,myronmarston
1396,2014-09-28 23:21:14,"That's an interesting idea, @abotalov.  I would say that it's really only a problem when gems choose to add methods to a namespace owned by another gem, as is the case here. RSpec ""owns"" the namespace for the API it exposes, and capybara chooses to import its API into that same namespace.  Also, I don't want to limit new RSpec APIs to just method names that aren't already in use by an RSpec extension.  It would be useful to know in advance that adding a particular API will cause a conflict with a method in a particular extension, but that wouldn't necessarily stop us from adding it.  It would, however, allow us to discuss the issue before the new API is released, to have solutions ready.

If you decide to develop your conflict-detection logic further and want some input from the RSpec side, let me know.
",myronmarston,abotalov
1394,2014-09-10 15:00:47,"@twalpole 

Good morning!

After further consideration, I realize that `#text(:all)` doesn't fully resolve the issue I reported and in fact I believe the current behavior still qualifies as a bug.  Let me explain and I fully welcome your feedback.

I will attempt to thoroughly qualify the statement that this is in fact a bug (or, perhaps a feature request since it may represent a breaking change):

Most importantly, your suggestion to use `#text(:all)` does not allow us to perform text validation (e.g. `has_content?`) on invisible elements using the implicit wait functionality built in to Capybara.  The text method will return immediately (if it finds the element in question) and then an assertion must be made on the immediate response, or I must wrap my query in a waiter block, again negating the benefit of Capybara's implicit wait mechanisms.

Alternately, I can use a `find()` using the `text: 'something'` query option(see below), but this is not ideal for setting expectations within tests.

Secondly, there exists an inconsistency in the current behavior.  Specifically, given an invisible element containing 'some text', take the following examples:



As you can see, specifying the `text` query option in the `find()` method parameter hash ignores the visibility of the element, and matches on `:all` text regardless.

Finally, by specifying `visible: false` on the element query, my query implicitly states that the element is not visible, and therefore any query against the text value of that element and/or any subelement should be performed implicitly with `text(:all)`.  The element is already determined at this point to be a non-visible element based on the specified query selector, and as such other method calls on the element should be able to apply this visibility context to their behavior.

Therefore, element methods such as '#text', '#has_content?', '#has_text?' etc should behave appropriately for the visibility of the context they are called within, and not simply to the global `ignore_hidden_elements` setting.
",tmertens,twalpole
1394,2014-09-10 19:28:37,"@abotalov Not at all, I'm simply trying to demonstrate that Capybara's concept of ""visibility"" is applied inconsistently to element and text nodes in the DOM.

That's not to say that there isn't utility for a `visible: :hidden` query option, but that's outside the scope of this ticket.
",tmertens,abotalov
1378,2015-04-23 06:11:51,"@twalpole I think if we make it for `find` it will give wrong suggestions. For example fill_in, select, click_link etc using find inside. I think better to make decorators for errors every case. And may be make special case to detect if `find` called from capybara or from user's test
",Paxa,twalpole
1365,2014-07-29 16:27:32,"@twalpole It's a single `switch_to_frame` method with ordinary overloads.
",abotalov,twalpole
1365,2014-07-29 19:07:34,"@abotalov   Actually you have said 2 different things, the initial text proposes adding switch_to_frame (with its overloads) to the session -- then later on you have said adding it to the driver API, which are you actually proposing?  
",twalpole,abotalov
1365,2014-07-29 23:36:00,":+1: to making the frame API behave more like the window API. I'd also like to cut down on the incompatibilities between drivers when it comes to frame handling, as noted in https://github.com/jnicklas/capybara/issues/984#issuecomment-14357652. And as @jnicklas pointed out, this code really needs to be cleaned up.

I agree with @abotalov regarding `switch_to_frame` vs `within_frame`. I feel there are benefits to both depending on the situation, and as we've provided both `switch_to_window` and `within_window` (implemented via `switch_to_window`), I think users may expect that behavior.

Perhaps `within_frame` could take a proc as an argument, as `within_window`. I think this is a nice way to handle the option of selecting a particular frame that matches a selector, versus overloading arguments.

Thanks for the heads up, @abotalov.
",mhoran,abotalov
1365,2015-09-16 20:32:11,"@route thanks for the reply.  A question for you (and the lurkers) regarding the following situation.  I am directly working with Session instances (no naked calls to #within_frame, etc).  I have scenarios where I want to observe the same behavior when a request comes directly from the browser vs. when the request is loaded into an iframe on another page.  So in my test code, I want a ""handle"" of sorts to the top level Session-like object.  In other words, something like this...



This is admittedly stripped down for illustrative purposes, but I want to re-use all of that code after the call to #get_root as if it were unaware that it were happening within an iframe.  So what's the recommended way to get a pointer/handle to the iframe that either is or behaves like a Session?
",jtrupiano,route
1365,2015-09-16 21:05:55,"Oh I get it now.  #within_frame actually alters the state of the variable session.  That's what I was missing.  Thanks for helping me think through this, @route.

btw I'd still be happier if I had #switch_to_frame :)
",jtrupiano,route
1363,2014-07-24 19:40:05,"Yeah, I think it would be fine to add a rescue there:



I think it makes sense to output a warning as javascript error can theoretically occur for some other reason and thus user will know that it occurred. We can add exception message to rescue but it's not standardized by Webdriver W3C spec so I wouldn't like it.

@twalpole AFAIK `warn` outputs to STDERR so user can't redirect such output to some file with ""debug"" info. Probably warning should be outputted to `$stderr`.
",abotalov,twalpole
1361,2014-07-16 07:29:37,"Hey @abotalov, thanks for the feedback, I forgot about the page method returning the current session so this would work quite nicely.
",jonathanchrisp,abotalov
1357,2014-07-08 20:50:29,"@abotalov good point - done!
",shepmaster,abotalov
1352,2014-07-02 20:08:12,"@abotalov I've added descriptions for the rest of the filters - please take a look
",twalpole,abotalov
1349,2014-07-01 02:23:10,"Thanks @twalpole, I didn't pulled from the master :flushed:
",sobrinho,twalpole
1348,2014-06-30 07:44:22,"@abotalov Thanks for your comment.
What do you think of my last commit?
",davidstosik,abotalov
1348,2015-08-28 18:32:42,"After thinking about this and looking through the tests I think all this boils down to is defaulting scheme to http when not specified, which I'm not convinced is necessarily valid.  I definitely agree with @abotalov that we should not be resolving against current_url for calls to Session#visit, since calls to visit really are about setting up the state of the browser in order to then interact with it, not about loading stuff relative to the current page.
",twalpole,abotalov
1340,2014-06-19 19:47:21,"@twalpole Currently I use something similar to your solution but I don't quiet like it as block returns either `true` or `false`.

Instead block should contain proper rspec expectation so user would see error message with more data about the error (e.g. which text appeared on the page instead of desired).
",abotalov,twalpole
1340,2014-06-24 16:22:05,"@abotalov since you're using method_missing you should probably also be defining respond_to_missing? .  Other than that I think the gem is solving the issue presented.  I don't necessarily like the  phrasing  'become_have_css', but I havent come up with anything better.  We should probably close this issue now, and move any further discussions over to your gem.
",twalpole,abotalov
1340,2014-06-24 18:14:50,"@twalpole Thanks, I defined respond_to_missing?
",abotalov,twalpole
1338,2014-06-19 12:02:54,"@twalpole seems fine for me, just the double check that @abotalov mentioned has to be changed :shipit: 
",sobrinho,twalpole
1334,2014-06-16 18:57:22,"I don't think backporting to 2.2.x is worth the effort for this, and as @myronmarston says wouldn't really fix the issue.  rspec-rails will work with capybara 2.2.0 just with deprecation warnings, and those warnings go away with capybara 2.3.x, so as long as the rspec-rails check is for >= 2.2.0 most people will update to capybara 2.3.x (and 2.4.x within the next couple of weeks) which don't have any backward breaking changes just add new features/support and get rid of the warnings.   I would however say the rspec-rails Gemfile should probably specify  ~>2.2   instead of ~>2.2.0  so tests can be run with the latest capybara 2.x versions instead of just 2.2.x versions.
",twalpole,myronmarston
1328,2014-06-11 19:27:18,"@abotalov all of the entries I looked at in that search were people trying to figure out why their matcher was failing, none of them seemed to be people rescuing that specific exception.  I'm not convinced this needs to go into a major release.
",twalpole,abotalov
1322,2014-06-03 21:08:59,"@abotalov hmmm -- I'm having second thoughts about respond_to_prompt -- maybe the parameter should be :with so it matches up with fill_in ---  I need to think about this a bit longer
",twalpole,abotalov
1319,2014-06-05 18:22:47,"@sobrinho Are you planning on submitting a PR for this?
",twalpole,sobrinho
1319,2014-06-18 23:40:47,"@sobrinho please take a look at PR #1338 and see if that will meet the needs.   I changed your idea a little bit by passing the options through as  :fill_options to prevent option clashes with those that can be passed to the finder.  so now it would be


",twalpole,sobrinho
1317,2014-05-29 17:56:17,"@twalpole the main reason is to make examples workable because click_link won't submit form.
And bit more logical user in example is created with email (not login) field.

Devise was just an example of widely used case.
",stgeneral,twalpole
1313,2014-06-04 06:01:01,"@twalpole My apologies for not being super clear.

My application gives a 301 redirect. Sometimes that redirect destination doesn't exist. Capybara doesn't handle this situation well in Chrome in that after the redirect, the `current_url` is `data:text/html,chromewebdata` instead of the expected destination url. Does that make more sense?
",tekknolagi,twalpole
1313,2014-06-04 17:30:25,"@twalpole What is the recommended way to check that a browser is being redirected?
",tekknolagi,twalpole
1309,2014-05-20 21:49:05,"@abotalov --  Great -- assuming they're producing the same results :)  --  Waiting for tests to pass and will then merge
",twalpole,abotalov
1305,2014-05-21 18:03:56,"@twalpole I believe it is between selenium and firefox webdriver. Thanks for following up.
",bdarfler,twalpole
1304,2015-11-04 21:21:37,"@twalpole this was the first hit I got when I was trying to figure why my number fields weren't filling with capybara's #fill_in method.  I figured I would just include how I got around this in case other people got to this same thread. 
",gabeodess,twalpole
1298,2014-07-08 18:16:20,"@twalpole I disagree with you.

Previously Capybara could sent to driver's `visit` method either String or not String. If user sends parameter of String type, then String will be sent to driver.

After this PR (or https://github.com/jnicklas/capybara/pull/1357) String is sent to driver's `visit` method (and it was supported previously). So it doesn't invoke any changes neither at driver, nor at user side.
",abotalov,twalpole
1298,2014-07-08 18:37:04,"@abotalov  I'll go through it again - although alex understood it so I think I explained my reasoning fine above.  As you said - previously Capybara could send to drivers visit method either a String or not a String (ie a URI could be passed through untouched, even though undocumented in some cases) and I wasn't willing in a minor version to change that just so the user didn't have to call #to_s on an arbitrary object in case an existing driver was actually using that undocumented ""feature"".  The visit method has since been changed to actually fix a bug - which I consider more justifiable than just for ease of use - and so it may now be fine to revisit this issue.  As it is the documentation for the visit method specifies that a String must be passed in, so any pull request for this issue will need to have that documentation updated to show that an ojbect that responds to #to_s would be acceptable as well
",twalpole,abotalov
1296,2014-05-08 18:56:23,"@twalpole thanks!
",ironcladlou,twalpole
1295,2014-09-04 17:25:57,"@abotalov the only thing stopping it is me having time to go through and see the current state -- I hope to be able to catch up on a lot of the current issues/PRs this weekend
",twalpole,abotalov
1289,2014-04-08 20:01:31,"@abotalov - speed -- webdriver does support a speed for the flick (the ruby selenium-webdriver has :fast and :normal) -- a slower flick would be what most people would call a swipe I believe -- I don't know if it makes sense to have the two as separate methods, or pass a parameter, or just not worry about speed
",twalpole,abotalov
1289,2014-04-08 21:03:53,"@abotalov - the issue with tap is that it would be overriding Object#tap with  a function that is completely different -  that might be a surprise to some people
",twalpole,abotalov
1285,2014-04-03 23:03:50,"@twalpole  Thanks. The `feature` without `RSpec` now works:



However `RSpec.feature` doesn't work. Also, the `feature` is still monkey-patched on the `main` object even though `expose_dsl_globally = false` is set. I'm not sure if Capybara should conform to the RSpec's policy strictly, but it would be nice if it could.
",yujinakayama,twalpole
1275,2014-03-25 18:56:39,"@jnicklas Nope, `should` syntax seems to be deprecated:
https://github.com/rspec/rspec-expectations/blob/master/lib/rspec/expectations/configuration.rb#L135
https://github.com/rspec/rspec-expectations/blob/master/lib/rspec/expectations/configuration.rb#L115
https://github.com/rspec/rspec-expectations/blob/master/lib/rspec/expectations/syntax.rb#L26
",abotalov,jnicklas
1275,2014-03-25 19:01:07,"@abotalov:

> or explicitly enable `:should`
",jnicklas,abotalov
1275,2014-03-25 19:23:39,"@jnicklas We can explicitly enable `should` instead of merging @twalpole's PR. I don't think that enabling `should` in Capybara specs is a bad decision.

But it doesn't change the fact that `should` is deprecated.
",abotalov,jnicklas
1275,2014-03-25 19:58:48,"@jnicklas RSpec-expectations produces a deprecation warning by default (if you don't specifically enable `should` syntax):
https://github.com/rspec/rspec-expectations/blob/master/lib/rspec/expectations/syntax.rb#L27
https://github.com/rspec/rspec-support/blob/master/lib/rspec/support/warnings.rb#L5

So I think it can be said that `should` syntax is deprecated
",abotalov,jnicklas
1275,2014-04-01 18:06:43,"FYI: as pointed out by @abotalov #1192 is this plus a bunch of other changes/fixes needed for rspec 3 compatability
",twalpole,abotalov
1274,2014-03-24 17:45:46,"@twalpole That's probably right... the bug is the converse, that spaces are being eaten somewhere. Can you offer any guidance?
",aceofspades,twalpole
1273,2014-03-24 02:48:00,"@abotalov Thanks for the comments! I fixed some of the things. Let's wait to see what @jnicklas has to say about some of the other ones, since I tried to not change the original API at all.
",gylaz,abotalov
1273,2014-04-02 23:15:58,"@gylaz Could you update this PR to be against current master, and see if you can figure out whats going on with the failed builds? Then we can move forward on getting this merged in.
",twalpole,gylaz
1273,2014-04-02 23:23:07,"> Could you update this PR to be against current master

@twalpole Will do!

> see if you can figure out whats going on with the failed builds?

The build if failing due to `Kernel#caller` not behaving the same way as in MRI. One way around this is to pass the calling method as an argument. Thoughts?
",gylaz,twalpole
1273,2014-04-02 23:59:43,"@gylaz -- actually -- this is just for a warning that Launchy needs to be installed to open the files, I don't know that it really matters whether it was called from save_and_open_page or save_and_open_screenshot -- either way the user needs to install Launchy - so maybe just dump the method name
",twalpole,gylaz
1273,2014-04-03 01:07:27,"@twalpole This is ready for a re-review.
",gylaz,twalpole
1273,2014-04-03 20:00:05,"@gylaz ok -- I think its all good now, unfortunately the tests failed due to the signature of the latest chrome failing on travis.   If you could rebase to master (which forces the chrome install now) one more time just to make sure the tests are passing and then I'll merge it in.
",twalpole,gylaz
1260,2014-02-24 20:59:47,"@twalpole Do you think that issue that you talk about is worth adding code for stuff outlined in issue description?
",abotalov,twalpole
1260,2014-03-02 14:16:23,"I agree with @twalpole on this. No need to go too crazy on this. If a user wants to choose options which might conflict then that's their prerogrative.
",jnicklas,twalpole
1259,2014-07-24 17:15:15,"@abotalov That bug is marked as fixed, supposedly in 2.42 -- doesnt appear to fix the test we currently have pending though, any insight?  
",twalpole,abotalov
1256,2014-02-20 07:03:08,"@twalpole There is another issue with `:exact`:



So we can't use the same option for both xpath matching and text matching. At the very least they should be named differently.
",abotalov,twalpole
1256,2014-02-20 08:44:18,"@jnicklas I thought about something like `exact` helper method previously too but somehow I forgot about that idea when writing this issue.

Proposed by me:



Proposed by you:



Your proposal is also quiet short and nice. I think I support it even more than mine as it would require much less amount of code to write and it leads to shorter learning curve. But I think this helper method is useful enough for everybody to be placed to Capybara::DSL.
",abotalov,jnicklas
1254,2014-02-27 23:57:51,"@abotalov I see. Is there any way to suppress the warnings for the time being?
",ashour,abotalov
1253,2014-02-20 19:45:14,"@jnicklas Thanks for the tips. I'm fairly new to the testing stack I'm using here (Cucumber/Capybara/Selenium) so my apologies for the potentially naive question, but are you suggesting the best approach to do something like Issue 1252 would be to monkey patch the `reset!` method?
",klinden,jnicklas
1253,2014-02-20 20:01:21,"@jnicklas Well, the only problem with that is I can't do what I need to do (accepting an onbeforeunload dialog) until the browser has attempted to navigate away (which happens in `reset!`)
",klinden,jnicklas
1246,2014-02-17 13:09:08,"@jnicklas I think we should have either TextQuery or TextResult to fix https://github.com/jnicklas/capybara/issues/1179

We can't just have assert_text as we need to store state somewhere.
",abotalov,jnicklas
1246,2014-02-17 21:57:55,"@jnicklas suggestion to add `assert_text` and `assert_title` for non-rspec users seems quiet good to me. I'll add them.

But it seems that `HaveSelector`'s `matches?` method shouldn't invoke `assert_selector`:



as [RSpec 3 adds compound matchers](http://myronmars.to/n/dev-blog/2014/01/new-in-rspec-3-composable-matchers). User should be able to use them like:



So `matches?` method should return false instead of raising error. So `HaveSelector` should have `failure_message` and `failure_message_when_negated` methods.
",abotalov,jnicklas
1246,2014-02-18 20:33:22,"@jnicklas I tried to fix commit according to your suggestions and updated pull request description to reflect this.

Some notes:
1. I still think that it would be better for `have_title` to do full string matching instead of substring matching. Reasons:
   - full text matching for title is arguably more useful than substring matching as titles are usually not long enough and they can be matched fully
   - currently synchronized full title matching can be done only using regexps like `/\Atitle\Z/`. If proposed change will be applied substring matching could be done via `/title/` which looks better than `/\Atitle\Z/` that is currently needed for full title matching
2. I put `failure_message` inside `TextQuery` and `TitleQuery` as
   - `:expected_text`, `:count`, `:actual_text` aren't needed in other places except building failure message
   - `failure_message` and `failure_message_when_negated` seem to need some helper method to be DRY
3. I will probably fix issue with compound matchers outlined above in another pull request later
",abotalov,jnicklas
1246,2014-02-20 08:37:24,"@abotalov, why did you remove the tests for `#description` on the RSpec matchers?

Looking at the code this no longer changes the `have_title`, etc.. behaviour, right? In that case I think this is shaping up nicely, and I'm pretty sure we'll get this merged soon. I think it would be nice to have separate tests for `assert_text`, etc... as these are now public API, but maybe it's not super essential to get this PR merged, I don't want to wait too long on this one since the diff is so huge.

Nice job @abotalov this cleans up the internals very nicely, and also opens up for other interesting refactorings in the future.
",jnicklas,abotalov
1246,2014-02-20 08:54:17,"@jnicklas 
1. I deleted `description` method from rspec matchers so I deleted tests for them too. It's better to test for failure messages than descriptions as users don't see descriptions.
2. I'm currently writing tests for `assert_text` and `assert_title`.
3. I haven't yet reverted my API changes for `has_title?`. I'll do so after we'll have final decision on https://github.com/jnicklas/capybara/issues/1256
4. I'll rebase this PR on master.
",abotalov,jnicklas
1246,2014-02-20 09:00:20,"@jnicklas Also I placed `failure_message` method into query. Do you see a better place for it?
",abotalov,jnicklas
1246,2014-02-20 09:10:11,"@jnicklas Do you prefer me to amend commit or make a new one?
",abotalov,jnicklas
1246,2014-02-20 09:16:26,"@abotalov amend is better, imo.

Just checked the code for `failure_message`, and I'm still not happy about it. My main problem is that I want queries to be repeatable, and therefore stateless. If we make this refactor, it'll set a direction, where we can generalize a lot of the querying code in Capybara, and the ability to re-use queries is nice. Making them stateless would make them reusable and also thread-safe (maybe not so important right now). So, the addition of `assert_title`, etc... is nice, but the purpose of adding them has been lost. The purpose was to remove the statefulness from Query.
",jnicklas,abotalov
1246,2014-02-20 11:07:06,"@jnicklas How can I make query stateless?
Do you mean that `resolve_for` should return `TextResult` (or just array) that will store state needed to construct failure message?
",abotalov,jnicklas
1246,2014-02-20 12:11:19,"@jnicklas Why do you want to make queries repeatable and stateless?
",abotalov,jnicklas
1246,2014-02-22 14:04:01,"@jnicklas I amended commit. Changes since my last comment:
- Branch was rebased on master
- `assert_selector`/`assert_no_selector` now use `resolve_for` directly instead of `all`. It's done as `assert_text`/`assert_no_text` should have the same logic for count keys.
- `has_title?(string)` checks passed string for inclusion, not exact matching, as it did previously as it's out of scope of this PR
- Tests for `assert_text`, `assert_title` have been added
- `assert_selector` and `assert_no_selector` have been moved upper in the file as all other methods (except methods for matching texts) depend on them
",abotalov,jnicklas
1246,2014-06-11 19:44:23,"@twalpole changes made by this PR are outlined in description of this PR.
",abotalov,twalpole
1246,2014-06-11 19:58:05,"@abotalov Yes - I read the list of changes and am asking why this is one monolithic change and not serveral smaller ones -  Are all the changes dependent  on other changes, or can some of this be done as smaller separate non-breaking commits.   For instance the ""Added"" section could be done as 1 or 2 commits and I don't think need the rest of these changes (from just a cursory glance), and would not require a major release.
",twalpole,abotalov
1246,2014-06-11 22:40:45,"@abotalov - Either I'm not explaining myself well or you're misreading what I wrote - ""For instance the ""Added"" section could be done as 1 or 2 commits and I don't think need the rest of these changes""  - this does not mean that the rest of the changes are unwarranted, it just means that the two things described under ""Added"" could be done as a separate much smaller commits, that don't break backwards compatibility of public APIs and could be released much sooner in a minor release.   

So I'm going to ask again, hopefully more clearly -  Which parts of this can be moved into separate smaller, feature specific,  pull requests that are independent from each other (so that some can be used now without waiting for a major release)?
",twalpole,abotalov
1246,2014-06-19 17:24:05,"@twalpole I thought a bit more about this PR and I think it's in a very unmergable state and should be splitted to several PRs with more terse goals when time for 3.0 will come.
",abotalov,twalpole
1246,2014-06-19 17:44:05,"@abotalov I agree completely
",twalpole,abotalov
1246,2014-06-25 18:40:11,"@twalpole I think I can add `assert_title`/`assert_no_title`/`assert_text`/`assert_no_text` but addition of those methods also requires to add new query classes (BaseQuery, TextQuery, TitleQuery). Otherwise, it would be needed to copy paste`Query#wait` method.
",abotalov,twalpole
1246,2014-06-25 21:40:05,"@twalpole I reduced the scope of PR. It seems not to contain backwards incompatible public API changes now. Is scope OK for you now?

I still have to review PR and write yardocs for added methods.
",abotalov,twalpole
1246,2014-06-25 23:11:26,"@abotalov - yes the scope of this is much more agreeable - I'll review the PR now
",twalpole,abotalov
1246,2014-07-01 00:06:24,"@abotalov ok -- I think this is looking good -- if you squash the commits I'll go ahead and merge it in
",twalpole,abotalov
1245,2015-02-26 21:55:11,"@twalpole That would do it for us! I can write a section to add to the _Gotchas_ blurb in the README for your patch, if you like.
",pnc,twalpole
1242,2015-12-07 10:21:52,"That also happens when using Materializecss (with js: true), in that case is enough to pass the  visible: false option (thanks @twalpole)
",alexdesi,twalpole
1241,2014-07-01 22:54:39,"@abotalov Ok to close this since its basically in the latest changes?
",twalpole,abotalov
1238,2014-02-06 17:10:27,"@jnicklas May the reason be that you wanted to share code between matcher methods? If yes, then it seems to be solvable.
",abotalov,jnicklas
1237,2014-09-23 18:05:00,"@sbonebrake - the assert_no_selector isn't verifying that the driver is reset though -- its verifying that the session is reset - ie - no content in the sessions page. 
",twalpole,sbonebrake
1237,2014-09-23 18:12:08,"> @sbonebrake - the assert_no_selector isn't verifying that the driver is reset though -- its verifying that the session is reset - ie - no content in the sessions page.

The problem is that check doesn't make sense for all drivers. A native Android app doesn't respond to the `""/html/body/*""` xpath selector.
",bootstraponline,sbonebrake
1235,2014-02-03 14:06:45,"Wow, awesome pull request! Thanks @abotalov. This thing is huge, so I'll have to review this properly. At a first glance, I really like it though. The proposed `window_opened_by` is very nice IMO, exactly what you'd want in most cases. Also, the fact that it synchronizes is very nice. I think the proposed API is definitely _much_ better than what we have now.

Does this include some method of returning all currently open windows? I didn't find it in the code. I think that would be desirable. We don't have it now either so it's not necessary for this to get merged.

One question is what we do with version numbers. I agree that the current window API can barely be described as working, so maybe we aren't _breaking_ anything per se. But still this would probably require a major version bump, right? I'm perfectly okay with doing a major version bump for this though.

@joliss, @twalpole your thoughts on this?
",jnicklas,abotalov
1235,2014-02-03 14:10:34,"@jnicklas AFAIK this pull request doesn't break backwards compatability. It adds deprecation warning but it seems to be OK.
From http://semver.org/ :
`Minor version ... MUST be incremented if any public API functionality is marked as deprecated.`

So it's OK to release a minor version with this.
",abotalov,jnicklas
1235,2014-02-03 15:10:56,"@jnicklas Re bumping the major, I'd say do it - there's no harm, and I also don't see that much reason to wait and coalescse multiple breaking changes into a single new major version. So ""Capybara 3.0.0 released, only breaking change is new window API superceding `.whatever`"" seems like a perfectly reasonable plan. (I have bumped the major version of [jquery-ui-rails](https://github.com/joliss/jquery-ui-rails) several times for fairly trivial reasons - it's at 4.x now - and not had any issues.)

No thoughts on the actual window API, I've never had to deal with windows.
",joliss,jnicklas
1235,2014-02-05 00:48:17,"Thanks for the heads up, @jnicklas. I'll take a look and see if there's anything we can't implement in capybara-webkit. At first glance, I don't see anything that looks too difficult. We're still behind on Capybara 2.2 features, but I hope to get caught up soon.
",mhoran,jnicklas
1235,2014-04-03 19:42:45,"@jnicklas @twalpole What do you think about it?
Should we release it in 2.3 and remove support for old `within_window` in 3.0?
Or release it in 3.0 and remove support for old `within_window` in 4.0?
",abotalov,jnicklas
1235,2014-04-15 01:22:16,"@abotalov I believe running with a window manager (fluxbox, etc) will solve most of these issues - see  https://github.com/twalpole/capybara/commit/126303097a6ab530da6cbb29c7aa8058ba979ae9  -  thats almost there - but I think the setting to hide the toolbar in fluxbox is needed --  currently the vertical height ends up 25px short
",twalpole,abotalov
1235,2014-04-22 21:17:56,"@twalpole Does it mean that you accept moving those methods to `Session`?
",abotalov,twalpole
1235,2014-04-22 21:27:59,"@abotalov Sorry I wasn't clear about that.  No I don't think they should be added to Session.  I like that they are currently available through current_window.  Maybe the result of current_window, should be a CurrentWindow singleton that supports the resize, maximize, etc methods - instead of just a Window object.
",twalpole,abotalov
1235,2014-04-22 21:57:48,"@twalpole Do you mean that all methods except `maximize`, `resize_to`, `close`, `size` should be delegated from `CurrentWindow` to `Window` using `method_missing`?
",abotalov,twalpole
1235,2014-05-27 20:57:32,"@twalpole I made defined fixes so please review it again. Last commit:
- fixes issue with maximize on Travis
- allows operations with non-current window
- adds a sleep to `switch_to_window`
- rebased PR
",abotalov,twalpole
1235,2014-05-28 16:32:25,"@abotalov other than the comments I added about just popping scopes instead of fully resetting it (which could end up hiding bugs elsewhere), and the failing tests I think its looking good.  I've restarted the tests to see if the failures were just a fluke (jruby will fail due to a bug in nokogiris xpath querying under jruby)
",twalpole,abotalov
1235,2014-05-28 20:36:58,"@twalpole I fixed the issue with scoping inside `within_window`.
",abotalov,twalpole
1235,2014-05-30 17:23:36,"@abotalov  -  So after rerunning the failed spec runs a couple of times - they will all eventually pass - other than possibly making sure the windows are opened in within_window_spec before the tests run , is there anything else you feel should be changed here or do you believe its ready for merging into master?
",twalpole,abotalov
1235,2014-06-01 18:57:50,"@twalpole I fixed intermittent issues related to windows (those that appeared more than one time at Travis). Last commit has been amended many times.

I don't plan to change anything here but if you see any issues I'm able to fix them.
",abotalov,twalpole
1232,2014-01-17 23:59:53,"@jnicklas Per your request!
",tmertens,jnicklas
1232,2014-01-25 19:23:07,"@jnicklas Any update on this and/or when it might be merged in?  I would love to see this make the next gem release.  Let me know if there are any other changes you would like me to make.
",tmertens,jnicklas
1232,2014-01-31 15:27:52,"@jnicklas 

Since scenario names are no longer being defined using values from the options hash, the `tap` is no longer necessary and I replaced it with the standard `let`.

`tap` is actually a very simple and useful construct which allows you to 'tap' into a call chain.  It takes the result of the method call being tapped into and passes it into the `tap` block.  So, in this case it was effectively creating the hash and passing it into the block of specs as the variable named 'options' at runtime.  In this case I was using it to avoid using an instance variable and to scope the options hash only to the block where it was required, preventing it from polluting the environment outside of the options specs.  You cannot use variables defined in `let` blocks inside scenario descriptions because `let` values are not available until the specs are actually being executed, so either `tap` or some other runtime variable was required for the looped tests that were previously implemented.  Since the loops were removed and the option names from the hash are no longer being used in the test names, we can drop the `tap`.
",tmertens,jnicklas
1232,2014-02-03 22:57:51,"@jnicklas do you have any preference on the proposed solutions above?
",tmertens,jnicklas
1232,2014-02-04 17:12:51,"@abotalov That is a possibility, but then we are calling a private method in the Finders module from the Matchers module. It is certainly simpler, but I'm not sure how I feel about this.

EDIT: I should add that this is effectively the same as using an `all_ignore_count` method, but using an existing private method instead of (new) public one which, really, would delegate directly to `#resolve_query` anyways.
",tmertens,abotalov
1232,2014-02-12 08:47:19,"ping @jnicklas 

EDIT: btw while working on #1241 I moved `Simple#resolve_query(query)` and `Finders#resolve_query(query)` to `Query#resolve_for(node)` (and added `find_css` and `find_xpath` to `Node::Simple` and `Node::Base`)

So I hope it will be refactored there to:



and you can merge it as it is currently
",abotalov,jnicklas
1232,2014-02-19 19:00:25,"@abotalov `Capybara::Helpers#failure_message` already has conditions for `:minimum`, `:maximum`, and `:between` so I don't believe any change is necessary.

Frankly, I think the way the failure message is handled is rather ugly and I would change it to use sideband data output by the `matches_count?` method; however, to do a proper refactor would probably break hundreds of tests that assert on the content of the failure messages, so I don't see myself doing that in this PR.
",tmertens,abotalov
1232,2014-02-19 22:03:05,"@abotalov Yes, I understand the issue as you mentioned with several options being passed.

This is where sideband data from the matches_count? method would come in helpful and would ultimately replace the failure_message helper method.  I took an initial stab at this and got it working for `Capybara::Result` but began running into additional test failures when `Helpers#failure_message` is removed because it is also used by `Capybara::RSpecMatchers`.  I haven't fully resolved this yet and I'm not sure I want to tackle it in this PR.  I haven't had time yet to look more into the RSpecMatchers failures.
",tmertens,abotalov
1232,2014-02-19 22:37:32,"@abotalov I'm inclined not to make any further changes to this PR without input from @jnicklas since he is ultimately responsible for approving/merging this afaik and I don't want to waste effort making changes which depend on another PR which may or may not get merged in.  This is a very important feature for us to get into the mainline, so I will punt on this until I hear more from him.  I am hoping to get this merged sometime soon so that we can switch back to an official release of Capybara in the near future rather than running off of a fork.
",tmertens,jnicklas
1232,2014-02-19 22:37:32,"@abotalov I'm inclined not to make any further changes to this PR without input from @jnicklas since he is ultimately responsible for approving/merging this afaik and I don't want to waste effort making changes which depend on another PR which may or may not get merged in.  This is a very important feature for us to get into the mainline, so I will punt on this until I hear more from him.  I am hoping to get this merged sometime soon so that we can switch back to an official release of Capybara in the near future rather than running off of a fork.
",tmertens,abotalov
1228,2014-03-03 12:55:00,"@jamesfzhang did you find out what was wrong? I seem to be having a similar issue. I have other tests throughout the application that submit forms and have js enabled but one form is not submitting. Capybara is finding the button but the form is hanging.

Also,  @jnicklas do you have any troubleshooting tips I could follow to get this sorted? There are more details of the problem here: http://stackoverflow.com/questions/22099004/trouble-shooting-issues-with-capybara-not-submitting-a-form
",QBD,jnicklas
1221,2014-01-06 02:22:28,"@JonRowe @myronmarston Can you alias before defining the method? (Given that I'm defining the RSpec 2 versions in `Matcher` and the RSpec 3 versions in it's descendants.
",thomasfedb,JonRowe
1221,2014-01-06 02:22:28,"@JonRowe @myronmarston Can you alias before defining the method? (Given that I'm defining the RSpec 2 versions in `Matcher` and the RSpec 3 versions in it's descendants.
",thomasfedb,myronmarston
1221,2014-01-06 02:47:19,"@JonRowe Yeah, and I opted to avoid duplication.
",thomasfedb,JonRowe
1219,2014-01-06 00:31:56,"@jdelStrother You missed one, see line 95.
",thomasfedb,jdelStrother
1219,2014-01-06 18:40:37,"@jnicklas Any timeline on a new gem being released?
",thomasfedb,jnicklas
1218,2014-01-06 17:37:10,"@jnicklas I'm rerunning the failed test since it failed trying to install the json gem which seems to install just fine under 2.1 for me, so it may just have been a spurious failure (will know once travis runs it again) - however while looking into this I did notice that since the rspec dependencies for 2.2 are setup as
Gem rspec-2.2.0
  rspec-core (~> 2.2)
  rspec-expectations (~> 2.2)
  rspec-mocks (~> 2.2)

it actually just loads all the latest 2.14.x versions of rspec-core, expectations and mocks -- so its really not testing rspec 2.2 as a minimum version.   That leaves rack, rack-test, nokogiri and cucumber as the packages its testing minimum versions of.   For me its not really worth testing the minimum versions of them for a testing tool (I'd feel differently if capybara was a library used in production)
",twalpole,jnicklas
1218,2014-01-06 18:42:54,"@jnicklas The rerun was fine, so this failure may have just been a temporary issue with travis
",twalpole,jnicklas
1218,2014-01-06 18:47:28,"> @joliss, @twalpole I'm thinking that the base versions Gemfile maybe isn't worth the trouble.

Here's the original reasoning: I was assuming that at some point we'd accidentally use a feature that wasn't supported by the minimum version of a dependency, without bumping the version spec in `Gemfile` at the same time. So I added the base version Gemfile in order to avoid having to deal with issues like ""Capybara breaks with old version of $dependency"". In other words, it was intended as a time saver. If it's not saving time, we should perhaps remove it.

I don't believe the `Gemfile.base-versions` test has ever actually caught anything, has it? If it hasn't, perhaps that's evidence that we don't need it.

Then again, seeing @twalpole comment's, perhaps this issue is unrelated.

I'll leave it up to you all.
",joliss,twalpole
1218,2014-01-07 18:53:37,"@jnicklas One thing to keep in mind is that we will probably want to test with both rspec 2 and 3 once 3 is final
",twalpole,jnicklas
1218,2014-02-03 13:41:57,"@twalpole true, but we don't have _that_ much code which integrates with RSpec. When we make changes to it, we could just run that manually.

@abotalov what does the bundler version have to do with this?
",jnicklas,abotalov
1218,2014-02-03 13:41:57,"@twalpole true, but we don't have _that_ much code which integrates with RSpec. When we make changes to it, we could just run that manually.

@abotalov what does the bundler version have to do with this?
",jnicklas,twalpole
1218,2014-02-03 14:25:50,"@abotalov I've just added a commit to remove that temp work around.
",salimane,abotalov
1216,2014-01-06 17:59:26,"Thanks @jnicklas. Can you point me to a better section? Actually we spent hours trying to figure out the right way to  override the :prefs, so thought it will be useful to share.
",tispratik,jnicklas
1208,2013-12-11 15:37:09,"@jnicklas : got it!
",lamvak,jnicklas
1208,2013-12-21 21:56:40,"@twalpole I just couldn't get back to it earlier. Thank you very much.
",lamvak,twalpole
1202,2013-12-02 10:11:52,"@jnicklas I just mentioned the environment to check if it the reason. 

The problem is, the application server doesn't spin-up while the test runs. The tests fails as the application is not loading on to the browser.
Just to confirm the application is not started, I observed there is no port used by a ruby in the system while I'm debugging the test.
",paramadeep,jnicklas
1194,2013-11-26 20:14:36,"@jnicklas I have no clue why chromedriver has issues under jruby on travis - but even removing chrome from being tested with jruby it still fails on the server spec with 

1) Capybara::Server should bind to the specified host
     Failure/Error: Unable to find matching line from backtrace
     Errno::EADDRINUSE:
       Address already in use - bind - Address already in use
     # ./lib/capybara.rb:171:in `run_default_server'
     # ./spec/capybara_spec.rb:30:in`(root)'
     # ./lib/capybara/server.rb:70:in `boot'

Is testing on jruby worth dealing with issues?  Also the tests with chrome randomly fail at the end with ""cannot kill Chrome"", which I'm guessing is chromedriver not waiting long enough for chrome to exit in the travis environment (from the chromedriver source it appears to wait a fixed 5 seconds with no way to modify), so it may not be worth running with chrome either
",twalpole,jnicklas
1192,2013-11-25 17:56:08,"@myronmarston  a 2.14 release that adds the be_truthy/falsey matchers might be a nice help for tools like capybara that have test suites other project use to ensure compliance and would like to be runnable under rspec 2 and 3.
",twalpole,myronmarston
1192,2013-11-25 18:04:52,"@myronmarston  or maybe a separate gem that provides those two matchers
",twalpole,myronmarston
1192,2014-04-01 20:38:20,"@abotalov Yeah I had noticed the rspec 2.2 vs 2.14 issue too (I think I mentioned it another issue somewhere) --  I'm not sure if going back to 2.2 makes any sense at this point - it was released 4.5 years ago and if anyone is still using 2.2 they're probably not updating capybara --  I think testing against 2.14 and 3 is probably going to be fine in the future
",twalpole,abotalov
1186,2013-10-31 17:02:50,"@jnicklas , the same form works when I submit it through the browser. When I do a puts page.body in the step that is failing, I do see the csrf meta tag in the page body. It looks like this in the HTML

meta content=""YgH87uIz/13tjJ9VgxvpM0uQx6lwYWULWGVzlho7oF8="" name=""csrf-token"" 
",maheshguruswamy,jnicklas
1181,2013-11-26 18:47:50,"@jnicklas - how about we have the built-in drivers output a deprecation warning for now, but not test for it - and add a test for throwing an exception that is pending until version >= 3.0.0  which would be when semver allows for the change
",twalpole,jnicklas
1181,2013-11-26 20:50:44,"@twalpole that sounds like an excellent suggestion. :+1: 
",jnicklas,twalpole
1181,2014-04-02 23:30:17,"@comjf / @abotalov  - any progress on this?
",twalpole,abotalov
1181,2014-04-03 00:57:31,"@twalpole Please review, I'm rusty and completely forgot about this. I didn't quite understand what you meant by 'have the built-in drivers output a deprecation warning for now', not sure how to do that. So I simply made a new exception and modified tests for it. When 3.0 is ready we can look at this again. 

Perhaps I should close this and make a new PR to a different branch? (I also need to squash my history)
",comjf,twalpole
1180,2013-10-28 23:01:04,"@jnicklas  ok, the defaulting now occurs in Capybara::Node::Simple#value, and tests are there for both value and submission
",twalpole,jnicklas
1175,2014-06-01 16:55:52,"@twalpole That seems like an important thing to mention in the [""Finding"" part of the README](https://github.com/jnicklas/capybara/blob/master/README.md#finding) no?

For instance a comment like:


",olivierlacan,twalpole
1175,2014-06-01 17:18:38,"@olivierlacan There are plenty of things that don't work in Racktest besides visibility checking. So it shouldn't go there.
",abotalov,olivierlacan
1172,2013-10-20 17:56:07,"@jnicklas I like `go_back` and `go_forward` names!
",nashby,jnicklas
1172,2013-10-20 21:01:19,"@jnicklas done!
",nashby,jnicklas
1172,2013-10-27 11:41:44,"@jnicklas please let me know if I should change anything else.
",nashby,jnicklas
1165,2013-09-19 21:21:43,"My bad, thanks @jnicklas 
",thatandyrose,jnicklas
1165,2015-11-13 02:59:44,"@jnicklas (And anyone else this may concern), this has bitten me too, and although it was pretty easy to find an answer and fix it, it is a bit hacky to use a RegEx, and it means we can't test for the right text neither on CSS or on the code.

I image this kind of inconsistency would be pretty easy to fix, or at least to define a ""standard"" and explain which drivers are the exception (Either Selenium and you test code, and have to be hacky when using headless, or you test the CSS-ed version and Selenium is flagged).

I'm also Ok with suggesting using RegEx from the start and documenting it, or whichever other solution is decided on, I just think we shouldn't let any inconsistencies ""slide"", especially considering pretty much everything is working really smoothly. :D
",frnco,jnicklas
1165,2016-04-20 10:58:53,"@abotalov So `has_content?` is **not** meant to check for content of the page body?
Checking for the raw content therefore should be done via `page.find('body').text`?
",momolog,abotalov
1163,2013-09-16 16:47:34,"Thx @twalpole . Your note solved the problem:


",nagyt234,twalpole
1161,2013-09-16 08:04:55,"Just rebased it and rewrote test, @jnicklas could you review this one? At least it checks that server is available if we bind 0.0.0.0 address.
",route,jnicklas
1157,2013-10-20 16:44:06,"I agree with @twalpole, closing.
",jnicklas,twalpole
1156,2013-10-20 19:32:39,"@jnicklas No, I don't experience such issues
",abotalov,jnicklas
1153,2013-08-25 17:22:48,"@twalpole Sorry about the disturbance.
",JuanitoFatas,twalpole
1142,2013-08-27 14:23:26,"@jnicklas All of the docs I read for saving a page pointed to the `save_and_open_page` method, but it's now painfully obvious that I could just call `save_page` from a step.

Still, I found it jarring that when I first attempted to save and open a page, that missing the Launchy gem prevented it from saving at all.
",justincampbell,jnicklas
1132,2013-08-08 01:43:52,"@jnicklas Yeah, It's not the Capybara. I debugged with chromedriver and finally found that there's a pending request in the network list, which was intermittently blocked by the China Great Fire Wall. After I set proxy for chromedriver the problem was gone. 
",ryancheung,jnicklas
1125,2013-07-23 02:45:55,"This looks good to me. rspec-rails master is green under it.

For context, we're deprecating and removing `example` in favor of it being yielded to the hook as a block argument. To support both RSpec 2 and 3, though, libraries will need to do something like @thomas-holmes's patch.

Thanks :heart: 
",alindeman,thomas-holmes
1125,2013-11-14 16:35:25,"@jnicklas, RSpec 3.0.0 is near! Any chance we can get a capybara release pushed out with this change?
",alindeman,jnicklas
1121,2013-09-12 20:46:45,"@brycesenz - I would but it seems that @jnicklas didn't think it was pull request worthy.  I responded to a thread on the mailing list, but so far nobody else has spoken up.  I was able to get things working by following your example and monkey patching the responsive? method.  I also had to ensure that i was using the latest firefox as firefox 17 did not seem to honor the ignore ssl check option.  Overall, i think some more light needs to be shed in this area.  
",kbaum,jnicklas
1115,2013-07-23 23:53:29,"I think @srawlins's analysis is spot on.
",jnicklas,srawlins
1115,2013-07-28 08:01:00,"@jnicklas I think this can be closed since #1127 was merged :)
",nashby,jnicklas
1112,2013-07-26 16:04:50,"I agree with @twalpole , this is not a change that should be made - `with_in` doesn't make sense, and neither does `fillin`, so neither proposed change is good.
",EamonNerbonne,twalpole
1109,2013-09-04 20:19:44,"@jnicklas I ran into this issue today and wrote an example to reproduce the error. I forked and updated your gist [here](https://gist.github.com/midu/6442311)

the failing test is the [third one](https://gist.github.com/midu/6442311#file-template-rb-L56-L76)

Hope this helps
",midu,jnicklas
1109,2013-11-08 23:56:09,"That's fantastic @twalpole, thank you very much!
",midu,twalpole
1109,2013-12-07 20:18:48,"Wow that's interesting. To summarize for others, basically Nokogiri doesn't have a .gemspec so that means you can't reference to their git repo in a Gemfile, when you might want to if their master branch has fixes merged in but those fixes haven't been released yet. Thanks a lot @twalpole, I found a way to get around the bug I was having–the code is more hideous but it'll have to do. 
",mattvleming,twalpole
1103,2013-07-02 18:03:46,"@jnicklas good catch.  I submitted a PR with tests that would fix this issue, although this does raise the question of whether within_frame should be allowed to work in this case, since the frame being switched to is outside the within 'table.letter-opener' scope
",twalpole,jnicklas
1103,2013-07-02 22:21:45,"Fixed by #1110! Thanks @twalpole.
",jnicklas,twalpole
1103,2013-07-11 21:34:51,"@jnicklas since #1110 was merged I think it can be closed.
",nashby,jnicklas
1103,2013-07-11 23:35:26,"Ooops, forgot to click the button ;) Thanks @nashby 
",jnicklas,nashby
1101,2013-06-18 15:06:12,"@abotalov this is exactly what I was using it for.
",jsteiner,abotalov
1097,2013-07-04 06:47:36,"@alishutc we actually handle that case. The synchronize behaviour has gone through a lot of iterations, and I think the current behaviour is quite sophisticated and should cover most cases quite well. Bugs like this aside ;)

`synchronize` actually does nothing when it called inside another `synchronize` block. Since pretty much every call you make into Capybara is wrapped in `synchronize`, this means that sub-operations, such as getting the text of an element, never actually get stuck at waiting for a removed element. Instead the error will bubble, and the whole operation will retry instead.
",jnicklas,alishutc
1096,2013-11-16 21:52:14,"@jnicklas sorry, this was one of those ""suddenly it was magically gone"" issues that pop up from time to time.
",JeanMertz,jnicklas
1092,2014-04-03 21:52:51,"@jnicklas What sort of matcher were you thinking?  Obviously the issue is that the code doesnt know that click_button is actually going to direct to a new ""page"" so the headers are still for the current page.
",twalpole,jnicklas
1092,2014-04-04 17:31:49,"@dnagir click_button doesnt wait for the javascript to execute before returning, so its possible the response_headers is being accessed before that POST occurs (in your original code).  I think what @jnicklas was thinking was to have a has_response_headers matcher that would actually wait for the headers to match the passed in values.   
",twalpole,jnicklas
1092,2014-04-04 17:39:55,"@jnicklas Yeah - we don't have matchers for any other non-user visible type things specifically because Capybara is a user interaction testing tool.   Maybe a has_content_type matcher would make more sense, since that is at least something that the user would ""see""
",twalpole,jnicklas
1091,2013-05-24 07:46:48,"@jnicklas LOL. Sorry for this, I have no idea where it came from, don't even remember starting to type ""Long..."" :(
",dnagir,jnicklas
1075,2013-05-09 18:06:10,"Thanks for the feedback. I'll take some time to try and clean it up. @jnicklas can you give me some feedback on what part you don't think is ""quite correct""?
",mikegehard,jnicklas
1074,2013-05-09 15:45:00,"I agree with @twalpole. Testing like this isn't good and we shouldn't encourage it. Besides, this doesn't work as intended.
",jnicklas,twalpole
1074,2013-05-09 17:45:18,"Ok. It was a nice learning experience. 

On 9 mei 2013, at 17:45, Jonas Nicklas notifications@github.com wrote:

> I agree with @twalpole. Testing like this isn't good and we shouldn't encourage it. Besides, this doesn't work as intended.
> 
> —
> Reply to this email directly or view it on GitHub.
",hajee,twalpole
1072,2013-05-09 06:52:10,"@mhoran is this the issue you're talking about? https://github.com/jonleighton/poltergeist/issues/176

It does seem like there may be no perfect solution here. I think it is important to be able to test the behavior of clearing out a field.

Another option would be to make it an explicit action: something like `clear_field 'name'` instead of `fill_in 'name', :with => ''`. The drawback is that it would need a new `clear` method on `Node` implementations. We could ease the burden on driver developers by putting a default implementation in `Capybara::Driver::Node` that just calls `self.set('')` and then leave it to driver developers to provide an alternate implementation if necessary to get the desired behavior.

What do you think, @jnicklas?
",TimMoore,mhoran
1069,2013-05-09 16:35:09,"@jnicklas  the requirement for ignoring leading line breaks comes from http://www.w3.org/TR/html401/appendix/notes.html#notes-line-breaks   -  This specifically refers to rendering, and browsers have taken this to affect the value - I think this makes the case that its an issue in parsing in Nokogiri/libxml2 less clear
",twalpole,jnicklas
1065,2013-10-30 22:11:37,"Solving issue with Racktest and Selenium returning different values for `#[]` would be nice but such solution can't be complete as in general Selenium returns not attribute but property.

There are many differences between them (see https://dvcs.w3.org/hg/webdriver/raw-file/default/webdriver-spec.html#reading-attributes-and-properties). It will be not possible to implement all those rules in Racktest without JS support.

@jnicklas Do you think that `#[]` of Capybara's Racktest driver should try to mimic behavior of Selenium where possible?
",abotalov,jnicklas
1063,2013-07-04 06:53:14,"I think @twalpole pointed out the correct reason why this is happening.
",jnicklas,twalpole
1061,2013-04-20 10:20:55,"@twalpole well for the matter of tests, I'd expect the finder to return what a user would see one the page and not what the browser is internally doing.
",ohcibi,twalpole
1061,2013-04-20 17:05:49,"@twalpole Thanks.. I was also stumbling over this in the meantime.. While this is a totally acceptable (or even better) solution for my current use case, I'd still consider the behaviour of the finder as a bug or at least as inconsistent.
",ohcibi,twalpole
1061,2015-12-30 17:21:59,"Thanks @twalpole! The `wait: 0` option made it got from 6 sec to 0.1! Gonna have to put that in the ol' tool kit. 

 I'm going to guess though, there's no ""nice"" way of getting around extracting a change in input value without executing some javascript... is that correct?
",daino3,twalpole
1059,2013-04-17 23:46:44,"@abotalov thanks a lot!
",alfonsocora,abotalov
1059,2014-03-27 00:21:36,"@abotalov 
Thanks for this.
You can also use it with `within`


",serv,abotalov
1054,2013-04-14 14:02:52,"@TimMoore: we'd need the focusmanager thing for this. It's not acceptable that Firefox needs focus for this to pass.
",jnicklas,TimMoore
1049,2013-04-12 14:50:53,"@jnicklas Because I'd like to upgrade dependencies one at a time, not all of them at once. I haven't gotten around to testing my app on 1.9.3. I know I could but I'm just not there yet.

BTW, the same argument about 1.9.3 being ""highly compatible"" can be used to ask why you restrict your users to a specific Ruby version when other version are ""highly compatible""? ;-)
",awendt,jnicklas
1047,2013-04-14 17:50:46,"@jnicklas Overriding the self.connection method means you are bypassing AR's connection pool, thus making the code thread-unsafe.  My connection pool of size one ensures that there is still only one shared connection being used but because it's wrapped, it's thread-safe.
",mperham,jnicklas
1047,2013-04-14 19:28:46,"@jnicklas [Here's an example](https://gist.github.com/adammck/5383846#file-results-txt) of the thread-unsafe behavior of the current patch. The new patch is certainly strange, because we're actually using the `connection_pool` gem as a mutex, rather than a connection pool. But it works.
",adammck,jnicklas
1047,2013-07-03 12:26:29,"@mperham, @adammck I'm inclined to close this issue. As I mentioned in my last comment, I'm not super satisfied with this proposed solution either. While it should be more threadsafe, it is also more likely to just hang the app if you're doing something wrong. Do you agree? Is this still something we should explore further?
",jnicklas,adammck
1038,2013-04-03 19:35:03,"I agree with @twalpole, we should not be facilitating craziness like this.
",jnicklas,twalpole
1038,2013-04-03 20:16:25,"@abotalov if checking for changes to cucumber is really an issue, then you could add a Before step that stores the scenario and alias reset_sessions! to check for your tag name on the stored scenario and not call the original reset_sessions if the tag exists.  That way you get your desired ability to turn off session reset in your own code without worrying about cucumber.rb changing and without having to add a dangerous undocumented ""feature"" to capybara
",twalpole,abotalov
1038,2013-04-03 21:34:34,"Actually I'm not against documenting it in README.md. I just thought it's better not to write about it there.

Also I haven't understood @twalpole's comment. In current implementation after scenario hook will reset sessions after each scenario regardless of any tags. I don't know how before step hooks can help not to reset sessions in after hook.
",abotalov,twalpole
1038,2013-04-03 21:46:18,"@abotalov  -  And your reasoning for not documenting it, it being dangerous and having numerous iffy side-effects, is the exact reason I think it doesnt belong in capybara, and generally isnt a good idea to be suggesting people do in testing.  If its a test that needs the sesion to not be reset then its really one scenario and not two.  If its strictly for speed then look into tokens for login and/or bypassing part of authentication during testing.  As for how your own code can implement it given the current setup and without worrying about changes to cucumber.rb:  in a Before step you can store the scenario that is passed in into a global or instance variable somewhere.  Then you can alias the normal capybara reset_sessions!  with your own function that either calls the original reset_sessions! or doesnt based on the tags on the scenario you stored in the before step. 
",twalpole,abotalov
1037,2013-04-04 22:55:28,"@twalpole Good point, I partially agree. Yes, accept/reject_notification returns the text, but readability would suffer if we removed the message accessors, in my opinion. Specifically, because the text is assigned above the line where the alert is clicked. Granted, this is also the case for accepting/rejecting. The name `#accept_alert` doesn't lend itself to returning the text, either.





All that said, I would be in favor of removing the message accessors.
",mikepack,twalpole
1037,2013-04-04 23:07:53,"@mikepack - btw the reason the test you think should fail doesn't is that the javascript code used by selenium for the firefox driver (havent checked others) has an alertTimeout which it will wait for a modal dialog to show https://github.com/SeleniumHQ/selenium/blob/master/javascript/firefox-driver/js/firefoxDriver.js  .  Its set to 2 seconds by default, so you'll need to figure out if its possible to shorten that timeout in some cross browser fashion or extend your delay on the alert - and then the test will fail with a Selenium::WebDriver::Error::NoAlertPresentError
",twalpole,mikepack
1037,2013-04-04 23:11:11,"@mikepack I dont think having a var for the return really hurts readability much, and I think its better than the accessors where values ""magically"" appear but not until you've accepted or rejected the alert.  e.g. at a quick glance I might assume that alert_messages would include the message for the alert currently on the screen, but it doesnt until I call accept or reject
",twalpole,mikepack
1037,2013-04-04 23:38:28,"@twalpole Thanks for the tip, I'll mess with the timeouts.

I could see the potential confusion around alert_messages; this is how capybara-webkit surfaces the message, though I don't know the general sentiment towards it.

Having alert_messages could also cause confusion if used in conjunction with manual management of the notification. The alert must be wrapped with accept/reject to populate any messages. Eg:


",mikepack,twalpole
1037,2013-04-05 07:52:52,"This is shaping up quite nicely, @mikepack.

I think I agree with @twalpole, the `alert_messages` style accessors are confusing, and I think it's better to skip them. I think the most common use case is not to care about the message of the alert at all. One thing that _would_ be useful, imo, is something like this:



I think that gives a more elegant API to the most common reason one might want to look at alert/confirm messages in the first place, to make sure that we're confirming the right one. What do you think?

@abotalov that's too RSpec specific, imo. We might want to add matchers around that particular API, but honestly I don't really see the point.
",jnicklas,mikepack
1037,2013-04-05 07:52:52,"This is shaping up quite nicely, @mikepack.

I think I agree with @twalpole, the `alert_messages` style accessors are confusing, and I think it's better to skip them. I think the most common use case is not to care about the message of the alert at all. One thing that _would_ be useful, imo, is something like this:



I think that gives a more elegant API to the most common reason one might want to look at alert/confirm messages in the first place, to make sure that we're confirming the right one. What do you think?

@abotalov that's too RSpec specific, imo. We might want to add matchers around that particular API, but honestly I don't really see the point.
",jnicklas,abotalov
1037,2013-04-05 07:52:52,"This is shaping up quite nicely, @mikepack.

I think I agree with @twalpole, the `alert_messages` style accessors are confusing, and I think it's better to skip them. I think the most common use case is not to care about the message of the alert at all. One thing that _would_ be useful, imo, is something like this:



I think that gives a more elegant API to the most common reason one might want to look at alert/confirm messages in the first place, to make sure that we're confirming the right one. What do you think?

@abotalov that's too RSpec specific, imo. We might want to add matchers around that particular API, but honestly I don't really see the point.
",jnicklas,twalpole
1037,2013-04-05 07:53:30,"@mikepack also, can you shorten the README section a bit. It's very longwinded, imo.
",jnicklas,mikepack
1037,2013-04-05 08:12:44,"@abotalov well, `accept_confirm` doesn't conform to the sequence of events either, but that's just a sacrifice we have to make to allow wider support in drivers. I'd rather that `accept_confirm` didn't take a block, and always appeared after the action that triggered the alert to appear. I.e. this:



Unfortunately, it seems like that's not technically possible in some drivers, from what I understand.
",jnicklas,abotalov
1037,2013-04-05 16:15:53,"@jnicklas the `accept_confirm` after the fact approach would definitely be harder in capybara-webkit, but if it's agreed that it would be a much better API, I could do some spiking to see if it's possible.
",jferris,jnicklas
1037,2013-04-05 16:23:48,"I've updated the README to be more succinct and removed the message accessors.

@jnicklas while passing the expected message to accept/reject, if the actual message presented does not match the expectation, would you assume this throws an error? If so, the implicit expectation here is a little unclear.

@jferris thanks a ton. I'm interested in your results.
",mikepack,jnicklas
1037,2013-04-05 16:30:31,"@jferris if it's not too much bother, that would be excellent. I would definitely prefer an API without blocks if it's possible. I think Selenium supports that nicely.

@mikepack I would expect `accept_confirm` to raise an error if there is no confirm box to accept, so if passed an argument, it should raise an error if the text does not match.
",jnicklas,mikepack
1037,2013-04-05 16:51:26,"@jnicklas Just to confirm 

>  I would expect accept_confirm to raise an error if there is no confirm box to accept, so if passed an argument, it should raise an error if the text does not match.

Those errors would only be raised after the appropriate wait time, using synchronize, correct?
",twalpole,jnicklas
1037,2013-04-05 16:55:06,"@mikepack it would be great if these methods could accept a regex or a string to match against the text in the alert
",twalpole,mikepack
1037,2013-04-05 17:14:33,"@mikepack  The current PR has methods for dealing with alerts, confirms, and prompts in the session with these all calling accept/reject_notification, but not passing pass a type.  I know selenium doesnt differentiate between the 3 different types but are you sure the other drivers dont?  I notice your ""Option Two"" from above did have a type parameter.
",twalpole,mikepack
1037,2013-04-05 17:26:12,"@twalpole Good catch! Updated.
",mikepack,twalpole
1037,2013-04-05 18:52:58,"if I was writing those specs I think I'd put them all in one file, notifications_spec or modal_spec or something since they are basically all the same thing.  @jnicklas what are your feelings on that?
",twalpole,jnicklas
1037,2013-04-05 18:57:29,"@abotalov @twalpole The reason I put them into separate files is to keep consistency with all the rest of the DSL methods: `all`, `click_link`, `execute_script`, etc as `all_spec.rb`, `click_link_spec.rb`, `execute_script_spec.rb`, etc
",mikepack,abotalov
1037,2013-04-05 18:57:29,"@abotalov @twalpole The reason I put them into separate files is to keep consistency with all the rest of the DSL methods: `all`, `click_link`, `execute_script`, etc as `all_spec.rb`, `click_link_spec.rb`, `execute_script_spec.rb`, etc
",mikepack,twalpole
1037,2013-04-05 19:05:46,"@mikepack I get completely why you created the multiple files, and it does fit with the way everything else is setup (other than they should be accept_alert_spec.rb instead of accept_alerts_spec.rb etc)
",twalpole,mikepack
1037,2013-04-05 19:11:25,"@twalpole Another great catch. Updated.
",mikepack,twalpole
1037,2013-04-10 16:03:49,"@jnicklas @abotalov I'd be in favor of subdirectories, but this is a little off topic for this PR :smile:. Spending some time today in capybara-webkit
",mikepack,jnicklas
1037,2013-04-10 16:03:49,"@jnicklas @abotalov I'd be in favor of subdirectories, but this is a little off topic for this PR :smile:. Spending some time today in capybara-webkit
",mikepack,abotalov
1037,2013-04-18 17:14:31,"@mikepack I haven't gotten to look at it yet. I'll spend some time on it tomorrow. Thanks for the push.
",jferris,mikepack
1037,2013-04-19 14:27:59,"@mikepack I did some research today and added notes to thoughtbot/capybara-webkit#506.
",jferris,mikepack
1037,2014-03-24 16:51:21,"@abotalov in terms of naming, I agree we should stick to the spec as much as possible.

The spec seems to only support reactive dialog management. As the issue you linked to points out, phantom doesn't accommodate this approach. So, the goal of this PR is to support both proactive and reactive management, which is why this PR currently wraps such behavior in a block.

Proactive management in headless drivers (eg capybara-webkit, poltergeist, ghostdriver) looks like this:
1. Developer takes actions on forthcoming prompts
2. Page ""displays"" prompt, but because it's headless does not block
3. Make assertions about the prompt messages cached by driver

Reactive management in Selenium looks like this:
1. Page displays prompt and blocks UI until action is taken
2. Make assertions about the message contents
3. Developer explicitly takes action to close dialog

Can you provide examples of how your proposed API would accommodate both of these cases?
",mikepack,abotalov
1037,2014-04-02 23:28:58,"@mikepack Any chance of getting this PR rebased against current master and the naming changes @abotalov mentioned integrated, I'd like to move forward with getting this finished up and integrated.   I agree that the block passing method is probably the only way to currently allow this feature to be implemented by all/most of the current drivers available, so unless @abotalov has a suggestion for how the API can work with the headless-drivers I think we can move forward with the current approach
",twalpole,mikepack
1037,2014-04-02 23:28:58,"@mikepack Any chance of getting this PR rebased against current master and the naming changes @abotalov mentioned integrated, I'd like to move forward with getting this finished up and integrated.   I agree that the block passing method is probably the only way to currently allow this feature to be implemented by all/most of the current drivers available, so unless @abotalov has a suggestion for how the API can work with the headless-drivers I think we can move forward with the current approach
",twalpole,abotalov
1037,2014-04-03 03:35:09,"@twalpole I've rebased off master, replaced instances of ""reject"" with ""dismiss"", and ""notification"" with ""modal"".
",mikepack,twalpole
1037,2014-04-03 17:58:57,"@abotalov  Ok - we can hold off a little while, but I would like to get this functionality into Capybara in the next few weeks, and in a way that all/most of the current drivers can implement.  Currently that looks to be with the block format, since prior knowledge of a modal dialog about to be opened, and the desired response seems to be needed by some of the drivers.
",twalpole,abotalov
1037,2014-04-04 17:20:22,"@mikepack - The async tests are failing since there is no code after executing the block that is waiting for the modal to appear
",twalpole,mikepack
1037,2014-04-04 17:22:48,"@mikepack - also if you could update the tests to the ""expect"" format rather than should due to the upcoming RSpec 3 that would be great -- thanks
",twalpole,mikepack
1037,2014-04-04 17:24:02,"@twalpole Yeah I noticed that as well. I'll do another pass and get everything passing.
",mikepack,twalpole
1037,2014-04-24 07:56:53,"I think I'm fine with merging this after issues pointed by @twalpole will be fixed.

However, what about naming a method `accept_alert_on` instead of `accept_alert`? IMO it would enhance readability.
",abotalov,twalpole
1037,2014-06-03 19:55:36,"@twalpole It would be also good to add more info to yard comments:



Also it would be good to make a pull request from modal to master branch. I think commit comments will have better visibility.
",abotalov,twalpole
1037,2014-06-03 20:22:25,"Apologies for the lack of movement. I'm not sure how I got this far without handling the async case that @twalpole mentioned (though I thought I tested it). One of the problems with it is that it would require the same wait logic that happens on `#synchronize`. I didn't want to dive too deep into sharing that logic.
",mikepack,twalpole
1037,2014-06-03 21:45:56,"@mikepack  - it did work with async - but only because selenium itself has a 2 second wait for modal boxes.  I implemented somewhat adjustable delays using the wait functionality built into selenium-webdriver. Its only somewhat because of the selenium 2 second delay which means it actually ends up being multiples of 2 seconds.  Anyway -- no problem for the lack of movement you had it mostly done - I've moved it over to PR #1322 if you want to see what I added to your PR
",twalpole,mikepack
1035,2013-03-29 18:01:32,"Hi @abotalov - this sounds like it could be related 

Currently at the top of acceptance_helper.rb I already have:

require ""spec_helper""
require 'capybara/rspec'
require 'rspec-rails'

Not sure what I need to do to fix it? 

Any help would be appreciated.
",wakiki,abotalov
1035,2013-09-24 23:15:22,"@jnicklas yes, that works, as does using a filename that doesn't exist.
",brettporter,jnicklas
1035,2013-09-25 13:48:18,"@jnicklas navigating to a file worked for me as well, and as brettporter noted, as does navigating to a file that does not exist.
",rhuberdeau,jnicklas
1035,2013-10-09 14:24:50,"@jnicklas I just updated chromedriver to 2.4 (with Chrome 30.0) and the problem seems to have gone away, as did a problem I was having with a click event. The release notes indicate it supports Chrome 29.0 - 32.0, so perhaps the problem highlighted by recent commenters was chromedriver 2.3 + Chrome 29.0+?

Incidentally, I noted that chromedriver starts on the URL `data:,`, which might be another alternative to consider if needed.
",brettporter,jnicklas
1035,2013-12-17 02:18:59,"Hi @jnicklas! I noticed that 6b1e42d hard codes a local file system path. In my test suite, rspec/capybara/webdriver are running in a virtualbox, and only firefox and selenium are running on the local Mac. As a result, I see firefox's file not found error in between each test. Do you have any suggestions for working around this issue?
",mickeyreiss,jnicklas
1035,2013-12-17 07:37:14,"@jnicklas how about `data:text/html,` instead? This works in Safari, Chrome and Firefox here. (`data:,` works in the last two only).
",brettporter,jnicklas
1035,2013-12-20 09:32:28,"@jdelStrother there are multiple reasons for doing this, for one, it cancels all active Ajax requests, which prevents a lot of ugly race conditions on cleanup. Also, it prevents state from bleeding over between test cases, which is generally what you want.
",jnicklas,jdelStrother
1035,2014-01-06 16:55:06,":cactus: Thanks @jnicklas! We'll try this out and will let you know if there are any problems.
",mickeyreiss,jnicklas
1035,2014-01-08 09:06:34,"Tested on a setup with the original problem (running local tests with Chrome on OSX) and on a setup that didn't like the above fix (remote tests with IE on Windows 7 VM).

Can confirm all is hunky dory now, thanks v much for the great project @jnicklas!
",kippr,jnicklas
1034,2013-03-29 14:50:27,"Thanks @jnicklas - I saw the gotcha with Timecop so already use Timecop.travel and it's not related to that.
",wakiki,jnicklas
1034,2013-03-29 17:42:47,"Thanks @jnicklas . I'll close this ticket.
",wakiki,jnicklas
1032,2013-03-28 17:02:09,"@shybovycha  As @jnicklas has pointed out the html spec states that the content model for textarea elements is of type Text.  That being said browsers default behavior for invalid content in textareas is to convert it to text.  This leads to the situation where having the following source for your document
    &lt;textarea&gt;&lt;div&gt;&amp;lt;div&amp;gt;some content&amp;lt;/div&amp;gt;&lt;/div&gt;&lt;/textarea&gt;
will lead to the innerText on the textarea returning 
&lt;div&gt;&lt;div&gt;some content&lt;/div&gt;&lt;/div&gt;  
which obviously isn't correct but is a byproduct of the browser trying to handle invalid markup.  It sounds like your app is generating invalid markup by not escaping the contents of the textarea to start with and should probably be fixed.  This does not look like an issue with capybara.
",twalpole,jnicklas
1028,2013-04-04 07:54:17,"I'm running into a problem that seems to be related. We're trying to _clear_ some input fields, but the change event doesn't get fired, so the underlying Backbone model isn't updated. Because we're setting to an empty string, the `send_keys` call is presumably a no-op.

If I patch in the old implementation, it works as expected. @jnicklas do you have any thoughts about what you'd like to do with this issue or how you want to handle these edge cases, if at all? Maybe offer an option to use the old behavior? Special case setting to an empty string?

I'm happy to take a stab at a pull request with the fix.
",TimMoore,jnicklas
1028,2013-04-04 09:55:40,"+1

I ended up monkey-patching/overriding the method. An option to use the odd behaviour would be great and should be very easy to implement. So the DSL would be something like:

fill_in ""name"", with: ""Jo Bloggs"", use_backspace: true

or whatever other name can be used for the option.

It would really help the edge cases like mine as current upgrade completely broke my specs and there's no way round it other than to hack the source...

@jnicklas what do you think?
",wakiki,jnicklas
1024,2013-03-25 09:36:07,"@abotalov if Rails previously returned something other than a `Gem::Version` that might break on older versions.
",jnicklas,abotalov
1024,2013-03-25 09:48:20,"@jnicklas What about:


",abotalov,jnicklas
1024,2013-03-25 09:56:43,"@jnicklas 


",abotalov,jnicklas
1009,2013-03-17 21:34:08,"@jnicklas  Thank you for the fix - definitely seemed to fix the issue in the test case.  
",jpurcell001,jnicklas
1007,2013-03-13 07:00:39,"@twalpole feel free to merge small changes like this yourself, if you want.
",jnicklas,twalpole
1006,2013-03-12 21:18:04,"Ah, right, thank you @abotalov.
",sirbrillig,abotalov
1002,2013-03-11 16:53:21,"@jnicklas, I would be really grateful for any advice on narrowing down this issue.

I now had to put an around filter for every spec that uses Rack::Test and has 2 slashes in visit call.

Gems:



spec_helper.rb


",fenelon,jnicklas
1002,2013-03-11 21:48:35,"Thanks anyway, @jnicklas. :) Are you absolutely sure that it's an app-level problem? Could you at least point me at the differences `Capybara.app_host` makes to `Rack::Test` behaviour? Cause those slashes dont get escaped if I specify it. 
",fenelon,jnicklas
1002,2013-03-11 23:38:30,"@jnicklas, it seems to have no effect on this issue.

# 

FOUND IT! After 2 tries back in November and 4 days this month! 

Somehow, it's been crashing because of this line in routes:



Rack::Test somehow hitting Rails with `www`. =/

Thank you, Jonas! I couldn't get to sleep because of this bug. 
",fenelon,jnicklas
1002,2013-03-11 23:53:48,"@jnicklas, closing it now. Thanks again!

P.S. Do you think the fact the default `Rack::Test` behaviour setting `www` subdomain worth reporting to them? 
",fenelon,jnicklas
1001,2013-03-11 02:19:12,"@deepj  doing page.execute_script('sessionStorage.clear()') from an after block for javascript tests or as the last step of any tests that set the sessionStorage would accomplish what you want too, without having to go through signing out of your app
",twalpole,deepj
1001,2013-11-15 15:29:10,"@deepj says ""It'd be nice when Capybara resets HTML5 session storage too.""

I say this is definitely an expected behaviour of capybara-cucumber integration. Otherwise the scenarios are not isolated.

Some web-apps use html5 local storage in stead of cookies to remember visitors across sessions.
",jarl-dk,deepj
1001,2013-11-15 16:08:23,"@jarl-dk Most web apps don't use HTML5 web storage at all.
I think it doesn't worth to be put to `cucumber.rb` as it will slower tests a bit.

Also note that Capybara doesn't clear cache between scenarios. It may affect other scenarios for some web apps. I think Capybara shouldn't do it for the same reason.
",abotalov,jarl-dk
996,2013-03-08 20:53:57,"@jnicklas @abotalov mentioned that fieldset supports the disabled attribute, and the spec says ""When specified, causes all the form control descendants of the fieldset element, excluding those that are descendants of the fieldset element's first legend element child, if any, to be disabled.""   This is not currently supported in racktest, and a quick test with selenium seems to show that it gets it wrong too (field is actually disabled in the browser, but the native element returns that its enabled).  Not sure if its worth trying to implement.
",twalpole,jnicklas
996,2013-03-08 21:38:04,"Note: @jnicklas and @twalpole replied to comment that was deleted just after writing
1. In this pull request `:option` doesn't support `:disabled`. But it supports it according to [HTML 5 spec](http://developers.whatwg.org/links.html#disabled-elements).
2. I prefer fast CSS selectors over selectors like `:button` that are transformed to XPath selectors so I think `:disabled` should also be available on `:css` and `:xpath`. IMO it does make sense to write `find('#button_id', disabled: true)`
3. Most of the buttons are never disabled so I think Capybara shouldn't check if button is disabled if `:disabled` option isn't specified. Such checks take time (especially in webdriver) and I don't want my tests to be slower because of unnecessary checks. But it can't be so because of backwards compatability as @jnicklas pointed out.

[But as I see](https://github.com/jnicklas/xpath/commit/6429e5a84a7893d514be1cb04d3ff250b74ab1f8) previously only disabled buttons weren't find by default. Do you think it will be better to set default for disabled to `false` only for buttons and to `nil` for all other selectors (where `nil` means no check)?

Another option is to add config option `find_disabled_elements` set by default to `false` and allow user to set it to `true`
",abotalov,jnicklas
996,2013-03-08 21:38:04,"Note: @jnicklas and @twalpole replied to comment that was deleted just after writing
1. In this pull request `:option` doesn't support `:disabled`. But it supports it according to [HTML 5 spec](http://developers.whatwg.org/links.html#disabled-elements).
2. I prefer fast CSS selectors over selectors like `:button` that are transformed to XPath selectors so I think `:disabled` should also be available on `:css` and `:xpath`. IMO it does make sense to write `find('#button_id', disabled: true)`
3. Most of the buttons are never disabled so I think Capybara shouldn't check if button is disabled if `:disabled` option isn't specified. Such checks take time (especially in webdriver) and I don't want my tests to be slower because of unnecessary checks. But it can't be so because of backwards compatability as @jnicklas pointed out.

[But as I see](https://github.com/jnicklas/xpath/commit/6429e5a84a7893d514be1cb04d3ff250b74ab1f8) previously only disabled buttons weren't find by default. Do you think it will be better to set default for disabled to `false` only for buttons and to `nil` for all other selectors (where `nil` means no check)?

Another option is to add config option `find_disabled_elements` set by default to `false` and allow user to set it to `true`
",abotalov,twalpole
996,2013-03-08 23:04:06,"@abotalov no, fields need to be disabled in 2.0 as well, not just buttons. This change as far as I'm aware is completely compatible with 2.0.

As for performance: we can't have the cake and eat it too, unfortunately. If we want disabled fields not to be found by default (which we do, both for semver and simply because it's a good idea), and we want that option to be configurable, which apparently a lot of people seem to want, even though I kinda think they're wrong, then this is what we end up with.
",jnicklas,abotalov
996,2013-03-08 23:21:18,"@jnicklas I haven't understood. Do you agree with providing something like `Capybara.find_disabled_elements` or not?
",abotalov,jnicklas
996,2013-03-10 14:31:27,"I am a concerned about the performance issue that @abotalov has pointed out. I did some benchmarking, with this code: https://gist.github.com/jnicklas/5128764

Running against this pull request:



For comparison, here it is running against master:



We can see that there is some variance, but clearly, this pull request yields an almost x2 decrease in performance when locating buttons. Unless the benchmark is somehow flawed.

To me, that's not really acceptable. @sobrinho and other who wanted this, what do you think?
",jnicklas,abotalov
996,2013-03-10 15:18:19,"With `n = 1000` I have similar results to @jnicklas :


",abotalov,jnicklas
996,2013-03-13 00:34:47,"@jnicklas Implementing with disabled being passed to the selector generator I get the following times for n=1000



that was with the button selector below


",twalpole,jnicklas
996,2013-03-13 02:04:47,"@sobrinho One downside I can think of is that according to the html 4 and 5 spec form controls inside a fieldset that is disabled are supposed to be disabled (unless they are in its first legend child element).  One would assume that browsers would report those controls as disabled even though they dont have the disabled attribute on them.  Querying via xpath for the disabled attribute would obviously not be correct then.  That being said selenium-webdriver (with firefox at least)  does not actually report those elements as disabled even though they are displayed as disabled, so I'm not sure whether thats a bug or a conflict between the html spec and the webdriver spec (Also current xpath gem uses the disabled attribute on the element so technically its wrong too).  The other downside is it probably means special casing the disabled option since it would no longer be implemented as a custom filter
",twalpole,sobrinho
996,2013-03-13 12:05:58,"It may be considered a bug but I never seen any web application using the disabled attribute on fieldsets.

Since XPath and Capybara seems to never be cared about this attribute on fieldset, I don't think we should care about it right now (maybe in the future or when someone report that's a needed feature).

@jnicklas ?
",sobrinho,jnicklas
996,2013-03-13 21:32:28,"@jnicklas PR 1011 builds on top of this PR, implements the concept of Selector modifiers which are applied to the selector expression based on options, and then implements :disabled as modifiers instead of filters which should get rid of the performance hit.
",twalpole,jnicklas
995,2013-03-25 23:29:11,"@jnicklas @michaelrkn what's the best move here?  I'm hoping to help triage a little bit, and figured this was a decent place to start?  I can send another PR that just cherry-picks the first commit, if that's helpful.
",knewter,jnicklas
995,2013-03-25 23:29:11,"@jnicklas @michaelrkn what's the best move here?  I'm hoping to help triage a little bit, and figured this was a decent place to start?  I can send another PR that just cherry-picks the first commit, if that's helpful.
",knewter,michaelrkn
988,2013-03-17 14:56:09,"Finally merged this, thank you @abotalov!
",jnicklas,abotalov
984,2013-03-06 12:16:04,"@jcoglan basically the wait system uses Exceptions as control flow, cuz everyone knows that's a great idea. 

Capybara's `synchronize` method wraps pretty much everything that Capybara does; when an exception happens inside `synchronize` that is of a certain type, the block is rerun, until no exception is raised or a timeout occurs.

For the most part, this process is completely irrelevant to driver authors, since it's handled at Capybara's layer.

However, in certain cases, elements become invalid, for example they may have disappeared from the DOM, or become invisible or whatever. This doesn't appear to be such a huge problem, since the element is now invalid, interacting with it should obviously raise an error. Unfortunately, this situation leads to race conditions, when elements disappear and reappear off the DOM. Since version 1.1 we've had a system in Capybara called automatic reload, which when faced with such an exception will attempt to reload the element.

The only thing you need to do as a driver author is to make calling methods on invalid elements raise an exception, and then adding the exception class that is raised to [`invalid_element_errors`].(https://github.com/jnicklas/capybara/blob/master/lib/capybara/driver/base.rb#L50-L52).
",jnicklas,jcoglan
984,2013-03-06 12:18:22,"@jcoglan In other words, you should _not_ block, in order to wait for timeouts. All actions performed in Capybara are assumed to be asynchronous. They don't _have_ to be, the RackTest driver is synchronous everywhere, but for JS support it makes more sense.
",jnicklas,jcoglan
984,2013-03-25 22:21:39,"@jnicklas I'm confused by when calls should wait or not. e.g. compare https://github.com/jnicklas/capybara/blob/master/lib/capybara/spec/session/find_spec.rb#L47-L51 with https://github.com/jnicklas/capybara/blob/master/lib/capybara/spec/session/has_css_spec.rb#L24-L28. The former requires `:wait` in order to wait for the `setTimeout()` to fire, while the second one doesn't. Is this difference indicated to the driver in any way?

I have this code in my `click` implementation that makes `click` block until timeouts and ajax calls have completed:

https://github.com/jcoglan/terminus/blob/master/lib/terminus/public/terminus.js#L245-L254

Should I remove this entirely, or reduce what it does, or are there options I'm ignoring in my implementation? Simply removing this logic and making `click` return immediately after triggering the event makes a lot of ""waits for asynchronous load"" specs fail, like the `has_css` spec I've linked to above.
",jcoglan,jnicklas
984,2013-03-26 07:26:46,"@jcoglan did you see my explanation above: https://github.com/jnicklas/capybara/issues/984#issuecomment-14496380

Capybara will keep retrying until it succeeds. You should _not_ block anywhere, it shouldn't be necessary. The :wait option is new, and just makes it configurable _how long_ Capybara will wait and retry, again, you shouldn't have to care about it. Try rereading the README section on async JS and my explanation above.
",jnicklas,jcoglan
984,2013-03-26 09:01:28,"@jnicklas Did this change in 2.0? Looking at my tests (I maintain compatibility with 1.1, 2.0 and 2.1) there was a group of tests in 1.1 called `driver with resynchronization support`, suggesting resync was the driver's responsibility. I've removed my resync code and got things working on 2.1, but on 1.1 these two tests fail:
- `#find with synchronization turned on should wait for all ajax requests to finish`
- `#find with short synchronization timeout should raise an error`

Can you clarify the role of resync in 1.1 and whether it was Capy's or the driver's responsibility?
",jcoglan,jnicklas
984,2013-03-26 09:46:47,"@jcoglan it changed between 1.0 and 1.1, where we implemented the auto_reload feature which made resynchronization in the driver no longer necessary. However, we kept the resynchronization feature around, in the Selenium driver, mostly for compatibility reasons, but it was switched off by default. As long as the rest of the tests pass, I think you should be good with just removing `driver with resynchronization support` from your suite.
",jnicklas,jcoglan
984,2013-03-27 10:16:42,"@jnicklas Okay, I've reinstated my resync code but made it disabled-by-default. I'm now passing all the tests on 1.1, 2.0 and 2.1.
",jcoglan,jnicklas
984,2013-03-27 13:32:55,"@jcoglan nice :D
",jnicklas,jcoglan
982,2013-02-27 16:16:49,"@jnicklas I should remove this line? https://github.com/jnicklas/xpath/blob/master/lib/xpath/html.rb#L172

I'm a bit afraid to remove it since it will change the currently behavior of xpath, regardless of the behavior of capybara.
",sobrinho,jnicklas
982,2013-03-08 02:57:34,"@sobrinho i like the idea!
Are you working on this already? If so looking forward to it :)
In case not, i probably can help working on a patch for this. Let me know.
",grzuy,sobrinho
982,2013-03-09 03:51:01,"@grzuy nope, I was pretty busy this week.

Seems like @jnicklas already started to work on this feature :)
",sobrinho,jnicklas
982,2013-03-09 03:51:01,"@grzuy nope, I was pretty busy this week.

Seems like @jnicklas already started to work on this feature :)
",sobrinho,grzuy
982,2013-03-16 14:24:26,"Thanks @jnicklas! :heart:
",sobrinho,jnicklas
982,2015-07-02 06:58:35,"I am late to this party but thanks @jnicklas  for this feature
",sigu,jnicklas
981,2013-03-04 20:31:29,"@yannp That works too.
",yfeldblum,yannp
980,2013-03-26 19:20:28,"No response from OP. I agree with @twalpole, there is nothing in Capybara itself which could possibly affect Rails.env. Closing.
",jnicklas,twalpole
979,2013-02-27 16:46:07,"@jnicklas my end goal was to just have travis default to run a few tests on chrome that firefox has to be pending on ( specifically hover currently). While working towards that I hit upon the issue I described with the sessions, and figured that should be fixed.
",twalpole,jnicklas
979,2013-02-28 23:03:27,"@jnicklas ok, chrome tests are now only run for the travis rake task and I fixed the issue with the second server instance not booting.  However now the rbx tests are failing due to timeouts, not sure why - any ideas you can provide would be appreciated
",twalpole,jnicklas
979,2013-03-04 22:58:46,"@abotalov there's also no native event support on OSX and the selenium hover support has positional issues on Firefox too, so the native events are not the only reason for issues on Firefox.
",twalpole,abotalov
979,2013-04-12 09:59:11,"@twalpole is this still working for you? When I merge it into the latest master and try to run it (with Chrome 26 on Mac OS 10.8) I get a lot of timeouts waiting for Chrome to load pages:



etc.
",TimMoore,twalpole
979,2013-04-13 19:07:17,"@TimMoore -  havent tried it in a while -- I know there were issues with the latest versions of chrome and chromedriver
",twalpole,TimMoore
979,2013-04-13 22:52:55,"@TimMoore Just tried it -  same issues you're having with it just hanging when using Chrome 26.0.1410.65 and chromedriver 26.0.1383.0 .  Strangely if one removes the 
    @browser.navigate.to('about:blank')
from Capybara::Selenium::Driver#reset!  then the tests work fine (other than the reset_session tests obviously).  It seems that either Chrome or chromedriver may be having an issue with changing the URL rapidly or something.
",twalpole,TimMoore
979,2013-11-14 21:29:22,"Whatever happened to this issue? Our build time on Travis is 11 minutes, well under the cut off at 50 minutes, so we should be able to add a Chrome run without problem. @twalpole did you have this working? Care to bundle it up in a pull request?
",jnicklas,twalpole
979,2013-11-15 21:44:18,"@jnicklas  I'll see about getting the PR updated to latest code
",twalpole,jnicklas
979,2013-11-18 21:32:26,"@jnicklas ok this PR works again, and will run the tests against chrome as well as firefox on travis
",twalpole,jnicklas
970,2013-02-25 08:02:04,"@jnicklas no problem. Do you plan remove rack-test dependency as well?
",morgoth,jnicklas
969,2013-02-25 17:26:09,"@jnicklas you're welcome
",twalpole,jnicklas
966,2013-02-21 19:44:17,"@jnicklas I wasn't aware of the contributing guide when I wrote this issue. Just read about the mailing list, so I'm going to repost this there, and close this issue for now unless it is determined that there is a bug indeed.

Thanks!
",jakeonrails,jnicklas
965,2013-02-21 17:09:01,"@jnicklas Moving window related functions to a Capybara::Driver::Window class is fine, but I'm not sure what you're suggesting with within_window.  Are you saying that one shouldnt be able to just call resize_window or window.size(xxx,yyy) in the current session to resize the current window?
",twalpole,jnicklas
965,2013-02-21 20:10:57,"@twalpole Please don't add different features in the same pull request next time when you will do it. It will make review easier
",abotalov,twalpole
965,2013-02-21 20:24:56,"@abotalov The only reason they were in the same PR was because they were discussed in the same issue referenced above.
",twalpole,abotalov
961,2013-02-18 20:42:06,"@jnicklas - I implemented a way for drivers to indicate their acceptance of native css queries, and changed find in driver and node to receive a parameter identifying the format of the selector.  Please take a look and let me know if you think this is going in the right direction. There are 3 original tests that fail currently

rspec ./lib/capybara/spec/session/within_spec.rb:7 # Capybara::Session selenium #within with CSS selector should click links in the given scope
rspec ./lib/capybara/spec/session/within_spec.rb:48 # Capybara::Session selenium #within with Node rather than selector should click links in the given scope
rspec ./lib/capybara/spec/session/within_spec.rb:60 # Capybara::Session selenium #within with the default selector set to CSS should use CSS

They are failing because they do a css query of ""#for_bar li[contains('With Simple HTML')]"" which isn't legal css, so when passed directly to the browser instead of being processed by nokogiri they error out.  I can change these to use the :text option instead if you're ok with chaning them
",twalpole,jnicklas
961,2013-02-18 20:50:17,"@twalpole if you can fix the failing specs, that would be great. There's no reason for them to use `contains`. Given that we went with separate methods for `visible_text` and `all_text`, maybe we should go with separate methods here as well? I like @jferris suggestion. Honestly though, I don't really care what the API towards the drivers looks like.
",jnicklas,twalpole
961,2013-02-18 21:14:16,"@jnicklas I have fixed the specs. As for the find api - one thing to take note of is that by just having it be find( selector_format, selector ) it matches the node#find api and resolve_query doesnt need to know whether its calling a driver or a node.  If Node and Driver have different find apis then resolve_query would have to determine which its calling
",twalpole,jnicklas
961,2013-02-18 21:18:05,"@abotalov - driver.rb is like that because the code defaults to not passing a format when using xpath, so that existing drivers will still work
",twalpole,abotalov
961,2013-02-18 21:21:40,"@twalpole shouldn't nodes implement both CSS and XPath as well then?
",jnicklas,twalpole
961,2013-02-18 21:26:46,"@twalpole Regarding your last comment: Capybara 2.1 breaks backwards compatability (as `all_text` method is added) so I think it can be brought here too
",abotalov,twalpole
961,2013-02-18 22:45:48,"@jnicklas I think the commit handles your concerns, next step is to move over to find_css and find_xpath if that is the consensus? or to remove the defaulting xpath format if the find(format, selector) api is preferred but with a required format?
",twalpole,jnicklas
961,2013-02-18 23:13:29,"@jnicklas Good catch - I missed the conversion, although its not overriding @preferred_format, because @preferred_format is only set in css (it defaults to :xpath in initialize)
",twalpole,jnicklas
961,2013-02-19 17:46:16,"@jnicklas I think the last pushes cover all current concerns and feedback
",twalpole,jnicklas
961,2013-02-19 18:48:08,"@mhoran nope 
",twalpole,mhoran
961,2013-02-19 19:05:36,"For some reason GitHub is not picking it up, but I just merged this. Thanks @twalpole for putting in so much effort and putting up with our nagging ;)
",jnicklas,twalpole
961,2013-02-19 19:11:03,"@jnicklas no problem, happy to contribute
",twalpole,jnicklas
961,2013-02-21 12:25:19,"@jcoglan seems like most browsers these days support most selectors which are in regular use. I'm okay with different browsers providing different levels of support for CSS. If you want to go the extra mile, you could use sizzle as a poly fill for older browsers.
",jnicklas,jcoglan
961,2013-02-21 13:06:35,"Actually Internet Explorer driver 6, 7 uses Sizzle for its purposes.

@jcoglan what do you propose instead of using browser's native CSS selector support?
",abotalov,jcoglan
959,2013-02-15 21:26:52,"@martijnwalraven: More like that:



@twalpole: I'd be kind of okay with that.

I personally hardly ever use `within` so I don't really feel the need. If someone wants to go ahead and implement this, then please go ahead, but I'm not going to ;)
",jnicklas,martijnwalraven
959,2013-02-15 21:26:52,"@martijnwalraven: More like that:



@twalpole: I'd be kind of okay with that.

I personally hardly ever use `within` so I don't really feel the need. If someone wants to go ahead and implement this, then please go ahead, but I'm not going to ;)
",jnicklas,twalpole
959,2013-02-16 09:11:10,"Sure, I understand. I was planning on working on this today though. Would you prefer #within to yield the element or exposing current_node/current_element as @twalpole suggests? The latter seems more general and might have other uses.
",martijnwalraven,twalpole
958,2013-02-11 18:42:16,"@jnicklas thanks so much for looking at this after I was admittedly being a jerk before.

I'm out of town till tonight but I'll see what I can do when I get back. I'm totally on the same page -- these were things I was concerned about too.
",sdhull,jnicklas
958,2013-02-13 16:22:47,"@danielres I was actually unaware of the existence of the `<base>` tag. That looks like a pretty excellent option!! I'm for it. @jnicklas what do you think?

Then I'd just have a single test that asserts that the base tag is added. Furthermore, finding index of the closing head tag and inserting just above it would probably be ok and I could leave this whole nokogiri mess behind. 
",sdhull,jnicklas
958,2013-02-13 16:42:49,"Base path usually causes more problems than it solves. So be sure to read up about its drawbacks before committing to this technique.

On Wed, Feb 13, 2013 at 5:22 PM, Steve notifications@github.com wrote:

> @danielres I was actually unaware of the existence of the `<base>` tag. That looks like a pretty excellent option!! I'm for it. @jnicklas what do you think?
> 
> ## Then I'd just have a single test that asserts that the base tag is added. Furthermore, finding index of the closing head tag and inserting just above it would probably be ok and I could leave this whole nokogiri mess behind. 
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/jnicklas/capybara/pull/958#issuecomment-13502548
",JeanMertz,jnicklas
958,2013-02-19 23:18:43,"Woot!  Thanks @jnicklas! For `body_to_write`, I just wanted to be sure I didn't modify the body itself (which users might be making assertions against). So I figured it'd be safer to make a copy of the body and modify that instead. At least that was the thinking there...
",sdhull,jnicklas
958,2013-02-21 22:03:54,"@jnicklas good call!

Any idea when you might push a new patch release to rubygems?  I'd like to start using this in the codebase at my office right away  :satisfied: 
",sdhull,jnicklas
958,2013-02-22 18:28:53,"Thanks @twalpole I might try that... or I might just try to exercise some patience and wait for a patch release  :)
",sdhull,twalpole
956,2013-02-11 17:20:08,"@jnicklas I'm afraid I don't understand the concern about associating a button with the first form on the page - If the button is associated with the form then the test should pass.  What is your concern there?
",twalpole,jnicklas
956,2013-02-11 17:56:34,"@jnicklas I've added the case of the submit being in one form but associated with a different form.  I'm not sure what the desired behavior for a submit that specifies the id of a form that doesn't exist should be.  My reading of http://www.w3.org/html/wg/drafts/html/master/forms.html#attr-fae-form says that if the form doesn't exist then the submit would not be associated with any form and I believe the click should just be ignored.  On the other hand its most likely an error to have a submit that isnt associated with a form so maybe we should throw an error?  Also note that the spec does allow for a form attribute on all the input types allowing one to associate a text input with a form its not located within, and that element should get submitted with the form it is associated with.  
",twalpole,jnicklas
956,2013-02-11 18:53:11,"@jnicklas Ok - well along with the addition of the test of a button in one form submitting a different form, the original tests were moved to use those 2 forms too, so they are no longer the first form in the document which I believe covers your concern?
",twalpole,jnicklas
956,2013-02-11 19:27:31,"@twalpole – It seems you're on top of things. Cheers, and thanks for covering my issue with a nice pull request. :thumbsup: 
",Spaceghost,twalpole
954,2013-06-07 17:25:38,"@abotalov I just ran into this problem myself.

I haven't  solved the issue (yet), but here's more details, maybe this is something you recognize?



Using `ruby-2.0.0-p195`, `rails-4.0.0.rc1`, `capybara-2.1.0`
",JeanMertz,abotalov
952,2013-08-27 18:10:21,"@brainhurricane @abotalov, did you guys find a workaround that works with capybara-webkit? I'm having the same issue
",beggerss,abotalov
951,2013-04-13 08:28:15,"@twalpole what were the problems that this causes? It doesn't seem to cause Capybara's own tests to fail when merged back into master.
",TimMoore,twalpole
951,2013-04-13 18:13:44,"@TimMoore The issue was that it interfered with events in linux and prevented typing into fields.   The bug report is https://bugzilla.mozilla.org/show_bug.cgi?id=774892  .  According to that report it may have been fixed in one of the later firefox versions, so might not be an issue anymore.
",twalpole,TimMoore
944,2013-02-07 08:46:27,"@jnicklas What about adding support for `:visible`, `:hidden`, `:any` as values for `:visible` instead of current `true` and `false`? I think it's a good idea.
",abotalov,jnicklas
944,2013-02-16 09:45:56,"I don't particularly like any of these solutions.

@abotalov is right that we need an API that allows us to find elements _regardless_ of whether they are visible or not. That's pretty important. Finding hidden elements _only_ seems like an edge case in comparison, which is why the API is the way it is. Yes it's confusing, but none of these alternatives are better, imo.
",jnicklas,abotalov
944,2013-02-17 07:17:47,"@jnicklas That is completely understandable. Whether true/false can be deprecated at some point is a totally different conversation.

I am inclined to think adding the options suggested here with copious documentation would be ideal.
",ToadJamb,jnicklas
942,2013-01-28 11:52:16,"@jnicklas No I hadn't, just I was looking for, thanks for the pointer!
",ches,jnicklas
938,2013-01-13 17:10:15,"I'm going to leave this up to @mhoran. I like the feature, but if it's too difficult for them to implement, then I don't want to force them to. What do you think?
",jnicklas,mhoran
938,2013-01-13 17:25:49,"@jnicklas I'm not sure that driver authors will become forced to support all params. Driver may look at types of params and throw error if it doesn't support them.
",abotalov,jnicklas
938,2013-01-14 07:49:12,"Okay, let's skip this then, sorry @abotalov.
",jnicklas,abotalov
936,2013-02-22 00:50:41,"Yeah, thanks @jnicklas. That was my hope.
Appreciate all your work.

Cheers.
",dnagir,jnicklas
936,2013-05-17 06:42:40,"@jnicklas wonder if 2.1 is still using the substring match, you said:

> Capybara 2.1 will allow you to essentially use the same settings as Capybara 1.x, with only very minor changes, so hold out a little longer and you should be able to upgrade more easily.

But the 2.1 is still using substring match (typical ""Password"", ""Password confirmation""). Is there an option to change how elements are matched or am I missing something?
",dnagir,jnicklas
928,2013-01-14 01:00:01,"@jnicklas, this change will require capybara-webkit to implement a way to find a frame given a `Capybara::Node::Base`. That shouldn't be too difficult, however this leaves me wondering how driver authors should treat master. Will API changes like this be rolled out as a patch release, or into something bigger like a minor version?
",mhoran,jnicklas
928,2013-02-13 07:15:11,"@mhoran I think Webdriver's `switch_to` does same:


",abotalov,mhoran
928,2013-02-13 07:30:36,"@mhoran I would be more than happy about a better API. The current within_frame API is crap.
",jnicklas,mhoran
928,2013-02-13 07:45:41,"@jnicklas [Here](https://groups.google.com/d/msg/ruby-capybara/lSBMiA_0hWU/LDkMalT6Pn0J) you proposed API for switching windows.
What about this?



Where options can be any of `id`, `name`, `position`, `element`, like `id: 'my_id'`

But it won't work for Webdriver as it searches for all those types and [doesn't provide option to specify type of locator](http://code.google.com/p/selenium/wiki/JsonWireProtocol#/session/:sessionId/frame).
Is current `within_frame` really crap?
",abotalov,jnicklas
928,2013-02-17 21:42:05,"I think that in the case of within_frame, switching on `Capybara::Element` solves some of the issues with the API. The problem arises when someone does what @abotalov  pointed out in his comment (https://github.com/jnicklas/capybara/pull/928#issuecomment-13477206). I've got this working in capybara-webkit, however the implementation will only work if a user finds an element and switches to it in the same context.

Using the Selenium driver, I get the following error if I try to switch to a frame outside the context in which the element was found:


",mhoran,abotalov
923,2013-02-19 21:00:25,"@twalpole Wonderful, thank you!
",Trevoke,twalpole
922,2013-01-02 19:04:55,"@joliss sounds sensible.
",jnicklas,joliss
920,2012-12-27 04:02:43,"@jnicklas that check prevents race conditions in `responsive?`. This PR does not describe a bug in that code.
",raggi,jnicklas
920,2012-12-31 10:54:48,"@raggi: sounds sensible. I removed the thin handler from the default server startup, so hopefully fewer people will run into this in the future. If they do, they will have handle this themselves. For those who don't explicitly need eventmachine, Puma is a better choice these days anyway.
",jnicklas,raggi
911,2013-01-22 01:21:03,"Hi @JonRowe   What (or where) are the xpath changes you mentioned?  
I didn't see an xpath repo under your name.
",tgaff,JonRowe
911,2013-02-25 22:44:17,"@jnicklas - I was working on enabling tests to run on chrome as well as firefox, which would allow the hover test to pass on chrome, while its ignored on firefox, would that be acceptable here too?  As far as the failing builds, do you have any clue why the base version tests fail on travis, running them locally appear to be fine for me.  Also is there any reason to continue testing the allowed failure matrix (ree, 1.8.7)
",twalpole,jnicklas
911,2013-02-25 23:15:57,"@twalpole no, we should get rid of all 1.8.7 builds. I think the suite is simply too slow, that's why it fails on Travis, but I haven't investigated it more than shrugging at the fact that travis is broken _again_ and realizing that I don't really care.
",jnicklas,twalpole
911,2013-03-06 12:03:21,"@jarib 

The hack to work around ElementNotVisible is a hack to work around a Selenium bug, you can type into an empty content-editable div just fine, Selenium just thinks it's not visible. In practise it is visible and usable.

The hack for focus is actually just to ensure consistency in tests, in my experience Chrome / Safari don't exhibit Firefox's behaviour when it comes to not responding to Javascript due to not having focus. My aim with this PR is actually to get the spec into Capybara, Selenium implementation is just a by product, if you have a suggested improvement please make it. (I want this feature in other [headless] drivers).
",JonRowe,jarib
911,2013-03-06 12:05:53,"I agree with @jarib that we should report bugs upstream instead of hacking around them. If this is a legit bug, then the webdriver project should be made aware of it.
",jnicklas,jarib
911,2013-03-06 12:16:59,"> The hack to work around ElementNotVisible is a hack to work around a Selenium bug, you can type into an empty content-editable div just fine, Selenium just thinks it's not visible. In practise it is visible and usable.

@JonRowe What browser are you testing this in?
",jarib,JonRowe
911,2013-03-06 16:10:05,"@jarib I take that statement back; It's actually a hack to work around Firefox not displaying them. Chrome and Safari display blank `contenteditable` elements as being one line high. I guess I made the mistake of not actually checking the test view in Firefox manually. This could be removed and the test data given styling to make it a line high instead.
",JonRowe,jarib
911,2013-03-10 21:42:10,"@jnicklas @jarib What can I do to get this merged? Do you want me to remove/refactor the stuff around blank elements? I'm convinced the focus stuff should stay, as it's a workaround for allowing in the background tests...
",JonRowe,jarib
911,2013-03-10 21:42:10,"@jnicklas @jarib What can I do to get this merged? Do you want me to remove/refactor the stuff around blank elements? I'm convinced the focus stuff should stay, as it's a workaround for allowing in the background tests...
",JonRowe,jnicklas
911,2013-03-16 01:13:15,"@JonRowe I want to wait with this a little. I am focusing on getting 2.1 out the door, and this will have to wait until after that.
",jnicklas,JonRowe
911,2013-03-16 09:09:19,"@jnicklas Why don't you want to include it to 2.1 if it's already done? I'm talking about my PR too
",abotalov,jnicklas
911,2013-03-16 10:04:10,"@abotalov I think I'll include your PR in 2.1, I want to review it thoroughly again before I merge it though, since it's a rather large change. I don't really feel comfortable with this one though. It's implemented in a quite hacky way, and I'm worried that it might be difficult for other driver authors. I don't see it as a super important feature, so I want to wait.
",jnicklas,abotalov
911,2013-03-16 17:08:17,"@JonRowe I see 3 main issues with this PR
1. The ElementNotVisible hack definitely shouldn't be there, since if the element isn't visible how would the user ever click the element to begin editing it?  A min-height in the div style so that it becomes visible and can then be clicked on fixes that.  
2. The focus hack really shouldn't be necessary since clicking on the element should bring it into focus and allow editing.  This may be something that needs a bug report over at selenium
3.  This doesn't at all take into account the nested nature of contenteditable, which I believe there is an issue with in selenium

I took your PR as a start and played around with it in my contenteditable branch at https://github.com/twalpole/capybara/tree/contenteditable .  One of the tests fails using both FF and Chrome, but for different reasons on each, and I think it may be an issue with selenium although I need to look into it further.  The other 4 contenteditable tests pass
",twalpole,JonRowe
911,2013-03-17 00:00:28,"@JonRowe  - Note these are purely my opinions and not those of @jnicklas and his decisions are the ones that count for this project 
2.  Yes firefox has issues with focus, and on some platforms setting focusmanager.testmode in the profile will fix this. Unfortunately setting that on linux causes some other issues, and therefore isn't defaulted on by selenium yet.  That being said I dont believe it is Capybaras job to work around the issue with a javascript hack, a click on the box should enough to select it and start editing, rather we should file bug reports upstream and hope/work to get them fixed.
3.  Read the spec on contenteditable. If we're going to add support to the test cases other drivers need to follow then we should meet the spec for the feature.  If a parent element is marked as contenteditable then its children become editable by default unless they specify contenteditable false.  What if a parent is content editable and I want to edit one of the children -- checking self[:contenteditable] doesnt work for that.    If you look at the branch in my repo you'll see that checking native.attribute('isContentEditable') does (docs for selenium seem to say it should be iscontenteditable but that doesnt work for FF or chrome).
",twalpole,JonRowe
911,2013-03-17 00:00:28,"@JonRowe  - Note these are purely my opinions and not those of @jnicklas and his decisions are the ones that count for this project 
2.  Yes firefox has issues with focus, and on some platforms setting focusmanager.testmode in the profile will fix this. Unfortunately setting that on linux causes some other issues, and therefore isn't defaulted on by selenium yet.  That being said I dont believe it is Capybaras job to work around the issue with a javascript hack, a click on the box should enough to select it and start editing, rather we should file bug reports upstream and hope/work to get them fixed.
3.  Read the spec on contenteditable. If we're going to add support to the test cases other drivers need to follow then we should meet the spec for the feature.  If a parent element is marked as contenteditable then its children become editable by default unless they specify contenteditable false.  What if a parent is content editable and I want to edit one of the children -- checking self[:contenteditable] doesnt work for that.    If you look at the branch in my repo you'll see that checking native.attribute('isContentEditable') does (docs for selenium seem to say it should be iscontenteditable but that doesnt work for FF or chrome).
",twalpole,jnicklas
911,2013-03-17 01:58:06,"@jarib because there's a need to click the element to initiate editing, and a need to clear the element to meet capybaras definition of set
",twalpole,jarib
911,2013-06-12 23:30:47,"This works as outlined so you're welcome to use my branch or take over this PR, I haven't had much luck convincing @jnicklas that this is necessary and I have no intention of going and hacking on selenium code to fix the issues this works around downstream. I mostly wanted the test to be included into capybara so I could go and implement this in poltergeist as I don't use selenium in my normal work.
",JonRowe,jnicklas
911,2013-08-30 07:02:11,"Thanks for this PR @JonRowe. It's a shame it hasn't been pulled.

I can't speak for every +1, but I don't need the gold plating, just a narrow slice of all possible environments to prove my UI interaction work well enough for me to check in code. I'll take that over months of crossed fingers and missed bugs any day. With your change, I know the UI at least works in my dev environment. Without the change I don't know it works anywhere.
",IamNaN,JonRowe
911,2013-10-20 17:44:52,"Okay so you probably weren't expecting this, but better late than never. I just pulled this, it seems that focusmanager is now the default in Selenium, so this passes even without the browser having focus now, yay!

@JonRowe: I took the liberty of squashing your commits into one, with an appropriate commit message, hope that's okay. Since this is so old, I didn't want you to have to do the extra work.
",jnicklas,JonRowe
910,2012-12-25 12:03:08,"Actually I was wrong, this issue still exists using last Capybara gem 2.0.1

I solved by installing version 1.1.1.

@abotalov I have already tried your code, but it is giving me the same error.

I am going to post more information in a bit, in the meanwhile Merry Christmas to you all!
",emilianodellacasa,abotalov
904,2013-02-21 19:14:17,"@joliss  Actually `has_content?` invokes text so it doesn't matter which one you use.
",abotalov,joliss
902,2012-12-06 08:57:44,"@jnicklas Yes, it's surely the regexp, take a look at the stack trace: https://gist.github.com/4193752

Now, I'm still a bit puzzled why the encoding header is needed there, since there are no actual unicode characters in the file - only /u codes. Might be just as well a bug in JRuby.

I'll check this later with JRuby 1.6 and might also raise this on the JRuby bug tracker.
",heypiotr,jnicklas
900,2012-12-05 19:00:02,"Thanks for your confirmation @avinmathew.

@joliss I've created a pull request #902. We're using this solution in our project for a week a now, and it does solve the problem for us.

If there's anything else I can do, I'll be happy to help.
",heypiotr,joliss
898,2012-12-03 17:06:38,"@jnicklas could you please guide me a bit what should I do after adding `title` method to `Capybara::Document`? :sweat: 
",nashby,jnicklas
898,2013-01-20 19:13:13,"@jnicklas, whats wrong with @nashby sollution? could you explaine please? This has_title? matcher is simply necessary. 
",molfar,nashby
898,2013-01-20 19:13:13,"@jnicklas, whats wrong with @nashby sollution? could you explaine please? This has_title? matcher is simply necessary. 
",molfar,jnicklas
887,2013-02-15 04:45:56,"The reason I haven't taken a stab at this is because I felt it does get more complicated given the requirements given by @jnicklas. I see where he's coming from, but have a preference for a different solution. This baby belongs to @jnicklas, so he gets to set the rules. :)

Using bundler as an example, I rather like how it handles the `bundle viz` command. It detects if the necessary gem is available and uses it if it is, or displays a message if it is not. The conditional code around whether selenium-web is available or not is easy to write, simple to understand, and pretty standard practice for ruby gems.

When someone upgrades to the new capybara-without-selenium-web, who is using selenium-web, they see a message to include one line in their Gemfile. Once done, they never think about it again. If they're not using selenium-web, then they would already have the driver they depend on in the Gemfile.

This approach would meet all requirements but 4.
",christiannelson,jnicklas
887,2013-02-21 18:12:10,"@morgoth I think you're describing @jnicklas's solution, not mine. My recommendation does not introduce a new gem.

Ultimately, either solution would be lovely and meet the goal of not dragging in gems you don't need.
",christiannelson,jnicklas
887,2013-02-22 17:17:53,"@christiannelson right, sorry for confusion.
@jnicklas Which solution would you accept?
- Separate gem (something like sass-rails)
- Wrapper for selenium still in capybara, but without requirement in gemspec also with displaying info to add selenium-webdriver when used

Both solutions require adding gem to Gemfile from user manually (capybara-selenium-webdriver or selenium-webdriver).
Solution with capybara-core and meta gem doesn't look friendly for user.
",morgoth,jnicklas
887,2013-03-18 08:06:22,"I think this commit is responsible for that: https://github.com/jnicklas/capybara/commit/c3e75f8988f640d3587bffbc48ead011ef2665d3
/cc @jnicklas 
",morgoth,jnicklas
887,2013-07-05 11:04:00,"I'm seeing the same error as @olivierlacan, even though I'm running 2.1.

The error only occurs on the first test in each file, when a spec file is run separately. When running the whole suite, there is no problem. Anyone have an idea what might be going on here?
",rogerkk,olivierlacan
887,2013-07-05 11:33:08,"@rogerkk maybe you're not running this particular spec through bundler, or something? The error that @olivierlacan was having has been fixed, so something else is probably going on. Make sure that selenium webdriver is actually installed and in the load path.
",jnicklas,olivierlacan
887,2013-07-05 12:04:40,"@jnicklas Thanks for pitching in! I suspect this discussion really belongs somewhere else, but:

I'm definitely running it using bundler, but I'm also trying to avoid using selenium. Thus had removed selenium-webdriver from my Gemfile, included capybara-webkit, and put ""Capybara.javascript_driver = :webkit"" in the before block of my spec_helper.rb.

I just seem to have resolved the problem by moving the ""Capybara.javascript_driver = :webkit"" out of the before block. I obviously don't know what I'm doing. ;)
",rogerkk,jnicklas
887,2013-07-05 12:26:05,"@jnicklas Aha, I see. Thanks for clearing that up!
",rogerkk,jnicklas
883,2012-11-28 18:56:40,"@jnicklas, thoughts?  I've confirmed that an `after` block will work even if an exception is raised.  `before` won't work if we focus on a test within the Capybara suite which sets Capybara.app_host followed by a test in our own suite.
",mhoran,jnicklas
883,2012-11-28 23:21:24,"@jnicklas, c65a61c works great, thanks.  Once this is released, we'll be ready to push capybara-webkit 2.0.
",mhoran,jnicklas
882,2012-11-22 08:17:49,"@jnicklas You're right... I botched my bisect.

v2.0.1 results in this issue consistently and older versions don't. I'm going through all of the changes between 2.0.0 and 2.0.1 now to see what commit really causes the issue to surface.
",christiannelson,jnicklas
882,2012-11-22 08:32:39,"@jnicklas Interesting. Using ref: '537fd691a8d6045dcf44aff22c880c609fcb6ece' in my Gemfile works but '2.0.1' does not. That suggests that the gem is either bunk (which you already checked), rubygems isn't producing correct dependency data for bundler (not sure if this totally makes sense) or there's a legit bug in bundler.

Thanks for looking into it and sorry for the goose chase.
",christiannelson,jnicklas
871,2012-11-19 14:25:13,"@mhoran I think I must be missing something. If the rack-test driver just returns whatever it got back from the server as `body`, doesn't that mean `toHtml` won't be called?
",jferris,mhoran
871,2012-11-19 15:14:41,"@mhoran if someone uses capy-webkit to test XML requests or whatever else people might use this stuff for, I think they have only themselves to blame. The behaviour as @jferris suggests makes sense to me, and it's a very minor change which I would feel comfortable pushing out in a point release as a ""bugfix"" of sorts. I can't imagine anyone has tests which actually depend on the difference between source and html under RackTest, which would be the only thing to change.
",jnicklas,mhoran
871,2012-11-19 15:56:33,"@mhoran what I'm suggesting is that all three browsers implement `body`. Drivers where the DOM actually can get modified return the current DOM (Selenium, Webkit) and rack-test always returns exactly what it got back from the server.

@jnicklas the thing I've used capybara for that requires non-HTML responses is testing stuff like CSV generators. For example, we had one application with a Backbone form to request CSV reports. The reports were generated in the background, the JavaScript polled the server until the report was ready, and the browser redirected to the finished CSV when it was ready. It was great to have a couple tests that ran through this whole stack together, all the way to the generated CSV.
",jferris,mhoran
871,2012-11-19 15:56:33,"@mhoran what I'm suggesting is that all three browsers implement `body`. Drivers where the DOM actually can get modified return the current DOM (Selenium, Webkit) and rack-test always returns exactly what it got back from the server.

@jnicklas the thing I've used capybara for that requires non-HTML responses is testing stuff like CSV generators. For example, we had one application with a Backbone form to request CSV reports. The reports were generated in the background, the JavaScript polled the server until the report was ready, and the browser redirected to the finished CSV when it was ready. It was great to have a couple tests that ran through this whole stack together, all the way to the generated CSV.
",jferris,jnicklas
871,2012-11-20 13:29:18,"@mhoran, @jferris (and maybe @jonleighton): can you guys take a look at this pull request #877 and see if that solves the problem.
",jnicklas,mhoran
871,2012-11-21 03:01:13,"I've come up with an implementation of `#source` for capybara-webkit that is far less of a hack than what I had previously conjured up.  I'm fine leaving it in place if we'd like to move forward with different `#source` and `#html` methods.  I'm definitely for the distinction.

@jonleighton, the change could likely be merged into PhantomJS as well.
",mhoran,jonleighton
870,2012-11-18 04:13:13,"Yeah, I'm on the fence like @jnicklas here. We can probably merge it, but I wish we had a better solution.
",joliss,jnicklas
870,2012-11-18 09:21:58,"Not knowing why you moved away from Element#clear, @twalpole's suggestion will be the fastest. 
",jarib,twalpole
870,2012-11-18 14:38:53,"I'm thinking that maybe `Element#clear` was the lesser of all evils, it seems like it only makes a difference in a tiny minority of cases, and is _way_ faster.

As an aside, why are keystrokes so damned slow under Selenium? Especially Chromedriver. @jarib, any insight?
",jnicklas,jarib
870,2012-11-18 14:48:18,"@jarib Could it be a Selenium bug that Element#clear triggers a [change event](https://developer.mozilla.org/en-US/docs/Mozilla_event_reference/change)? With a human user, clearing an element wouldn't cause it to lose focus.
",joliss,jarib
870,2012-11-18 19:49:43,"@jnicklas It appears to be a [known issue](https://code.google.com/p/chromedriver/issues/detail?id=90). I'm sure it'll help its progress if you can demonstrate with code that Chrome is significantly slower than e.g. Firefox.

@joliss I'm not sure what the rationale is for firing the change event, but it's [covered by our test suite](https://code.google.com/p/selenium/source/browse/trunk/javascript/atoms/test/action_test.html#118) so I assume it's intentional. You'll probably get a better explanation if you raise it on the [selenium-developers list](https://groups.google.com/forum/?fromgroups#!forum/selenium-developers).
",jarib,joliss
870,2012-11-18 19:49:43,"@jnicklas It appears to be a [known issue](https://code.google.com/p/chromedriver/issues/detail?id=90). I'm sure it'll help its progress if you can demonstrate with code that Chrome is significantly slower than e.g. Firefox.

@joliss I'm not sure what the rationale is for firing the change event, but it's [covered by our test suite](https://code.google.com/p/selenium/source/browse/trunk/javascript/atoms/test/action_test.html#118) so I assume it's intentional. You'll probably get a better explanation if you raise it on the [selenium-developers list](https://groups.google.com/forum/?fromgroups#!forum/selenium-developers).
",jarib,jnicklas
870,2012-11-22 18:19:09,"Thanks @DouweM and @jarib, I totally misread what `.value` does. That makes me feel much better.

I'm still a bit worried about the whole execute_script thing causing issues, as I wrote above:

> (As an aside, based on my experiences with execute_script, I'd also be scared of weird flickering issues and horrible horrible error handling when things go wrong. Wherever I've used execute_script in the past, I've tried to keep its use contained, and be ready to rip it out if things go bad.)

@jnicklas, what do you think?
",joliss,jarib
870,2012-11-22 18:19:09,"Thanks @DouweM and @jarib, I totally misread what `.value` does. That makes me feel much better.

I'm still a bit worried about the whole execute_script thing causing issues, as I wrote above:

> (As an aside, based on my experiences with execute_script, I'd also be scared of weird flickering issues and horrible horrible error handling when things go wrong. Wherever I've used execute_script in the past, I've tried to keep its use contained, and be ready to rip it out if things go bad.)

@jnicklas, what do you think?
",joliss,DouweM
870,2012-11-22 18:19:09,"Thanks @DouweM and @jarib, I totally misread what `.value` does. That makes me feel much better.

I'm still a bit worried about the whole execute_script thing causing issues, as I wrote above:

> (As an aside, based on my experiences with execute_script, I'd also be scared of weird flickering issues and horrible horrible error handling when things go wrong. Wherever I've used execute_script in the past, I've tried to keep its use contained, and be ready to rip it out if things go bad.)

@jnicklas, what do you think?
",joliss,jnicklas
870,2012-11-22 22:12:55,"@jarib interesting. I'll try to use Element#clear, maybe the issue we were having originally has been fixed.

@joliss we'll try with Element#clear and see if that works, otherwise, let's just keep an eye on it. If people have any trouble we'll have to change it again. As for the attribute changing, I don't think that's the case, we would have to do `setAttribute` for that, the change to the value property is not reflected in the value, from what I know.
",jnicklas,jarib
870,2012-11-22 22:12:55,"@jarib interesting. I'll try to use Element#clear, maybe the issue we were having originally has been fixed.

@joliss we'll try with Element#clear and see if that works, otherwise, let's just keep an eye on it. If people have any trouble we'll have to change it again. As for the attribute changing, I don't think that's the case, we would have to do `setAttribute` for that, the change to the value property is not reflected in the value, from what I know.
",jnicklas,joliss
870,2012-11-23 00:15:03,"@jnicklas: Ah, no - `Element#clear` still fires the change event after setting `element.value = ''`. My point was that the `execute_script` solution is essentially the same code without focus/change events firing.
",jarib,jnicklas
865,2013-07-10 16:58:34,"@jnicklas Awesome, thanks for providing this. I just ran into this same problem as well.
",denzilv,jnicklas
865,2013-08-29 19:08:17,"Derp. As soon as you said that, @jnicklas, I realize that makes perfect sense. Just a bit harder test to write.
",dcoder2099,jnicklas
858,2012-11-07 01:07:17,"@ekampp read @twalpole's comment again, he did answer the question.
",jnicklas,twalpole
858,2012-11-07 01:10:26,"@jnicklas if you have no intention of answering the question, and have already marked this as closed, then I think you should bugger of, and let me and him figure out a solution. 

And anyway, we have shifted the correspondance to mail. So nothing more for you to see here. 
",ekampp,jnicklas
856,2013-10-15 10:12:03,"I prefer @joliss solution, since if it's going to be a hacky solution it's better for it to be on the tests. Capybara should support this though.
",zamith,joliss
856,2014-05-16 18:34:00,"Had the same issue while trying to style a label and hide the input it was related to. So when the user clicked the label the input was selected. I had to change the styling as mentioned by @joliss to get my test to work.
",Baril27,joliss
856,2014-05-16 23:35:29,"@twalpole You are correct and thats exactly what I ended up doing.
",Baril27,twalpole
856,2015-08-27 01:25:51,"@twalpole yeap, put extra span looks like good idea
",kovpack,twalpole
849,2012-10-22 21:33:32,"@jnicklas it didn't, it failed with `:first_name` but passed with `""first_name""`
",envygeeks,jnicklas
849,2012-10-23 11:44:49,"@jnicklas when will you publish the version 2? Do you have any idea?
",fabianoalmeida,jnicklas
848,2012-10-17 22:52:21,"Hi @jnicklas, I am running both, because I need Selenium for some more tests which Capybara-Webkit is not capable of doing (such as drag & drop).  Interesting you had a similar issue.  I'll look into a way to run the tests independently to see what happens.  Thanks for the reply.
",mattheworiordan,jnicklas
848,2013-04-24 05:20:44,"@jnicklas haha, yeah you're right - i feel silly now :-) sorry for polluting the thread
",houen,jnicklas
848,2015-08-28 15:18:55,"@Nerian since you're using capybara-webkit as your driver you should probably look over in that project
",twalpole,Nerian
844,2012-12-15 22:38:52,"@jnicklas Well, it is visible :)
![](http://cl.ly/image/0g2E462s3Z3U/Screen%20Shot%202012-12-15%20at%202.34.51%20PM.png)

I do think it makes more semantic sense for `has_text` to include text from the title element. Since the whole idea behind `has_text` is to move away from the logical model of XML's notion of text and towards the notion of human readable text.

I think your suggested solution for #1 and #2 are a good idea, regardless.
",mkdynamic,jnicklas
844,2012-12-16 10:25:15,"@jnicklas As you say, the elemenI itself is not visible - not only its content. So think it'd be more intuitive if `page.find(element)` would return `nil` if the element is not visible. But when `page.find(element)` returns an element, it should properly return its attributes and content as they are - no matter if it's visible or not.
",gucki,jnicklas
844,2013-01-29 00:24:47,"Thanks @john-patrik. That's a great find and just what I needed. Something like this could be in Capybara by default as per @jnicklas's 2nd proposed solution above: https://github.com/jnicklas/capybara/issues/844#issuecomment-11411003
",LeahCim,jnicklas
844,2013-03-08 17:03:31,"@jnicklas I actually never liked using `have_selector` in this context; in the original Rails 2.3 version of the book I used Webrat's `have_tag`, but that disappeared when Webrat was deprecated. Using `have_selector` was the closest, if imperfect, substitute. I agree that `have_title` is much better, and I'll plan to update the tutorial accordingly. Thanks!
",mhartl,jnicklas
843,2013-03-11 13:06:01,"Hm, so I applied https://github.com/DimaSamodurov/capybara/commit/08f228181d44e81cf645243238572e06dff0908b to latest Capybara's master and it seems it works like a charm. I run our scenarios several times and any problem was caused. Thanks @jpurcell001 for your help! I probably don't need to change RSpec/Capybara to something else. I hope @jnicklas will take a look at the commit.
",deepj,jnicklas
843,2013-03-11 16:43:08,"@jnicklas In his comments on the forum he indicated he isn't ready for a pull request yet since he doesn't have tests, so no surprise.  And it could very well just be a placebo effect that make those changes appear to cut down on the intermittent failures.  But does the reasoning he lays out in the discussion forum (https://groups.google.com/forum/?fromgroups=#!topic/ruby-capybara/A64s_iUdSDE) make sense?  This would help those of us trying to track these issues down know whether his approach is a red herring, or whether there really are race conditions lurking there.  
",jpurcell001,jnicklas
843,2013-03-11 19:38:54,"@deepj it's worth noting that @DimaSamodurov's changes only affect code which is only called under failure conditions anyway. The only thing the commit could have affected is that you would have been shown a different error message. It wouldn't affect whether your test passes or fails, unless you did something very, _very_ crazy.
",jnicklas,deepj
843,2013-03-11 21:47:29,"@jnicklas Thanks for your infinite help with the previous problem how to select the damn select. After rabid goggling how to do it I figure it out. I would appreciate you would to be more helpful. I have used Capybara from 0.2.0 version for all my Rails. It is the best tool for this. Unfortunately with testing external application I have been a bit surprised how many problems were discovered in my case.

I hope this will be helpful from me to you how to catch the problem. Unfortunately the exception is not thrown always. But you should be able to reproduce after serveral re-runs.



We should be both helpful together. Again, thanks for the Capybara. It helped me a lot in the past...
",deepj,jnicklas
843,2013-03-11 23:21:08,"@deepj okay, let's try to solve this together.

I've created a pull request, #1005, which I think solves the race condition you're experiencing. I ran the code you provided and could replicate the problem easily. With #1005, I let it run around 40-50 times without seeing the problem. I'm still not 100% sure what exactly caused the problem, but hopefully #1005 should prevent any similar race conditions from screwing things up in the future.
",jnicklas,deepj
843,2013-03-11 23:35:01,"@jnicklas I dont think 1005 fixes this -- it might slow things down enough that the problem doesnt show, but I believe the real issue is that has_selector? doesnt set allow_reload on the result nodes like Finders#find does. Because of this the auto reloading doesnt actually occur.
",twalpole,jnicklas
843,2013-03-11 23:45:25,"@twalpole in this case, auto reloading isn't necessary though, since the assertion is run on the session itself. Reloading the session would mean reloading the entire page. I'm not sure where you mean that has_selector? should set allow_reload, since it doesn't actually return a node.
",jnicklas,twalpole
843,2013-03-11 23:55:23,"@jnicklas correct and that I believe is actually the issue.  If  the has_selector? '#grid tbody tr', count: 20  manages to grab elements before the .click changes the page then it spins in synchronize getting the StaleElement exception and calling reload.  Unfortunately it cant reload, so does nothing and just goes until timeout.   I put two puts in Capybara::Node#reload so its whats below and its easy to see whats happening.  
      def reload
        puts ""in reload""
        if @allow_reload
          puts ""reloading""
          reloaded = parent.reload.first(@query.name, @query.locator, @query.options)
          @base = reloaded.base if reloaded
        end
        self
      end

If the line is changed to sess.find('#grid').has_selector? 'tbody tr', count: 20  then the reload can happen and the issue goes away
",twalpole,jnicklas
843,2013-03-11 23:57:05,"@jnicklas In my case everything is green. The suite was re-run 20 times so I think it would be enough. Thank you
",deepj,jnicklas
843,2013-03-12 00:20:30,"@jnicklas - Ah - nevermind I see how your patch fixes it.  It was an inner synchronize link that wasnt reloading, now it just fails out to the outer synchronize.
",twalpole,jnicklas
843,2013-03-12 02:32:26,"@jnicklas Tried out the branch with poltergeist master and the vast majority of the failures appear to have gone away.  Now out of about 200 tests it looks like there are 2 that intermittently fail about 30% of the time (interestingly a different set than what was happening with Dima's patch).  Going to try to figure out if we can create a reproducible test case using the gist you provided.  In parallel, is an rspec -b backtrace helpful at all in potentially figuring out what's going on? 

Thanks for both the project and the ongoing assistance.

Jason
",jpurcell001,jnicklas
843,2013-03-13 00:28:03,"@jnicklas Think I was able to put a gist together using your template that reproduces the problem.  Filed as #1009 with the gist link as a separate issue.  
That template is awesome by the way.  Removes all excuses for not putting a test case together ..
",jpurcell001,jnicklas
840,2012-10-04 14:20:29,"That's great @danryan. Congratulations! Simple and useful.
",fabianoalmeida,danryan
832,2012-10-03 16:04:27,"@joliss is the policy that all parts of the capybara api must be supported by selenium?
",jonleighton,joliss
832,2012-10-04 17:39:34,"@joliss I guess I disagree. There are already differences between what drivers support, and this seems fine to me so long as it's clear to the user that their driver does/doesn't support something.

What seems more problematic is divergence between drivers. For example, capybara-webkit and poltergeist support several of the same things. Let's take resizing the window as an example. In capybara-webkit this is `page.driver.resize_window(x, y)` and in poltergeist it's `page.driver.resize(x, y)`. This means that if a user wants to switch from one to the other they have to change their code. Now I don't know if selenium does or doesn't support resizing the window, but supposing it doesn't I think there's still a lot of value in the capybara project deciding what the blessed API is, because then all the drivers that support that feature can implement it using the same API, increasing portability.

I have a rule that I won't allow Capybara to be monkey-patched in Poltergeist. This gives some indication to users about whether something is non-standard. So basically all non-standard stuff must be on `page.driver` rather than `page` (or a node).

So assuming Capybara doesn't standardise this feature, the only way to support it in poltergeist will be:



Which seems kind of a shame, really.
",jonleighton,joliss
832,2012-12-18 23:52:13,"@joliss wrote ""I think this will be tricky to get into the Capybara API, since it's not supported in Selenium.""

Why don't you like Selenium's [move_to](http://selenium.googlecode.com/svn/trunk/docs/api/rb/Selenium/WebDriver/ActionBuilder.html#move_to-instance_method)?
",abotalov,joliss
818,2012-09-17 05:07:58,"@jnicklas I agree, I submitted the PR hoping to elicit some help. If anyone who understands this can make it better, that would be great.
",lazylester,jnicklas
814,2012-09-19 11:43:52,"@joliss There's no problem if you see solution. Will wait it on SO =)
",itsNikolay,joliss
814,2013-01-05 18:54:31,"@jnicklas that would be really great. Personally would appreciate that consideration in the future, and I know probably all other devs using/upgrading Capybara would also appreciate it.
",sdhull,jnicklas
814,2014-10-21 13:17:09,"@jnicklas thx, good to know. 

I was commenting the proposed solution with `:type => :feature`. Btw,  instead of adding that setting or replacing `describe` with `feature` I added:



to `RSpec.configure` and that solved everything in my case.
",heaven,jnicklas
811,2013-02-16 18:09:03,"@abotalov has a point. Let's close this down for now.
",jnicklas,abotalov
809,2012-09-07 18:41:51,"@jnicklas The naming convention is a bit tricky. We have `spec/models`, `spec/views`, `spec/helpers`, so I would vote for `spec/features`. But I will leave the final decision for @dchelimsky.

I think adding support for these in rspec-rails will be trivial as well. So rspec-rails should catch up quickly. My $.02. :)
",josevalim,jnicklas
809,2012-09-07 18:53:19,"@josevalim @jnicklas if capybara attaches itself to feature (or features) what would rspec-rails even need to do?
",dchelimsky,josevalim
809,2012-09-07 18:53:19,"@josevalim @jnicklas if capybara attaches itself to feature (or features) what would rspec-rails even need to do?
",dchelimsky,jnicklas
809,2012-09-07 19:03:48,"@dchelimsky I think we need to attach the basic rspec-rails stuff there, like:

https://github.com/rspec/rspec-rails/blob/master/lib/rspec/rails/example/rails_example_group.rb

Or this is attached by default to all example groups? If so, I guess rspec-rails doesn't have to do anything.
",josevalim,dchelimsky
809,2012-09-07 19:07:25,"@josevalim not automatic for all groups, so that would need a fix in rspec-rails - need to coordinate that with a minor release of rspec-rails (eg 2.12.0)
",dchelimsky,josevalim
809,2012-09-07 19:19:52,"@sobrinho: yes, this is also in part to clear up jnicklas/turnip#66, I would personally prefer if Turnip used `:feature` as its type, and the recommendation is to use `spec/features`. After all, Gherkin files do start with the word `Feature`, and I would like to have Turnip behave as close to regular RSpec as possible.

@josevalim: It seems that the folders are plural, but the `:type` is singular, from what I can tell. At least for `:model`, `:controller`, `:request`, `:acceptance`, etc... Maybe @dchelimsky can clear this up.

@dchelimsky: I don't know the internals of rspec-rails at all, so I don't know if it does anything special at all. Maybe not. In that case, even better :)
",jnicklas,josevalim
809,2012-09-07 19:19:52,"@sobrinho: yes, this is also in part to clear up jnicklas/turnip#66, I would personally prefer if Turnip used `:feature` as its type, and the recommendation is to use `spec/features`. After all, Gherkin files do start with the word `Feature`, and I would like to have Turnip behave as close to regular RSpec as possible.

@josevalim: It seems that the folders are plural, but the `:type` is singular, from what I can tell. At least for `:model`, `:controller`, `:request`, `:acceptance`, etc... Maybe @dchelimsky can clear this up.

@dchelimsky: I don't know the internals of rspec-rails at all, so I don't know if it does anything special at all. Maybe not. In that case, even better :)
",jnicklas,sobrinho
809,2012-09-07 19:19:52,"@sobrinho: yes, this is also in part to clear up jnicklas/turnip#66, I would personally prefer if Turnip used `:feature` as its type, and the recommendation is to use `spec/features`. After all, Gherkin files do start with the word `Feature`, and I would like to have Turnip behave as close to regular RSpec as possible.

@josevalim: It seems that the folders are plural, but the `:type` is singular, from what I can tell. At least for `:model`, `:controller`, `:request`, `:acceptance`, etc... Maybe @dchelimsky can clear this up.

@dchelimsky: I don't know the internals of rspec-rails at all, so I don't know if it does anything special at all. Maybe not. In that case, even better :)
",jnicklas,dchelimsky
809,2012-09-07 19:53:27,"> It seems that the folders are plural, but the :type is singular, from what I can tell. At least for :model, :controller, :request, :acceptance, etc..

Ah, right. @dchelimsky so don't we need to change rspec-rails to also map the type `:feature` to the folder `spec/features`?
",josevalim,dchelimsky
809,2012-09-07 19:58:41,"@josevalim if we don't care about :type => xxx, capybara can do it by directory the way rspec-rails does it:


",dchelimsky,josevalim
809,2012-09-09 14:46:02,"@jnicklas just so we're on the same page: the change you just merged will break integration with rspec-2.11. Is that your understanding/intent?
",dchelimsky,jnicklas
809,2012-09-09 15:21:06,"@dchelimsky yes, I'm aware of that. I hope that doesn't screw up your release cycle too much. It'll be at least a month or two before Capybara 2.0 hits, maybe more, so you guys do have some time to prepare.
",jnicklas,dchelimsky
809,2012-09-09 16:26:49,"Assuming spec/features for capybara makes sense for me.

But what about the developers that want to change this structure, @dchelimsky?
",sobrinho,dchelimsky
809,2012-09-09 16:41:57,"@sobrinho as things stand today in rspec-rails, integration, model, view, controller, and routing behavior are all added based on directory structure. It also supports :type => 'xxx', but I don't think any end users write `describe X, :type => 'y' do` in their specs.
",dchelimsky,sobrinho
809,2012-09-09 16:42:50,"@sobrinho to align well w/ how rspec-rails works for the other types, Capy could add itself based on either :type => :feature or dir => spec/features.
",dchelimsky,sobrinho
809,2012-09-09 16:46:24,"I certainly wouldn't have a problem with adding the folder based behaviour too. How does rspec-rails handle this? I can see the metadata `:type => :model` for model specs, but I don't explicitly specify it, so rspec-rails is adding this somewhere? Can we do the same thing? In that case, I think that would be good, and maybe easier to explain.

It's worth mentioning that Capybara's global `feature` method ([described here](https://github.com/jnicklas/capybara#using-capybara-with-rspec)) adds the type explicitly, so it doesn't matter what directory it's in, it will always get the correct type. The issue is mainly with behaviour that people have attached to Capybara specs themselves, and limited to only `:request` specs, that's where compatibility will most likely be affected most.

As @josevalim mentioned however, we still need to attach the base Rails behaviour stuff (routing etc.) to `:type => :feature` specs, and that is something that _will_ require a new rspec release, from what I can tell.
",jnicklas,josevalim
809,2012-09-13 20:08:26,"I'd be happy to review the changes for rspec-rails if you make a pull, @jnicklas.
",alindeman,jnicklas
809,2012-09-26 00:22:57,"@jnicklas @alindeman I'll have time after Monday (conf preso) and happy to work w/ either one or both of you on this.
",dchelimsky,alindeman
809,2012-09-26 00:22:57,"@jnicklas @alindeman I'll have time after Monday (conf preso) and happy to work w/ either one or both of you on this.
",dchelimsky,jnicklas
809,2012-09-27 03:32:58,"@jnicklas don't sweat it. @alindeman and I will work on it after Monday. When are you trying to get your release out? I'd like the rspec-rails release that supports this to be out well in advance of the capy release.
",dchelimsky,alindeman
809,2012-09-27 03:32:58,"@jnicklas don't sweat it. @alindeman and I will work on it after Monday. When are you trying to get your release out? I'd like the rspec-rails release that supports this to be out well in advance of the capy release.
",dchelimsky,jnicklas
809,2012-09-27 12:24:38,"@dchelimsky we're pretty much ready to go with Capybara. I want to do another beta release, and then wait for a month before I do the final release, but aside from this issue there isn't anything stopping us. So the ideal for us would be if we do the beta release immediately after you guys do your release, and then wait a month, then final 2.0 release. Does that sound sensible?
",jnicklas,dchelimsky
809,2012-09-27 12:43:34,"@jnicklas sure, but it might be a couple of weeks before we're ready to go. This will be part of a minor release of the entire rspec suite so there are some things that need to be coordinated. Most likely we'll be able to get it out the door by Monday, Oct 8, but I can't promise that at this point. We'll keep you posted.
",dchelimsky,jnicklas
809,2012-10-06 13:45:55,"OK - I got started on this. I've added one commit that includes `Capybara::DSL` and `Capybara::RSpecMatchers` in example groups in the spec/features directory: https://github.com/rspec/rspec-rails/commit/9332167de751e3c1c2f240e656e4a7d6e9b44bfa

There is no automated testing for this but there was none before either. I've verified that it does the right thing by ensuring that the following runs correctly (in spec/features/thing_list_spec.rb):



This solves for the ""features"" directory, but not the ""api"" directory. I see that as separate from this specific issue even though it's part of the wider discussion spawned by @josevalim. Agree?
",dchelimsky,josevalim
809,2012-10-06 16:00:06,"@jnicklas I'm not sure I'll be able to get a minor release out this weekend, but I can do a patch release of rspec-rails. This would be rspec-rails-2.11.1. Are you OK explaining in your release notes that capy-2 requires rspec-rails >= 2.11.1 or would you rather wait until we do the 2.12 release (which is unlikely to happen before next weekend).
",dchelimsky,jnicklas
809,2012-10-07 02:12:03,"Hey @jnicklas looking this over a bit more, right now capybara takes the responsibility of adding itself if type == :feature, but rspec-rails is responsible to add capybara if directory == spec/features. This feels odd to me. I'm thinking that either rspec-rails or capybara should own both. rspec-rails would still include Capybara::RSpecMatchers in other types of specs (but not DSL) either way. Thoughts?

/cc @alindeman 
",dchelimsky,alindeman
809,2012-10-07 02:12:03,"Hey @jnicklas looking this over a bit more, right now capybara takes the responsibility of adding itself if type == :feature, but rspec-rails is responsible to add capybara if directory == spec/features. This feels odd to me. I'm thinking that either rspec-rails or capybara should own both. rspec-rails would still include Capybara::RSpecMatchers in other types of specs (but not DSL) either way. Thoughts?

/cc @alindeman 
",dchelimsky,jnicklas
809,2012-10-14 18:54:08,"@jnicklas I released rspec-rails-2.11.4 today with support for including Capybara::DSL and Capybara::RSpecMatchers in spec/features. I've tested this building a new app using capybara-head and rspec-rails-2.11.4 and files added spec/features work as expected (visit/page are available and get|post|put|delete|head are not), and spec/requests also work as expected (get|post|put|delete|head work but visit/page do not).

I was under the false impression that the capybara-2.0.0.beta release already removed support for spec/acceptance and spec/requests, so I documented that you can use rspec-rails-2.11.4 + capybara-2.0.0.beta2. This _does_ work in the sense that you can now use visit/page in spec/features, but it does _not_ solve the ""get and visit are both available"" problem. Any chance you can drop a capybara-2.0.0.beta3 release sometime soon?
",dchelimsky,jnicklas
809,2012-11-07 03:01:36,"/cc @dchelimsky 

After @alindeman's https://github.com/rspec/rspec-rails/commit/fd25838a39321708d6cdaaeb493274f119db1a19 I think we're getting closer.

One (hopefully last) issue is that previously we'd have a `:type` set on the examples, e.g. you could do



Looking at https://github.com/rspec/rspec-rails/blob/master/lib/rspec/rails/vendor/capybara.rb and grepping the rspec-rails source for `:feature`, it seems that we don't really have a corresponding `:feature` type now, but instead we just go off of the spec path. Should we perhaps change that?
",joliss,alindeman
809,2012-11-07 03:01:36,"/cc @dchelimsky 

After @alindeman's https://github.com/rspec/rspec-rails/commit/fd25838a39321708d6cdaaeb493274f119db1a19 I think we're getting closer.

One (hopefully last) issue is that previously we'd have a `:type` set on the examples, e.g. you could do



Looking at https://github.com/rspec/rspec-rails/blob/master/lib/rspec/rails/vendor/capybara.rb and grepping the rspec-rails source for `:feature`, it seems that we don't really have a corresponding `:feature` type now, but instead we just go off of the spec path. Should we perhaps change that?
",joliss,dchelimsky
809,2012-11-07 08:44:32,"@joliss did you see rspec/rspec-rails#632?
",jnicklas,joliss
806,2012-11-21 23:49:12,"Hi @jnicklas,

A philosophical point:

So I understand your arguments for why you want to hide `#synchronize`, and how the method is not simply a renaming of the capybara 1.x `#wait_until` method. It is also cool how generally in capybara you don't need to concern yourself with waiting for elements to appear due to automagic synchronizing. Kinda analogous to how OS X makes things all pretty and easy to use - lots of things happen automatically without having to concern yourself with trivial details. But... Apple still give me Terminal.app to use when I want to do something with my mac that Jonny Ive would rather I didn't. In the same spirit, if I were in your position, I'd leave `#synchronize` public.

A practical question:

With `#wait_until` gone and without access to `#synchronize`, I'm trying to work out how to allow for customized wait times. How would I convert the following capybara 1.x code to work in 2.x?



If I understand capybara 2.x's code right, shouldn't the following be what I want?



Ie: just get rid of `#wait_until` and let `#has_selector?` do the synchronizing in the background?

Regards,

Nat Ritmeyer
",natritmeyer,jnicklas
796,2012-08-31 00:16:31,"@joliss let me try checking out master and see if that fixes the problem.  It's recently become an issue because I just now upgraded to Rails 3.1.8 and `SafeBuffer` has started to encode single quotes.  This has caused a pretty large headache.

Such that doing this:



Perhaps `master` has fixed this issue or there's something more insidious going on.  I'll update back here when I have time to try it this weekend.

Thanks for the feedback!
",jfelchner,joliss
791,2012-09-23 20:37:27,"@gmile, yes indeed it was hidden. So instead of hiding it, now I'm just positioning it off screen, like so:



and it's working with or without :js => true

Incidentally, now the upload works in Chrome, too. It wasn't before. 
",jackdesert,gmile
789,2012-08-14 15:22:44,"@joliss I tried it with `dtruss` but the test does not seem to want to start.

Thanks @joliss and @jarib - I've run it with `$DEBUG` and saw a bunch of stuff. It's pretty late here, so I need to get some shut eye. I'll get back you both with what I find.

# 

**I realized** at the last minute that, because other finds worked in the spec without delay, maybe it's the way `pry` prints out stuff (it uses awesome_print). I tried doing `find('html').to_s` and I got a result immediately.  I guess that rules out selenium-webdriver? I guess `awesome_print` does some recursive hoopla to print it out with all the info you need, thus the thousand-line output.

I have yet to fully test this hypothesis though. I'll be a zombie tomorrow if I don't get sleep. Thanks again.
",ramontayag,jarib
789,2012-08-14 15:22:44,"@joliss I tried it with `dtruss` but the test does not seem to want to start.

Thanks @joliss and @jarib - I've run it with `$DEBUG` and saw a bunch of stuff. It's pretty late here, so I need to get some shut eye. I'll get back you both with what I find.

# 

**I realized** at the last minute that, because other finds worked in the spec without delay, maybe it's the way `pry` prints out stuff (it uses awesome_print). I tried doing `find('html').to_s` and I got a result immediately.  I guess that rules out selenium-webdriver? I guess `awesome_print` does some recursive hoopla to print it out with all the info you need, thus the thousand-line output.

I have yet to fully test this hypothesis though. I'll be a zombie tomorrow if I don't get sleep. Thanks again.
",ramontayag,joliss
783,2012-08-22 14:34:09,"Regarding whether we should have this feature: It seems to be a rather rare use case, for expressions like `all(:checkbox)`. For `find`, something like `find(:checkbox)` seems too brittle to be useful.

Because of that, I'm not convinced that it's worth the added complexity in the selector definitions (and other code).

The only real usability issue I see is `node.all(:checkbox).length` being 0 (confusingly), because it searches by ID. If we deprecated the symbols-as-ID feature, this problem would go away. But even that seems rare enough that I wouldn't worry about it.

So my vote is, leave it as it is. It's @jnicklas's call though, as always.
",joliss,jnicklas
783,2012-08-22 16:09:20,"My rough implementation is backwards-compatible with `find(:my_id)`, because [it simply falls back to the old behavior](https://github.com/adammck/capybara/blob/e34ec60707f6832cfafd4b57bf8776fcd46a5069/lib/capybara/query.rb#L17) if the first parameter isn't a valid selector type. I recognize that this is more complex than absolutely necessary, but backwards compatibility seems more important than purity here.

I think that we should remove `find(:my_id)` anyway, since it's so easy to update to `find(:id, ""my_id"")` or `find_by_id(""my_id"")`, but this would be a backwards-incompatible change, so it would be a major version bump. I'd deprecate the old behavior in 2.0 and remove it in 3.0, but it's obviously @jnicklas' call.
",adammck,jnicklas
783,2012-08-22 17:23:56,"Regarding @joliss' second point, I agree that `find(:checkbox)` is not very useful. But since `find(:x, locator)` is used so frequently, it seems reasonable to expect that `find(:x)` and `all(:x)` would work in the same way. I don't think that it should be required that all selectors expect a locator, especially not user-defined selectors.
",adammck,joliss
783,2012-09-09 17:38:33,"@joliss and @adammck check out the commit I just pushed. I don't think we'll have time to get this into Capybara 2.0, so I preemptively broke the API. I think it's better to be unambiguous. Now `find(:foo)` will always be a custom selector with the name `:foo`, you don't have to know whether or not that is defined, which seems better to me. That leaves us the option of creating a nice consistent API for this in the future.
",jnicklas,joliss
783,2012-09-09 17:38:33,"@joliss and @adammck check out the commit I just pushed. I don't think we'll have time to get this into Capybara 2.0, so I preemptively broke the API. I think it's better to be unambiguous. Now `find(:foo)` will always be a custom selector with the name `:foo`, you don't have to know whether or not that is defined, which seems better to me. That leaves us the option of creating a nice consistent API for this in the future.
",jnicklas,adammck
783,2012-09-09 21:25:24,"@adammck do send a pull request once you're ready!
",jnicklas,adammck
783,2014-02-20 08:11:13,"@abotalov did you post this to the right issue? I agree, but I'm not sure what this has to do with this issue?
",jnicklas,abotalov
783,2014-02-20 08:33:36,"@jnicklas I think I posted to the right issue. I think adding this API will encourage people to write something like:



which would be bad. I don't see a way how we can write it so it won't make N+1 driver method invocation.
",abotalov,jnicklas
767,2012-07-29 04:13:46,"@jnicklas Thanks. why I thought something wrong with normalize-space is that when I use XPATH checker (https://addons.mozilla.org/en-US/firefox/addon/xpath-checker/),

 Using this xpath:
 `.//a[./@href][(((./@id = 'MP3' or normalize-space(string(.)) = 'MP3') or ./@title = 'MP3') or .//img[./@alt = 'MP3'])]`, the XPATH checker can find the element.

But when I use:
`.//a[./@href][(((./@id = '知 道' or normalize-space(string(.)) = '知 道') or ./@title = '知 道') or .//img[./@alt = '知 道'])]`,
the XPATH checker cannot find the element.

I tried all the text link in Chinese. None can be found.

@joliss 
Thanks.
the encoding is:
`<meta http-equiv=""Content-Type"" content=""text/html;charset=gb2312"">`

I use 1.9.3 and I tried Chinese text link without space inside.
",lihuazhang,jnicklas
767,2012-07-29 04:13:46,"@jnicklas Thanks. why I thought something wrong with normalize-space is that when I use XPATH checker (https://addons.mozilla.org/en-US/firefox/addon/xpath-checker/),

 Using this xpath:
 `.//a[./@href][(((./@id = 'MP3' or normalize-space(string(.)) = 'MP3') or ./@title = 'MP3') or .//img[./@alt = 'MP3'])]`, the XPATH checker can find the element.

But when I use:
`.//a[./@href][(((./@id = '知 道' or normalize-space(string(.)) = '知 道') or ./@title = '知 道') or .//img[./@alt = '知 道'])]`,
the XPATH checker cannot find the element.

I tried all the text link in Chinese. None can be found.

@joliss 
Thanks.
the encoding is:
`<meta http-equiv=""Content-Type"" content=""text/html;charset=gb2312"">`

I use 1.9.3 and I tried Chinese text link without space inside.
",lihuazhang,joliss
767,2012-07-31 16:12:09,"Ah, that's a bug indeed! This happens because `知 道` on baidu.com has an `&nbsp;` as space. As a workaround, try `""知\u00a0道""`.

@jnicklas I have a fix in the queue, but I need to extract #normalize_whitespace into a global method. (It doesn't use `this`.) Is there a nice place for it, like Capybara::Helpers.normalize_whitespace?
",joliss,jnicklas
766,2012-07-25 18:40:01,"@jnicklas yeah, it works.
",nashby,jnicklas
761,2014-10-09 23:54:52,"@jnicklas , could you correct your comment from 



to 



? 
Somebody can have a lot of time for to find mistake in him code. Best Regards!
",byzg,jnicklas
749,2012-07-12 11:37:42,"@jnicklas Fair points, thanks for the feedback. 

Setting a textfield value via Capybara behaves differently from a human being doing so via the browser. That seems broken to me. 

Of course new code should be able to handle multiple change events firing, though that point seems irrelevant. What if I'm putting tests into place before I refactor a legacy application? What if I'm using Capybara against a staging environment that requires third-party authentication, and the third-party site is awful?

I'll remove the jQuery dependency, give the fix implementation another shot, and open a new pull request. Let me know if you have any specific ideas for the right way to do this. 
",akasper,jnicklas
746,2012-07-09 07:17:42,"@joliss right. any thoughts how to fix it except checking for regexp and using `match` or `include` based on that check?
",nashby,joliss
746,2012-07-09 13:27:53,"@jnicklas right, thanks. I'll fix it tonight!
",nashby,jnicklas
746,2012-07-09 15:28:09,"@jnicklas I've update the code. Not sure if about separate `escape_regexp` method though.
",nashby,jnicklas
735,2012-06-25 17:51:58,"@joliss I adapted the template.rb into an equivalent test:



This works fine in IE9.  It's possible that capybara is calling different selenium-webdriver apis than I am, however.  At any rate, I can't reproduce the issue using pure selenium-- there's some kind of problem between capybara and selenium.
",paleozogt,joliss
735,2012-06-25 19:13:33,"@joliss In debugging this some more I noticed that capybara opens 127.0.0.1 rather than localhost.  While this seems innocuous, I changed my pure-selenium script to use 127.0.0.1:



and it fails!



So it's definitely not a capybara issue-- its some kind of problem with selenium + IE9.  Is it possible to workaround this issue by telling capybara to use ""localhost"" instead of 127.0.0.1?  I could use `Capybara.app_host`, but then how would I know which port capybara is running the rack host?
",paleozogt,joliss
733,2012-06-26 22:27:19,"Mentioning @jarib like @joliss says above as I am seeing the same issue. I see the issue in full rake run. When I setup a breakpoint before the checking the url then the tests pass so that does imply a timing issue. Interesting thing is that after I have once run with a breakpoint the next run succeeds for just that cucumber scenario but I guess such is the life with races.
",betelgeuse,joliss
724,2013-04-23 02:39:00,"@twalpole Thank you so much for your help. Yes, as you may have expected, it was a problem with my code. I am using Bootstrap and SimpleForm and I believe my issue was I was starting a row before the start of the fieldset and then closing the row within the fieldset. The code may explain this better:



When I moved the row tag under the fieldset tag then my test go green without needing to use Selenium:


",MrHubble,twalpole
724,2014-09-01 16:18:32,"@jnicklas I appreciate your good work for creating Capybara. 
I've only been into development using ruby on rails for about 7 months, I have noticed that `click_on` produces the error that was shown in this issue, for buttons that are not in a form. However, sometimes some buttons are not in a form. e.g I have a button that simply unhides a certain `div` when it is clicked on. 

what is work around for this? by asking this I have used the different query methods and I have not been sucessful. and simply putting a button into a form so that test runs might not be very ideal.
",leonardk1,jnicklas
719,2012-07-10 14:40:21,"@jnicklas Thanks!!
",jjulian,jnicklas
714,2012-05-21 21:37:04,"@jnicklas, it will never work. DATA doesn't exist.
",jsmiley,jnicklas
708,2012-05-25 23:35:30,"@lanej: Why would it need to be configurable? Surely there can't be a legitimate use case for more than 20 redirects in a row, especially since no browser even supports that.
",jnicklas,lanej
708,2012-05-26 00:15:21,"This allows the casual user to abide by the default limit if 5, but special case tests like mine can raise the limit to exactly what is needed to assert success. +1

On May 25, 2012, at 7:35 PM, Jonas Nicklasreply@reply.github.com wrote:

> @lanej: Why would it need to be configurable? Surely there can't possibly be a legitimate use case for more than 20 redirects in a row, especially since no browser even supports that.
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/jnicklas/capybara/pull/708#issuecomment-5942634
",jjulian,lanej
708,2012-05-26 03:10:25,"Working with zendesk, I have a legimate case where 6 302 requests are issued in sequence and I haven't found a browser yet that doesn't support it.

The specs were not meant say that 21 sequential redirects was a legitimate case @jnicklas, just > 5.
",lanej,jnicklas
699,2013-01-22 22:09:57,"For those that end up here via google like I did, I want to note that we ran into issues with this as well. It seems also that @jnicklas [considers this dangerous](https://groups.google.com/forum/#!msg/ruby-capybara/sgBkBKVXf_w/N3t0cS2ODl8J) now too. It worked for us for a long time. It started being less stable as we started using the parallel_tests gem.
",aaronjensen,jnicklas
698,2012-04-26 19:20:32,"That it does! Now we only need to get it pulled in... @jnicklas, you still following this?
",DouweM,jnicklas
698,2012-06-11 00:56:10,"@jnicklas, can you take a look at this? I think it should be merged. 
",andmej,jnicklas
698,2012-07-03 06:14:22,"@jnicklas @DouweM  In fact, I think the `insert_port_into_portless_url` option could be true by default. Would there be any problems if we did that? I think adding the port doesn't hurt, even if it's not needed.
",andmej,DouweM
698,2012-07-03 06:14:22,"@jnicklas @DouweM  In fact, I think the `insert_port_into_portless_url` option could be true by default. Would there be any problems if we did that? I think adding the port doesn't hurt, even if it's not needed.
",andmej,jnicklas
698,2012-07-03 08:41:11,"@jnicklas Why not? When we call `visit`, we always mean to navigate to a page served through Capybara (right?), so if for whatever reason we don't specify the correct port (when providing a URL with a subdomain, for example), wouldn't automatically inserting the port be the right thing to do? This way people can forget that Capybara serves the app on a randomly generated port, which really isn't that interesting to them as it's really just an implementation detail to Capybara. For people who don't want this behavior, the option can easily be turned off.
",DouweM,jnicklas
698,2012-07-03 09:44:02,"@jnicklas Ah, all right. I wasn't aware Capybara was used like that, but I guess it makes sense. In that case, I definitely agree this option should not be on by default. I would still really like it to be an option, though. 
",DouweM,jnicklas
698,2012-07-03 17:57:28,"I see. In that case I also agree that the option shouldn't be on by default.

Can we still merge this? I'm currently using my own fork and I'd like to see this change upstream.

@jnicklas what can we do to help with the merge? Perhaps you want more tests? Just ask :)
",andmej,jnicklas
698,2012-07-04 14:55:43,"@jnicklas I think we're ready now!
",DouweM,jnicklas
698,2012-07-11 05:18:31,"Thanks @jnicklas!
",andmej,jnicklas
685,2013-05-11 16:58:28,"@twalpole Apologies, I thought it was related to the pull request.
",thelucid,twalpole
668,2012-03-26 15:14:33,"@raggi: I see what you mean. I use a testing library that halts on the first assertion failure, so letting the server die wasn't a problem for me. I'll think a bit more about this. Thanks for your feedback.
",djanowski,raggi
668,2012-04-02 16:27:32,"@raggi: Just changed this a little bit, so now:
- It doesn't use `abort_on_exception`.
- It doesn't let the server die.
- It raises the exception on the correct thread, so can be used outside of `Thread.main`.

What do you think now?

@jnicklas: This is an alternative solution that doesn't require to actively check for errors.
",djanowski,raggi
668,2012-04-02 17:47:30,"This looks like a _much_ cleaner solution to me. @raggi et al. what do you think? I really like the fact that the exception is just handed to the main thread. It seems like a very elegant solution. Also, I'd never seen the Queue class in Ruby core, quite neat!
",jnicklas,raggi
668,2012-04-04 01:12:10,"@djanowski this still causes capybara-webkit to choke. After a spec raises an exception, it is caught and the test output shows it (nice!). However, every Capybara spec after the first one fails with `Capybara::Driver::Webkit::WebkitInvalidResponseError`, just after the console spits out `QCoreApplication::postEvent: Unexpected null receiver`.

I suspect this is an issue with capybara-webkit rather than your patch. For now I'm going to go ahead and use your patch and ignore specs failing with `WebkitInvalidResponseError` after the first failure. It's just so valuable to be able to see exceptions on the server in the spec output rather than parsing through the server log. Thanks a ton for the patch!
",cvincent,djanowski
668,2012-04-04 01:20:48,"@djanowski that would be sweet! Here's my Capybara config if it helps:



In case it makes a difference, but I'm also using Spork and Guard.
",cvincent,djanowski
668,2012-04-06 01:13:51,"@raggi: I see what you're saying. That does indeed sound pretty dangerous. But maybe we don't even really need to raise the error, just printing it to stdout would probably be enough. We could format it nicely and make it very obvious that this error was caught inside the server. That only leaves the issue of contention for IO and we could solve that with a mutex, no?
",jnicklas,raggi
660,2012-04-03 14:58:07,"@jonleighton: See #668 for a parallel discussion.
",djanowski,jonleighton
660,2012-04-05 02:34:50,"@jnicklas having done this kind of work before, doing synchronization in a deterministic way is the only path to sanity. Further discussions over the alternative solutions are discussed on the other PR.

I do understand why you feel this is fragile, I'm afraid that adding the check in the consuming thread is a necessary requirement. Welcome to multithreaded programming.

EDIT: sorry, that sounds arrogant/condescending, I don't mean to be, it's just - this is how it's solved everywhere (when solved correctly (read: deterministically)).
",raggi,jnicklas
660,2012-04-09 13:51:13,"@raggi: I agree that stdout/err is not reliable and doesn't play well with other tools.

Question: with this approach, would errors triggered by interactions (like `click_link`) be raised correctly? Should we check for errors _after_ delegating to the session?

All in all, I think we should try this approach first.
",djanowski,raggi
660,2012-04-13 02:57:59,"@djanowski the server error would be raised first, which would prevent any interaction from actually occurring. This is essentially the same as if the error was raised by the server running synchronously as a callee of visit.

If you mean to ask about backtraces, those should be correct, so the output should not be confusing.
",raggi,djanowski
660,2012-07-13 13:08:28,"I spent some time with this pull request, and there were a couple of things about it I didn't really like, so I went in a slightly different direction with it. Let me explain what I did:

1) Moved the responsibility of starting the server to the session. As @raggi mentioned, this makes the implementation of this much easier, and it's a sensible thing to do anyway.

2) Capture error raised inside the application.

3) Re-raise those errors when `Session#reset!` is called.

The last point is obviously the controversial one, so let me explain why I did that. We obviously need some way of raising errors on the main thread, since, as @raggi explained, we would run into too many thread safety issues if we let the application thread raise those errors. So that leaves us two options:

1) require the user to manually check for and raise exceptions
2) raise exceptions automatically when some kind of user action occurs

This exception tried to go with option (2), but that has a huge problem, in my opinion: there are a huge amount of possible user actions in Capybara, and every single one of them would have to check for errors and raise them. Just jamming this in `visit` and only `visit` as this pull request did is confusing and insufficient. I considered going this route, but after realizing the sheer amount of methods I would have to add these checks to, I realized that it just isn't feasible without some crazy meta programming.

I chose to go with option (1) instead. At first I had a separate method, which I called `raise_error!`, but after spending some time with this, I realized that you always call `reset_session!` and `raise_error!` at the same time. There is no reason to call one without calling the other. Rolling this into `reset_session!` also gives us the added benefit that users of Capybara don't need to change anything about there code to benefit from this behaviour, no matter how they integrate Capybara into their workflow.
",jnicklas,raggi
660,2013-10-13 19:40:41,"@raggi @Systho it wasn't so much about the idea than about the implementation. I wanted something which would have made the behaviour at least somewhat predictable, but I was unable to find a sane way to do it. I think you guys may be right though that having catching errors early is better. I've run into these situations as well. So I think I'm open to adding a check to all DSL methods (which is better, before or after?). This doesn't cover everything that can be done with Capybara, but it would make raise errors earlier in _many_ cases, which is probably better than _never_, since I don't think we're going to get to _always_.
",jnicklas,raggi
660,2013-10-28 23:46:52,"> @raggi @Systho it wasn't so much about the idea than about the implementation.

Sure. You may find it a good reference is all. It has the behavior you describe, but only hooks a single method - iirc. It was years ago now.

> I wanted something which would have made the behaviour at least somewhat predictable, but I was unable to find a sane way to do it.

I'm pretty sure it is predictable, if all session access causes a check. It's much like the semantics of a private errno in that regard.

> I think you guys may be right though that having catching errors early is better. I've run into these situations as well. So I think I'm open to adding a check to all DSL methods (which is better, before or after?).

Always before. The problem with after is that you can find the action causes more errors which will raise and take precedence, hiding the original error - in other words this falls back to todays harder to debug behavior. It's possible that before and after can lead to catching some more odd items, where the action causes an asynchronous error - but those are really really hard to make deterministic. As long as one can describe the behavior of when the check is done in a single sentence, and it is frequent, that's best.

> This doesn't cover everything that can be done with Capybara, but it would make raise errors earlier in many cases, which is probably better than never, since I don't think we're going to get to always.

Nod.
",raggi,raggi
660,2015-08-03 07:32:10,"I know this issue has been officially closed but at the same time it does not yet work as expected. @jnicklas  do you have any idea on how you want to tackle this problem ? I think more and more app are using asynchronous drivers so I guess this problem will only amplify.
",Systho,jnicklas
654,2012-03-25 10:31:25,"@grzuy I really hope there will be some way to get the selection, rather than having [a single function to validate it](https://github.com/jnicklas/capybara/issues/665). It allows testing a lot more different scenarios:
- The selection _is exactly_ a given set.
- The selection contains _at least_ a given set.
- The selection contains _one_ (or N, or minimum/maximum N) of a given set.
- The selection contains _none_ of a given set.
- The selection is empty.
",l0b0,grzuy
650,2012-03-01 12:14:38,"Jonas just merged #652. Closing this. Thanks @grzuy!
",joliss,grzuy
647,2012-02-19 21:31:33,"@joliss - please reopen this issue (I don't have permission, even if it's my own pull request)

The reason: patch still applies, since now people will be bothered with deprecation warnings.

Unless Capybara is going to allow only cucumber < 1.1.5 from now on, which I don't think makes sense, because of other Cucumber fixes present.

Thanks!
",e2,joliss
647,2012-02-20 00:26:12,"Thanks, @joliss - since you were able to reopen it, I believe the restrictions make sense.

I agree about the warnings, but I don't think it should be fixed on the Cucumber side because ...

... the api changes reflect changes in Gherkin (using a Tag object instead of strings):

  https://github.com/cucumber/gherkin/blob/45335f757af46b956c8259e02875068b6a596911/spec/gherkin/tag_expression_spec.rb

The diffs are here (scroll down for Ruby api part):

  https://github.com/cucumber/gherkin/commit/45335f757af46b956c8259e02875068b6a596911

So, Capybara should either handle two api's or use the new api along with dep version bumps in cucumber-rails.

I think handling two different methods with the above hack isn't that bad, because it doesn't require reverting about 30 lines in different files in Cucumber to undo good refactoring and replacing strings with tag objects.
",e2,joliss
647,2012-02-20 01:43:55,"@aslakhellesoy - yes, the deprecation warnings are the only reason this was reopened :)
",e2,aslakhellesoy
644,2012-02-18 20:21:17,"I agree with @joliss, it seems very hack-ish for us to add some kind of workaround for this, any chance cucumber can bring back the `source_tag_names` method, @aslakhellesoy?
",jnicklas,joliss
644,2012-02-18 20:21:17,"I agree with @joliss, it seems very hack-ish for us to add some kind of workaround for this, any chance cucumber can bring back the `source_tag_names` method, @aslakhellesoy?
",jnicklas,aslakhellesoy
644,2012-02-19 01:10:11,"expected: :selenium
     got: :rack_test

It probably means instead of a string (tag -> ""@selenium"") it got a Tag instance (<....::Tag, @name=""@selenium"">) dump as a string, so it defaulted to :rack_test.

In short, the test is using scenarios.source_tags instead of scenarios.source_tags.map(&:name).

It's strange you are getting this, @joliss. I would have expected you to get the same error as here: https://github.com/cucumber/cucumber/pull/229

P.S. With all the chaos around this, I believe @aslak will never again change anything in Cucumber without deprecation ;) Cucumber is just so cool, that people are using every dark corner of Cucumber for whatever they need. And the noise also points out how crucial Capybara is for everyday life.
",e2,joliss
644,2012-02-19 08:48:16,"On 18 Feb 2012, at 23:52, Jo Liss wrote:

> Thanks Matt! I tested it in Capybara like so
> 
>    diff --git a/Gemfile b/Gemfile
>    index 07a1f43..32116d9 100644
>    --- a/Gemfile
>    +++ b/Gemfile
>    @@ -5,3 +5,6 @@ gemspec
> 
> 
> 
>    +
>    +@dependencies.delete_if { |d| d.name == ""cucumber"" }
>    +gem 'cucumber', :path => '~/src/cucumber'
> 
> and ""rake cucumber"" now doesn't choke on source_tags, but instead reports that the driver switching isn't working anymore:
> 
>    expected: :selenium
>         got: :rack_test (using ==)
>    ...
>    features/capybara.feature:23:in `Then Capybara should use the ""selenium"" driver'
> 
> Hm, too bad. I'm not sure off the top of my head _what's_ going wrong. Perhaps it's the updated Gherkin, even.

Thanks @joliss. Could you re-try this with the current HEAD of Cucumber? I just ran Capybara's features against that and they all passed. 

There also weren't any deprecation warnings! Perhaps the pixies fixed them?

> I tested b7d7e97 (v1.1.15^) though, and it works fine. May I suggest you revert to b7d7e97 and push v1.1.6 with that?
> 
> Then we can re-try adding 4bc5ed6 (""Upgraded to gherkin 2.3.8"") with more time to figure out what's going wrong.

You're quite right, that's what we should have done in the first place. If we haven't got this straightened out before Monday morning that's what we'll do.

> Btw, re 844fefea (""Add back Scenario#source_tag_names for #227""), I wonder if source_tag_names really has to be deprecated. Semver says that you shouldn't deprecate API without bumping the minor, but even when you go to 1.2.0, is there any need to deprecate it? Capybara for instance wouldn't be able avoid those deprecations without bumping its Cucumber dependency, so they'll just clutter the terminal and annoy users.

Hmm yes. My immediate thought is - ""but then how do we remove this kind of clutter from Cucumber?"" but of course otherwise we're expecting you guys to have to put backwards-compatiblity hacks like #647 in. I don't mind taking the deprecation warnings out - we can just flag that method up as something we remove in the next major release, I suppose.
",mattwynne,joliss
644,2012-02-19 15:56:46,"Tech first:

Matt wrote:

> Thanks @joliss. Could you re-try this with the current HEAD of Cucumber?

Yup, it works great with 1.1.7, and with HEAD 5731b64, it passes but throws deprecation warnings.

I'm not sure that source_tag_names is bad enough to be deprecation-worthy with a minor bump (I'd perhaps wait till version 2.0), but I shall not bike-shed -- it's you guys's call.

@e2 wrote:

> In short, the test is using scenarios.source_tags

(In case this still matters: I'm pretty sure I ran the test on a pristine Capybara HEAD, which uses source_tag_names, though I don't know what actually caused the issue.)
",joliss,joliss
644,2012-02-19 15:56:46,"Tech first:

Matt wrote:

> Thanks @joliss. Could you re-try this with the current HEAD of Cucumber?

Yup, it works great with 1.1.7, and with HEAD 5731b64, it passes but throws deprecation warnings.

I'm not sure that source_tag_names is bad enough to be deprecation-worthy with a minor bump (I'd perhaps wait till version 2.0), but I shall not bike-shed -- it's you guys's call.

@e2 wrote:

> In short, the test is using scenarios.source_tags

(In case this still matters: I'm pretty sure I ran the test on a pristine Capybara HEAD, which uses source_tag_names, though I don't know what actually caused the issue.)
",joliss,e2
644,2012-02-19 16:09:57,"Talk second:

@e2 wrote:

> P.S. With all the chaos around this, I believe @aslak will never again change anything in Cucumber without deprecation ;)

Haha, yeah -- I'm glad I got to make this experience vicariously. ^_^

> Cucumber is just so cool, that people are using every dark corner of Cucumber for whatever they need. And the noise also points out how crucial Capybara is for everyday life.

Yup. Funny how reports about the breakage started coming in within hours of the release.

@mattwynne wrote:

> My immediate thought is - ""but then how do we remove this kind of clutter from Cucumber?"" but of course otherwise we're expecting you guys to have to put backwards-compatiblity hacks like #647 in. I don't mind taking the deprecation warnings out - we can just flag that method up as something we remove in the next major release, I suppose.

I agree -- I guess it's one of these unpleasant facts of open-source library maintenance that you only get to remove clutter something like once a year (at best).

@e2 wrote:

> it might make sense to have versioned API layers in Cucumber - and deprecate an api version as a whole.

I'm thinking that might actually be overkill -- I'm personally not _that_ concerned about breaking things (within reason) between majors, dropping compatibility entirely.

---

What I think this mess demonstrates is this: When we publish libraries, it really pays to be careful about deciding and communicating what is and isn't public API, and when we use other people's libraries, we should read up on the API documentation (or pester the developers) so we don't accidentally use private methods. Just as a general thought.

Anyways, glad we got this sorted out! Thanks for spending your weekend time. :-)
",joliss,e2
644,2012-02-19 20:32:50,"@joliss Actually, I take back what I said about the API.

Capybara is a _runtime_ _dependency_ of cucumber-rails:

  https://github.com/cucumber/cucumber-rails/blob/master/cucumber-rails.gemspec

Which means every Cucumber change should be tested against Capybara, to make sure cucumber-rails doesn't end up ""broken"".

Also, cucumber-rails is a good point to handle version conflict information between Capybara and Cucumber.

I'm not sure cucumber-rails can actually work without Rails itself (runtime), but it may be the best solution to give maintainers more development flexibility, while providing the stability through versioning in cucumber-rails.

Because of that, I was wondering if cucumber-rails could be renamed to cucumber-web to handle things like sinatra, etc.
",e2,joliss
642,2012-12-19 17:42:50,"@jnicklas Why `maximum` and `minimum` must be supported? They aren't supported by `has_css` so I don't know why they should be supported by has_content.

I don't think it will be bad if the only possible option for `has_content` will be `count`
",abotalov,jnicklas
642,2012-12-19 18:35:35,"@abotalov they are supported by has_css.
",jnicklas,abotalov
634,2012-02-07 04:27:29,"@joliss you're right.... that returned false.  I thought has_select checks the label of the field, according to the docs http://rubydoc.info/github/jnicklas/capybara/Capybara/Node/Matchers#has_select%3F-instance_method

![](https://dl.dropbox.com/u/71697/jing/2012-02-06_2224.png)

So why would `page.should have_select 'Staff Member'` be returning false.  A print out and `save_and_open_page` shows the html is there.....

p.s. sorry I thought it was a bug.
",cj,joliss
634,2012-02-07 04:33:47,"@joliss why would you say it's my app?  If I do `page.should have_select 'user[acd_api_id]'` it returns true.  So surely this is a bug......

edit: typo
",cj,joliss
634,2012-02-07 14:49:27,"@jnicklas not sure how I could miss that!  Thank you!  @joliss Thank you for all your help too.  If you both ever need anything let me know.
",cj,joliss
634,2012-02-07 14:49:27,"@jnicklas not sure how I could miss that!  Thank you!  @joliss Thank you for all your help too.  If you both ever need anything let me know.
",cj,jnicklas
629,2012-02-29 10:51:37,"@jnicklas It seems like there are two 'levels' to this issue, and they can be addressed separately:
1. Exception handling where we are testing against a rack app that exists in the same process
2. Status code handling

I have a proposal for number 2.

At the moment, Capybara doesn't care about the status code. It won't raise an error if a `visit` or a `click` produces a 500 or a 404 etc.

I think that by default Capybara should raise an error if the status code is not in the 2XX range. This would help people catch errors faster and make it more obvious what's going on. (""Received 500 response"" is more obvious than ""couldn't find 'foo' link to click"".)

This would only be possible for drivers that have status code support, and would need something to be added so that drivers can indicate their support (or not) for status codes.

Additionally, there are cases where someone might want to test their 404 or 500 pages. Therefore, there needs to be a way to disable this functionality. Suggested API:



What do you think?
",jonleighton,jnicklas
628,2012-02-02 09:57:27,"/cc @jnicklas 

Thanks -- I've merged this. (If we find that it's over-eager with our development dependencies, we can always change or remove it later, I guess.)

And thanks for building Gemnasium, @laserlemon! :-)
",joliss,laserlemon
620,2014-12-15 17:41:58,"@twalpole At least you noticed it! Should I open another issue?
",907th,twalpole
609,2012-03-15 06:42:29,"Any chance this'll be merged?  @jnicklas ?  Or are the save_and_open just going away?
",nyarly,jnicklas
609,2013-01-04 22:47:11,"FWIW, @jnicklas I think you should care more about how people need to use Capybara than having Capybara's code itself look good.

I've only _just_ gotten `capybara-firebug` working, but prior to today I literally had _no_ feasible way to debug js issues in my request (now ""feature"") specs.  And even at that, my workflow sucks for debugging js issues (run specs, edit failing tests to change them to `:driver => :selenium_with_firebug` and add a debugger in each failing example, re-run failing examples & poke around in firebug).

Compare this with simply accepting this PR, which would enable developers -- regardless of whether they are using Selenium or not -- to actually be able to debug their js.  I'm mainly discussing WRT to rails devs, as it's my opinion that the asset pipeline causes most of the headaches.

At the end of the day, the 20+ developers in my office would have benefitted from this functionality, as would (I'm sure) many many others.  There are enough stackoverflow questions and at least 2 issues (if you count this one) on the Capybara repo itself about issues with assets and `save_and_open_page`.  Surely you've heard about the user researcher at Yahoo! that found there were 50,000 people who experienced a given problem for every ONE that complained about it...

Just my 2c.  I guess we'll continue working around the limitations of the tool.
",sdhull,jnicklas
605,2012-01-10 22:31:12,"@jnicklas it's difficult - there isn't, afaik, a good way to serve README.md et al from your bundled gems, and the (incorrect) assumption is made that if you're on the latest version of a gem then whatever is on github's default branch is correct.
",mipearson,jnicklas
598,2012-07-11 16:33:27,"@joliss The way to improve performance is to profile and find out wtf it's using several million CPU cycles just to start up ;-)  I mean, what can it really need to do which requires all that work?

@tcrayford 40s may be a _standard_ boot-up time these days, but that doesn't mean it's _right_, it just means that as a community we're getting sloppy and our expectations are too low ;-)  You only need to look at what programmers used to do with 64k of RAM and a 50MHz CPU to be reminded of that.  Or what Google achieved with Go's compilation times.  Anyway, I do not want to turn this issue into a nostalgia-fest or flame war, so let's not discuss further until someone has done some profiling or coding ;-)
",aspiers,joliss
594,2012-03-13 18:17:02,"@joliss -- Sounds fine.  It didn't even occur to me to think about the additional costs to rubygems.
",myronmarston,joliss
585,2012-01-03 12:38:33,"@jnicklas Yes, you are right. I had a tab of both projects open and confused it.

@joliss Thanks, that did the trick!
",clemenshelm,joliss
585,2012-01-03 12:38:33,"@jnicklas Yes, you are right. I had a tab of both projects open and confused it.

@joliss Thanks, that did the trick!
",clemenshelm,jnicklas
578,2012-01-08 23:11:19,"Huh, good to know. @jnicklas Luckily, the renamed exceptions are aliased under their old names:



So we should leave the old exception names in the code to keep compatibility with selenium-webdriver ~> 2.0.

@stevecj So, back to your original issue, could you perhaps provide some condensed failing test that demos the problem? It's quite possible that there are issues in Capybara with stale element handling -- Selenium can be a hairy beast. But from your description alone it's very hard to reproduce.
",joliss,jnicklas
570,2012-01-05 00:05:03,"@jnicklas actually it is a problem with Capybara.

I was trying to make a minimal repro for Nokogiri, but it just worked.

The issue is this:



And the `save_and_open_page` method is using `body`, instead of `source` which wraps it with the XML declaration.
I think `Capybara.save_page` should use `source` instead of body. We really want to save the whole page not only what's inside the body.
",dnagir,jnicklas
569,2011-12-22 18:41:52,"@jslag Check this out https://github.com/Nerian/akephalos2
",Nerian,jslag
565,2011-12-29 02:29:10,"@joliss +1. I agree. Being new to Capybara, that totally tripped me up until I stumbled onto your comment just now!

I kept getting errors like: 



Looks like it's a simple fix – once you realize RSpec is required you can run code like this:



But, that wasn't obvious to me when I first read the README.
",audionerd,joliss
565,2011-12-30 02:21:00,"> @joliss +1. I agree. 

I'm not sure if _I_ still agree with my previous statement. :-) We probably should endorse Capybara.javascript_driver regardless of the testing framework. I have a documentation patch for Test::Unit coming up in a day or so.

You are right though that Capybara.javascript_driver should be available.



@jnicklas, that shouldn't happen, should it? I made a pull request at #582 to automatically require 'capybara/dsl'. (I thought about simply moving things out of dsl.rb up into capybara.rb, but I wasn't really sure if they best belong there.)
",joliss,joliss
565,2011-12-30 02:21:00,"> @joliss +1. I agree. 

I'm not sure if _I_ still agree with my previous statement. :-) We probably should endorse Capybara.javascript_driver regardless of the testing framework. I have a documentation patch for Test::Unit coming up in a day or so.

You are right though that Capybara.javascript_driver should be available.



@jnicklas, that shouldn't happen, should it? I made a pull request at #582 to automatically require 'capybara/dsl'. (I thought about simply moving things out of dsl.rb up into capybara.rb, but I wasn't really sure if they best belong there.)
",joliss,jnicklas
564,2011-12-10 00:41:20,"@joliss 
Wow, quick turn around. Exciting.

1) I agree that this is a valid concern. This was a very rough/quick patch job on my part, and should not necessarily be definitive. On the other hand, by using the *args notation, is it not the case that all existing functionality remains precisely the same? 

I agree that other browsers - if they do not support passing elements to the script in question - should perhaps raise an error (like the WebDriver bindings to Capybara do when you call functions such as 'trigger' 'Node#path'), or further, perhaps this should only be included in the Selenium driver's evaluate_script/execute_script. Would be interesting to hear other people's opinions.

Also, there is always the option that other driver's simply drop the arguments. If the script passed to them relied on it, it would probably fail. Again, a relevant error message would explain (and rectify) the offending code. 

I don't necessarily think it is the end of the world if different drivers have some differing implementations of the API and functionality. In fact, I would argue strongly that this already occurs - I often find myself writing certain sections of my test code with a conditional that checks for the current driver, treating :selenium on way and others differently.
2) Again, agreed. 

3) Good point, and again, agreed.

I will point out the following: I came upon this while trying to access the raw Javascript contained in a script element. I ended up opening an issue on the Selenium queue to the extent of ""why doesn't the ruby binding to webdriver have the same functionality as the Java version?"" They schooled me proper, and basically told me I was an idiot (...I kind of am ;) From there, I figured: why doesn't Capy have this? Which has brought us here....
",wokkaflokka,joliss
554,2012-01-03 18:23:27,"@jarib, out of curiosity, do you know which chromedriver version you ran that example under?
",jayzes,jarib
551,2011-11-28 22:18:24,"Ack that with Ruby everything is possible given enough time and effort - the idea here is to arrive at a simple way of providing functionality that I and others are currently overloading Capybara classes/methods to arrive at. 

Perhaps pry is the best solution, I'll look into it.  
However I dislike my feature/example files getting littered with BDD scaffolding, what I have in mind are one or two methods that I use in helpers, nowhere near my feature/example files. One question I have is how do I conditionally determine which session to close when describing multi-user cases - again maybe Pry _is_ the bees knees.

Thanks @joliss
",hedgehog,joliss
551,2011-11-29 05:02:25,"OK thanks @jnicklas, I think I can make Pry do what I want, if I find some convenience behaviors, likely in the multiple user behavior use-case, I'll make a pull request.  
",hedgehog,jnicklas
548,2011-12-20 16:17:16,"@joliss Do you know where selenium-webdriver is hosted so I can raise the issue there? We had to upgrade to get support for FF9 (we were on 2.10 before), but I set my selenium-webdriver version to 2.14.0, which resolves both issues.

Thanks
",despo,joliss
547,2012-12-23 21:31:28,"@jnicklas Which entry is that in History.md? I tried looking for this change in Changed section but nothing connects for me to this one.
",betelgeuse,jnicklas
547,2012-12-23 23:37:46,"@jnicklas yeah that's more clear. I am still trying to figure out how to best handle cucumber where you want to use the labels. I guess it's best to modify the step so that it matches the label fully.
",betelgeuse,jnicklas
544,2011-11-28 09:44:47,"This is a widespread issue, I've seen at least 4 instances of people trying to implement the behavior they think Capybara provides, but they can't get working.  In all cases they try to do achieve the same behavior, some via css, others via xpath.  Anyway, there does seem to be a common understanding of the desired behavior.

@grzuy, my understanding of `visible => false` is the same as yours.  From what I've seen of the solutions people have offered up others have a similar understanding.

Maybe for an collective method like `all`, the keys `:select_visible` or `:exclude_visible` are more descriptive of what is intended to happen?  Other more explicit key names are `:if_visible`, `:is_visible` or `:is => :visible|:invisible` and `if => :visible|:invisible`

I'm not being argumentative when I say I really don't understand why @jniklas claims the current behavior is expected.  Almost nobody else seems to think so, and if we took the new name the current behavior would surprise people:



When really it should be false.
",hedgehog,grzuy
536,2011-11-02 20:58:07,"@jnicklas where in the docs does it cover this issue (link please)?
",trvrplk,jnicklas
536,2011-11-02 23:38:28,"@jnicklas I read that, but it solves nothing
",trvrplk,jnicklas
536,2011-11-03 11:57:08,"@jnicklas Here is the spec:



and the output:


",trvrplk,jnicklas
536,2011-11-03 12:03:37,"@jnicklas yes.
",trvrplk,jnicklas
535,2014-07-26 20:12:16,"@espen  Adding a request for how to do something to an issue that was closed over 2 years ago is unlikely to get you help.  Try posting to the mailing list as indicated in the README
",twalpole,espen
535,2016-11-28 18:13:44,"@wrtsprt @twalpole - I would be happy to update the docs, if that is desired.",georgeu2000,twalpole
533,2012-07-17 17:16:04,"@JonRowe I'm working on a major refactor of the test suite, which will affect how these tests would be written. I should be able to finish that up in the next couple of days. I'd suggest holding off until then, if you're interested in making this work in Selenium.
",jnicklas,JonRowe
522,2011-10-16 23:49:22,"@jnicklas I have updated the implementation based on Element#text. Definitely agree it makes more sense this way, and it came together pretty quickly, which is always a good sign. Let me know your thoughts on how this looks?
",mkdynamic,jnicklas
522,2011-10-24 05:56:02,"@jnicklas OK, so `has_text` is now implemented to use `Element#text`. It worked out the box with the `Selenium` driver for all cases (head, script, hidden text etc.). For `RackText` driver, as you hinted, I had to tweak the behaviour of `Element#text` to behave correctly.

Please scope, and let me know what you think?
",mkdynamic,jnicklas
521,2011-10-14 19:49:15,"@joliss that change made more tests fail. The important thing would be to match however the XPath::HTML.content is ignoring whitespace. It looks like content is using an xpath `contains` which may be where whitespace is being ignored. I didn't dig much further but I believe that would be handled by Nokogiri and in turn LibXML. I'm not 100% sure though.
",rmontgomery429,joliss
521,2011-10-17 01:09:47,"It turns out that XPath::HTML normalizes content through xpath function `normalize-whitespace`. This doesn't behave exactly the same as `gsub(/\s/m, """")`. The `normalize-whitespace` function works by ""stripping leading and trailing whitespace and replacing sequences of whitespace characters by a single space"". http://www.w3.org/TR/xpath/#function-normalize-space

What I ended up doing to make this behave more like the `normalize-whitespace` function was to replace any one or more matched whitespace character with a single space.

I think the /\s/ suggestion was a good one and I've just pushed a change to make it work better in all cases. 

Thanks for the feedback @joliss and @jnicklas.
",rmontgomery429,joliss
521,2011-10-17 01:09:47,"It turns out that XPath::HTML normalizes content through xpath function `normalize-whitespace`. This doesn't behave exactly the same as `gsub(/\s/m, """")`. The `normalize-whitespace` function works by ""stripping leading and trailing whitespace and replacing sequences of whitespace characters by a single space"". http://www.w3.org/TR/xpath/#function-normalize-space

What I ended up doing to make this behave more like the `normalize-whitespace` function was to replace any one or more matched whitespace character with a single space.

I think the /\s/ suggestion was a good one and I've just pushed a change to make it work better in all cases. 

Thanks for the feedback @joliss and @jnicklas.
",rmontgomery429,jnicklas
521,2011-10-17 01:16:33,"@mkdynamic that makes sense. I must have pushed just as you commented. :) The latest change (removing the /m modifier) if pushed.
",rmontgomery429,mkdynamic
521,2011-10-17 01:44:55,"@mkdynamic do you know if it is preferable within capybara to make something like `gsub(/\s/, "" "").strip` a call to a function like `normalize_whitespace(content)` or leave it in-line?
",rmontgomery429,mkdynamic
508,2011-11-03 23:44:08,"@jnicklas does this not happen to you?  When Rails raises an error (from a controller or view or something), the backtrace is not displayed in the test output.
",joevandyk,jnicklas
508,2012-01-03 13:53:34,"@JonnieCache are you sure that causes firefox to hang? I found that usually happens when my version of `selenium-webdriver` is outdated or is not compatible with my version of FF. Anyway... that hack has worked quite nicely for me for a while.

And, yes @jnicklas -- there doesn't seem to be an elegant way to handle this... Maybe it's worth putting a note in the README/wiki saying that exceptions raised in the application will not be raised while running the test suite and link to a gist like mine or something similar?
",agibralter,jnicklas
508,2012-01-03 14:02:29,"I agree this should probably be closed, at least as long as there is not a neat solution. In general, I just use `save_and_open_page` or open the URL in my browser when the app raises an exception.

And as @agibralter said: ""Sometimes, you _want_ your app to return a 500 error and you want to test how your JS deals with that situation."" So we'd need to add more logic to allow _some_ error pages to pass through.

So I'd say we close this. If someone comes up with a sensible solution for this, we can revisit the issue.
",joliss,agibralter
505,2012-03-07 16:20:31,"@jnicklas is there a way to do that but lazy find the body?  I'm trying to get back to the body from inside a within, so that I can check it loaded a popup....
",cj,jnicklas
505,2012-03-07 16:22:49,"@jnicklas looks like find(:xpath, '//body') works :D
",cj,jnicklas
500,2011-11-15 17:44:55,"@jnicklas, am I correct in the reasoning for why `save_and_open_page` copies the page and changes all of its asset references, rather than just simply opening the page it's currently on as-is?
",JangoSteve,jnicklas
500,2011-11-16 18:11:01,"@jnicklas, better to open a page, than every time to think about whether enough seconds set for sleep. Why watch ""cartoon"" of, for example, twenty episodes, if you want to watch only twenty-first? Let's all give up the use of webkit. More cartoons! More selenium!
",dom1nga,jnicklas
500,2011-11-16 18:11:58,"@jnicklas, that's the point, you _can't_ see most of the relevant markup just fine. Everyone on my team has stated that `save_and_open_page` became useless in Rails 3.1 (and I've heard it from a lot of people outside of my team as well), and it made simple debugging (short of switching to selenium/pry) very difficult. Trust me, I wouldn't be spending my time on it if it wasn't a big issue.
",JangoSteve,jnicklas
500,2011-11-16 20:06:13,"The fork from @JangoSteve has worked well for me and I will continue to use it if that is the best option.  That being said, I would just as soon not see Capybara be fragmented into multiple branches if @JangoSteve is willing and able to work towards a solution compatible with the vision and constraints of the project.  @jnicklas - Since this does not seem to be a core concern for you and already depends on launchy, are you thinking that save_and_open_page should be pulled out into a separate gem?
",baldwindavid,jnicklas
500,2012-06-06 21:16:49,"@JangoSteve I'm sure @jnicklas wouldn't mind adding an extension point where one is useful. On the other hand, I don't see a problem overriding a method in capybara as long as dependencies are correctly specified. We can just add `gem ""capybara-rails""` to Gemfile, which depends on its compatible version of capybara, and remove `gem ""capybara""` itself. Then hopefully update capybara-rails often enough until @jnicklas has a chance to add a cleaner way to change that stuff, like injecting a proc.

Regarding the feature being Rails-specific — this pull request would be, but a generic extension point would not. Rails is nothing more than a very popular type of Rack app that has some special handling of assets. I see it as a good enough reason to add an extension point to inject ""special handling of assets"". There are rack apps in the wild that depend on it.

Whether or not `save_and_open_page` a best way to debug is a separate conversation. Feature exists, I love using it, many others do. It's quicker for me than to switch to a terminal and ""sense"" my surroundings with pry, or setup selenium.
",maxim,jnicklas
500,2013-02-09 08:40:25,"If you choose to embark on that journey of adding back asset rewriting, you should consider going whole-hog and adding [asset server support](https://github.com/nyarly/capybara/commit/6562e0aec8219b817c097abd81ddcd177675dd5e).  Maybe via a `capybara-rails` gem?  :smiley_cat: 

Of course, I'm working on adding it as a new PR, following the guidelines outlined by @jnicklas in #609 (after my brief but furious outrage about the asset situation in `save_and_open_page`).

And if my PR doesn't get merged, then I figured I'd release it as a gem that monkey-patches it in.
",sdhull,jnicklas
490,2011-11-26 08:00:22,"@jnicklas, can you be a little bit more in details on how you avoid using `save_and_open_page` and halt the execution for debugging?
",gmile,jnicklas
485,2011-11-02 02:13:16,"@joliss, I have a pull request already submitted, see #500.

@nruth, I think that it is needed. Capybara comes into play when we're testing content rendered with our views, and at least half the time (for me anyway), it's  with js turned on. If I have an action that hides  content, and then I have a test that says `page.should have_no_content 'blah'`, and that test is failing, I'm going to put `save_and_open_page` right before it and see if the content really isn't there, or if maybe it's duplicated elsewhere on the page, or if maybe I used a lowercase instead of uppercase in the test, or whatever.

If my javascript and stylesheets (and images) don't work, then the page often isn't anything near what's actually  seen in the app. In other words, `save_and_open_page` is useless for Rails 3.1 apps using the asset pipeline, which I'm guessing will become more and more relavent as a sizable portion of capybara's users migrate in that direction.
",JangoSteve,joliss
485,2011-11-02 02:13:16,"@joliss, I have a pull request already submitted, see #500.

@nruth, I think that it is needed. Capybara comes into play when we're testing content rendered with our views, and at least half the time (for me anyway), it's  with js turned on. If I have an action that hides  content, and then I have a test that says `page.should have_no_content 'blah'`, and that test is failing, I'm going to put `save_and_open_page` right before it and see if the content really isn't there, or if maybe it's duplicated elsewhere on the page, or if maybe I used a lowercase instead of uppercase in the test, or whatever.

If my javascript and stylesheets (and images) don't work, then the page often isn't anything near what's actually  seen in the app. In other words, `save_and_open_page` is useless for Rails 3.1 apps using the asset pipeline, which I'm guessing will become more and more relavent as a sizable portion of capybara's users migrate in that direction.
",JangoSteve,nruth
483,2011-12-14 16:24:06,"@joliss: I don't see ""acceptance"" there (line 30):
https://github.com/rspec/rspec-rails/blob/master/lib/rspec/rails/example.rb

Or am I missing something?
",jarijokinen,joliss
483,2011-12-16 02:04:47,"@joliss Sorry to hijack this but I wonder if that section needs to be rewritten, again. I think that's part of the problem here. I know I rewrote it a while back, but it could be abbreviated still. This is how I imagine people reading it currently:

> You can make an example group and tag it :type => :request. Oh by the way, :type => :acceptance works too. These are RSpec versions of Rails integration tests Capybara request specs blah blah. So actually scratch what I just said about :type => :request, stick your tests in spec/requests. Or spec/integration. See, easy!!

I mean I get why all that is there, because we're assuming that people aren't using Rails, and then we say ""oh but if you do use Rails, then you can do this instead"". Maybe it would be a good idea to move the Rails stuff down to the Rails section?
",mcmire,joliss
483,2011-12-21 00:14:48,"@mcmire wrote:

> @joliss Sorry to hijack this but I wonder if that section needs to be rewritten, again.

Right. I made a pull request at #577. Do you think that's better?
",joliss,joliss
483,2011-12-21 00:14:48,"@mcmire wrote:

> @joliss Sorry to hijack this but I wonder if that section needs to be rewritten, again.

Right. I made a pull request at #577. Do you think that's better?
",joliss,mcmire
481,2011-09-05 16:43:55,"Still trying to fix the has_select_spec on Selenium. I have relatively little experience with raw Xpath or Selenium, but it appears to me that Selenium doesn't like the generated Xpath when it factors in the :selected option. @jnicklas does this sound like anything you've encountered before?

Here is a snippet of my debugger session that shows what I'm seeing:


",adamlogic,jnicklas
481,2011-09-06 01:04:36,"@jfirebaugh I'd love to buy you a beer for that detailed commit message. Makes total sense now. I'm going to see about moving that logic into the selectors, because right now it feels a bit scattered to me. I'll push what I come up with to see what you guys think.
",adamlogic,jfirebaugh
481,2011-09-06 21:25:02,"@jfirebaugh: a while ago, I started sketching on a DSL to allow options for selectors. The problem was that the thing quickly became a grotesque monster, with dozens of different methods to construct the selectors. This seemed like overengineering to me. Not sure it makes sense to move this stuff to selectors if it isn't configurable per selector _somehow_ though.
",jnicklas,jfirebaugh
481,2011-09-09 01:58:26,"@jnicklas @jfirebaugh Curious to get your thoughts on [this approach](https://github.com/adamlogic/capybara/compare/custom_selectors...new_selector_api). I removed the add_selector DSL in favor of each selector being a Ruby class. In my mind this is a more straightforward approach and also more flexible. To be honest I never really understood the purpose of having a DSL for creating new selectors.

I realize this completely breaks the selector API and would have to wait for Capybara 2, if it goes anywhere at all. It's also a rough spike -- no tests, all in one file, etc. I really just wanted to throw it out there to see what you guys think.
",adamlogic,jnicklas
481,2011-09-09 01:58:26,"@jnicklas @jfirebaugh Curious to get your thoughts on [this approach](https://github.com/adamlogic/capybara/compare/custom_selectors...new_selector_api). I removed the add_selector DSL in favor of each selector being a Ruby class. In my mind this is a more straightforward approach and also more flexible. To be honest I never really understood the purpose of having a DSL for creating new selectors.

I realize this completely breaks the selector API and would have to wait for Capybara 2, if it goes anywhere at all. It's also a rough spike -- no tests, all in one file, etc. I really just wanted to throw it out there to see what you guys think.
",adamlogic,jfirebaugh
481,2012-01-02 20:15:02,"@jnicklas Excellent! I'd been procrastinating writing specs for all of this because I wasn't quite sure how to go about it. I'm glad to see you merged it in, and I like where you've gone with the filters.
",adamlogic,jnicklas
471,2012-11-07 14:42:50,"@jnicklas Ah! I got bit by the FakeWeb problem (yes, it's still a problem a year later).

Tomorrow I'll take a few minutes to mention the issue and the solution in the README. Ok with you?
",webmat,jnicklas
463,2011-08-23 13:18:30,"@jnicklas: I'll try to help.

The root failure is rspec + capybara + selenium driver eats the process exit code. So when a spec fails rspec says `exit 1`, then on cleanup capybara says `no, no, exit 0`. This is happening in `@browser.kill`, although I am not sure how. IMO, it's a bug.

In RSpec we tried a workaround of saying `capybara sets exit code last, nomatter what`. It worked around this particular problem, but broke existing functionality. We can't figure out a fix that works for all scenarios. Saying `my exit code is last` is tough because we end up in a nested `at_exit` block that execute in some weird order in Ruby.

You're the boss to Capybara to figure out what the best way to proceed is. I think this or a variant of this fix should be committed, Capybara shouldn't be setting the process exit code ever, it's not in the business of doing that.
",dblock,jnicklas
463,2011-08-23 13:21:27,"@dchelimsky: the code in this patch saves the old exit code and restores it afterwards, it does quit the browser
",dblock,dchelimsky
463,2011-08-24 12:35:04,"@ebeigarts - I don't think the redef on Kernel belongs in Capybara as it has wide-reaching impact on the runtime and Capybara users would be unable to control it. It might, however, make sense as an at-exit-fix gem (especially in light of the fact that it's being fixed in future versions of Ruby). WDYT?

@jnicklas - does @dblock's explanation help you to understand this patch any better?
",dchelimsky,ebeigarts
463,2011-08-24 12:35:04,"@ebeigarts - I don't think the redef on Kernel belongs in Capybara as it has wide-reaching impact on the runtime and Capybara users would be unable to control it. It might, however, make sense as an at-exit-fix gem (especially in light of the fact that it's being fixed in future versions of Ruby). WDYT?

@jnicklas - does @dblock's explanation help you to understand this patch any better?
",dchelimsky,jnicklas
463,2011-08-30 02:10:50,"I am a _huge_ fan of monkey patching. I say hack it (3). I think @jnicklas should spend a few minutes understanding what's at stake here (poor users can't get CI to work properly) and decide what to do. In the meantime @ebeigarts could make a gem, but I would call it _at-exit-code-warrior_ - the real functionality of this code is not to overwrite the previous exit code if set to non-zero. 
",dblock,ebeigarts
463,2011-08-30 02:10:50,"I am a _huge_ fan of monkey patching. I say hack it (3). I think @jnicklas should spend a few minutes understanding what's at stake here (poor users can't get CI to work properly) and decide what to do. In the meantime @ebeigarts could make a gem, but I would call it _at-exit-code-warrior_ - the real functionality of this code is not to overwrite the previous exit code if set to non-zero. 
",dblock,jnicklas
463,2012-07-28 14:12:11,"@ebeigarts sorry about being daft but I'm not following. Are you referring to log output or source code?
",mhenrixon,ebeigarts
463,2012-07-28 14:22:50,"In the sorce code, this is the actual bug - http://redmine.ruby-lang.org/issues/5218

On 28 Jul 2012, at 17:12, Mikael Henrikssonreply@reply.github.com wrote:

> @ebeigarts sorry about being daft but I'm not following. Are you referring to log output or source code?
> 
> ---
> 
> Reply to this email directly or view it on GitHub:
> https://github.com/jnicklas/capybara/pull/463#issuecomment-7333307
",ebeigarts,ebeigarts
460,2011-08-26 06:54:00,"@jnicklas: Of course :)

I didn't touch anything though. That's why I deduce '2.0' is sometimes interpreted as '0.2.0'.
",apneadiving,jnicklas
442,2011-08-11 17:51:42,"Agree with @jfirebaugh. These APIs are taken verbatim from Webrat. I think they read quite nicely tbh.
",jnicklas,jfirebaugh
431,2011-08-02 09:53:02,"Morning Guys!

@jeroenvandijk This should defiantly sort you out. I'm using it for a similar reason at the moment! RackTest was taking the external links to our payment processor and forwarding them to Rails (_KaBOOM!_). I'm using this driver and FakeWeb to stub out and test responses from the processor. 

@joliss I'll rebase my feature branch off HEAD and get that sorted out! I'll have to give it a `push -f` to get this pull request updated. Can you make sure you delete any versions of the mechanize branch that you have.

Cheers,
Chris
",clowder,joliss
431,2011-08-02 23:07:43,"On Tue, Aug 2, 2011 at 11:53, clowder
reply@reply.github.com
wrote:

> @joliss I'll rebase my feature branch off HEAD and get that sorted out! I'll have to give it a `push -f` to get this pull request updated. Can you make sure you delete any versions of mechanize the branch that you have.

Great, thanks. Feel free to rebase as much as you want -- I don't
expect to be able to work on top of other people's feature branches
(unless I'm prepared to deal with incessant `push -f`'ing). I don't think
most people would. :-)

Jo
",joliss,joliss
431,2011-08-11 08:44:29,"I agree with @jnicklas that it adds yet another dependency. As an application developer however I normally don't mind having some extra dependencies in the test part of my application as long as they don't conflict with application gems, but chances are they will.

I am more than willing to rename or deprecate (one of the two, depending on the feature set) the capybara-mechanize gem so that it can be used by this work instead. As long as we mention the driver in the Readme people should be able to find it. Another choice could be to make a move like RSpec where you start with Capybara-Core Capybara-Selenium etc etc.
",jeroenvandijk,jnicklas
422,2011-07-29 23:15:55,"@joliss a fair point. I went ahead and reverted to the original implementation.
",mcolyer,joliss
409,2011-07-25 23:50:04,"@joliss thanks for responding I was beginning to wonder what was going on. 

Unfortunately I didn't see this pull request when I made mine. However I would rather we use #422 as it includes the code for the test server and it also handles changing the host upon each redirect as opposed to the last redirect. 
",mcolyer,joliss
396,2011-06-29 13:58:33,"@joliss: I think we should do whatever the UAs are doing. If they ignore it, we should too. Same goes for maxlength=""0"", imho.
",jnicklas,joliss
396,2011-06-29 14:59:28,"@joliss: thanks!
",jnicklas,joliss
394,2011-09-26 10:54:49,"+1, this affects me too. Thanks for the workaround using page.source instead.
@jnicklas: Please deprecated #body, and just leave #source and #html. This has cost med ours testing an XML application.
",jarl-dk,jnicklas
392,2011-07-12 22:28:42,"@jnicklas any idea when a Capybara 1.0.1 will be out which includes this fix? Unfortunately selenium-webdriver has been updated on July 7th and so this is a real problem now (not able to use git source). Appreciate you're probably busy :-)
",parndt,jnicklas
384,2011-06-28 10:32:37,"@jnicklas, since lots of people are switching from webrat and this is a mistake people often make, perhaps it would be nice for us to give them a warning when passing ignored options or a block to #have_selector ?
",gunn,jnicklas
384,2011-07-22 18:28:24,"@joliss: I'm not sure what's odd about it. This is in a controller spec (not a cuke feature), so response is an available method and used all over the place.

The docs for capybara explicitly state: ""rspec-rails will also automatically include Capybara in :controller and :mailer example groups."" and `within` is definitely available as a method in the specs. The problem is that `within` doesn't find the content in `response.body` that matches the selector while `response.body.should have_css('the same selector')` does.
",contentfree,joliss
384,2011-07-27 21:02:23,"I was able to modify the work-around provided by @jnicklas so that it works in my view specs under capybara 1.0.0 and rspec-rails 2.6.1:



The trick here was to expose the Capybara DSL by wrapping RSpec's `rendered` string in a `Capybara::Node::Simple` object.
",Tekhne,jnicklas
383,2011-12-28 16:01:01,"/cc @jnicklas 

It seems there has been no progress on this for a while, and there are still synchronicity issues for the temp file cleanup that prevent us from adding this feature. I'll close this pull request for now. Feel free to reopen if there's new code.

Jonas, is it OK if I close old pull requests like this?
",joliss,jnicklas
382,2011-06-14 06:37:41,"@joho: I'm not opposed at all to this pull request, if you can get it into better shape, I'd be glad to merge it. I'd agree that it would be best to have a test which just checks that it isn't nil, that seems sensible.
",jnicklas,joho
382,2011-06-14 15:27:36,"@joho: just realized that those tests are not run by Selenium, since it doesn't include the header support module in its suite (Selenium doesn't have support for reading HTTP headers). That's why it's passing, these will still fail with any other driver (e.g. Akephalos) which implements the headers, but doesn't have the same API as RackTest. Please rewrite these tests to use the official Capybara driver API only (see Capybara::Driver::Base). 
",jnicklas,joho
382,2011-06-15 05:45:45,"@joho: pull down the Akephalos source, change the Gemfile to point at your Capybara fork on Github, bundle install and run.
",jnicklas,joho
379,2013-03-07 18:40:43,"@jnicklas I've tried adding href='#' to my links but I run into the same issue as @pboling - my pages jump to the top when the user clicks them. Without a hack like @tomazzlender suggested, Capybara won't click something that isn't a link, and using inline javascript as @pboling suggested mixes your concerns and is generally frowned upon these days. 

What I've finally settled on is having a real link that is used if a browser doesn't support JS, and using `preventDefault()` to keep the link from actually being followed if the browser does support JS. 

But I actually got the practice of using `a` without the `href` from the Jquery UI documentation (http://jqueryui.com/sortable/). If Jquery UI is using this practice, it seems to me that it's standard enough to support it.

Thanks for all your good work on Capybara.
",michaelrkn,jnicklas
379,2013-03-07 18:51:12,"@michaelrkn standard is kind of a binary concept, it either is standard or it isn't. In this case, standard means the [HTML5 spec](http://www.w3.org/html/wg/drafts/html/master/text-level-semantics.html#the-a-element). This is the relevant section:

> If the a element has an href attribute, then it represents a hyperlink (a hypertext anchor) labeled by its contents.
> 
> If the a element has no href attribute, then the element represents a placeholder for where a link might otherwise have been placed, if it had been relevant, consisting of just the element's contents.

I don't think this can be much clearer. ""then it represents a hyperlink"". otherwise is does not.

Capybara will happily click on anything you can throw at it, by the way, it just won't _find_ it as a link, if you do `click_link`. `find(""a"", :text => ""whatever"").click` will work just fine, `href` or not.
",jnicklas,michaelrkn
379,2013-04-22 15:44:42,"@twalpole: In the meantime, we found out that there was a bug so that the link-without-href couldn't be clicked upon. So sorry for the spam, there's no Capybara issue here.
",anpr,twalpole
379,2014-06-01 23:46:23,"@jnicklas your suggestion of `find(""a"", :text => ""whatever"").click` is nice -- however I think I'm finding that capybara will visit ""/"" if it doesn't find a href.
",jjb,jnicklas
373,2011-08-13 21:56:42,"I expanded upon @dbkbali's solution to support recursive subfolders in assets, and also rewriting css packages and asset_paths within those. So far its all working pretty good for me. Gist is here:

https://gist.github.com/1144277

You just need to run rake assets:precompile before you run your test suite. I'm also running on the latest rails 3-1-stable branch as I was having some inconsistency issues with precompiling across different machines on rc5.

Not sure what you think @jnicklas about asset pipeline save_and_open_page support ever going into Capybara, but this is a good starting point. I'm sure a lot of people will want this feature, so if you think it doesn't belong in Capybara, we can create a separate gem.
",snelson,jnicklas
370,2011-08-21 15:01:56,"@jdelStrother I believe this has been fixed on master, can you double check and close.
",ngan,jdelStrother
368,2011-06-04 09:45:22,"What @dchelimsky suggests is exactly [what Steak does](https://github.com/cavalle/steak/blob/master/lib/rspec-2/steak.rb#L11). I can help if you think it would make sense to port that logic to capybara.

Regarding the original motivation of this pull request (making the upgrade for steak users as smooth as possible), it seems that there'd be no problem [overwriting the type](https://github.com/cavalle/steak/blob/steak-2/lib/steak/acceptance_example_group.rb) of capybara features to `acceptance` in steak. So there's a workaround for that original issue that I can include in the next version of steak if you decide not to merge this pull request.
",cavalle,dchelimsky
368,2011-10-15 09:30:13,"@dchelimsky I am definitely interested in the treatise version. I actually think the terms 'integration' and 'acceptance' are very fuzzy. They are not mutually exclusive plus the meaning is dependent on perspective and context. I think they are often unhelpful. 

You could argue that all tests are integration tests. It's debatable. You could also say all acceptance tests are integration tests. Then again, you could have acceptance tests for a class' unit tests. You could have integration tests that are not acceptance tests (say, Rails' functional tests). In fact, functional tests is another term that is ambiguous. Anyway, this is a little OT, but I'd love for the community to have a discussion about these terms and bring some clarity.

On this specific matter, I would stick with request specs over acceptance specs in this case, if not only to follow RSpec conventions.
",mkdynamic,dchelimsky
358,2012-01-03 13:54:47,"@jnicklas totally agree.
",agibralter,jnicklas
351,2011-06-15 16:00:28,"@joliss: Why even have a Capybara API at all then—why not just send everything through to the native drivers? You need to be able to send keystrokes to interact with and test modern web applications, so don’t see why `send_keys` would ‘clutter’ the API any more than you could say `fill_in` does.
",codyrobbins,joliss
347,2011-05-14 08:36:34,"@joliss why would it make the test suite brittle?
",jnicklas,joliss
347,2011-05-23 22:06:19,"@joliss Is capybara currently being tested against windows? I.e. is anyone (perhaps yourself) running tests successfully on that platform? I've just spent a couple of hours trying to get it set up in a VM. I have got as far as the following error, which leaves me stumped (it's not my usual platform as you can imagine):



It seems like a good idea to preserve Windows compatibility if that's currently already working, but if it's more of a hypothetical concern because nobody actually knows if it works on Windows then it would be good to just merge this IMO.
",jonleighton,joliss
347,2011-06-01 21:07:00,"On Tue, May 24, 2011 at 12:06 AM, jonleighton
reply@reply.github.com
wrote:

> @joliss Is capybara currently being tested against windows?

Not by me, and I don't know if anyone has successfully run the tests
on Windows, to be honest.

> PS E:\Code\capybara> bundle exec rspec .\spec\driver\selenium_driver_spec.rb
> C:/Ruby192/lib/ruby/gems/1.9.1/gems/nokogiri-1.4.4-x86-mingw32/lib/nokogiri/nokogiri.rb:1:in `require': 127: The specified procedure could not be found.   - Init_nokogiri (LoadError)

Interesting.  Thanks a lot for trying -- I'm not sure what's going on
there.  At least now we can say ""smart people have tried and failed"".

> if it's more of a hypothetical concern because nobody actually knows if it works on Windows then it would be good to just merge this IMO.

I agree, actually.  Sorry for holding up the merge!

Jo
",joliss,joliss
347,2011-06-01 21:35:51,"@joliss I didn't run the full test suite, but that specific test file ran successfully, and selenium worked etc.
",jonleighton,joliss
336,2011-04-28 19:24:52,"@joliss I like the diff in pull 337 to except it should probably be: `n[:value]` in the `each`...
",agibralter,joliss
331,2011-06-27 00:48:57,"@jnicklas it is quite alright. I honestly would have been very surprised if that patch had gone through as it was.

I agree some sort of contextual error message would be awesome. But are you talking about putting this sort of error handling in the [XPath gem](https://github.com/jnicklas/xpath)? Or would each error be handled differently for each matcher?

Finally, where do we go from here? I'm not too familiar with contributing to open source projects and so I don't really know what I can/should do now.
",vrish88,jnicklas
329,2011-06-07 00:57:47,"@jnicklas: I'm beginning to agree with the Thin people. As I wrote my [reply](https://github.com/macournoyer/thin/issues/50#issuecomment-1312946) to the Thin thread, I realized that the only difference between Thin and WEBrick in Capybara is that WEBrick's 500 error page includes a backtrace. That's probably not ideal either... here's the pertinent part of my post:

> Anyway, as your tests run, you will expect to see some tests fail due to failed assertions (i.e. failed RSpec expectations); however, it is also possible that your app will have its own internal errors which need solving. WEBrick's 500 error response includes a stack trace... I guess that's not the same as what I was asking for in the original post... perhaps there's a better way as you suggest that involves a failsafe piece of rack middleware that captures app errors... perhaps Capybara's Identify rack app could serve this purpose.

Don't you think Capybara should handle internal app errors? `Identify` could capture exceptions to some sort of global variable/queue. Then Capybara could check for the presence of a `@@last_error` after app requests. What do you think?
",agibralter,jnicklas
329,2011-08-29 22:01:29,"@jnicklas Would you consider accepting a patch that inserted one more piece of middleware `Capybara::Server::ExceptionCatcher` (much like `Capybara::Server::Identify`) that handles exceptions raised in the app?
",agibralter,jnicklas
329,2011-08-29 22:22:19,"@agibralter: providing it is well written, it's purpose well defined and it has no annoying side effects, then yes. Oh and well tested too! ;)
",jnicklas,agibralter
322,2011-04-13 21:25:04,"@joliss
I am not totally sure what you mean.  What I posted above was inserted into the test_helper.rb file.  The reason I included the DSL module was that I was getting deprecation warnings with `include Capybara`.
",chrisolsen,joliss
316,2014-07-25 00:53:48,"Spent some time trying to figure this out then stumbled upon this. Thanks @jonleighton! :smiley_cat: 
",rickarubio,jonleighton
261,2012-12-19 00:18:21,"@jnicklas Seems like Capybara-webkit and Poltergeist solved this problem by automatic accept of all alerts.

Do you think Capybara should provide alert support by itself? i.e.
`page.alert.confirm` will work like `page.driver.browser.alert.confirm` if driver is Selenium and do nothing if Poltergeist

It will make switching between drivers easier
",abotalov,jnicklas
243,2011-04-11 03:39:45,"I encountered this issue today and ended up with the same CGI.escape fix as @jfirebaugh down in Rack::Util. 
",mculp,jfirebaugh
243,2011-04-11 08:07:34,"@jfirebaugh: that makes perfect sense. I think I understand now. If you'd like to fix the Capybara side of this issue, that'd be fantastic, and maybe we can figure this out once and for all.
",jnicklas,jfirebaugh
243,2011-04-25 09:12:00,"@jfirebaugh: any progress? if you don't have time to fix this, could you explain what you intended to change? Really want to get this fixed.
",jnicklas,jfirebaugh
243,2011-05-16 18:20:28,"What's the status of this.  I'm trying to move an app to Rails 3.1 beta and haver run into it.

I can't tell if the current rack has a variant of @jfirebaugh's pull request. I see that the pull request was accepted but the code looks a bit different.
",rubyredrick,jfirebaugh
243,2011-06-28 01:09:02,"@jnicklas thanks for the response!
",jschairb,jnicklas
210,2011-02-13 19:25:58,"@byrnejb will you implement this feature any time soon? If you won't I can give it a try
",gvc,byrnejb
203,2016-09-23 18:00:53,"@twalpole Unfortunately this field doesn't have an id, it's react and I had to access with page.find(:xpath) method
",DougMaisells,twalpole
203,2016-09-23 18:06:41,"@twalpole  so do I replace the page.find up above with find_field?
",DougMaisells,twalpole
203,2016-09-23 18:25:09,"@twalpole Thanks, got by run-time error but still does not persist with the zapped value.  It zaps the field as I run the scripts but the value is restored as the script travels through other fields on the form.  It must be a React thing; I'll have to get with my developer.  (I am QA)
",DougMaisells,twalpole
203,2016-09-23 18:41:38,"@twalpole Tom, you are talking over my head now.  My extent of understanding of React is it's a javascript framework which my app and others like Facebook is written in.  I'll get with my dev.  BTW, what you suggested above didn't work either.  This time, it doesn't even render the field as zapped and it stays with its value where the other tries at least zapped the field in real-time but then it restored a moment later as it went through other fields.    But with manual testing, I can highlight the value, hit the delete key, and tab (or use mouse to move focus to another field) and the zapped value persists.  If you have a quick and dirty way to emulate the manual actions above, I'm all ears.
",DougMaisells,twalpole
203,2016-09-23 19:05:40,"@twalpole Ooh, I missed that connection.  Yes, I am on OSX and yes that works.   I glanced over that detail above because I wasn't sure what was being talked about.
",DougMaisells,twalpole
194,2011-07-09 10:47:49,"@jnicklas: I'm aware of your stance on this, it's just that I don't agree. Keeping scenarios as free of implementation details as possible is a worthwhile quest, but the way you're recommending with hundreds of hand-crafted, single-use steps doesn't hit the sweet spot for us. We enjoy having reusable steps that take us most of the way (and they [don't](http://github.com/makandra/cucumber_factory) have to be ugly), and write custom steps when using a generic step would make a scenario too hard to read.
",triskweline,jnicklas
187,2010-11-09 14:50:53,"@jnicklas I'm not sure that will work, since I don't think it's able to access the `example.metadata`, which is the why Swinger can't use the around block: https://github.com/jnicklas/capybara/pull/187#issuecomment-526439

@alloy Swinger allows you to set the driver per example and per group. :)

I'll send in a new pull request when RSpec has metadata in its around blocks: https://github.com/rspec/rspec-core/issues#issue/221 :)
",jeffkreeftmeijer,jnicklas
170,2011-03-24 14:25:23,"I do the whole fake thing like @jnicklas does as well - however with the recent upgrade to FF4 these all break.  Anyone have an alternative?
",thechrisoshow,jnicklas
141,2011-10-20 07:58:41,"@w1150n Yes this is what I was using since the beginning
",jmgarnier,w1150n
139,2010-10-04 21:08:05,"@dchelimsky: ensuring API compatibility is nice, but it's just too many moving parts from Capybara that would have to be hacked together to make this work. Unlike Webrat, Capybara is heavily layered, and there is a clear line drawn between the DSL and the drivers underneath. In order to make this work we'd have to pick pieces from both and somehow build a new stack with them. I'm convinced that such a solution would be very fragile.
",jnicklas,dchelimsky
119,2011-07-19 22:39:09,"@jnicklas, can we see how you hacked around it accessing the Selenium node?
",bbuchalter,jnicklas
110,2010-11-25 18:08:37,"@jnicklas Removing the 'capybara_javascript_emulation' fixed the problem for me.

  require 'cucumber/rails/capybara_javascript_emulation' 
",jspooner,jnicklas
81,2010-11-18 13:30:23,"@bjornblomqvist your quick fix works perfectly. Thanks for that :)
",sriprasanna,bjornblomqvist
81,2012-06-06 21:37:26,"Hidden elements are properly ignored by have_content in `capybara/master`, regardless of ignore_hidden_elements setting, at least using the `capybara-webkit` driver. This seems like the semantically-correct behavior, since have_content seems to address what the user sees, not what elements are in the DOM.

@jnicklas perhaps a new release is in order? This is a blocker for me using Capybara for JS testing, and while I can just use the :git option in Gemfile, the Capybara repo is 6.2MB and [Bundler doesn't do --depth](https://github.com/carlhuda/bundler/issues/228) so I hesitate to foist it on my teammates.
",edrex-janrain,jnicklas
68,2012-03-20 05:14:09,"@jnicklas 
I  am facing following problem when I run cucumber test :
no button with value or id or text 'Save' found (Capybara::ElementNotFound)
      (eval):2:in `click_button'

I tried to trace also but it is not giving any clear picture...
Plz help... 
",adityaswaroop,jnicklas
46,2010-02-25 23:56:59,"@jnicklas: no idea who robotarmy actually is. I'd just attribute robotarmy then.
",aslakhellesoy,jnicklas
44,2011-08-05 13:09:57,"@jnicklas, @retrospect : I just ran into the same problem, but realized that freezing date/time with Timecop was responsible of the issue.

I think Timecop messes up with Capybara's timeout function. I don't think there is any real fix here... Clearly, ""freezing"" time is dangerous, and I would recommend using this trick with caution.
",gdeest,jnicklas
36,2011-04-21 06:38:03,"@cavalle there have definitely been changes to how this behaves, it's not impossible that we messed something up in the process. What is it setting the host name to for you?
",jnicklas,cavalle
36,2011-04-21 07:12:15,"@jnicklas I tried setting the `default_host` but it still seemed to use `www.example.com`. Not only that, but the `visit` call no longer worked when using a path (instead of the full url).
",ryanb,jnicklas
27,2011-05-10 15:18:06,"@carlosantoniodasilva, just faced this same issue. out of curiosity, how did you work around it?
",mhfs,carlosantoniodasilva
27,2011-05-13 14:05:02,"@carlosantoniodasilva np. thanks anyway. =)
",mhfs,carlosantoniodasilva
1845,2017-03-13 18:23:08,"After looking at this further, it may actually be Poltergeist and capybara-webkit that are producing the incorrect result here.  selenium-webdriver is following the webdriver spec which states that `title` is the title of the top level browsing context, not of the current browsing context.  

@route @mhoran  @jferris   Do any of you have any input on which should be the correct interpretation of `#title`",twalpole,mhoran
1845,2017-03-13 18:23:08,"After looking at this further, it may actually be Poltergeist and capybara-webkit that are producing the incorrect result here.  selenium-webdriver is following the webdriver spec which states that `title` is the title of the top level browsing context, not of the current browsing context.  

@route @mhoran  @jferris   Do any of you have any input on which should be the correct interpretation of `#title`",twalpole,route
1844,2017-03-07 22:11:35,"@jferris @mhoran @jonleighton @route FYI: I plan to do a Capybara 2.13.0 within the next week or so. 

The only change that affects drivers currently is the expectation of the ability to return elements from evaluate_script.   For Poltergeist that ability is already in the master branch, and capybara-webkit has an open PR to support it.

The other major change (which doesn't affect drivers) is the addition of MiniTest assertions and expectations to provide parity with the support provided for RSpec.
",twalpole,route
1844,2017-03-07 22:11:35,"@jferris @mhoran @jonleighton @route FYI: I plan to do a Capybara 2.13.0 within the next week or so. 

The only change that affects drivers currently is the expectation of the ability to return elements from evaluate_script.   For Poltergeist that ability is already in the master branch, and capybara-webkit has an open PR to support it.

The other major change (which doesn't affect drivers) is the addition of MiniTest assertions and expectations to provide parity with the support provided for RSpec.
",twalpole,jonleighton
1844,2017-03-07 22:11:35,"@jferris @mhoran @jonleighton @route FYI: I plan to do a Capybara 2.13.0 within the next week or so. 

The only change that affects drivers currently is the expectation of the ability to return elements from evaluate_script.   For Poltergeist that ability is already in the master branch, and capybara-webkit has an open PR to support it.

The other major change (which doesn't affect drivers) is the addition of MiniTest assertions and expectations to provide parity with the support provided for RSpec.
",twalpole,mhoran
1825,2017-01-03 22:18:55,@abotalov Have you come across this or do you have any ideas about the cause?,twalpole,abotalov
1823,2017-01-03 22:12:02,"@abotalov Can you think of any other style changes that would make sense for the default (true) option to make.  It could do things like make the position absolute and move the element to the top of the page, etc - but that might be going too far and better suited for people to specify as custom changes if needed.  I believe the majority of cases (of hidden file inputs) I see currently are just the field with opacity set to 0 and then overlayed over whatever element is being styled as the upload button.",twalpole,abotalov
1821,2017-01-03 00:08:38,"@jferris @mhoran @jonleighton @route FYI: I plan to do a Capybara 2.12.0 within the next week or two. Two changes that affect drivers are 

1. Optional driver support for simple argument passing to execute_script/evaluate_script (including page elements).
2. Session#switch_to_frame - requires the driver to support the Driver#switch_to_frame API

There were also some tests added around #disabled? behavior when field elements are inside disabled fieldsets.",twalpole,route
1821,2017-01-03 00:08:38,"@jferris @mhoran @jonleighton @route FYI: I plan to do a Capybara 2.12.0 within the next week or two. Two changes that affect drivers are 

1. Optional driver support for simple argument passing to execute_script/evaluate_script (including page elements).
2. Session#switch_to_frame - requires the driver to support the Driver#switch_to_frame API

There were also some tests added around #disabled? behavior when field elements are inside disabled fieldsets.",twalpole,jonleighton
1821,2017-01-03 00:08:38,"@jferris @mhoran @jonleighton @route FYI: I plan to do a Capybara 2.12.0 within the next week or two. Two changes that affect drivers are 

1. Optional driver support for simple argument passing to execute_script/evaluate_script (including page elements).
2. Session#switch_to_frame - requires the driver to support the Driver#switch_to_frame API

There were also some tests added around #disabled? behavior when field elements are inside disabled fieldsets.",twalpole,mhoran
1814,2017-01-05 21:09:32,"IMO this alone might be not a quiet good solution to the underlying issue.
User should be able to use both Capybara's and RSpec-Expectations APIs. `all`/`within` have useful implementations in both libraries.

Let's see what ways we have:
* User includes RSpec::Matchers after Capybara::DSL. Here we can:
  - Recommend to use `all` and `within` via a session object (page)
  - Add `within_element` method as alias for `within`. Also replace `all` with `find_all` / `within` with `within_element` in Capybara's docs. But `page.all` / `page.within` is not worse so this is too crazy.
* User includes Capybara::DSL after RSpec::Matchers. Here we can:
  - Recommend to alias `all` / `within` rspec matchers using `alias_matcher`. One may try to add these aliases into RSpec itself.
  - Implement blocks suggested in https://github.com/rspec/rspec-expectations/issues/820 in RSpec-Expectations and recommend to access shadowed rspec methods using such blocks
  - Advice to call `RSpec::Matchers::BuiltIn::All.new` instead of `all`

Regarding your point in https://github.com/rspec/rspec-expectations/pull/960:
`claim RSpec owns the within method name is ludicrous` - [one may say that its RSpec that owns the namespace](https://github.com/teamcapybara/capybara/issues/1396#issuecomment-57104345). I agree that it would have been better if RSpec had chosen names that don't collide with Capybara's methods. But now both libraries own their methods and can't just remove/rename them.

Going forward, I think it might be good [to have build checks for such clashes](https://github.com/teamcapybara/capybara/issues/1396#issuecomment-57098125) so there would be less chance of new colliding methods.

cc @JonRowe ",abotalov,JonRowe
1804,2016-12-14 12:44:56,"This commit injects the CSS as internal, and the images as Base64 allowing to have an HTML screenshot looking much better.

Regarding the code, I don't like to pass the session as parameter to the helper methods, but it was even worst to me to have those methods in the `Capybara::Session` class. I was tempted to create a `Capybara::HtmlTransformer` class which would embed this code and called from the `Capybara::Session`.

Can someone (@twalpole maybe?) tells me the way I should implement this better (if needed)?",zedtux,twalpole
1775,2016-10-13 16:51:28,"Potential fix for Issue #1773 - waiting for feedback from @dylanlive before merging
",twalpole,dylanlive
1759,2016-09-13 18:03:49,"@jferris @mhoran @jonleighton @route  FYI: I plan to do a Capybara 2.9.0 release end of this week/beginning of next - There should be no changes that affect drivers.
",twalpole,route
1759,2016-09-13 18:03:49,"@jferris @mhoran @jonleighton @route  FYI: I plan to do a Capybara 2.9.0 release end of this week/beginning of next - There should be no changes that affect drivers.
",twalpole,jonleighton
1759,2016-09-13 18:03:49,"@jferris @mhoran @jonleighton @route  FYI: I plan to do a Capybara 2.9.0 release end of this week/beginning of next - There should be no changes that affect drivers.
",twalpole,mhoran
1722,2016-07-15 19:33:06,"This changes the expected frame api for drivers from `within_frame` to `switch_to_frame` accepting either the frame elment, :parent, or :top to switch to the given frame, the parent frame, or the outermost frame.   

@jferris @mhoran @jonleighton @route  Please give your thoughts?  I'd like to make this change in Capybara 2.8, however if there are reasons this couldn't be implemented relatively quickly in any drivers I may have to reconsider.  Note this only changes the driver API not the user `within_frame` API which will continue to accept index, id/name, or an element.  Once the drivers have implemented the new method we can possibly look at improving the user facing API as discussed in Issue #1365 in a future Capybara release
",twalpole,route
1722,2016-07-15 19:33:06,"This changes the expected frame api for drivers from `within_frame` to `switch_to_frame` accepting either the frame elment, :parent, or :top to switch to the given frame, the parent frame, or the outermost frame.   

@jferris @mhoran @jonleighton @route  Please give your thoughts?  I'd like to make this change in Capybara 2.8, however if there are reasons this couldn't be implemented relatively quickly in any drivers I may have to reconsider.  Note this only changes the driver API not the user `within_frame` API which will continue to accept index, id/name, or an element.  Once the drivers have implemented the new method we can possibly look at improving the user facing API as discussed in Issue #1365 in a future Capybara release
",twalpole,jonleighton
1722,2016-07-15 19:33:06,"This changes the expected frame api for drivers from `within_frame` to `switch_to_frame` accepting either the frame elment, :parent, or :top to switch to the given frame, the parent frame, or the outermost frame.   

@jferris @mhoran @jonleighton @route  Please give your thoughts?  I'd like to make this change in Capybara 2.8, however if there are reasons this couldn't be implemented relatively quickly in any drivers I may have to reconsider.  Note this only changes the driver API not the user `within_frame` API which will continue to accept index, id/name, or an element.  Once the drivers have implemented the new method we can possibly look at improving the user facing API as discussed in Issue #1365 in a future Capybara release
",twalpole,mhoran
1721,2016-07-14 00:46:53,"@jferris @mhoran @jonleighton @route Heads up - I plan to release Capybara 2.8.0 some time next week.  The only real changes are for ease of usability Capybara will now attempt to click on the labels of checkboxes/radio-buttons if the checksbox/radio button is non-visible, and removal of the need to pass a nil to most node action when a selector is not wanted.  Currently poltergeist is passing all the 2.8.0 tests, however capybara-webkit is failing one that was added for an issue that came up.  There is already an open issue about this behavior in capybara-webkit - https://github.com/thoughtbot/capybara-webkit/issues/365
",twalpole,route
1721,2016-07-14 00:46:53,"@jferris @mhoran @jonleighton @route Heads up - I plan to release Capybara 2.8.0 some time next week.  The only real changes are for ease of usability Capybara will now attempt to click on the labels of checkboxes/radio-buttons if the checksbox/radio button is non-visible, and removal of the need to pass a nil to most node action when a selector is not wanted.  Currently poltergeist is passing all the 2.8.0 tests, however capybara-webkit is failing one that was added for an issue that came up.  There is already an open issue about this behavior in capybara-webkit - https://github.com/thoughtbot/capybara-webkit/issues/365
",twalpole,jonleighton
1721,2016-07-14 00:46:53,"@jferris @mhoran @jonleighton @route Heads up - I plan to release Capybara 2.8.0 some time next week.  The only real changes are for ease of usability Capybara will now attempt to click on the labels of checkboxes/radio-buttons if the checksbox/radio button is non-visible, and removal of the need to pass a nil to most node action when a selector is not wanted.  Currently poltergeist is passing all the 2.8.0 tests, however capybara-webkit is failing one that was added for an issue that came up.  There is already an open issue about this behavior in capybara-webkit - https://github.com/thoughtbot/capybara-webkit/issues/365
",twalpole,mhoran
1697,2016-05-09 15:32:00,"Unfortunately the current way of doing this is prone to race conditions. See #1696. Selenium does not provide any API to check if a modal is open, and simply trying to close it and catching the error is very, very slow on Firefox. One quirk though is that Selenium returns the text of any open modal as the return value of `navigate.to`. Why? I have no idea. Is this even an official/intentional API? I don't know. (Maybe @jarib knows?). So it turns out that the fastest way of safely navigating away from a page and catching any alerts caused by this is by checking that the return value of `navigate.to` is neither `""""` nor `nil` (the behaviour seems to differ between selenium drivers). I've checked that this works with Chrome, Firefox and IE via the remote driver at least.

Honestly I'm not sure if this is the right way of solving this, but I'm kind of out of other ideas.
",jnicklas,jarib
1674,2016-04-05 00:04:45,"@jferris @mhoran @jonleighton @route  Heads up - I plan to release Capybara 2.7.0 in the next few days.  

I believe the only changes that are relevant for drivers are the deprecation of #browser_initialized from the driver public API, and the requirement that Driver#reset! now be synchronous.  Tests were added for this behavior and both capybara-webkit and poltergeist appear to pass, so no updates should be needed.  

The biggest change from a driver maintenance perspective is the middleware added to the server instance Capybara starts.  This tracks open requests and will hopefully prevent requests continuing in the server after session resets/during database clearing and reduce the issue reports filed because of this.
",twalpole,route
1674,2016-04-05 00:04:45,"@jferris @mhoran @jonleighton @route  Heads up - I plan to release Capybara 2.7.0 in the next few days.  

I believe the only changes that are relevant for drivers are the deprecation of #browser_initialized from the driver public API, and the requirement that Driver#reset! now be synchronous.  Tests were added for this behavior and both capybara-webkit and poltergeist appear to pass, so no updates should be needed.  

The biggest change from a driver maintenance perspective is the middleware added to the server instance Capybara starts.  This tracks open requests and will hopefully prevent requests continuing in the server after session resets/during database clearing and reduce the issue reports filed because of this.
",twalpole,jonleighton
1674,2016-04-05 00:04:45,"@jferris @mhoran @jonleighton @route  Heads up - I plan to release Capybara 2.7.0 in the next few days.  

I believe the only changes that are relevant for drivers are the deprecation of #browser_initialized from the driver public API, and the requirement that Driver#reset! now be synchronous.  Tests were added for this behavior and both capybara-webkit and poltergeist appear to pass, so no updates should be needed.  

The biggest change from a driver maintenance perspective is the middleware added to the server instance Capybara starts.  This tracks open requests and will hopefully prevent requests continuing in the server after session resets/during database clearing and reduce the issue reports filed because of this.
",twalpole,mhoran
1670,2016-03-30 22:20:13,"@mhoran @route @jonleighton @jferris  Is reset! in your drivers currently synchronous, if not is it something that could be easily implemented?
",twalpole,mhoran
1670,2016-03-30 22:20:13,"@mhoran @route @jonleighton @jferris  Is reset! in your drivers currently synchronous, if not is it something that could be easily implemented?
",twalpole,route
1670,2016-03-30 22:20:13,"@mhoran @route @jonleighton @jferris  Is reset! in your drivers currently synchronous, if not is it something that could be easily implemented?
",twalpole,jonleighton
1667,2016-03-18 21:58:32,"https://github.com/jnicklas/capybara/commit/89d00c4f0801a1d00f57c4bedb81c23b888e18df   - host (which over time became the server_host value) was specifically set to 127.0.0.1 many years ago  to ""prevents some issues"" .  I have no clue what those issues were, or if they would still be issues.  Other than that this makes sense to me - lets see if @jnicklas has any recollection of what the issues were? :)
",twalpole,jnicklas
1665,2016-03-17 00:07:25,"Hi @jnicklas, any thoughts on bringing this into the next release?  
",Tmee,jnicklas
1661,2016-03-01 09:34:53,"Hi @jnicklas 
I got  a module named `addressable` in `app/models/concerns`, to manage `addresses` `phones` and `faxes`. After I upgrade `capybara` to latest version, all my feature tests were failed. And failure message: 



I noticed version 2.6.2 is forced dependency on gem `addressable`, did it override my `Addressable` ? and what need I do?

Any thoughts? 
",cod7ce,jnicklas
1642,2016-01-22 11:12:27,"Just a syntactic sugar method that would make RSpec expectations a little better to read.

Usage in RSpec would be:



Compared to the current available:



@twalpole 
",syndbg,twalpole
1634,2016-01-14 18:16:45,"@jferris @mhoran @jonleighton @route   -  Just a heads up that I plan to hopefully release Capybara 2.6 this coming weekend.  I don't believe there is anything that should affect driver authors, it's mainly to get released support for rack 2.0 (rails 5) in the rack_test driver.
",twalpole,route
1634,2016-01-14 18:16:45,"@jferris @mhoran @jonleighton @route   -  Just a heads up that I plan to hopefully release Capybara 2.6 this coming weekend.  I don't believe there is anything that should affect driver authors, it's mainly to get released support for rack 2.0 (rails 5) in the rack_test driver.
",twalpole,jonleighton
1634,2016-01-14 18:16:45,"@jferris @mhoran @jonleighton @route   -  Just a heads up that I plan to hopefully release Capybara 2.6 this coming weekend.  I don't believe there is anything that should affect driver authors, it's mainly to get released support for rack 2.0 (rails 5) in the rack_test driver.
",twalpole,mhoran
1634,2016-01-17 23:52:31,"@jferris @mhoran @jonleighton @route - 2.6.0 is released
",twalpole,jonleighton
1575,2015-09-19 03:56:59,"And right after I submit this I notice that @twalpole submitted the same thing earlier today. Oops. Well, here's another idea of how to approach it.
",jillianrosile,twalpole
1566,2015-08-21 19:55:32," @jferris @jonleighton @mhoran  @route  It's been a while since the last Capybara release and some of the features I wanted to add have been delayed (proxy support for selenium driver).  My current plan is to release the current set of updates as 2.5 in the next few days/week, and then do a 2.6 with the other planned updates in the next couple of months.   I don't think there is much in 2.5 that will affect your drivers other than Node#send_keys and that there is now a test for Node#path behavior.  If you have any concerns with the 2.5 release please let me know
",twalpole,route
1566,2015-08-21 19:55:32," @jferris @jonleighton @mhoran  @route  It's been a while since the last Capybara release and some of the features I wanted to add have been delayed (proxy support for selenium driver).  My current plan is to release the current set of updates as 2.5 in the next few days/week, and then do a 2.6 with the other planned updates in the next couple of months.   I don't think there is much in 2.5 that will affect your drivers other than Node#send_keys and that there is now a test for Node#path behavior.  If you have any concerns with the 2.5 release please let me know
",twalpole,jonleighton
1566,2015-08-21 19:55:32," @jferris @jonleighton @mhoran  @route  It's been a while since the last Capybara release and some of the features I wanted to add have been delayed (proxy support for selenium driver).  My current plan is to release the current set of updates as 2.5 in the next few days/week, and then do a 2.6 with the other planned updates in the next couple of months.   I don't think there is much in 2.5 that will affect your drivers other than Node#send_keys and that there is now a test for Node#path behavior.  If you have any concerns with the 2.5 release please let me know
",twalpole,mhoran
1547,2015-07-15 15:21:41,"Hi

 `capybara` uses a method `rspec` also uses: `all` - see [RSpec's documentation](https://www.relishapp.com/rspec/rspec-expectations/docs/built-in-matchers/all-matcher) for more on this matcher. 

Unfortunately this is at least an issue  for all projects using `aruba` (> 0.8) together with `capybara` as it makes heavy use of `rspec-expectations` - e.g.`middleman` middleman/middleman#1562. Maybe this is even an issue for your own `rspec`-integration. It looks very similar to #1526.

Here's some code which breaks if both `aruba` and `capybara` are used. Though it's a problem of `capybara` plus `rspec-exectations` really from my point of view. @myronmarston @mattwynne Just a ping for you to know.

For now I don't see a way to work around this. Any suggestion is more than welcome. This code checks if all or none of the given strings are existing files. Unfortunately `all` should be used from `rspec` and not from `caypbara` in this context.



This code above now fails with:



Looking at the source of `~/.gem/ruby/2.2.2/gems/capybara-2.4.4/lib/capybara/dsl.rb` there seem to be some lines of code relevant here:



At `~/.gem/ruby/2.2.2/gems/capybara-2.4.4/lib/capybara/session.rb:24` you will find this:


",maxmeyer,myronmarston
1508,2015-04-24 18:02:29,"@mhoran @jferris @route @jonleighton I'm working on adding whitelisting of urls to the selenium driver using browsermob_proxy - and was wondering whether the proxy is something that would be of use to other drivers, or to just hide it all inside the selenium driver - feedback appreciated
",twalpole,mhoran
1508,2015-04-24 18:02:29,"@mhoran @jferris @route @jonleighton I'm working on adding whitelisting of urls to the selenium driver using browsermob_proxy - and was wondering whether the proxy is something that would be of use to other drivers, or to just hide it all inside the selenium driver - feedback appreciated
",twalpole,route
1508,2015-04-24 18:02:29,"@mhoran @jferris @route @jonleighton I'm working on adding whitelisting of urls to the selenium driver using browsermob_proxy - and was wondering whether the proxy is something that would be of use to other drivers, or to just hide it all inside the selenium driver - feedback appreciated
",twalpole,jonleighton
1502,2015-04-16 18:17:05,"@abotalov thanks for the review - Fix for those comments coming shortly
",twalpole,abotalov
1498,2015-04-08 16:46:03,"IIRC the performance hit (especially with chrome) was enough to make Capybara basically unusable so we won't be changing the default currently.  Issue #1319 and PR #1338 were where the need for fill_options was discussed and @sobrinho was the person initially requesting for poltergeist.  I'm not sure if it was ever used in poltergeist or not.  I would be open to a pull request that implements multiple clear methods for selenium and potentially a setting that will allow changing the default option (as long as its default is the current behavior)
",twalpole,sobrinho
1498,2015-04-08 16:52:31,"as @abotalov mentioned it would probably be nice to have a :none option for clear too thereby allowing for appending to existing content, it might also be nice to accept an array of keystrokes so I could pass [[:command, 'A'], :backspace], as my clear method and those keystrokes would just get forwarded on to send_keys
",twalpole,abotalov
1493,2015-03-17 20:12:37,"@abotalov You did a great job getting this passing originally with the awesome window manager.  Any chance you have time to look at it again and see if you can figure out what has changed that is causing it to fail with firefox every time (I believe it passes with chrome).  I have marked the test as pending for the firefox/travis combo currently.
",twalpole,abotalov
1472,2015-01-23 21:17:37,"Implementation of item discussed in Issue #1459  -  @jferris @jonleighton @mhoran Thoughts on implementing this in your drivers for Capybara 2.5 ?
",twalpole,jonleighton
1472,2015-01-23 21:17:37,"Implementation of item discussed in Issue #1459  -  @jferris @jonleighton @mhoran Thoughts on implementing this in your drivers for Capybara 2.5 ?
",twalpole,mhoran
1466,2015-01-18 13:09:28,"### jnicklas/capybara now has a Chat Room on Gitter

@abotalov has just created a chat room. You can visit it here: [https://gitter.im/jnicklas/capybara](https://gitter.im/jnicklas/capybara?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&content=body_link).

This pull-request adds this badge to your README.md:

[![Gitter](https://badges.gitter.im/Join%20Chat.svg)](https://gitter.im/jnicklas/capybara?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=body_badge)

Happy chatting.

PS: [Click here](https://gitter.im/settings/badger/opt-out) if you would prefer not to receive automatic pull-requests from Gitter in future.
",gitter-badger,abotalov
1459,2015-01-14 18:33:59,"@jferris @jonleighton @mhoran  - any thoughts on supporting a unified definition/mapping for special keys?
",twalpole,jonleighton
1459,2015-01-14 18:33:59,"@jferris @jonleighton @mhoran  - any thoughts on supporting a unified definition/mapping for special keys?
",twalpole,mhoran
1431,2014-10-27 07:47:32,"What was the conclusion?  I also have the same problem, and started on 10/17/14 for me. cc: @twalpole and @tonybearpan.
",styliii,twalpole
1415,2014-10-01 17:40:07,"This is a fix issue 1237 best liked by @twalpole 
",sbonebrake,twalpole
1410,2014-11-05 18:47:36,"@twalpole Do you want me to provide reasoning on why I think it would be a good idea to make elements returned by `all` reloadable? Or do you need something else from me?
",abotalov,twalpole
1407,2014-09-25 16:00:04,"Not sure why it's disabled, but since I expected to find it working I think it would be useful to enable it

cc: @twalpole (6c0674db9bb6896d4ced8f8ab12fc0e3eec6d71e)
",elia,twalpole
1403,2014-09-22 01:31:46,"Quite a few of my tests broke when upgrading to Capybara 2.4.2. Looks like I was taking advantage of the fact Rails was allowing concurrent requests. I have a few endpoints in my app that I call while a request is happening (I make a HTTP request to m app's API during a request to get data).

Looks like a recent change has stopped Rails from allowing concurrent requests here: https://github.com/jnicklas/capybara/commit/385a7507f6525d9b2d1e23bef0bb2e6fe5ad0c97

I suppose I'm trying to figure out why this was changed, and if there's a way I can change this behaviour? I couldn't find a related issue.

Cheers!

cc. @twalpole
",keithpitt,twalpole
1396,2014-09-11 18:54:59,"@myronmarston That's the second time when RSpec adds a method with a name that already exists in Capybara - see https://github.com/jnicklas/capybara/issues/1361
",abotalov,myronmarston
1396,2014-09-11 19:13:07,"> @myronmarston That's the second time when RSpec adds a method with a name that already exists in Capybara - see #1361

Sorry about that :(.  I'm not sure what we could have or should have done differently, given that RSpec continues to gain new features (often in the form of new APIs) as requested by the community.  Any suggestions?
",myronmarston,myronmarston
1365,2014-07-29 17:41:15,"The fact that `within_frame` is exposed to driver level isn't good (Jonas said it in the past too - https://github.com/jnicklas/capybara/issues/984#issuecomment-14349992, see also Jon Leighton's comment above it). So IMO that issue is best to be resolved by:
1. deprecating drivers' `within_frame` method
2. adding `switch_to_frame(element)`, `switch_to_parent_frame` to drivers' interfaces

The use case for `switch_to_frame` (and `switch_to_window`) is that you can switch in one method, then do some operations in various other methods and then switch back in possibly another method.  Consider this:



This scenario (or just a test) is not declarative enough but if a person already has `I do something useful` stepdef (for another scenario that works with the page not opened in a frame) they can reuse it instead of writing a new stepfef. (P.S.: I know that Matt Wynne tells that scenarios should be declarative but still many people write not declarative scenarios and use Cucumber without following BDD). I haven't had a need to use `switch_to_frame` actually myself.

Also it seems there were users requesting it:
https://github.com/thoughtbot/capybara-webkit/issues/620

cc @mhoran @jferris @route @yaauie

---

> Perhaps updating within_frame to take an array of selectors for nested frames makes sense

Do you mean that?


",abotalov,mhoran
1365,2014-07-29 17:41:15,"The fact that `within_frame` is exposed to driver level isn't good (Jonas said it in the past too - https://github.com/jnicklas/capybara/issues/984#issuecomment-14349992, see also Jon Leighton's comment above it). So IMO that issue is best to be resolved by:
1. deprecating drivers' `within_frame` method
2. adding `switch_to_frame(element)`, `switch_to_parent_frame` to drivers' interfaces

The use case for `switch_to_frame` (and `switch_to_window`) is that you can switch in one method, then do some operations in various other methods and then switch back in possibly another method.  Consider this:



This scenario (or just a test) is not declarative enough but if a person already has `I do something useful` stepdef (for another scenario that works with the page not opened in a frame) they can reuse it instead of writing a new stepfef. (P.S.: I know that Matt Wynne tells that scenarios should be declarative but still many people write not declarative scenarios and use Cucumber without following BDD). I haven't had a need to use `switch_to_frame` actually myself.

Also it seems there were users requesting it:
https://github.com/thoughtbot/capybara-webkit/issues/620

cc @mhoran @jferris @route @yaauie

---

> Perhaps updating within_frame to take an array of selectors for nested frames makes sense

Do you mean that?


",abotalov,route
1365,2014-07-29 23:36:00,":+1: to making the frame API behave more like the window API. I'd also like to cut down on the incompatibilities between drivers when it comes to frame handling, as noted in https://github.com/jnicklas/capybara/issues/984#issuecomment-14357652. And as @jnicklas pointed out, this code really needs to be cleaned up.

I agree with @abotalov regarding `switch_to_frame` vs `within_frame`. I feel there are benefits to both depending on the situation, and as we've provided both `switch_to_window` and `within_window` (implemented via `switch_to_window`), I think users may expect that behavior.

Perhaps `within_frame` could take a proc as an argument, as `within_window`. I think this is a nice way to handle the option of selecting a particular frame that matches a selector, versus overloading arguments.

Thanks for the heads up, @abotalov.
",mhoran,jnicklas
1348,2014-07-26 21:36:31,"I've digged into this issue a bit more and now would like to say the following:

> Actually, an absolute URL can have an empty scheme: when encountering //example.com, browsers will use the same scheme as the current page (thus https://example.com if you're currently on an HTTPS page, or http://example.com otherwise).

URI reference without scheme is called a relative URI reference (see http://tools.ietf.org/html/rfc3986#section-4.2), not absolute one. Absolute URI reference must start from scheme.

From YARD-ocs of `#visit` method:

> Navigate to the given URL. The URL can either be a relative URL or an absolute URL.

Actually that statement is currently incorrect. Transforming of relative URI reference to the absolute one made by `#visit` doesn't handle most of cases specified by http://tools.ietf.org/html/rfc3986#section-5. However, supporting relative URI references' resolution properly will drastically complicate the algorithm. And I don't see enough reasons to make `visit` compliant with RFC as handling most of those cases is IMHO not needed by Capybara users.

Also changing the algorithm to one from RFC may be backwards incompatible for someone.

For example, some users may currently do something like:



In current Capybara version this would open `http://www.example.com/en/something`. This is against RFC but someone may have relied on such implementation (maybe, they looked into Capybara's code, saw that `visit` concatenates strings and relied on such behavior without checking RFCs. Also such ""resolution"" may seem natural.). Therefore I would vote against changing it in 2.x. Note that this PR changes behavior for this case.

However, I think the case pointed by @dstosik is worth supporting as it may be useful in some circumstances.

So I would vote for inserting a ""crutch"" like this in 2.5 instead of this PR:



@twalpole WDYT?
",abotalov,twalpole
1338,2014-06-19 12:02:54,"@twalpole seems fine for me, just the double check that @abotalov mentioned has to be changed :shipit: 
",sobrinho,abotalov
1336,2014-06-18 18:58:35,"`Session#visit` doesn't work correctly with e.g. `about` scheme:



I propose to change :



to:



I think this is a backwards-compatible fix. @twalpole do you agree?
",abotalov,twalpole
1328,2014-06-11 19:00:33,"@jnicklas  The real issue with this is that HaveSelector needs to catch the Capybara::ExpectationNotMet exception and then ends up raising an RSpec::Expectations::ExpectationNotMetError  exception.   This may necessitate waiting for a major version update if there was a guarantee of HaveSelector raising Capybara::ExpecationNotMet on failure.   I don't see it documented (or specifically tested) anywhere.  What would your thoughts on it be?
",twalpole,jnicklas
1307,2014-05-20 05:39:40,"I confirm a 100% speed increase on my side:





On Mon, May 19, 2014 at 11:31 AM, Thomas Walpole
notifications@github.comwrote:

> @abotalov https://github.com/abotalov It's possible I screwed something
> up there, but I don't think so - what makes you think it would?
> unnormalized_text aborts traversing through children if a node is hidden -
> so it would never look at ""Invisible text""
> 
> —
> Reply to this email directly or view it on GitHubhttps://github.com/jnicklas/capybara/issues/1307#issuecomment-43539538
> .
",pcreux,abotalov
1299,2014-04-24 21:19:04,"Currently the `process` method in `Capybara::RackTest::Browser` takes an argument called `path` and assumes it is a string as it treats it as such by using it as an argument to `URI.parse` and sending it methods like `start_with?`.

This patch coerces the path argument with `to_s`.

@twalpole I thought this a more appropriate near term fix for my desired long term fix by tackling the issue at the driver level.
",alexpeachey,twalpole
1297,2014-04-22 21:08:29,"The reason it was rejected was the problem with passing and returning elements, not different values of options as was explained by @mhoran in #938 - also execute_script is way more core to using capybara than save_screenshot - and as such I'd like to keep supported use as compatible across drivers as we can
",twalpole,mhoran
1289,2014-04-09 17:22:20,"pulling in @jonleighton @mhoran @jferris @jcoglan , if any of you are planning on implementing touch methods do you have any feedback on this?
",twalpole,mhoran
1289,2014-04-09 17:22:20,"pulling in @jonleighton @mhoran @jferris @jcoglan , if any of you are planning on implementing touch methods do you have any feedback on this?
",twalpole,jcoglan
1289,2014-04-09 17:22:20,"pulling in @jonleighton @mhoran @jferris @jcoglan , if any of you are planning on implementing touch methods do you have any feedback on this?
",twalpole,jonleighton
1285,2014-04-03 06:33:33,"Currently the Capybara's DSL `feature` does not work with the new RSpec 3 configuration [`expose_dsl_globally = false`](https://relishapp.com/rspec/rspec-core/v/3-0/docs/configuration/global-namespace-dsl#when-exposing-globally-is-disabled-the-top-level-dsl-no-longer-works) which removes the `describe` from Ruby's `main` object. 

Please see https://github.com/rspec/rspec-rails/issues/984 for background.

As @myronmarston suggested, it seems Capybara needs to use [`RSpec::Core::Configuration#alias_example_group_to`](https://github.com/rspec/rspec-core/blob/77cc21e97a6e4c66acb21c8a89e8e45bffade820/lib/rspec/core/configuration.rb#L726-L756) in [lib/capybara/rspec/features.rb](https://github.com/jnicklas/capybara/blob/12b975da27eacb482cb325f6c68b7fd44389506f/lib/capybara/rspec/features.rb#L10).
#### Environment
- capybara 2.2.0 (https://github.com/jnicklas/capybara/tree/12b975da27eacb482cb325f6c68b7fd44389506f)
- rspec-core 3.0.0.beta2 (https://github.com/rspec/rspec-core/tree/77cc21e97a6e4c66acb21c8a89e8e45bffade820)
",yujinakayama,myronmarston
1275,2014-03-25 19:23:39,"@jnicklas We can explicitly enable `should` instead of merging @twalpole's PR. I don't think that enabling `should` in Capybara specs is a bad decision.

But it doesn't change the fact that `should` is deprecated.
",abotalov,twalpole
1273,2014-03-22 10:57:15,"I made some comments about my concerns. It would be better to wait for @jnicklas to see if he will approve them.
",abotalov,jnicklas
1273,2014-03-24 02:48:00,"@abotalov Thanks for the comments! I fixed some of the things. Let's wait to see what @jnicklas has to say about some of the other ones, since I tried to not change the original API at all.
",gylaz,jnicklas
1259,2014-03-02 14:19:02,"@rbu @twalpole I don't know, this is a very edge use case, so it could be buggy in Capybara. @rbu which driver are you using? Could you provide an executable reproduction?
",jnicklas,twalpole
1237,2014-09-23 17:28:48,"I'm leaning towards the first solution, because of the backwards compatibility it provides.  @jferris, @jonleighton, @mhoran - any input on this ?
",twalpole,jonleighton
1237,2014-09-23 17:28:48,"I'm leaning towards the first solution, because of the backwards compatibility it provides.  @jferris, @jonleighton, @mhoran - any input on this ?
",twalpole,mhoran
1235,2014-02-03 14:06:45,"Wow, awesome pull request! Thanks @abotalov. This thing is huge, so I'll have to review this properly. At a first glance, I really like it though. The proposed `window_opened_by` is very nice IMO, exactly what you'd want in most cases. Also, the fact that it synchronizes is very nice. I think the proposed API is definitely _much_ better than what we have now.

Does this include some method of returning all currently open windows? I didn't find it in the code. I think that would be desirable. We don't have it now either so it's not necessary for this to get merged.

One question is what we do with version numbers. I agree that the current window API can barely be described as working, so maybe we aren't _breaking_ anything per se. But still this would probably require a major version bump, right? I'm perfectly okay with doing a major version bump for this though.

@joliss, @twalpole your thoughts on this?
",jnicklas,joliss
1235,2014-02-03 14:06:45,"Wow, awesome pull request! Thanks @abotalov. This thing is huge, so I'll have to review this properly. At a first glance, I really like it though. The proposed `window_opened_by` is very nice IMO, exactly what you'd want in most cases. Also, the fact that it synchronizes is very nice. I think the proposed API is definitely _much_ better than what we have now.

Does this include some method of returning all currently open windows? I didn't find it in the code. I think that would be desirable. We don't have it now either so it's not necessary for this to get merged.

One question is what we do with version numbers. I agree that the current window API can barely be described as working, so maybe we aren't _breaking_ anything per se. But still this would probably require a major version bump, right? I'm perfectly okay with doing a major version bump for this though.

@joliss, @twalpole your thoughts on this?
",jnicklas,twalpole
1235,2014-02-04 09:18:56,"Also pulling in @jonleighton @mhoran @jferris @jcoglan. I don't think this presents any problems for driver authors, right guys? Just want to check and make sure. IIRC both capybara-webkit and poltergeist implement a lot of this stuff themselves anyway, right?
",jnicklas,mhoran
1235,2014-02-04 09:18:56,"Also pulling in @jonleighton @mhoran @jferris @jcoglan. I don't think this presents any problems for driver authors, right guys? Just want to check and make sure. IIRC both capybara-webkit and poltergeist implement a lot of this stuff themselves anyway, right?
",jnicklas,jcoglan
1235,2014-02-04 09:18:56,"Also pulling in @jonleighton @mhoran @jferris @jcoglan. I don't think this presents any problems for driver authors, right guys? Just want to check and make sure. IIRC both capybara-webkit and poltergeist implement a lot of this stuff themselves anyway, right?
",jnicklas,jonleighton
1235,2014-04-03 19:42:45,"@jnicklas @twalpole What do you think about it?
Should we release it in 2.3 and remove support for old `within_window` in 3.0?
Or release it in 3.0 and remove support for old `within_window` in 4.0?
",abotalov,twalpole
1229,2014-01-28 23:05:25,"@jnicklas - this is a very small change. Let me know what you think. Right now we're monkeypatching this part of capybara so would be really happy to get this into master if it looks ok.
",lesliepc16,jnicklas
1221,2014-01-06 02:07:56,"/cc: @myronmarston, @jonrowe, @samphippen, @xaviershay ... is this the right idea for an RSpec 2.x and 3.x compatible matcher?
",alindeman,myronmarston
1221,2014-01-06 02:13:29,"I also wouldn't object to just having the aliases as is. I don't think it'll cause any pain? /cc @myronmarston
",JonRowe,myronmarston
1218,2014-01-06 14:58:01,"Seems like Ruby 2.1.0 is not building with the base versions Gemfile. @joliss, @twalpole I'm thinking that the base versions Gemfile maybe isn't worth the trouble. What do you think, should we kill it? 
",jnicklas,joliss
1218,2014-01-06 14:58:01,"Seems like Ruby 2.1.0 is not building with the base versions Gemfile. @joliss, @twalpole I'm thinking that the base versions Gemfile maybe isn't worth the trouble. What do you think, should we kill it? 
",jnicklas,twalpole
1218,2014-01-06 18:47:28,"> @joliss, @twalpole I'm thinking that the base versions Gemfile maybe isn't worth the trouble.

Here's the original reasoning: I was assuming that at some point we'd accidentally use a feature that wasn't supported by the minimum version of a dependency, without bumping the version spec in `Gemfile` at the same time. So I added the base version Gemfile in order to avoid having to deal with issues like ""Capybara breaks with old version of $dependency"". In other words, it was intended as a time saver. If it's not saving time, we should perhaps remove it.

I don't believe the `Gemfile.base-versions` test has ever actually caught anything, has it? If it hasn't, perhaps that's evidence that we don't need it.

Then again, seeing @twalpole comment's, perhaps this issue is unrelated.

I'll leave it up to you all.
",joliss,joliss
1198,2013-11-26 08:18:45,"Which driver are you using? It's possible some of them haven't caught up with the 2.2.0 changes yet. We now require `reset` to be synchronous, because otherwise it can cause strange failures, but it might not be in all drivers yet.

It's pretty bad that this breaks the driver API. Maybe this assertion should be removed. Pulling in @mhoran, @jferris @jcoglan and @jonleighton.
",jnicklas,mhoran
1198,2013-11-26 08:18:45,"Which driver are you using? It's possible some of them haven't caught up with the 2.2.0 changes yet. We now require `reset` to be synchronous, because otherwise it can cause strange failures, but it might not be in all drivers yet.

It's pretty bad that this breaks the driver API. Maybe this assertion should be removed. Pulling in @mhoran, @jferris @jcoglan and @jonleighton.
",jnicklas,jcoglan
1198,2013-11-26 08:18:45,"Which driver are you using? It's possible some of them haven't caught up with the 2.2.0 changes yet. We now require `reset` to be synchronous, because otherwise it can cause strange failures, but it might not be in all drivers yet.

It's pretty bad that this breaks the driver API. Maybe this assertion should be removed. Pulling in @mhoran, @jferris @jcoglan and @jonleighton.
",jnicklas,jonleighton
1194,2013-11-19 21:10:09,"This enables the rbx-2.1.1 build to run on travis.  @jnicklas : 2.1.0 on travis appears to just be missing since it doesnt even install, so I removed it from travis.yml completely.  2.0.0 appears not to install the ruby standard library since 'gem --version' errors our before we have a chance to run any scripts to install anything so I've moved that to allowed failures.   jruby is failing because stdout appears to be buffered so travis doesnt see any status output from rspec for 10 minutes and aborts the run.  Any ideas on that?
",twalpole,jnicklas
1194,2013-11-19 22:19:22,"@jnicklas I just changed to the documentation rspec formatter, when testing with jruby, which flushes the buffer so travis sees test progress
",twalpole,jnicklas
1194,2013-11-20 00:17:54,"@jnicklas - ok so now that the jruby test actually gets to run fully - it fails being unable to connect to chromedriver  - any thoughts on the cause of that?
",twalpole,jnicklas
1192,2013-11-15 17:34:32,"@jnicklas -  This is all the tests changed to use 'expect' syntax and changes made to get rid of all the deprecation warnings rspec 2.99.0.beta1 throws in advance of rspec 3 being released.  The downside to these changes is that the tests will no longer run with earlier rspecs than 2.99 due to the lack of the be_truthy/be_falsey matchers.  I'm not sure that its going to be possible to have tests that can ruin using either rspec 2.x or 3 without implementing our own be_truthy/be_falsey matchers if rspec doesnt have them.  Do you think this is worth continuing on currently?
",twalpole,jnicklas
1192,2014-04-01 19:34:13,"@abotalov 5 months ago when this PR was first started it was against 2.99 - since then the release of 3 is much closer and so now its testing against the beta of 3 - the base versions is set to rspec 2.2 and whatever the latest version of fuubar is compatible with that is.  
",twalpole,abotalov
1181,2013-10-28 21:58:45,"Thanks for contributing, and welcome ;)

I'm not sure if I like using a warning like this. At least the warning could be more descriptive.

I'd actually forgotten that we'd written tests codifying the behaviour of ignoring writes to readonly elements. Semver then tells us we shouldn't raise an exception.

I'm torn on this one. @twalpole, what do you think?
",jnicklas,twalpole
1180,2013-10-26 22:34:16,"Changes from @wtfiwtz with tests now added
",twalpole,wtfiwtz
1180,2013-10-26 22:40:45,"@jnicklas I created tests for this because it makes sense but @wtfiwtz hasnt come back, however I have one question.   @wtfiwtz implemented this in Form#params so the defaulting is only done at submit time, however ""real browsers"" return 'on' as the value of a checkbox/radio without a specified value any time its queried ( ie   field.value returns 'on' ) -- would you rather this be implemented through changes to Simple#value so its more like a real browser, or left as is ???
",twalpole,jnicklas
1180,2013-10-26 22:40:45,"@jnicklas I created tests for this because it makes sense but @wtfiwtz hasnt come back, however I have one question.   @wtfiwtz implemented this in Form#params so the defaulting is only done at submit time, however ""real browsers"" return 'on' as the value of a checkbox/radio without a specified value any time its queried ( ie   field.value returns 'on' ) -- would you rather this be implemented through changes to Simple#value so its more like a real browser, or left as is ???
",twalpole,wtfiwtz
1127,2013-07-24 18:57:49,"In #1115, @jnicklas suggested we change Result#inspect, to avoid confusion. This is that.

No new tests. Tests pass.
",srawlins,jnicklas
1084,2013-05-15 20:49:17,"@jnicklas The fix I added makes all the tests pass, but I havent fully convinced myself request_path wasn't returning """" instead of ""/"", from the rescue, for some good reason.   Can you think of anything this change would break?
",twalpole,jnicklas
1081,2013-09-30 08:41:28,"@jnicklas did you have any particular concerns with this? I can rebase the branch if you're interested in merging it.
",TimMoore,jnicklas
1078,2013-05-28 18:42:19,"@jnicklas - thanks for the merge. This is effecting dependent gems upgrading to Capy2.1 (eg. jeroenvandijk/capybara-mechanize#51), any chance there's a patch release coming soon?
",phillbaker,jnicklas
1072,2013-05-09 06:52:10,"@mhoran is this the issue you're talking about? https://github.com/jonleighton/poltergeist/issues/176

It does seem like there may be no perfect solution here. I think it is important to be able to test the behavior of clearing out a field.

Another option would be to make it an explicit action: something like `clear_field 'name'` instead of `fill_in 'name', :with => ''`. The drawback is that it would need a new `clear` method on `Node` implementations. We could ease the burden on driver developers by putting a default implementation in `Capybara::Driver::Node` that just calls `self.set('')` and then leave it to driver developers to provide an alternate implementation if necessary to get the desired behavior.

What do you think, @jnicklas?
",TimMoore,jnicklas
1069,2013-04-29 20:55:21,"@jnicklas I moved the modify textarea contents part of this into one place Capybara::HTML -  If there's a different place you think it would fit better (or different name) let me know and I'll make that change
",twalpole,jnicklas
1068,2013-04-25 23:38:44,"I think this is more complicated than just adding the same gsub to Capybara::RackTest::Form#params .  I did a few little tests to compare browser behavior to rack-test

If the \n immediately following the textarea is in the original document and the form is submitted without changing the textarea contents then current behavior is the following
RackTest : submits the leading \n
FF via Selenium : ignores the leading \n (and a final \n if there is one) and all remaining \n are returned as \r\n

However if we set the content of the textarea to something with a leading \n then FF will not ignore that leading \n (or a final \n) and will return those converted to \r\n s

Just changing the params function to gsub out leading \n would potentially interfere with any changed values,
so we have to be careful that any changes dont strip the \n values that get set into the textarea during running.  There is also the question of whether we should be converting all \n to \r\n when the form is submitted as browsers do.  @jnicklas I've done some work on a fix for this, would be interested on your thoughts on the \r\n issue
",twalpole,jnicklas
1065,2013-04-22 21:10:17,"This changes the racktest driver to respond with ""true"" or nil when retrieving boolean attributes as the selenium driver does.  I'm ambivalent about this change but @abotalov feels pretty strongly about having the same behavior from all drivers so I have implemented this.  I'm not loving the ""true""/nil responses (which come from the webdriver spec) and maybe it would be better to change both drivers to respond with true/false for boolean attributes.  Either way getting tests that exactly match the expected returns will encourage other drivers to do the same thing.  I had code in Capybara::Node::Simple that verified the specified attribute name was valid for the current element before treating it as a boolean attrribute, however after looking at Selenium I removed it since they don't seem to verify that.  
",twalpole,abotalov
1065,2013-07-03 12:19:09,"Hmm, this adds so much code, and I don't feel that this is particularly valuable. @abotalov, you felt very strongly about this, do you really think this is necessary? It seems superfluous to me. :-1: 
",jnicklas,abotalov
1065,2013-08-26 14:39:17,"Closing. @abotalov never got back here, and I personally feel this is a bad idea.
",jnicklas,abotalov
1051,2013-04-11 18:31:48,"From a quick look at this, I think Capybara::RSpecMatchers is not being included which means that rspecs method_missing for matchers is called and ends up just directly calling Capybara::Node::Matchers::has_selector? which won't correctly handle the waiting for the should_not.   When Capybara::RSpecMatchers is correctly included Capybara::RSpecMatchers::have_selector is called instead, which means that Capybara::RSpecMatchers::HaveSelector is used as the Matcher and will correctly convert over to calling assert_no_selector which will then correctly wait.   I think this also means that should_not have_no_xxxx  wont work properly since there are no have_no_xxxx methods that would generate a Capyabara::RSpecMatchers::HaveNoSelector  matcher, and therefore they wouldnt wait properly.   @jnicklas does this analysis seem correct?   As for why you're not getting Capybara::RSpecMatchers included properly, I'm not sure 
",twalpole,jnicklas
1051,2013-04-11 22:14:38,"Yes that sounds exactly right. You can clearly see by the error message
that the matchers are not being used.

On Thursday, April 11, 2013, Thomas Walpole wrote:

> From a quick look at this, I think Capybara::RSpecMatchers is not being
> included which means that rspecs method_missing for matchers is called and
> ends up just directly calling Capybara::Node::Matchers::has_selector? which
> won't correctly handle the waiting for the should_not. When
> Capybara::RSpecMatchers is correctly included
> Capybara::RSpecMatchers::have_selector is called instead, which means that
> Capybara::RSpecMatchers::HaveSelector is used as the Matcher and will
> correctly convert over to calling assert_no_selector which will then
> correctly wait. I think this also means that should_not have_no_xxxx wont
> work properly since there are no have_no_xxxx methods that would generate a
> Capyabara::RSpecMatchers::HaveNoSelector matcher, and therefore they
> wouldnt wait properly. @jnicklas https://github.com/jnicklas does this
> analysis seem correct? As for why you're not getting
> Capybara::RSpecMatchers included properly, I'm not sure
> 
> —
> Reply to this email directly or view it on GitHubhttps://github.com/jnicklas/capybara/issues/1051#issuecomment-16252816
> .
",jnicklas,jnicklas
1040,2013-04-28 18:59:17,"hm got it.. and yeah, the `#check` method doesn't filter by value...

I avoid to do my tests filtering by name or id because i always try to simulate the real user behavior..

@jnicklas  what do you think about this? 
",carloslopes,jnicklas
1037,2013-04-02 12:39:02,"Wow this is very impressive. I'm intent on pushing Capybara 2.1 RC1 very soon, so this will not make it into Capybara 2.1, as it will take some further deliberation before we can get this merged. Just wanted to point that out up front.

A few things I noticed:
1. We metaprogram in all other methods in the session, why not do the same with NOTIFICATION_METHODS?
2. This API should be opt-in for driver authors, so it should have it's own `:requires` metadata, so that driver authors can skip it if they desire.
3. I find the utility of confirming multiple prompts/alerts/confirms dubious, especially since we can't mix and match with the suggested API. There is no way to handle both a prompt and a following alert, so why bother with this at all?
4. The surfact area towards drivers is very large, do we really have to add that many methods?
5. I'm concerned about synchronization. Capybara should not leave that up to the driver. If for example the alert appears due to an async process 50ms later than the action that was supposed to trigger it, then Capybara should be able to handle that, and that should work without the driver authors having to do anything special, just as it does with elements.

Finally, let's get the driver authors involved in this discussion, @jferris, @jonleighton, @mhoran, @jcoglan, any comments on this?
",jnicklas,jcoglan
1037,2013-04-02 12:39:02,"Wow this is very impressive. I'm intent on pushing Capybara 2.1 RC1 very soon, so this will not make it into Capybara 2.1, as it will take some further deliberation before we can get this merged. Just wanted to point that out up front.

A few things I noticed:
1. We metaprogram in all other methods in the session, why not do the same with NOTIFICATION_METHODS?
2. This API should be opt-in for driver authors, so it should have it's own `:requires` metadata, so that driver authors can skip it if they desire.
3. I find the utility of confirming multiple prompts/alerts/confirms dubious, especially since we can't mix and match with the suggested API. There is no way to handle both a prompt and a following alert, so why bother with this at all?
4. The surfact area towards drivers is very large, do we really have to add that many methods?
5. I'm concerned about synchronization. Capybara should not leave that up to the driver. If for example the alert appears due to an async process 50ms later than the action that was supposed to trigger it, then Capybara should be able to handle that, and that should work without the driver authors having to do anything special, just as it does with elements.

Finally, let's get the driver authors involved in this discussion, @jferris, @jonleighton, @mhoran, @jcoglan, any comments on this?
",jnicklas,jonleighton
1037,2013-04-02 12:39:02,"Wow this is very impressive. I'm intent on pushing Capybara 2.1 RC1 very soon, so this will not make it into Capybara 2.1, as it will take some further deliberation before we can get this merged. Just wanted to point that out up front.

A few things I noticed:
1. We metaprogram in all other methods in the session, why not do the same with NOTIFICATION_METHODS?
2. This API should be opt-in for driver authors, so it should have it's own `:requires` metadata, so that driver authors can skip it if they desire.
3. I find the utility of confirming multiple prompts/alerts/confirms dubious, especially since we can't mix and match with the suggested API. There is no way to handle both a prompt and a following alert, so why bother with this at all?
4. The surfact area towards drivers is very large, do we really have to add that many methods?
5. I'm concerned about synchronization. Capybara should not leave that up to the driver. If for example the alert appears due to an async process 50ms later than the action that was supposed to trigger it, then Capybara should be able to handle that, and that should work without the driver authors having to do anything special, just as it does with elements.

Finally, let's get the driver authors involved in this discussion, @jferris, @jonleighton, @mhoran, @jcoglan, any comments on this?
",jnicklas,mhoran
1022,2013-03-26 19:49:36,"Looks like @jnicklas merged this branch using [ordinary commit](https://github.com/jnicklas/capybara/commit/5c1229acf94dc4a54531a4d72a1959b9fe1c10f4), not merge button 
",abotalov,jnicklas
1013,2013-03-15 19:32:29,"@jnicklas - You said to just commit simple changes (and this one is pretty simple) - but it could affect other driver writers so I'll leave it up to you to commit :)
",twalpole,jnicklas
1013,2013-03-21 03:44:00,"WebKit doesn't seem to share this behavior. Ping @jonleighton.
",mhoran,jonleighton
996,2013-03-08 20:53:57,"@jnicklas @abotalov mentioned that fieldset supports the disabled attribute, and the spec says ""When specified, causes all the form control descendants of the fieldset element, excluding those that are descendants of the fieldset element's first legend element child, if any, to be disabled.""   This is not currently supported in racktest, and a quick test with selenium seems to show that it gets it wrong too (field is actually disabled in the browser, but the native element returns that its enabled).  Not sure if its worth trying to implement.
",twalpole,abotalov
996,2013-03-10 14:31:27,"I am a concerned about the performance issue that @abotalov has pointed out. I did some benchmarking, with this code: https://gist.github.com/jnicklas/5128764

Running against this pull request:



For comparison, here it is running against master:



We can see that there is some variance, but clearly, this pull request yields an almost x2 decrease in performance when locating buttons. Unless the benchmark is somehow flawed.

To me, that's not really acceptable. @sobrinho and other who wanted this, what do you think?
",jnicklas,sobrinho
991,2013-03-07 15:55:03,"The timeout is 60s, it used to be configurable, but it isn't anymore, for some reason I can't quite remember. @joliss tinkered with that stuff a while ago, maybe she remembers. Remember that at this point your app is probably already _loaded_ we're only talking about actually _booting_ it, which _should_ be very fast.
",jnicklas,joliss
987,2013-03-02 03:57:00,"Error pointed out by @jcoglan
",twalpole,jcoglan
984,2013-02-28 15:49:06,"I'm creating this as kind of a meta issue, so the process isn't as much in my head. I think we're in a fairly good state right now. I just upgraded a project from Capybara 1.1.4 to 2.1 as an exercise and it worked pretty well, only a few failures, all of which could be fixed easily by using the new `:match` option.

I want to release a beta in the next couple of days. I really want to get #982 fixed for the final release, but maybe we can release the beta before it is finished?
## Beta

In a couple of days.
- [x] Fix #982?
- [x] Release xpath 2.0.0.beta
- [x] Coordinate with driver authors
- [x] Update history file
- [x] Publish blog post re new features. Draft here: https://gist.github.com/jnicklas/ea03263353d98c6dfae8
- [x] Add post install instruction to gem file, warning of default change?
## RC

Wait two weeks, maybe?
- [x] Make sure capy-webkit and poltergeist have releases available
## Final

One week after RC?
- [x] Release final xpath 2.0.0
## Drivers?

@jonleighton, @jferris, @mhoran, @jcoglan, we have some breaking changes coming in 2.1 as you know from previous discussions. I'd like to coordinate so that we have releases for the drivers as soon as possible. Do you guys have time to work on this in the coming weeks? Is there anything I can do to help?
",jnicklas,jcoglan
984,2013-02-28 15:49:06,"I'm creating this as kind of a meta issue, so the process isn't as much in my head. I think we're in a fairly good state right now. I just upgraded a project from Capybara 1.1.4 to 2.1 as an exercise and it worked pretty well, only a few failures, all of which could be fixed easily by using the new `:match` option.

I want to release a beta in the next couple of days. I really want to get #982 fixed for the final release, but maybe we can release the beta before it is finished?
## Beta

In a couple of days.
- [x] Fix #982?
- [x] Release xpath 2.0.0.beta
- [x] Coordinate with driver authors
- [x] Update history file
- [x] Publish blog post re new features. Draft here: https://gist.github.com/jnicklas/ea03263353d98c6dfae8
- [x] Add post install instruction to gem file, warning of default change?
## RC

Wait two weeks, maybe?
- [x] Make sure capy-webkit and poltergeist have releases available
## Final

One week after RC?
- [x] Release final xpath 2.0.0
## Drivers?

@jonleighton, @jferris, @mhoran, @jcoglan, we have some breaking changes coming in 2.1 as you know from previous discussions. I'd like to coordinate so that we have releases for the drivers as soon as possible. Do you guys have time to work on this in the coming weeks? Is there anything I can do to help?
",jnicklas,jonleighton
984,2013-02-28 15:49:06,"I'm creating this as kind of a meta issue, so the process isn't as much in my head. I think we're in a fairly good state right now. I just upgraded a project from Capybara 1.1.4 to 2.1 as an exercise and it worked pretty well, only a few failures, all of which could be fixed easily by using the new `:match` option.

I want to release a beta in the next couple of days. I really want to get #982 fixed for the final release, but maybe we can release the beta before it is finished?
## Beta

In a couple of days.
- [x] Fix #982?
- [x] Release xpath 2.0.0.beta
- [x] Coordinate with driver authors
- [x] Update history file
- [x] Publish blog post re new features. Draft here: https://gist.github.com/jnicklas/ea03263353d98c6dfae8
- [x] Add post install instruction to gem file, warning of default change?
## RC

Wait two weeks, maybe?
- [x] Make sure capy-webkit and poltergeist have releases available
## Final

One week after RC?
- [x] Release final xpath 2.0.0
## Drivers?

@jonleighton, @jferris, @mhoran, @jcoglan, we have some breaking changes coming in 2.1 as you know from previous discussions. I'd like to coordinate so that we have releases for the drivers as soon as possible. Do you guys have time to work on this in the coming weeks? Is there anything I can do to help?
",jnicklas,mhoran
984,2013-02-28 16:38:08,"I think @mhoran implemented/merged everything we need:
- `Node#all_text`
- Native CSS
- `#title`
- `Node#hover` (work in progress)

Based on previous discussions and the draft blog post, I think we're covered. Anything we missed?
",jferris,mhoran
979,2013-02-26 07:58:50,"@jnicklas - This PR adds selenium with chrome to the tests - There is one test failure currently   

Failure/Error: expect do
 expected TestApp::TestAppError but nothing was raised
 # ./lib/capybara/spec/session/reset_session_spec.rb:36:in `block (2 levels) in <top (required)>'

This doesnt occur if just the chrome specs are run, or just the firefox, but if both are run the error occurs.  I'm 99% sure this is because of the way Capybara::Server caches and looks up the port for server instances by object_id, meaning that even though I create a separate test session for chrome which creates a server object, that server object doesnt actually get booted (doesnt error either), and instead the tests are hitting the server object created for the firefox session.  This doesnt make any difference for most of the tests except the one failing since it checks the internal error state of the server object it thinks is handling requests, but ends up not. Not sure what the best way to fix that error would be, any suggestions?
",twalpole,jnicklas
976,2013-02-26 00:06:09,"Ping @jonleighton. I'll get this in the pipeline for capybara-webkit. Fortunately we just implemented native click events.
",mhoran,jonleighton
965,2013-02-20 22:35:34,"@abotalov I'm pretty sure it gets reset for every test in Capybara::SpecHelper::reset!  - if I'm wrong about that I'll be happy to store and reset the setting
",twalpole,abotalov
965,2013-02-20 22:40:07,"1. I think specs to `resize_window` and `hover` shouldn't belong to the same group. For example capybara-webkit currently supports `resize_window` but doesn't support hover without executing script (at least at first glance, I haven't used it)
2. @jnicklas If we support set of window size, we should also support get of size. What about alias:
   `window_size=(width, height)`  
   and method:  
   `window_size` returning 2 values: width and height

Also please take a look at [Selenium's Window class](http://selenium.googlecode.com/svn/trunk/docs/api/rb/Selenium/WebDriver/Window.html). Do we need separate class? I think no but want to point it out
",abotalov,jnicklas
961,2013-02-16 21:35:00,"@jnicklas - Seeing issue #923 get closed this morning (request for :invalid pseudo selector support), it made me revisit something I'd been meaning to look at for a while.  Why always convert css to xpath when browsers can handle direct css searches?  This PR is the beginning of work on allowing css selectors to just flow through and be searched for as css, which would allow for css pseudo selectors to be used on browsers that support them.  Currently this code would require drivers to implement a find_css method which is obviously not optimal. I think a better way may be for find to  take a second parameter indicating whether the selector is xpath or css, and a way for the driver to indicate whether it will accept css, but this would break the current driver api.  I've also implemented the :disabled and :enabled pseudo selectors in the RackTest driver as proof that some of the css pseudo selectors can be implemented there (obviously not :invalid).  Your thoughts on how best to implement this, and whether or not you would consider it are appreciated before I finish it up
",twalpole,jnicklas
961,2013-02-17 11:45:53,"I'm not sure. I like the implementation, it's quite unobtrusive. There are a couple of things which should probably be cleaned up, but overall it looks pretty good. I guess we should involve the author driver authors in this discussion as well. Ping @jonleighton, @jcoglan, @jferris, @mhoran.
",jnicklas,jcoglan
961,2013-02-17 11:45:53,"I'm not sure. I like the implementation, it's quite unobtrusive. There are a couple of things which should probably be cleaned up, but overall it looks pretty good. I guess we should involve the author driver authors in this discussion as well. Ping @jonleighton, @jcoglan, @jferris, @mhoran.
",jnicklas,jonleighton
961,2013-02-17 11:45:53,"I'm not sure. I like the implementation, it's quite unobtrusive. There are a couple of things which should probably be cleaned up, but overall it looks pretty good. I guess we should involve the author driver authors in this discussion as well. Ping @jonleighton, @jcoglan, @jferris, @mhoran.
",jnicklas,mhoran
960,2013-02-16 18:18:26,"This is really a question to @jonleighton, @jcoglan and @mhoran mostly, but really anyone who authors capybara drivers.

I want to break the driver API for Capybara 2.1 by introducing a new method `#full_text` on nodes, as opposed to the regular `#text`. This would return the text of the node as it appears in the source, ignoring visibility. The name of this method doesn't really matter as it wouldn't be exposed to regular users, so I'm open to suggestions.

The idea is to have `Capybara::Element#text` take a boolean flag which would control which driver method is called. The default would be to use `Capybara.ignore_hidden_elements`, so that the behaviour matches that of finding elements and can be controlled through a config option. In order to not break semver, we'll include a config option which makes sure that text always returns only visible text, something like `Capybara.only_visible_text = true`.

We're changing some other defaults as well, so I'm not too concerned about breaking compatibility of the public API, but obviously this would break the driver API.

I know @jonleighton was campaigning for this even before 2.0 was released, and I should have listened then. Sorry about that.

Are you guys okay with that breakage?
",jnicklas,mhoran
960,2013-02-16 18:18:26,"This is really a question to @jonleighton, @jcoglan and @mhoran mostly, but really anyone who authors capybara drivers.

I want to break the driver API for Capybara 2.1 by introducing a new method `#full_text` on nodes, as opposed to the regular `#text`. This would return the text of the node as it appears in the source, ignoring visibility. The name of this method doesn't really matter as it wouldn't be exposed to regular users, so I'm open to suggestions.

The idea is to have `Capybara::Element#text` take a boolean flag which would control which driver method is called. The default would be to use `Capybara.ignore_hidden_elements`, so that the behaviour matches that of finding elements and can be controlled through a config option. In order to not break semver, we'll include a config option which makes sure that text always returns only visible text, something like `Capybara.only_visible_text = true`.

We're changing some other defaults as well, so I'm not too concerned about breaking compatibility of the public API, but obviously this would break the driver API.

I know @jonleighton was campaigning for this even before 2.0 was released, and I should have listened then. Sorry about that.

Are you guys okay with that breakage?
",jnicklas,jcoglan
960,2013-02-16 18:18:26,"This is really a question to @jonleighton, @jcoglan and @mhoran mostly, but really anyone who authors capybara drivers.

I want to break the driver API for Capybara 2.1 by introducing a new method `#full_text` on nodes, as opposed to the regular `#text`. This would return the text of the node as it appears in the source, ignoring visibility. The name of this method doesn't really matter as it wouldn't be exposed to regular users, so I'm open to suggestions.

The idea is to have `Capybara::Element#text` take a boolean flag which would control which driver method is called. The default would be to use `Capybara.ignore_hidden_elements`, so that the behaviour matches that of finding elements and can be controlled through a config option. In order to not break semver, we'll include a config option which makes sure that text always returns only visible text, something like `Capybara.only_visible_text = true`.

We're changing some other defaults as well, so I'm not too concerned about breaking compatibility of the public API, but obviously this would break the driver API.

I know @jonleighton was campaigning for this even before 2.0 was released, and I should have listened then. Sorry about that.

Are you guys okay with that breakage?
",jnicklas,jonleighton
955,2013-02-15 21:54:39,"Excellent work from @twalpole on submitting a fix. Can you check and see if the fix works for you?
",jnicklas,twalpole
952,2013-02-05 19:07:59,"@jnicklas Do you think it's worth to change behavior of `text` if it's `<pre>` element where [type of whitespace matters.](http://www.w3.org/TR/html401/struct/text.html#h-9.1)
",abotalov,jnicklas
947,2013-01-29 00:02:50,"Node#all returns.

@jnicklas - As discussed on the [mailing list](https://groups.google.com/forum/?fromgroups=#!topic/ruby-capybara/1JEwsbqJQ8s)
",mdgreenfield,jnicklas
942,2013-01-28 08:53:13,"Heh, I just saw [this exchange](https://github.com/jnicklas/xpath/commit/0bfd283a1147c7d07e6cfc6b1683aa09a489c843#commitcomment-2392254). @jnicklas have you expounded on that new set of tools on the mailing list or anywhere?
",ches,jnicklas
920,2012-12-26 18:05:11,"I have no idea why we are doing that check anyway. @joliss, any ideas?
",jnicklas,joliss
920,2012-12-26 20:03:41,"I'm not sure. It was added by @raggi in ab62b27ae1c3836351a9a08ac9db729ed7e01f25. @raggi, any insights?
",joliss,raggi
911,2013-01-22 07:42:43,"Ah yeah, there's a bunch of issues around Firefox and focus, especially on OSX, but in general this works :) Personally I'm hoping @jnicklas will merge this, and then phantomjs and the like will eventually integrate it, rather than relying on selenium.
",JonRowe,jnicklas
911,2013-03-05 00:37:05,"Seems a bit crazy :) Maybe @jarib has some insight if this is a sane thing to do?
",jnicklas,jarib
873,2012-11-19 12:52:48,"Hi @jnicklas,

What do you think about improving the message of have_field matcher?

Currently we don't have a nice message, take a look:



I know it's not `35,0000`, but what value is?

I was thinking in something like:


",sobrinho,jnicklas
871,2012-11-18 04:09:21,"@jnicklas We could (without any change to the public API behavior) unify the spec to say: `html` (and synonymously `body` and `source`) return the state of the DOM. And in case of RackTest, we do the next most sensible thing and return the original source.

The current differentiation (original source vs. DOM) doesn't really make much sense IMO, since not one driver actually has different behavior for those methods.

Thoughts?
",joliss,jnicklas
871,2012-11-20 13:29:18,"@mhoran, @jferris (and maybe @jonleighton): can you guys take a look at this pull request #877 and see if that solves the problem.
",jnicklas,jonleighton
870,2012-11-18 04:14:09,"Hey @jarib, could you take a look at the OP's bug description please? I'm wondering if there's a faster/cleaner way to fix it than sending repeated `:backspace` keys.
",joliss,jarib
868,2012-11-17 00:33:27,"Thanks for fixing. I don't know what I was thinking when I wrote that code.

@jnicklas, do you want to push out 2.0.1?
",joliss,jnicklas
844,2012-10-07 18:00:51,"Capybara master has a new `has_text?` matcher which excludes invisible content such as `<title>` elements and `display: none` elements.

Its implementation uses the `Node#text` method, so the implication is that the behaviour of `Node#text` has now changed from returning all text to only returning visible text. This presents two problems:
- Users will have trouble upgrading if they are using `Node#text` directly, or `has_content?` (which is now just an alias of `has_text?`)
- There is no API for getting e.g. the text of the `<title>` element. This could be a valid user requirement and was previously supported by the `#text` method.

I propose adding a `#visible_text` method and using that to implement `has_text?`, leaving the implementations of `#text` and `#has_content?` as they are in 1.1. (`#has_content?` can be deprecated but I believe `#text` remains useful for checking e.g. `<title>` text.) WDYT?

Related: #522

cc @mkdynamic
",jonleighton,mkdynamic
832,2013-02-25 19:59:25,"Go, go @twalpole!
",jnicklas,twalpole
823,2012-09-15 12:23:17,"Actually, we have a bunch of flickering tests that are only fixed on master. I'm thinking we should perhaps disable 1.1_stable on Travis again and stick with local running for the 1.1 branch.

@jnicklas, what do you think?
",joliss,jnicklas
823,2012-09-15 12:26:17,"Well.

In that case it might be difficult to ensure that 1.1_stable is actually
... stable. :-)

I think the root cause for these flickering tests should be examined...

Jarl

2012/9/15 Jo Liss notifications@github.com

> Actually, we have a bunch of flickering tests that are only fixed on
> master. I'm thinking we should perhaps disable 1.1_stable on Travis again
> and stick with local running for the 1.1 branch.
> 
> @jnicklas https://github.com/jnicklas, what do you think?
> 
> —
> Reply to this email directly or view it on GitHubhttps://github.com/jnicklas/capybara/pull/823#issuecomment-8584254.

## 

Jarl Friis
Softace ApS
Rådhustorvet 7, 2.
3520 Farum
LinkedIn: http://dk.linkedin.com/in/jarlfriis
",jarl-dk,jnicklas
821,2012-09-15 12:07:52,"On the actual pull request, I'll let @jnicklas handle it. I'm muting; email me if you need me.
",joliss,jnicklas
809,2012-09-07 18:23:55,"Hey @josevalim, @dchelimsky, @sobrinho and anyone else who has had an opinion on this. When applied, this commit changes Capybara to use `:feature` as the type for its own `feature` helper, as well as only including Capybara in those steps with type `:feature`. This follows [José's suggestion](http://blog.plataformatec.com.br/2012/06/improving-the-integration-between-capybara-and-rspec/). I feel that this is a very sensible approach.

Though there is obviously a big issue: It breaks compatibility with rspec, especially with rspec-rails.

I'd like to get this into Capybara 2.0 so that we don't have to break the API post release. Can you guys let me know what you think? Should I just release this and hope for the other tools to catch up as soon as possible?
",jnicklas,josevalim
809,2012-09-07 18:23:55,"Hey @josevalim, @dchelimsky, @sobrinho and anyone else who has had an opinion on this. When applied, this commit changes Capybara to use `:feature` as the type for its own `feature` helper, as well as only including Capybara in those steps with type `:feature`. This follows [José's suggestion](http://blog.plataformatec.com.br/2012/06/improving-the-integration-between-capybara-and-rspec/). I feel that this is a very sensible approach.

Though there is obviously a big issue: It breaks compatibility with rspec, especially with rspec-rails.

I'd like to get this into Capybara 2.0 so that we don't have to break the API post release. Can you guys let me know what you think? Should I just release this and hope for the other tools to catch up as soon as possible?
",jnicklas,sobrinho
809,2012-09-07 18:23:55,"Hey @josevalim, @dchelimsky, @sobrinho and anyone else who has had an opinion on this. When applied, this commit changes Capybara to use `:feature` as the type for its own `feature` helper, as well as only including Capybara in those steps with type `:feature`. This follows [José's suggestion](http://blog.plataformatec.com.br/2012/06/improving-the-integration-between-capybara-and-rspec/). I feel that this is a very sensible approach.

Though there is obviously a big issue: It breaks compatibility with rspec, especially with rspec-rails.

I'd like to get this into Capybara 2.0 so that we don't have to break the API post release. Can you guys let me know what you think? Should I just release this and hope for the other tools to catch up as soon as possible?
",jnicklas,dchelimsky
809,2012-09-07 18:41:51,"@jnicklas The naming convention is a bit tricky. We have `spec/models`, `spec/views`, `spec/helpers`, so I would vote for `spec/features`. But I will leave the final decision for @dchelimsky.

I think adding support for these in rspec-rails will be trivial as well. So rspec-rails should catch up quickly. My $.02. :)
",josevalim,dchelimsky
809,2012-09-09 15:24:57,"BTW - it's less about the release cycle than it is about forcing end-users to upgrade two libs at the same time (and some of them not understanding that that is necessary).

/cc @myronmarston, @alindeman
",dchelimsky,alindeman
809,2012-09-09 15:24:57,"BTW - it's less about the release cycle than it is about forcing end-users to upgrade two libs at the same time (and some of them not understanding that that is necessary).

/cc @myronmarston, @alindeman
",dchelimsky,myronmarston
809,2012-09-12 15:46:55,"I'm OK w/ an rspec-rails release that deals with the directory paths, but it would be good if Capy could check for the rspec version in capybara/rspec.rb (will need to be >= 2.12, but that doesn't exist yet, so you probably want to wait for that release before making this change).

/cc @alindeman
",dchelimsky,alindeman
803,2012-09-03 12:54:36,"Little bit of background: For a touch platform only web app we're building we're using Capybara for acceptance tests, along with a js driver that is touch capable (now poltergeist, before capybara-webkit - basically any recent webkit based driver supporting touch events could be used). We're not using any click interactions at all, thus I needed to make the capybara js driver touch capable.

Here's a pull request I sent to poltergeist
https://github.com/jonleighton/poltergeist/pull/135/files

which contains an initial implementation, so far only for simple, single taps:



e.g.



@jonleighton in response asked me to start a discussion here as to (hopefully) agree on an API that could be implemented by any capable driver.  See https://github.com/jonleighton/poltergeist/issues/141

I had further methods in mind to be implement later, just as a proposal:

single_tap
double_tap
long_tap
swipe_left
swipe_right
swipe_up
swipe_down

(The names follow what Zepto.js provides for touch event abstractions.) There are also gesture events I didn't yet think about.

I'd be glad if we could get a discussion going about this and happily help with the implementation whenever required.

[Edit: swipe_bottom -> swipe_down]
",carhartl,jonleighton
792,2012-08-21 10:14:50,"/cc @jarib - I think we'll need your help here, Jari!

I've been running the Capybara test suite in a loop. I could reproduce the flickering tests with Selenium that we've been seeing on Travis. I tried `rspec --order random:$i`, and it turns out that the flickeringness is not test order dependent but random (i.e. some kind of race condition).

Here is an example failure:



The first offending test is this:



My sense is that it has nothing to do with `within`, which is just a chained `find_elements` as far as I know. The flickering failure happens in other places as well: http://travis-ci.org/#!/jnicklas/capybara/jobs/2020450

I'm thinking perhaps `@session.body` (=> `browser.page_source`) is causing the problem, where other matchers (like `has_content`) would retry repeatedly and smooth over Selenium returning `""""`.

I can't reproduce it with [this gist](https://gist.github.com/3414141), however.

Any ideas?
",joliss,jarib
789,2012-08-14 15:08:36,"Hey @jarib, @ramontayag is having a weird problem where the Selenium bridge seems to lock up for minutes when he calls `all('html')`. Is there something he can do to produce some trace log of the communication between Ruby and Firefox, to figure out where exactly it's going wrong?
",joliss,jarib
777,2012-08-06 21:47:20,"Maybe @jarib can provide some insight here.
",joliss,jarib
771,2012-08-02 11:40:48,"It does seem to make sense that we only ever want to click enabled buttons, to be honest. I don't think we should have a separate `click_enabled_button` action though. I'm torn about this. @joliss, what do you think?
",jnicklas,joliss
764,2012-07-20 14:12:09,"This causes ""file not added for reaping"" errors with Selenium, as the
exit handler is called twice.

Thanks @jarib for tracking this one down!
",joliss,jarib
763,2012-07-19 16:17:11,"Hey @jarib, I remember seeing this `file not added for reaping` error occasionally on Travis, but now it occurs reliably on my system. Can  you reproduce it, or is there anything I can do to debug this?


",joliss,jarib
744,2012-07-08 17:49:15,"I have no opinion on whether this is a good addition to Capybara (perhaps it is), but I'm thinking that regarding the method name, something like `save_screenshot` might be clearer than `render`.

Let's see what @jnicklas has to say.
",joliss,jnicklas
738,2012-06-27 18:50:42,"This is a kind of known limitation in selenium. Selenium will only clear cookies for the current domain. As far as I know there is no way around that. Maybe @jarib knows more.
",jnicklas,jarib
737,2012-06-27 00:08:16,"Hello

Selenium-Webdriver now throws a Selenium::WebDriver::Error::UnhandledAlertError whenever you click on a element that shows an alert or confirm dialog it seems.

In the past I've done things like this as a crude workaround:
  page.evaluate_script('window.confirm = function() { return true; }')

But now I'd like to test that the message being presented to the user matches what I expect (it's not static text).  The ruby bindings doc at [JavaScript_dialogs](http://code.google.com/p/selenium/wiki/RubyBindings#JavaScript_dialogs) say that you can do something like: 



But I'm never able to do something like a click_button() then switch to the alert/confirm after since the exception is thrown.

Perhaps @jarib can shed some light on the preferred method of getting by these dialog exceptions so we can handle the confirm states like in the docs?
",supairish,jarib
735,2012-06-25 19:16:02,"@jarib I've reduced this to a selenium bug [here](http://code.google.com/p/selenium/issues/detail?id=4147)
",paleozogt,jarib
733,2012-06-26 22:27:19,"Mentioning @jarib like @joliss says above as I am seeing the same issue. I see the issue in full rake run. When I setup a breakpoint before the checking the url then the tests pass so that does imply a timing issue. Interesting thing is that after I have once run with a breakpoint the next run succeeds for just that cucumber scenario but I guess such is the life with races.
",betelgeuse,jarib
705,2012-05-13 13:24:49,"@thoferon Right. @jarib, here's a gist that demonstrates that selenium-webdriver returns ""true"" and ""false"" as strings for the 'disabled' attribute: https://gist.github.com/2688447 That seems odd, at least. Would you mind taking a look?

I'm closing this issue, since it's not a Capybara issue, but let's continue discussion here unless/until we have a bug report in the upstream tracker.
",joliss,jarib
705,2012-05-13 16:04:48,"Ah, very well. Hm, I wonder what the RackTest driver does.

In any case, perhaps it would be sensible to tie down the behavior with a test, to ensure that all the drivers are consistent.

I'll reopen and leave this up to @jnicklas.
",joliss,jnicklas
703,2012-05-02 07:08:18,"@yomike05 Awesome, that was exactly what was happening to me! I'm using @josevalim's trick and that fixed it. Thanks a bunch! I'm gonna leave this ticket open for the moment cause I'd like to see mention of this issue in the documentation. I imagine it's quite common given the simplicity of the test that surfaced it for me.
",jimmycuadra,josevalim
702,2012-04-26 11:27:46,"@jarib, OP has an issue with sessions not properly resetting when there's pending Ajax requests, perhaps related to chromedriver. Ring a bell by any chance?
",joliss,jarib
696,2012-04-20 18:55:03,"Very interesting.

I'll go ahead and close this issue, since the behavior is likely either correct, or something that could only be changed in the Selenium upstream.

I wonder if we should start documenting edge cases like this. Perhaps it's time for a Capybara FAQ where we can collect pointers to discussions like this one. @jnicklas, what you think?

> page.execute_script(""$(""#p_doctor_tabs"").tabs('select', 2);"")
> That does not switch tabs.

This isn't valid Ruby code because of the quotes. Assuming you have single quotes, if it still doesn't work, there's perhaps something going wrong on the JS side. You could debug this by poking into the browser, perhaps with capybara-firebug. The error reporting with execute_script/evaluate_script is bad to non-existent, unfortunately. I'd recommend using execute_script very sparingly, if at all.
",joliss,jnicklas
690,2012-06-13 00:30:26,"Let's cc @jarib then. Jari, does this ring a bell at all?
",joliss,jarib
687,2012-05-18 09:15:05,"@jnicklas any outlook when this will be released?
",exviva,jnicklas
686,2013-02-24 17:30:42,"I honestly didn't think this would ever get fixed. Thanks @twalpole!
",jnicklas,twalpole
686,2013-02-27 10:07:27,"@fy-kenny please review what's previously been said in this issue, and take a look at @twalpole. If you're still having problems, please write something more coherent. I can't make any sense out of what you've written.
",jnicklas,twalpole
685,2012-07-13 13:25:22,"There were a couple of things I didn't like too much about this pull request, so I went ahead and rewrote it. I disagree with @exviva, that the port needs to update between `new` and `boot`. I think setting `Capybara.server_port` as the default is fine. The implementation was also overly complex, in my opinion, adding a lot of cruft for an essentially simple change.
",jnicklas,exviva
668,2012-03-16 20:02:13,"(An evolution of #667).

This solves the long standing issue of not being able to know what went wrong with a request that failed.

Consider this a solution for issues #629 and #508.

Thanks to @raggi (#660) for the inspiration.
",djanowski,raggi
668,2012-04-02 16:27:32,"@raggi: Just changed this a little bit, so now:
- It doesn't use `abort_on_exception`.
- It doesn't let the server die.
- It raises the exception on the correct thread, so can be used outside of `Thread.main`.

What do you think now?

@jnicklas: This is an alternative solution that doesn't require to actively check for errors.
",djanowski,jnicklas
667,2012-03-16 19:44:20,"Summoning @raggi since this is an alternative implementation of #660.
",djanowski,raggi
647,2012-02-19 21:39:09,"@jnicklas - I don't know the policy behind closing a pull request (which I now believe means ""reject"" irrevocably), so please manually merge the commit or comment the patch.

I've created too many pull requests for this issue already to add more noise.
",e2,jnicklas
647,2012-02-19 23:51:19,"(Reopening is no problem, actually -- I just reopened it for you. GitHub is just annoyingly restrictive about who gets to do that.)

I'm actually not sure though that having those kinds of conditionals is good practice. I think we _can_ if we have to, but I'd argue that it shouldn't be deprecated for this exact reason (that is, other libraries like Capybara having to do hacky conditionals).

Hm, I just noticed that Cucumber 1.1.8 re-added the deprecation warnings. :(

I think they're totally pointless -- it would be better to just remove it without warning in 2.0.0, since the warnings nag people who can't do anything about it (i.e. Cucumber users).

Oh well. Cc @aslakhellesoy in case he changes his mind.

Let's wait and see. Or maybe Jonas has an opinion.
",joliss,aslakhellesoy
644,2012-02-18 12:16:15,"Cc: @aslakhellesoy

Wait, how come stuff is breaking for us at a patch-level release? Is source_tags not part of Cucumber's public API? Should we be using something different?
",joliss,aslakhellesoy
642,2012-06-19 19:41:42,"@jnicklas would you accept a pull request with this functionality?
",sobrinho,jnicklas
628,2012-02-02 09:57:27,"/cc @jnicklas 

Thanks -- I've merged this. (If we find that it's over-eager with our development dependencies, we can always change or remove it later, I guess.)

And thanks for building Gemnasium, @laserlemon! :-)
",joliss,jnicklas
620,2012-03-27 19:05:04,"I've been meaning to cc @jarib for a while. Jari, do you have any idea?
",joliss,jarib
614,2012-01-12 17:31:23,"Some drivers (like WebKit) apparently do this. Suggested by
@jonleighton in #611.
",joliss,jonleighton
613,2012-01-12 17:49:47,"@joliss any chance you can merge this one too? then poltergeist will be green against caypbara master :) thanks
",jonleighton,joliss
609,2012-02-08 09:50:48,"Let's cc him: @jnicklas, care to take a look?
",joliss,jnicklas
606,2012-01-20 12:47:41,"@jnicklas 

I'm starting to think that this is actually not the right way to do it.

I've repushed a better fix with a cleaned up (shorter) implementation of referer handling. Instead of always sending referers and special-casing visits and redirects, we now explicitly send a referer along with links (follow) and form submissions (submit), like a real browser.

I've also added a test so we now cover everything (visit, link, redirect, submit).

See if you like it! :)
",joliss,jnicklas
606,2012-02-01 00:12:18,"@jnicklas I'm pretty confident that the repushed code is good. Mind if I self-merge?
",joliss,jnicklas
597,2012-01-08 12:28:13,"Hi there!

This is a duplicate of issue https://github.com/jnicklas/capybara/issues/570 , but I am attaching a failing spec and I'll try to explain why I think this is a real issue.

I've attached a failing spec here: https://gist.github.com/1578175

In that issue, @jnicklas closes the issue telling that browsers won't bother about that.

The problem is that because of Nokogiri (or Capybara interacting with it, i am not sure where is the real problem) inserts that xml declaration, Capybara parsing breaks and some of my specs are failing.

Every spec where we test that we have some content, and this content contains accented characters (áéíóú), or where we test that we have a html tag (for example, <iframe></iframe>) that with the xml declaration get converted to <iframe />.

The attached spec works  properly in my laptop (capybara 1.1.1, nokogiri 1.5.0, rack 1.2,5, rack-test 0.5.7, ruby 1.9.2p180), but fails in my CI server (same version of every gem, ruby, etc, only difference is that is a 64 bit machine).

I'll try to find the problem.
",gaizka,jnicklas
591,2012-01-04 18:27:50,"/cc @jarib

Sometimes (very rarely), running the Capybara test suite yields failures with a weird ""docElement is null"" error message.
On my system (MRI 1.9.2 I'm pretty sure): https://gist.github.com/1560935
Or Travis: http://travis-ci.org/#!/jnicklas/capybara/jobs/475145

The offending test code is here: https://github.com/jnicklas/capybara/blob/master/lib/capybara/spec/session/within_spec.rb#L22 ff.

Any ideas as to what might be going on?
",joliss,jarib
591,2012-01-04 19:36:18,"I have no idea what that error even means. Haven't ever seen it locally on my machine either, which is strange. Maybe @jarib knows? Sorry for linking you in all the time Jari, I'll buy you a beer to make up for it next time we meet ;) At least we know that it's not completely random, since it seems to be failing with the same spec.
",jnicklas,jarib
589,2012-01-03 20:29:23,"/cc @madadam

Quoting my commit message in c444d336:

> Remove broken tests for server_boot_timeout
> 
> When they were added in 09d6335, responsive? already only hit `/__identify__`, which does not hit the server, but gets special-cased in Capybara's Identify server class (and runs instantly). 
> 
> So it's not clear what constitutes a ""slow"" server that might time out at boot, and thus why server_boot_timeout needs to be configurable. A server that is slow to respond to HTTP requests would not trigger the boot timeout. All we really seem to be waiting for within the timeout window is for Thin or WEBrick to come up.

It's not clear to me at this point that this was ever a useful option. Should we perhaps remove it for Capybara 2.0? If it comes up for anyone, we can re-add it in 2.x, this time with proper tests to show why it's needed.
",joliss,madadam
577,2011-12-20 23:49:25,"As suggested by @mcmire and @gorn in #483.

---

(Just updated this for a more extensive rewrite of the RSpec section.)

I went through it sentence by sentence and found that none of all those details really added anything. So now we're left with two short paragraphs.

You like?
",joliss,mcmire
564,2011-12-10 00:17:18,"Okay, this is working good so far, but there's a couple of issues:
1. How about cross-driver compatibility? Any opinions, @jnicklas? (Perhaps this relies too much on Selenium features?)
2. It would need documentation, I think. Probably tests as well.
3. As it is you'd have to use .native, like so: `page.execute_script('... arguments ...', el.native)` That seems awkward. We'd probably have to auto-convert nodes into native objects.
",joliss,jnicklas
564,2011-12-30 16:22:00,"/cc @jnicklas 

I think as it is, this is not mergeable, so I'll go ahead and close this for now. If you repush new code, just leave a comment and we can reopen it. :)
",joliss,jnicklas
554,2012-01-03 13:06:10,"Very strange, why would these behave differently?

@jarib: is it not possible to clear date and time fields?
",jnicklas,jarib
541,2011-11-15 14:47:03,"Getting the same error when I run the Capybara test suite. @jarib, any insight on this?
",jnicklas,jarib
539,2011-11-09 19:26:54,"This might be a problem with Selenium or selenium-webdriver, I think. Cc @jarib. :)
",joliss,jarib
525,2012-01-09 11:14:09,"@jnicklas apologies about that. I'm pretty sure RSpec's doco is not the only source of confusion here, but we didn't help matters by posting an incorrect example in the RDoc. The doc error is fixed (thanks to @jwow313), but won't be reflected on rubydoc.info until the next rspec-rails release.
",dchelimsky,jnicklas
516,2011-10-05 19:24:37,"Hey @jnicklas!

In order to run Selenium via Capybara on my virtual machine running IE (kill me), you need to be able to bind the server IP to a net interface on the same subnet as the VM.

This patch exposes an configuration variable to allow you to bind the test server to any net interface on your local machine.

It falls back to 127.0.0.1 if the config var is not set.

Thanks!
",dbalatero,jnicklas
511,2011-09-28 18:24:32,"Hey @jnicklas,

I have two inputs on my form, ""Nome da Fórmula"" and ""Fórmula"".

My scenario is like this:



But the second line is filling ""Nome da Fórmula"" instead of ""Fórmula"".

I guess we should check first for label using full match and after the partial match.

Something like: ""label[equals(., ""Fórmula"") | contains(., ""Fórmula"")]"".

I don't know the XPath language, so is not exactly that.

What you think?
",sobrinho,jnicklas
483,2011-12-21 00:29:38,"@gorn wrote:

> I use RoR and I somewhat did not pay attention that the README is NOT only for Rails so I did not even seeked for RoR section ;-)

Actually, I think a lot of people get tripped up by this and forget to
include 'capybara/rails'.

@jnicklas, back when you added rails.rb, was there something that
stopped you from autodetecting Rails (like `defined? Rails.version`)?

I'm thinking that we could require capybara/rails.rb at load-time for
Capybara, and wrap it in an `if defined? Rails.version` block.

One thing we'd have to deal with is deferring these lines in rails.rb
until the Rails app has been loaded, or Rails.root won't be defined:


",joliss,jnicklas
481,2011-09-03 18:22:25,"I'm starting to dig into failure_messages now, specifically understanding the difference between how they are treated in HaveSelector versus HaveMatcher. It appears the direction I'm moving in is a bit at odds with 70c4f196, but I don't really understand the intent of that commit. Seems to me if everything is a selector, there is no need for two matcher classes, and the selector can be responsible for providing a meaningful failure_message.

@jnicklas - Can you help me understand the intent of that commit so I don't stray too far in a direction you've already chosen to avoid?
",adamlogic,jnicklas
477,2011-09-01 17:35:16,"[Cc @jarib; see GitHub for the original report.]

It does make sense, though what you describe seems to be a problem with Selenium, not Capybara. Capybara just forwards the call:



I'll close this issue, but perhaps either of you want to bump this problem upstream to Selenium (if it's not a known bug already).
",joliss,jarib
461,2011-08-19 01:52:44,"Closes issue #452. #using_driver now restores the driver to what it was before the block rather than default_driver.

Please let me know if there are any improvements I can make to this patch.

I use capybara in my work and personal projects every single day, and I'm really thankful for all the work that @jnicklas and other maintainers have done. Please consider this a very tiny token of my appreciation!
",carols10cents,jnicklas
460,2011-08-19 06:32:11,"This dependency has been confirmed and encouraged by @jarib, btw.
",jnicklas,jarib
448,2011-08-12 11:29:19,"Hmm, not sure if this is something that Capybara is doing wrong, sounds more like a Selenium issue.

This code was recently changed in Capybara due to deprecations in Selenium. It now looks like this: https://github.com/jnicklas/capybara/blob/master/lib/capybara/selenium/node.rb#L33-35. @jarib, does that seem correct?
",jnicklas,jarib
436,2011-07-29 23:13:30,"Wait, actually `bundle update` won't pull webdriver 2.2, since we were specifying `~> 2.0.0`. So I guess it _is_ reasonable to bump the dependency to the newest release. I just merged this pull request.

@jarib, should Capybara be using `~> 2.0` instead? How likely do you think is the API to break in backwards-incompatible ways between minor release in the 2.x branch?
",joliss,jarib
432,2011-11-10 04:32:54,"I'll close this for inactivity -- feel free to reopen of course, if you have any insights on what's causing the test to fail.

/cc @jnicklas
",joliss,jnicklas
430,2011-07-22 11:28:44,"After looking into this some more, I think this problem is related to this rack-test pull request: **[Subdomain / Host awareness](https://github.com/brynary/rack-test/pull/23)** _(which was denied, stating that this should be solved by Capybara instead of rack-test)_. I also now believe this is 100% related to the above mentioned issue #376.

I wonder if this has been addressed already, I haven't found anything in the commits so far, and I still haven't found a sure-fire way of solving this issue without changing all path's to url's in the views.

**edit**
I can solve it by using `Capybara.default_host = ""mydomain.dev""` each time I need Capybara to use a different domain, but I still don't see why it wouldn't be better to simply use the host of the current page when a relative path is clicked.

For now I solved it by adding this to my `env.rb`:



I won't close this just yet, like to know what @jnicklas thinks of this.
",JeanMertz,jnicklas
425,2011-07-21 11:08:38,"Hm, seems a little peculiar on selenium-webdriver's side, though not obviously wrong. Before we go fixing the Capybara code, let's have @jarib weigh in. What do you think, Jari?
",joliss,jarib
408,2012-01-08 23:02:28,"/cc @jnicklas 

> I have a script that [demos the problem](https://gist.github.com/1076062/870eae0eafcd0401adac65b36025e71193bbc7c9)

This is printing ""yay, it worked"" with Capybara 1.1.2, selenium-webdriver 2.16.0, and Firefox 8.0.

So I'm assuming that whatever/wherever the problem was, it has been fixed in the meantime. If anyone is still seeing issues with iframes, please leave a comment (or even better, post a failing test) and I'll reopen this.
",joliss,jnicklas
406,2011-07-11 13:53:07,"Tested and merged -- thanks! :)

@jnicklas, FYI, this just bumped the webdriver dependency from ~> 0.2.2 to ~> 2.0.0 (the gem for the official Selenium 2.0 release).
",joliss,jnicklas
401,2011-07-08 13:05:00,"*bugs @brynary* ;-)
",joliss,brynary
396,2011-06-29 11:21:50,"Nice catch! Indeed this seems to be because Rack::Test calls .to_i on empty maxlength attributes.



HTML4 says maxlength must be number:
http://www.w3.org/TR/html401/interact/forms.html#adef-maxlength
HTML5 says it must be positive number:
http://www.w3.org/TR/html-markup/input.text.html#input.text.attrs.maxlength

@jnicklas, should we ignore maxlength=""""? Even if it doesn't conform, I would expect that ignoring it is what most UAs do. But I guess maxlength=""0"" should still be honored, even though it's not valid HTML5 (and perhaps not sensible)?
",joliss,jnicklas
394,2011-07-25 21:59:33,"> Even if page.body is the wrong thing to use in this case, that doesn't change the fact that the value of page.body itself is still wrong. What is actually returned as the HTTP body of the page (a JSON string) is not what Capybara is reporting (a JSON string wrapped in an HTML document).

page.body is somewhat misnamed -- its purpose is not to return the HTTP body (as you write, and as one might expect), but to return the browser's current DOM tree.

(It's aliased to page.html for exactly that reason, but I seem to recall that actually renaming the method to #html and phasing out #body would be difficult, as all drivers would have to rename it at the same time, so we'd be breaking a lot of compatibility. Unless @jnicklas has a good idea how to rename it in a more painless fashion.)
",joliss,jnicklas
384,2011-07-22 22:11:32,"[Cc @dchelimsky. Some context: @contentfree was trying to mix Capybara and ActionController::TestCase methods like so:]



---

Re @contentfree: Oh, that's a controller test -- now I see.

I think the reason why it doesn't work is that `within` is part of Capybara, whereas `response` is part of ActionController::TestCase. (That's two completely separate testing systems: Capybara exercises the entire stack, and ActionController::TestCase only calls the controller.) As a result, `within` uses Capybara's current `page` to find and set a new scope, which is then used by the methods in Capybara's DSL (unless you call them on specific nodes). But `response` does not care about Capybara's scope.

@dchelimsky, should rspec-rails really include the Capybara::DSL in :controller specs? What was the reason behind that? I'm wondering (in a _just putting the thought out there without a technical clue_ kind of way) if rspec-rails should rather include some subset (or nothing at all) for :controller specs to avoid confusion like this.
",joliss,dchelimsky
377,2012-01-08 22:54:09,"/cc @jnicklas

Hm ... Pull request #490 (""Debug mode"") didn't yield any results. I'll go ahead and close this until we have some more specific ideas (or preferably, code) to work with.
",joliss,jnicklas
368,2011-06-02 14:54:57,"Oh, and to get @dchelimsky involved, we should mention him.

Oh wait, I just did. :)
",steveklabnik,dchelimsky
360,2011-05-26 18:24:42,"Ahh man, THANK you. I never would have seen that. @jnicklas would you be interested in a patch where stupid people like me who mistakingly mix rspec and capybara methods get a warning raised? Something like ""if this result is nil, make sure they didn't use get instead of visit?""
",jackdempsey,jnicklas
347,2011-05-13 15:28:33,"@jnicklas I wonder if this is going to make the test suite brittle?
",joliss,jnicklas
340,2011-05-10 13:42:18,"I was just trying to figure out where to add tests within the Capybara
test suite, but grepping the source does not yield any tests that
specifically test `to_binary`.

@jnicklas, what do you think?
",joliss,jnicklas
331,2011-06-26 13:29:02,"@jnicklas closed the pull request [citing](https://github.com/jnicklas/capybara/pull/395#issuecomment-1440456): ""this problem need a way more comprehensive approach"". What is meant by this? Is a rewrite of error reporting in Capybara::Node::Finders required?
",vrish88,jnicklas
330,2011-04-23 11:04:41,"Regardless of the setup of your app and static files, `page.has_content?(""My custom test content"")` only ever returns true or false (which then gets discarded the way you are using it), so it does not do anything.  You need to use RSpec's [predicate matchers](http://relishapp.com/rspec/rspec-expectations/v/2-6-rc/dir/built-in-matchers/predicate-matchers) with `should` in order to actually test anything.

In other words, so long as `visit ""/""` succeeds, the test is guaranteed to pass.

I am closing this (cc @jnicklas).  If I misunderstood you, feel free to reopen it. :)
",joliss,jnicklas
325,2011-04-14 13:09:02,"Cc @jnicklas

I think the 'rspec-rails' gem it the culprit. As of the edge version from github:



I wonder how it will be possible to make rspec-rails work with both 0.4.1.2 and newer versions of Capybara at the same time.
",joliss,jnicklas
322,2011-04-13 14:37:40,"Does this work for you (for test_helper.rb)?



(@jnicklas, I don't know about your Test::Unit fu, but do you think this is a good way to do it?)
",joliss,jnicklas
320,2011-04-10 17:16:30,"Hello, I updated my tests to the current branch and I was facing with some i18n issues. In older releases, I was setting up my tests with:

page.driver.header 'Accept-Language', 'pt-br'

Now I saw that header was removed from this branch, according to driver.rb file. Then I had to code a little workaround, based on @aslakhellesoy code:

 def set_headers(headers)
    driver = Capybara.current_session.driver.browser 
    def driver.env
      @env.merge(super)
    end
    def driver.env=(env)
      @env = env
    end
    driver.env = headers
  end

Does exist any implementation in capybara to easily setup http headers that I could help?
",abstractj,aslakhellesoy
319,2011-04-08 18:45:11,"Nice catch, thanks! Merged (and while we're at it, changed ""locator"" to ""value"" so as to have the docs consistent with the method signature).

@jnicklas Closing.  Would you like me to ping you like this whenever I close a pull request?
",joliss,jnicklas
178,2011-09-25 21:01:02,"I'm late to the game, but the problem boils down to this - a begin/rescue inside the at_exit resets $! from SystemExit to nil. ChildProcess doesn't mess with the process' exit codes, but it does have inevitable begin/rescue blocks as part of reliably killing the child.



1.8.7 gets it right (IMHO):



But even after @sunaku's [issue](http://redmine.ruby-lang.org/issues/show/4400) fixed at_exit ordering, the begin/rescue issue is still in 1.9.3:



Rubinius gets it right:



As does JRuby:



This is a nasty one for sure. I'm tempted to file it as a bug in 1.9.

cc: @dchelimsky, @paneq
",jarib,dchelimsky
151,2012-01-08 22:37:23,"/cc @jnicklas 

I'll go ahead close this feature request, since there hasn't been any activity for more than a year. ;-)
",joliss,jnicklas
